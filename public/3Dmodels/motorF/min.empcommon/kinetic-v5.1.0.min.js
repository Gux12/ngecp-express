/*
 MPL v1.1 [http://www.pixastic.com/lib/license.txt]
*/
var Kinetic={};(function(c){var a=Math.PI/180;Kinetic={version:"5.1.0",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:0,angleDeg:!0,UA:function(){var a=c.navigator&&c.navigator.userAgent||"",b=a.toLowerCase(),b=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||0>b.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[],a=!!a.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);return{browser:b[1]||"",version:b[2]||"0",mobile:a}}(),Filters:{},Node:function(a){this._init(a)},Shape:function(a){this.__init(a)},Container:function(a){this.__init(a)},Stage:function(a){this.___init(a)},BaseLayer:function(a){this.___init(a)},Layer:function(a){this.____init(a)},FastLayer:function(a){this.____init(a)},Group:function(a){this.___init(a)},isDragging:function(){var a=Kinetic.DD;return a?a.isDragging:!1},isDragReady:function(){var a=Kinetic.DD;return a?!!a.node:!1},_addId:function(a,b){void 0!==b&&(this.ids[b]=a)},_removeId:function(a){void 0!==a&&delete this.ids[a]},_addName:function(a,b){void 0!==b&&(void 0===this.names[b]&&(this.names[b]=[]),this.names[b].push(a))},_removeName:function(a,b){if(void 0!==a){var f=this.names[a];if(void 0!==f){for(var e=0;e<f.length;e++)f[e]._id===b&&f.splice(e,1);0===f.length&&delete this.names[a]}}},getAngle:function(d){return this.angleDeg?d*a:d}}})(this);(function(c,a){if("object"===typeof exports){var d=require("canvas"),b=require("jsdom").jsdom,b=b("\x3c!DOCTYPE html\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3e\x3c/body\x3e\x3c/html\x3e");a=a();Kinetic.document=b;Kinetic.window=Kinetic.document.createWindow();Kinetic.window.Image=d.Image;Kinetic.root=c;Kinetic._nodeCanvas=d;module.exports=a}else"function"===typeof define&&define.amd&&define(a),Kinetic.document=document,Kinetic.window=window,Kinetic.root=c})((0,eval)("this"),function(){return Kinetic});(function(){Kinetic.Collection=function(){var b=[].slice.call(arguments),a=b.length,d=0;for(this.length=a;d<a;d++)this[d]=b[d];return this};Kinetic.Collection.prototype=[];Kinetic.Collection.prototype.each=function(b){for(var a=0;a<this.length;a++)b(this[a],a)};Kinetic.Collection.prototype.toArray=function(){var b=[],a=this.length,d;for(d=0;d<a;d++)b.push(this[d]);return b};Kinetic.Collection.toCollection=function(b){var a=new Kinetic.Collection,d=b.length,c;for(c=0;c<d;c++)a.push(b[c]);return a};Kinetic.Collection._mapMethod=function(b){Kinetic.Collection.prototype[b]=function(){var a=this.length,d,c=[].slice.call(arguments);for(d=0;d<a;d++)this[d][b].apply(this[d],c);return this}};Kinetic.Collection.mapMethods=function(b){b=b.prototype;for(var a in b)Kinetic.Collection._mapMethod(a)};Kinetic.Transform=function(b){this.m=b&&b.slice()||[1,0,0,1,0,0]};Kinetic.Transform.prototype={copy:function(){return new Kinetic.Transform(this.m)},point:function(b){var a=this.m;return{x:a[0]*b.x+a[2]*b.y+a[4],y:a[1]*b.x+a[3]*b.y+a[5]}},translate:function(b,a){this.m[4]+=this.m[0]*b+this.m[2]*a;this.m[5]+=this.m[1]*b+this.m[3]*a;return this},scale:function(b,a){this.m[0]*=b;this.m[1]*=b;this.m[2]*=a;this.m[3]*=a;return this},rotate:function(b){var a=Math.cos(b);b=Math.sin(b);var d=this.m[1]*a+this.m[3]*b,c=this.m[0]*-b+this.m[2]*a,l=this.m[1]*-b+this.m[3]*a;this.m[0]=this.m[0]*a+this.m[2]*b;this.m[1]=d;this.m[2]=c;this.m[3]=l;return this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(b,a){var d=this.m[1]+this.m[3]*a,c=this.m[2]+this.m[0]*b;b=this.m[3]+this.m[1]*b;this.m[0]+=this.m[2]*a;this.m[1]=d;this.m[2]=c;this.m[3]=b;return this},multiply:function(b){var a=this.m[1]*b.m[0]+this.m[3]*b.m[1],d=this.m[0]*b.m[2]+this.m[2]*b.m[3],c=this.m[1]*b.m[2]+this.m[3]*b.m[3],l=this.m[0]*b.m[4]+this.m[2]*b.m[5]+this.m[4],k=this.m[1]*b.m[4]+this.m[3]*b.m[5]+this.m[5];this.m[0]=this.m[0]*b.m[0]+this.m[2]*b.m[1];this.m[1]=a;this.m[2]=d;this.m[3]=c;this.m[4]=l;this.m[5]=k;return this},invert:function(){var b=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),a=-this.m[1]*b,d=-this.m[2]*b,c=this.m[0]*b,l=b*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),k=b*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*b;this.m[1]=a;this.m[2]=d;this.m[3]=c;this.m[4]=l;this.m[5]=k;return this},getMatrix:function(){return this.m},setAbsolutePosition:function(b,a){var d=this.m[0],c=this.m[1],l=this.m[2],k=this.m[4];a=(d*(a-this.m[5])-c*(b-k))/(d*this.m[3]-c*l);return this.translate((b-k-l*a)/d,a)}};var c=Math.PI/180,a=180/Math.PI,d={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},b=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(b){return!(!b||1!=b.nodeType)},_isFunction:function(b){return!!(b&&b.constructor&&b.call&&b.apply)},_isObject:function(b){return!!b&&b.constructor==Object},_isArray:function(b){return"[object Array]"==Object.prototype.toString.call(b)},_isNumber:function(b){return"[object Number]"==Object.prototype.toString.call(b)},_isString:function(b){return"[object String]"==Object.prototype.toString.call(b)},_throttle:function(b,a,d){var c,l,k,m=null,n=0;d||(d={});var r=function(){n=!1===d.leading?0:(new Date).getTime();m=null;k=b.apply(c,l);c=l=null};return function(){var p=(new Date).getTime();n||!1!==d.leading||(n=p);var q=a-(p-n);c=this;l=arguments;0>=q?(clearTimeout(m),m=null,n=p,k=b.apply(c,l),c=l=null):m||!1===d.trailing||(m=setTimeout(r,q));return k}},_hasMethods:function(b){var a=[],d;for(d in b)this._isFunction(b[d])&&a.push(d);return 0<a.length},createCanvasElement:function(){var b=Kinetic.document.createElement("canvas");b.style=b.style||{};return b},isBrowser:function(){return"object"!==typeof exports},_isInDocument:function(b){for(;b=b.parentNode;)if(b==Kinetic.document)return!0;return!1},_simplifyArray:function(b){var a=[],d=b.length,c=Kinetic.Util,l,k;for(l=0;l<d;l++)k=b[l],c._isNumber(k)?k=Math.round(1E3*k)/1E3:c._isString(k)||(k=k.toString()),a.push(k);return a},_getImage:function(b,a){var d,c;b?this._isElement(b)?a(b):this._isString(b)?(d=new Kinetic.window.Image,d.onload=function(){a(d)},d.src=b):b.data?(c=Kinetic.Util.createCanvasElement(),c.width=b.width,c.height=b.height,c.getContext("2d").putImageData(b,0,0),this._getImage(c.toDataURL(),a)):a(null):a(null)},_getRGBAString:function(b){return["rgba(",b.red||0,",",b.green||0,",",b.blue||0,",",b.alpha||1,")"].join("")},_rgbToHex:function(b,a,d){return(16777216+(b<<16)+(a<<8)+d).toString(16).slice(1)},_hexToRgb:function(b){b=b.replace("#","");b=parseInt(b,16);return{r:b>>16&255,g:b>>8&255,b:b&255}},getRandomColor:function(){for(var b=(16777215*Math.random()<<0).toString(16);6>b.length;)b="0"+b;return"#"+b},get:function(b,a){return void 0===b?a:b},getRGB:function(a){return a in d?(a=d[a],{r:a[0],g:a[1],b:a[2]}):"#"===a[0]?this._hexToRgb(a.substring(1)):"rgb("===a.substr(0,4)?(a=b.exec(a.replace(/ /g,"")),{r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}):{r:0,g:0,b:0}},_merge:function(b,a){a=this._clone(a);for(var d in b)this._isObject(b[d])?a[d]=this._merge(b[d],a[d]):a[d]=b[d];return a},cloneObject:function(b){var a={},d;for(d in b)this._isObject(b[d])?a[d]=this.cloneObject(b[d]):this._isArray(b[d])?a[d]=this.cloneArray(b[d]):a[d]=b[d];return a},cloneArray:function(b){return b.slice(0)},_degToRad:function(b){return b*c},_radToDeg:function(b){return b*a},_capitalize:function(b){return b.charAt(0).toUpperCase()+b.slice(1)},error:function(b){throw Error("Kinetic error: "+b);},warn:function(b){Kinetic.root.console&&console.warn&&console.warn("Kinetic warning: "+b)},extend:function(b,a){for(var d in a.prototype)d in b.prototype||(b.prototype[d]=a.prototype[d])},addMethods:function(b,a){for(var d in a)b.prototype[d]=a[d]},_getControlPoints:function(b,a,d,c,l,k,m){var n=Math.sqrt(Math.pow(d-b,2)+Math.pow(c-a,2)),r=Math.sqrt(Math.pow(l-d,2)+Math.pow(k-c,2)),p=m*n/(n+r);m=m*r/(n+r);return[d-p*(l-b),c-p*(k-a),d+m*(l-b),c+m*(k-a)]},_expandPoints:function(b,a){var d=b.length,c=[],l,k;for(l=2;l<d-2;l+=2)k=Kinetic.Util._getControlPoints(b[l-2],b[l-1],b[l],b[l+1],b[l+2],b[l+3],a),c.push(k[0]),c.push(k[1]),c.push(b[l]),c.push(b[l+1]),c.push(k[2]),c.push(k[3]);return c},_removeLastLetter:function(b){return b.substring(0,b.length-1)}}})();(function(){var c=Kinetic.Util.createCanvasElement().getContext("2d"),a=Kinetic.UA.mobile?(window.devicePixelRatio||1)/(c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1):1;Kinetic.Canvas=function(a){this.init(a)};Kinetic.Canvas.prototype={init:function(d){d=d||{};this.pixelRatio=d.pixelRatio||Kinetic.pixelRatio||a;this._canvas=Kinetic.Util.createCanvasElement();this._canvas.style.padding=0;this._canvas.style.margin=0;this._canvas.style.border=0;this._canvas.style.background="transparent";this._canvas.style.position="absolute";this._canvas.style.top=0;this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a;this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio;this._canvas.style.width=a+"px"},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio;this._canvas.style.height=a+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,b){this.setWidth(a);this.setHeight(b)},toDataURL:function(a,b){try{return this._canvas.toDataURL(a,b)}catch(f){try{return this._canvas.toDataURL()}catch(e){return Kinetic.Util.warn("Unable to get data URL. "+e.message),""}}}};Kinetic.SceneCanvas=function(a){a=a||{};var b=a.width||0,f=a.height||0;Kinetic.Canvas.call(this,a);this.context=new Kinetic.SceneContext(this);this.setSize(b,f)};Kinetic.SceneCanvas.prototype={setWidth:function(a){var b=this.pixelRatio,f=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,a);f.scale(b,b)},setHeight:function(a){var b=this.pixelRatio,f=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,a);f.scale(b,b)}};Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas);Kinetic.HitCanvas=function(a){a=a||{};var b=a.width||0,f=a.height||0;Kinetic.Canvas.call(this,a);this.context=new Kinetic.HitContext(this);this.setSize(b,f)};Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)})();(function(){var c="arc arcTo beginPath bezierCurveTo clearRect clip closePath createLinearGradient createPattern createRadialGradient drawImage fill fillText getImageData createImageData lineTo moveTo putImageData quadraticCurveTo rect restore rotate save scale setLineDash setTransform stroke strokeText transform translate".split(" ");Kinetic.Context=function(a){this.init(a)};Kinetic.Context.prototype={init:function(a){this.canvas=a;this._context=a._canvas.getContext("2d");Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){a.getFillEnabled()&&this._fill(a);a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(a){var d=this.traceArr,b=d.length,f="",e,c,h;for(e=0;e<b;e++)c=d[e],(h=c.method)?(c=c.args,f+=h,f=a?f+"()":Kinetic.Util._isArray(c[0])?f+("(["+c.join(",")+"])"):f+("("+c.join(",")+")")):(f+=c.property,a||(f+="\x3d"+c.val)),f+=";";return f},clearTrace:function(){this.traceArr=[]},_trace:function(a){var d=this.traceArr;d.push(a);d.length>=Kinetic.traceArrMax&&d.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(a){var d=this.getCanvas();a?this.clearRect(a.x||0,a.y||0,a.width||0,a.height||0):this.clearRect(0,0,d.getWidth(),d.getHeight())},_applyLineCap:function(a){(a=a.getLineCap())&&this.setAttr("lineCap",a)},_applyOpacity:function(a){a=a.getAbsoluteOpacity();1!==a&&this.setAttr("globalAlpha",a)},_applyLineJoin:function(a){(a=a.getLineJoin())&&this.setAttr("lineJoin",a)},setAttr:function(a,d){this._context[a]=d},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var a=arguments;if(2===a.length)return this._context.createImageData(a[0],a[1]);if(1===a.length)return this._context.createImageData(a[0])},createLinearGradient:function(){var a=arguments;return this._context.createLinearGradient(a[0],a[1],a[2],a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,d=this._context;3===a.length?d.drawImage(a[0],a[1],a[2]):5===a.length?d.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&d.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},fill:function(){this._context.fill()},fillText:function(){var a=arguments;this._context.fillText(a[0],a[1],a[2])},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],a[1],a[2])},quadraticCurveTo:function(){var a=arguments;this._context.quadraticCurveTo(a[0],a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){this._context.rotate(arguments[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var a=arguments,d=this._context;this._context.setLineDash?d.setLineDash(a[0]):"mozDash"in d?d.mozDash=a[0]:"webkitLineDash"in d&&(d.webkitLineDash=a[0])},setTransform:function(){var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var a=this,d=c.length,b=Kinetic.Util._simplifyArray,f=this.setAttr,e,g,h=function(e){var d=a[e],f;a[e]=function(){g=b(Array.prototype.slice.call(arguments,0));f=d.apply(a,arguments);a._trace({method:e,args:g});return f}};for(e=0;e<d;e++)h(c[e]);a.setAttr=function(){f.apply(a,arguments);a._trace({property:arguments[0],val:arguments[1]})}}};Kinetic.SceneContext=function(a){Kinetic.Context.call(this,a)};Kinetic.SceneContext.prototype={_fillColor:function(a){var d=a.fill()||Kinetic.Util._getRGBAString({red:a.fillRed(),green:a.fillGreen(),blue:a.fillBlue(),alpha:a.fillAlpha()});this.setAttr("fillStyle",d);a._fillFunc(this)},_fillPattern:function(a){var d=a.getFillPatternImage(),b=a.getFillPatternX(),f=a.getFillPatternY(),e=a.getFillPatternScale(),c=Kinetic.getAngle(a.getFillPatternRotation()),h=a.getFillPatternOffset();a=a.getFillPatternRepeat();(b||f)&&this.translate(b||0,f||0);c&&this.rotate(c);e&&this.scale(e.x,e.y);h&&this.translate(-1*h.x,-1*h.y);this.setAttr("fillStyle",this.createPattern(d,a||"repeat"));this.fill()},_fillLinearGradient:function(a){var d=a.getFillLinearGradientStartPoint(),b=a.getFillLinearGradientEndPoint();a=a.getFillLinearGradientColorStops();d=this.createLinearGradient(d.x,d.y,b.x,b.y);if(a){for(b=0;b<a.length;b+=2)d.addColorStop(a[b],a[b+1]);this.setAttr("fillStyle",d);this.fill()}},_fillRadialGradient:function(a){var d=a.getFillRadialGradientStartPoint(),b=a.getFillRadialGradientEndPoint(),f=a.getFillRadialGradientStartRadius(),e=a.getFillRadialGradientEndRadius();a=a.getFillRadialGradientColorStops();d=this.createRadialGradient(d.x,d.y,f,b.x,b.y,e);for(b=0;b<a.length;b+=2)d.addColorStop(a[b],a[b+1]);this.setAttr("fillStyle",d);this.fill()},_fill:function(a){var d=a.fill()||a.fillRed()||a.fillGreen()||a.fillBlue(),b=a.getFillPatternImage(),f=a.getFillLinearGradientColorStops(),e=a.getFillRadialGradientColorStops(),c=a.getFillPriority();d&&"color"===c?this._fillColor(a):b&&"pattern"===c?this._fillPattern(a):f&&"linear-gradient"===c?this._fillLinearGradient(a):e&&"radial-gradient"===c?this._fillRadialGradient(a):d?this._fillColor(a):b?this._fillPattern(a):f?this._fillLinearGradient(a):e&&this._fillRadialGradient(a)},_stroke:function(a){var d=a.dash(),b=a.getStrokeScaleEnabled();a.hasStroke()&&(b||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(a),d&&a.dashEnabled()&&this.setLineDash(d),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.stroke()||Kinetic.Util._getRGBAString({red:a.strokeRed(),green:a.strokeGreen(),blue:a.strokeBlue(),alpha:a.strokeAlpha()})),a._strokeFunc(this),b||this.restore())},_applyShadow:function(a){var d=Kinetic.Util,b=a.getAbsoluteOpacity(),f=d.get(a.getShadowColor(),"black"),e=d.get(a.getShadowBlur(),5),c=d.get(a.getShadowOpacity(),1);a=d.get(a.getShadowOffset(),{x:0,y:0});c&&this.setAttr("globalAlpha",c*b);this.setAttr("shadowColor",f);this.setAttr("shadowBlur",e);this.setAttr("shadowOffsetX",a.x);this.setAttr("shadowOffsetY",a.y)}};Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context);Kinetic.HitContext=function(a){Kinetic.Context.call(this,a)};Kinetic.HitContext.prototype={_fill:function(a){this.save();this.setAttr("fillStyle",a.colorKey);a._fillFuncHit(this);this.restore()},_stroke:function(a){a.hasStroke()&&(this._applyLineCap(a),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.colorKey),a._strokeFuncHit(this))}};Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)})();(function(){Kinetic.Factory={addGetterSetter:function(c,a,d,b,f){this.addGetter(c,a,d);this.addSetter(c,a,b,f);this.addOverloadedGetterSetter(c,a)},addGetter:function(c,a,d){var b="get"+Kinetic.Util._capitalize(a);c.prototype[b]=function(){var b=this.attrs[a];return void 0===b?d:b}},addSetter:function(c,a,d,b){var f="set"+Kinetic.Util._capitalize(a);c.prototype[f]=function(e){d&&(e=d.call(this,e));this._setAttr(a,e);b&&b.call(this);return this}},addComponentsGetterSetter:function(c,a,d,b,f){var e=d.length,g=Kinetic.Util._capitalize,h="get"+g(a),l="set"+g(a),k,m;c.prototype[h]=function(){var b={};for(k=0;k<e;k++)m=d[k],b[m]=this.getAttr(a+g(m));return b};c.prototype[l]=function(e){var d=this.attrs[a],c;b&&(e=b.call(this,e));for(c in e)this._setAttr(a+g(c),e[c]);this._fireChangeEvent(a,d,e);f&&f.call(this);return this};this.addOverloadedGetterSetter(c,a)},addOverloadedGetterSetter:function(c,a){var d=Kinetic.Util._capitalize(a),b="set"+d,f="get"+d;c.prototype[a]=function(){return arguments.length?(this[b](arguments[0]),this):this[f]()}},backCompat:function(c,a){for(var d in a)c.prototype[d]=c.prototype[a[d]]},afterSetFilter:function(){this._filterUpToDate=!1}};Kinetic.Validators={RGBComponent:function(c){return 255<c?255:0>c?0:Math.round(c)},alphaComponent:function(c){return 1<c?1:1E-4>c?1E-4:c}}})();(function(){var c=["id"];Kinetic.Util.addMethods(Kinetic.Node,{_init:function(a){var d=this;this._id=Kinetic.idCounter++;this.eventListeners={};this.attrs={};this._cache={};this._filterUpToDate=!1;this.setAttrs(a);this.on("xChange.kinetic yChange.kinetic scaleXChange.kinetic scaleYChange.kinetic skewXChange.kinetic skewYChange.kinetic rotationChange.kinetic offsetXChange.kinetic offsetYChange.kinetic transformsEnabledChange.kinetic",function(){this._clearCache("transform");d._clearSelfAndDescendantCache("absoluteTransform")});this.on("visibleChange.kinetic",function(){d._clearSelfAndDescendantCache("visible")});this.on("listeningChange.kinetic",function(){d._clearSelfAndDescendantCache("listening")});this.on("opacityChange.kinetic",function(){d._clearSelfAndDescendantCache("absoluteOpacity")})},_clearCache:function(a){a?delete this._cache[a]:this._cache={}},_getCache:function(a,d){void 0===this._cache[a]&&(this._cache[a]=d.call(this));return this._cache[a]},_clearSelfAndDescendantCache:function(a){this._clearCache(a);this.children&&this.getChildren().each(function(d){d._clearSelfAndDescendantCache(a)})},clearCache:function(){delete this._cache.canvas;this._filterUpToDate=!1;return this},cache:function(a){var d=a||{};a=d.x||0;var b=d.y||0,c=d.width||this.width(),e=d.height||this.height(),d=d.drawBorder||!1;this.getLayer();if(0===c||0===e)Kinetic.Util.warn("Width or height of caching configuration equals 0. Cache is ignored.");else{var g=new Kinetic.SceneCanvas({pixelRatio:1,width:c,height:e}),h=new Kinetic.SceneCanvas({pixelRatio:1,width:c,height:e}),l=new Kinetic.HitCanvas({width:c,height:e});this.transformsEnabled();this.x();this.y();var k=g.getContext(),m=l.getContext();this.clearCache();k.save();m.save();d&&(k.save(),k.beginPath(),k.rect(0,0,c,e),k.closePath(),k.setAttr("strokeStyle","red"),k.setAttr("lineWidth",5),k.stroke(),k.restore());k.translate(-1*a,-1*b);m.translate(-1*a,-1*b);"Shape"===this.nodeType&&(k.translate(-1*this.x(),-1*this.y()),m.translate(-1*this.x(),-1*this.y()));this.drawScene(g,this);this.drawHit(l,this);k.restore();m.restore();this._cache.canvas={scene:g,filter:h,hit:l};return this}},_drawCachedSceneCanvas:function(a){a.save();this.getLayer()._applyTransform(this,a);a.drawImage(this._getCachedSceneCanvas()._canvas,0,0);a.restore()},_getCachedSceneCanvas:function(){var a=this.filters(),d=this._cache.canvas,b=d.scene,d=d.filter,c=d.getContext(),e,g,h,l;if(a){if(!this._filterUpToDate){try{for(e=a.length,c.clear(),c.drawImage(b._canvas,0,0),g=c.getImageData(0,0,d.getWidth(),d.getHeight()),h=0;h<e;h++)l=a[h],l.call(this,g),c.putImageData(g,0,0)}catch(k){Kinetic.Util.warn("Unable to apply filter. "+k.message)}this._filterUpToDate=!0}return d}return b},_drawCachedHitCanvas:function(a){var d=this._cache.canvas.hit;a.save();this.getLayer()._applyTransform(this,a);a.drawImage(d._canvas,0,0);a.restore()},on:function(a,d){a=a.split(" ");var b=a.length,c,e,g;for(c=0;c<b;c++)e=a[c],g=e.split("."),e=g[0],g=g[1]||"",this.eventListeners[e]||(this.eventListeners[e]=[]),this.eventListeners[e].push({name:g,handler:d});return this},off:function(a){a=a.split(" ");var d=a.length,b,c,e,g;for(b=0;b<d;b++)if(e=a[b],g=e.split("."),e=g[0],g=g[1],e)this.eventListeners[e]&&this._off(e,g);else for(c in this.eventListeners)this._off(c,g);return this},dispatchEvent:function(a){this.fire(a.type,{target:this,type:a.type,evt:a})},addEventListener:function(a,d){this.on(a,function(b){d.call(this,b.evt)})},remove:function(){var a=this.getParent();a&&a.children&&(a.children.splice(this.index,1),a._setChildrenIndices(),delete this.parent);this._clearSelfAndDescendantCache("stage");this._clearSelfAndDescendantCache("absoluteTransform");this._clearSelfAndDescendantCache("visible");this._clearSelfAndDescendantCache("listening");this._clearSelfAndDescendantCache("absoluteOpacity");return this},destroy:function(){Kinetic._removeId(this.getId());Kinetic._removeName(this.getName(),this._id);this.remove()},getAttr:function(a){var d="get"+Kinetic.Util._capitalize(a);return Kinetic.Util._isFunction(this[d])?this[d]():this.attrs[a]},getAncestors:function(){for(var a=this.getParent(),d=new Kinetic.Collection;a;)d.push(a),a=a.getParent();return d},getAttrs:function(){return this.attrs||{}},setAttrs:function(a){var d,b;if(a)for(d in a)if("children"!==d)if(b="set"+Kinetic.Util._capitalize(d),Kinetic.Util._isFunction(this[b]))this[b](a[d]);else this._setAttr(d,a[d]);return this},isListening:function(){return this._getCache("listening",this._isListening)},_isListening:function(){var a=this.getListening(),d=this.getParent();return"inherit"===a?d?d.isListening():!0:a},isVisible:function(){return this._getCache("visible",this._isVisible)},_isVisible:function(){var a=this.getVisible(),d=this.getParent();return"inherit"===a?d?d.isVisible():!0:a},shouldDrawHit:function(){var a=this.getLayer();return a&&a.hitGraphEnabled()&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){this.setVisible(!0);return this},hide:function(){this.setVisible(!1);return this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function a(k){e=[];g=k.length;for(h=0;h<g;h++)l=k[h],c++,"Shape"!==l.nodeType&&(e=e.concat(l.getChildren().toArray())),l._id===b._id&&(h=g);0<e.length&&e[0].getDepth()<=d&&a(e)}var d=this.getDepth(),b=this,c=0,e,g,h,l;"Stage"!==b.nodeType&&a(b.getStage().getChildren());return c},getDepth:function(){for(var a=0,d=this.parent;d;)a++,d=d.parent;return a},setPosition:function(a){this.setX(a.x);this.setY(a.y);return this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var a=this.getAbsoluteTransform().getMatrix(),d=new Kinetic.Transform,b=this.offset();d.m=a.slice();d.translate(b.x,b.y);return d.getTranslation()},setAbsolutePosition:function(a){var d=this._clearTransform(),b;this.attrs.x=d.x;this.attrs.y=d.y;delete d.x;delete d.y;b=this.getAbsoluteTransform();b.invert();b.translate(a.x,a.y);a={x:this.attrs.x+b.getTranslation().x,y:this.attrs.y+b.getTranslation().y};this.setPosition({x:a.x,y:a.y});this._setTransform(d);return this},_setTransform:function(a){for(var d in a)this.attrs[d]=a[d];this._clearCache("transform");this._clearSelfAndDescendantCache("absoluteTransform")},_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};this.attrs.x=0;this.attrs.y=0;this.attrs.rotation=0;this.attrs.scaleX=1;this.attrs.scaleY=1;this.attrs.offsetX=0;this.attrs.offsetY=0;this.attrs.skewX=0;this.attrs.skewY=0;this._clearCache("transform");this._clearSelfAndDescendantCache("absoluteTransform");return a},move:function(a){var d=a.x;a=a.y;var b=this.getX(),c=this.getY();void 0!==d&&(b+=d);void 0!==a&&(c+=a);this.setPosition({x:b,y:c});return this},_eachAncestorReverse:function(a,d){var b=[],c=this.getParent();if(d&&d._id===this._id)return a(this),!0;for(b.unshift(this);c&&(!d||c._id!==d._id);)b.unshift(c),c=c.parent;d=b.length;for(c=0;c<d;c++)a(b[c])},rotate:function(a){this.setRotation(this.getRotation()+a);return this},moveToTop:function(){if(this.parent)return this.parent.children.splice(this.index,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0;Kinetic.Util.warn("Node has no parent. moveToTop function is ignored.")},moveUp:function(){if(this.parent){var a=this.index,d=this.parent.getChildren().length;return a<d-1?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0):!1}Kinetic.Util.warn("Node has no parent. moveUp function is ignored.")},moveDown:function(){if(this.parent){var a=this.index;return 0<a?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):!1}Kinetic.Util.warn("Node has no parent. moveDown function is ignored.")},moveToBottom:function(){if(this.parent){var a=this.index;return 0<a?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}Kinetic.Util.warn("Node has no parent. moveToBottom function is ignored.")},setZIndex:function(a){if(this.parent)return this.parent.children.splice(this.index,1),this.parent.children.splice(a,0,this),this.parent._setChildrenIndices(),this;Kinetic.Util.warn("Node has no parent. zIndex parameter is ignored.")},getAbsoluteOpacity:function(){return this._getCache("absoluteOpacity",this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();this.getParent()&&(a*=this.getParent().getAbsoluteOpacity());return a},moveTo:function(a){Kinetic.Node.prototype.remove.call(this);a.add(this);return this},toObject:function(){var a=Kinetic.Util,d={},b=this.getAttrs(),c,e,g;d.attrs={};for(c in b)e=b[c],a._isFunction(e)||a._isElement(e)||a._isObject(e)&&a._hasMethods(e)||(g=this[c],delete b[c],g=g?g.call(this):null,b[c]=e,g!==e&&(d.attrs[c]=e));d.className=this.getClassName();return d},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var a=this.getParent();return a?a.getLayer():null},getStage:function(){return this._getCache("stage",this._getStage)},_getStage:function(){var a=this.getParent();if(a)return a.getStage()},fire:function(a,d,b){b?this._fireAndBubble(a,d||{}):this._fire(a,d||{});return this},getAbsoluteTransform:function(a){return a?this._getAbsoluteTransform(a):this._getCache("absoluteTransform",this._getAbsoluteTransform)},_getAbsoluteTransform:function(a){var d=new Kinetic.Transform,b,c;this._eachAncestorReverse(function(a){b=a.transformsEnabled();c=a.getTransform();"all"===b?d.multiply(c):"position"===b&&d.translate(a.x(),a.y())},a);return d},getTransform:function(){return this._getCache("transform",this._getTransform)},_getTransform:function(){var a=new Kinetic.Transform,d=this.getX(),b=this.getY(),c=Kinetic.getAngle(this.getRotation()),e=this.getScaleX(),g=this.getScaleY(),h=this.getSkewX(),l=this.getSkewY(),k=this.getOffsetX(),m=this.getOffsetY();0===d&&0===b||a.translate(d,b);0!==c&&a.rotate(c);0===h&&0===l||a.skew(h,l);1===e&&1===g||a.scale(e,g);0===k&&0===m||a.translate(-1*k,-1*m);return a},clone:function(a){var d=this.getClassName(),b=Kinetic.Util.cloneObject(this.attrs),f,e;for(e in c)delete b[c[e]];for(f in a)b[f]=a[f];var g=new Kinetic[d](b);for(f in this.eventListeners)for(a=this.eventListeners[f],d=a.length,b=0;b<d;b++)e=a[b],0>e.name.indexOf("kinetic")&&(g.eventListeners[f]||(g.eventListeners[f]=[]),g.eventListeners[f].push(e));return g},toDataURL:function(a){a=a||{};var d=a.mimeType||null,b=a.quality||null,c=this.getStage(),e=a.x||0,g=a.y||0;a=new Kinetic.SceneCanvas({width:a.width||this.getWidth()||(c?c.getWidth():0),height:a.height||this.getHeight()||(c?c.getHeight():0),pixelRatio:1});c=a.getContext();c.save();(e||g)&&c.translate(-1*e,-1*g);this.drawScene(a);c.restore();return a.toDataURL(d,b)},toImage:function(a){Kinetic.Util._getImage(this.toDataURL(a),function(d){a.callback(d)})},setSize:function(a){this.setWidth(a.width);this.setHeight(a.height);return this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Kinetic.dragDistance},_get:function(a){return this.nodeType===a?[this]:[]},_off:function(a,d){var b=this.eventListeners[a],c,e;for(c=0;c<b.length;c++)if(e=b[c].name,!("kinetic"===e&&"kinetic"!==d||d&&e!==d)){b.splice(c,1);if(0===b.length){delete this.eventListeners[a];break}c--}},_fireChangeEvent:function(a,d,b){this._fire(a+"Change",{oldVal:d,newVal:b})},setId:function(a){var d=this.getId();Kinetic._removeId(d);Kinetic._addId(this,a);this._setAttr("id",a);return this},setName:function(a){var d=this.getName();Kinetic._removeName(d,this._id);Kinetic._addName(this,a);this._setAttr("name",a);return this},setAttr:function(){var a=Array.prototype.slice.call(arguments),d=a[0],a=a[1],b=this["set"+Kinetic.Util._capitalize(d)];Kinetic.Util._isFunction(b)?b.call(this,a):this._setAttr(d,a);return this},_setAttr:function(a,d){var b;void 0!==d&&(b=this.attrs[a],this.attrs[a]=d,this._fireChangeEvent(a,b,d))},_setComponentAttr:function(a,d,b){var c;void 0!==b&&((c=this.attrs[a])||(this.attrs[a]=this.getAttr(a)),this.attrs[a][d]=b,this._fireChangeEvent(a,c,b))},_fireAndBubble:function(a,d,b){var c=!0;d&&"Shape"===this.nodeType&&(d.target=this);"mouseenter"===a&&b&&this._id===b._id?c=!1:"mouseleave"===a&&b&&this._id===b._id&&(c=!1);c&&(this._fire(a,d),d&&!d.cancelBubble&&this.parent&&(b&&b.parent?this._fireAndBubble.call(this.parent,a,d,b.parent):this._fireAndBubble.call(this.parent,a,d)))},_fire:function(a,d){var b=this.eventListeners[a];d.type=a;if(b)for(a=0;a<b.length;a++)b[a].handler.call(this,d)},draw:function(){this.drawScene();this.drawHit();return this}});Kinetic.Node.create=function(a,d){return this._createNode(JSON.parse(a),d)};Kinetic.Node._createNode=function(a,d){var b=Kinetic.Node.prototype.getClassName.call(a),c=a.children;d&&(a.attrs.container=d);a=new Kinetic[b](a.attrs);if(c)for(d=c.length,b=0;b<d;b++)a.add(this._createNode(c[b]));return a};Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position");Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1);Kinetic.Factory.addGetter(Kinetic.Node,"name");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name");Kinetic.Factory.addGetter(Kinetic.Node,"id");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id");Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0);Kinetic.Factory.addSetter(Kinetic.Node,"dragDistance");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"dragDistance");Kinetic.Factory.addSetter(Kinetic.Node,"width",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width");Kinetic.Factory.addSetter(Kinetic.Node,"height",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height");Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",void 0,function(a){this._filterUpToDate=!1;return a});Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"size");Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});Kinetic.Collection.mapMethods(Kinetic.Node)})();(function(){Kinetic.Filters.Grayscale=function(c){c=c.data;var a=c.length,d,b;for(d=0;d<a;d+=4)b=.34*c[d]+.5*c[d+1]+.16*c[d+2],c[d]=b,c[d+1]=b,c[d+2]=b}})();(function(){Kinetic.Filters.Brighten=function(c){var a=255*this.brightness();c=c.data;var d=c.length,b;for(b=0;b<d;b+=4)c[b]+=a,c[b+1]+=a,c[b+2]+=a};Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Invert=function(c){c=c.data;var a=c.length,d;for(d=0;d<a;d+=4)c[d]=255-c[d],c[d+1]=255-c[d+1],c[d+2]=255-c[d+2]}})();(function(){function c(){this.a=this.b=this.g=this.r=0;this.next=null}var a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],d=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(b){var f=Math.round(this.blurRadius());if(0<f){var e=b.data,g=b.width;b=b.height;var h,l,k,m,n,r,p,q,t,u,x,z,y,A,w,C,D,I,E,G,H,B,J;h=f+f+1;var O=g-1,P=b-1,F=f+1,K=F*(F+1)/2,N=new c,Q=null,v=N,L=a[f],M=d[f];for(k=1;k<h;k++)v=v.next=new c,k==F&&(Q=v);v.next=N;for(l=r=n=0;l<b;l++){w=C=D=I=p=q=t=u=0;x=F*(E=e[n]);z=F*(G=e[n+1]);y=F*(H=e[n+2]);A=F*(B=e[n+3]);p+=K*E;q+=K*G;t+=K*H;u+=K*B;v=N;for(k=0;k<F;k++)v.r=E,v.g=G,v.b=H,v.a=B,v=v.next;for(k=1;k<F;k++)m=n+((O<k?O:k)<<2),p+=(v.r=E=e[m])*(J=F-k),q+=(v.g=G=e[m+1])*J,t+=(v.b=H=e[m+2])*J,u+=(v.a=B=e[m+3])*J,w+=E,C+=G,D+=H,I+=B,v=v.next;k=N;v=Q;for(h=0;h<g;h++)e[n+3]=B=u*L>>M,0!==B?(B=255/B,e[n]=(p*L>>M)*B,e[n+1]=(q*L>>M)*B,e[n+2]=(t*L>>M)*B):e[n]=e[n+1]=e[n+2]=0,p-=x,q-=z,t-=y,u-=A,x-=k.r,z-=k.g,y-=k.b,A-=k.a,m=r+((m=h+f+1)<O?m:O)<<2,w+=k.r=e[m],C+=k.g=e[m+1],D+=k.b=e[m+2],I+=k.a=e[m+3],p+=w,q+=C,t+=D,u+=I,k=k.next,x+=E=v.r,z+=G=v.g,y+=H=v.b,A+=B=v.a,w-=E,C-=G,D-=H,I-=B,v=v.next,n+=4;r+=g}for(h=0;h<g;h++){C=D=I=w=q=t=u=p=0;n=h<<2;x=F*(E=e[n]);z=F*(G=e[n+1]);y=F*(H=e[n+2]);A=F*(B=e[n+3]);p+=K*E;q+=K*G;t+=K*H;u+=K*B;v=N;for(k=0;k<F;k++)v.r=E,v.g=G,v.b=H,v.a=B,v=v.next;m=g;for(k=1;k<=f;k++)n=m+h<<2,p+=(v.r=E=e[n])*(J=F-k),q+=(v.g=G=e[n+1])*J,t+=(v.b=H=e[n+2])*J,u+=(v.a=B=e[n+3])*J,w+=E,C+=G,D+=H,I+=B,v=v.next,k<P&&(m+=g);n=h;k=N;v=Q;for(l=0;l<b;l++)m=n<<2,e[m+3]=B=u*L>>M,0<B?(B=255/B,e[m]=(p*L>>M)*B,e[m+1]=(q*L>>M)*B,e[m+2]=(t*L>>M)*B):e[m]=e[m+1]=e[m+2]=0,p-=x,q-=z,t-=y,u-=A,x-=k.r,z-=k.g,y-=k.b,A-=k.a,m=h+((m=l+F)<P?m:P)*g<<2,p+=w+=k.r=e[m],q+=C+=k.g=e[m+1],t+=D+=k.b=e[m+2],u+=I+=k.a=e[m+3],k=k.next,x+=E=v.r,z+=G=v.g,y+=H=v.b,A+=B=v.a,w-=E,C-=G,D-=H,I-=B,v=v.next,n+=g}}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)})();(function(){function c(a,b,c){b=4*(c*a.width+b);c=[];c.push(a.data[b++],a.data[b++],a.data[b++],a.data[b++]);return c}function a(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}Kinetic.Filters.Mask=function(d){var b;b=this.threshold();var f=c(d,0,0),e=c(d,d.width-1,0),g=c(d,0,d.height-1),h=c(d,d.width-1,d.height-1);b=b||10;if(a(f,e)<b&&a(e,h)<b&&a(h,g)<b&&a(g,f)<b){e=[e,f,h,g];f=[0,0,0];for(g=0;g<e.length;g++)f[0]+=e[g][0],f[1]+=e[g][1],f[2]+=e[g][2];f[0]/=e.length;f[1]/=e.length;f[2]/=e.length;e=[];for(g=0;g<d.width*d.height;g++)h=a(f,[d.data[4*g],d.data[4*g+1],d.data[4*g+2]]),e[g]=h<b?0:255;b=e}else b=void 0;if(b){for(var f=d.width,e=d.height,g=[1,1,1,1,0,1,1,1,1],h=Math.round(Math.sqrt(g.length)),l=Math.floor(h/2),k=[],m=0;m<e;m++)for(var n=0;n<f;n++){for(var r=m*f+n,p=0,q=0;q<h;q++)for(var t=0;t<h;t++){var u=m+q-l,x=n+t-l;0<=u&&u<e&&0<=x&&x<f&&(p+=b[u*f+x]*g[q*h+t])}k[r]=2040===p?255:0}b=k;f=d.width;e=d.height;g=[1,1,1,1,1,1,1,1,1];h=Math.round(Math.sqrt(g.length));l=Math.floor(h/2);k=[];for(m=0;m<e;m++)for(n=0;n<f;n++){r=m*f+n;for(q=p=0;q<h;q++)for(t=0;t<h;t++)u=m+q-l,x=n+t-l,0<=u&&u<e&&0<=x&&x<f&&(p+=b[u*f+x]*g[q*h+t]);k[r]=1020<=p?255:0}b=k;f=d.width;e=d.height;g=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9];h=Math.round(Math.sqrt(g.length));l=Math.floor(h/2);k=[];for(m=0;m<e;m++)for(n=0;n<f;n++){r=m*f+n;for(q=p=0;q<h;q++)for(t=0;t<h;t++)u=m+q-l,x=n+t-l,0<=u&&u<e&&0<=x&&x<f&&(p+=b[u*f+x]*g[q*h+t]);k[r]=p}b=k;for(f=0;f<d.width*d.height;f++)d.data[4*f+3]=b[f]}return d};Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.RGB=function(c){c=c.data;var a=c.length,d=this.red(),b=this.green(),f=this.blue(),e,g;for(e=0;e<a;e+=4)g=(.34*c[e]+.5*c[e+1]+.16*c[e+2])/255,c[e]=g*d,c[e+1]=g*b,c[e+2]=g*f,c[e+3]=c[e+3]};Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(c){this._filterUpToDate=!1;return 255<c?255:0>c?0:Math.round(c)});Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(c){this._filterUpToDate=!1;return 255<c?255:0>c?0:Math.round(c)});Kinetic.Factory.addGetterSetter(Kinetic.Node,"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.HSV=function(c){c=c.data;for(var a=c.length,d=Math.pow(2,this.value()),b=Math.pow(2,this.saturation()),f=Math.abs(this.hue()+360)%360,e=d*b*Math.cos(f*Math.PI/180),g=d*b*Math.sin(f*Math.PI/180),b=.299*d+.701*e+.167*g,f=.587*d-.587*e+.33*g,h=.114*d-.114*e-.497*g,l=.299*d-.299*e-.328*g,k=.587*d+.413*e+.035*g,m=.114*d-.114*e+.293*g,n=.299*d-.3*e+1.25*g,r=.587*d-.586*e-1.05*g,e=.114*d+.886*e-.2*g,p,q,t,d=0;d<a;d+=4)g=c[d+0],p=c[d+1],q=c[d+2],t=c[d+3],c[d+0]=b*g+f*p+h*q,c[d+1]=l*g+k*p+m*q,c[d+2]=n*g+r*p+e*q,c[d+3]=t};Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"luminance",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Filters.HSL=function(c){c=c.data;var a=c.length,d=Math.pow(2,this.saturation()),b=Math.abs(this.hue()+360)%360,f=127*this.luminance(),e;e=1*d*Math.cos(b*Math.PI/180);var g=1*d*Math.sin(b*Math.PI/180),d=.299+.701*e+.167*g,b=.587-.587*e+.33*g,h=.114-.114*e-.497*g,l=.299-.299*e-.328*g,k=.587+.413*e+.035*g,m=.114-.114*e+.293*g,n=.299-.3*e+1.25*g,r=.587-.586*e-1.05*g,g=.114+.886*e-.2*g,p,q,t,u;for(e=0;e<a;e+=4)p=c[e+0],q=c[e+1],t=c[e+2],u=c[e+3],c[e+0]=d*p+b*q+h*t+f,c[e+1]=l*p+k*q+m*t+f,c[e+2]=n*p+r*q+g*t+f,c[e+3]=u}})();(function(){Kinetic.Filters.Emboss=function(c){var a=10*this.embossStrength(),d=255*this.embossWhiteLevel(),b=this.embossDirection(),f=this.embossBlend(),e=0,g=0,h=c.data,l=c.width;c=c.height;var k=4*l,m=c;switch(b){case "top-left":g=e=-1;break;case "top":e=-1;g=0;break;case "top-right":e=-1;g=1;break;case "right":e=0;g=1;break;case "bottom-right":g=e=1;break;case "bottom":e=1;g=0;break;case "bottom-left":e=1;g=-1;break;case "left":e=0,g=-1}do{var b=(m-1)*k,n=e;1>m+n&&(n=0);m+n>c&&(n=0);var n=(m-1+n)*l*4,r=l;do{var p=b+4*(r-1),q=g;1>r+q&&(q=0);r+q>l&&(q=0);var q=n+4*(r-1+q),t=h[p+1]-h[q+1],u=h[p+2]-h[q+2],q=h[p]-h[q],x=0<q?q:-q,z=0<u?u:-u;(0<t?t:-t)>x&&(q=t);z>x&&(q=u);q*=a;f?(t=h[p]+q,u=h[p+1]+q,q=h[p+2]+q,h[p]=255<t?255:0>t?0:t,h[p+1]=255<u?255:0>u?0:u,h[p+2]=255<q?255:0>q?0:q):(q=d-q,0>q?q=0:255<q&&(q=255),h[p]=h[p+1]=h[p+2]=q)}while(--r)}while(--m)};Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",.5,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossWhiteLevel",.5,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",!1,null,Kinetic.Factory.afterSetFilter)})();(function(){function c(a,d,b,c,e){b-=d;e-=c;return 0===b?c+e/2:0===e?c:(a-d)/b*e+c}Kinetic.Filters.Enhance=function(a){a=a.data;var d=a.length,b=a[0],f=b,e,g=a[1],h=g,l=a[2],k=l,m,n=this.enhance();if(0!==n){for(m=0;m<d;m+=4)e=a[m+0],e<b?b=e:e>f&&(f=e),e=a[m+1],e<g?g=e:e>h&&(h=e),e=a[m+2],e<l?l=e:e>k&&(k=e);f===b&&(f=255,b=0);h===g&&(h=255,g=0);k===l&&(k=255,l=0);var r,p,q,t;0<n?(e=f+n*(255-f),r=b-n*(b-0),p=h+n*(255-h),q=g-n*(g-0),t=k+n*(255-k),n=l-n*(l-0)):(m=.5*(f+b),e=f+n*(f-m),r=b+n*(b-m),m=.5*(h+g),p=h+n*(h-m),q=g+n*(g-m),m=.5*(k+l),t=k+n*(k-m),n=l+n*(l-m));for(m=0;m<d;m+=4)a[m+0]=c(a[m+0],b,f,r,e),a[m+1]=c(a[m+1],g,h,q,p),a[m+2]=c(a[m+2],l,k,n,t)}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Posterize=function(c){var a=Math.round(254*this.levels())+1;c=c.data;var d=c.length,a=255/a,b;for(b=0;b<d;b+=1)c[b]=Math.floor(c[b]/a)*a};Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",.5,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Noise=function(c){var a=255*this.noise();c=c.data;var d=c.length,a=a/2,b;for(b=0;b<d;b+=4)c[b+0]+=a-2*a*Math.random(),c[b+1]+=a-2*a*Math.random(),c[b+2]+=a-2*a*Math.random()};Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",.2,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Pixelate=function(c){var a=Math.ceil(this.pixelSize()),d=c.width,b=c.height,f,e,g,h,l,k,m,n=Math.ceil(d/a),r=Math.ceil(b/a),p,q,t,u,x,z,y;c=c.data;for(x=0;x<n;x+=1)for(z=0;z<r;z+=1){m=k=l=h=0;p=x*a;q=p+a;t=z*a;u=t+a;y=0;for(f=p;f<q;f+=1)if(!(f>=d))for(e=t;e<u;e+=1)e>=b||(g=4*(d*e+f),h+=c[g+0],l+=c[g+1],k+=c[g+2],m+=c[g+3],y+=1);h/=y;l/=y;k/=y;for(f=p;f<q;f+=1)if(!(f>=d))for(e=t;e<u;e+=1)e>=b||(g=4*(d*e+f),c[g+0]=h,c[g+1]=l,c[g+2]=k,c[g+3]=m)}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"pixelSize",8,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Threshold=function(c){var a=255*this.threshold();c=c.data;var d=c.length,b;for(b=0;b<d;b+=1)c[b]=c[b]<a?0:255};Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",.5,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Sepia=function(c){var a=c.data,d=c.width;c=c.height;var b=4*d,f,e,g,h,l,k,m,n;do{f=(c-1)*b;e=d;do g=f+4*(e-1),h=a[g],l=a[g+1],k=a[g+2],m=.393*h+.769*l+.189*k,n=.349*h+.686*l+.168*k,h=.272*h+.534*l+.131*k,a[g]=255<m?255:m,a[g+1]=255<n?255:n,a[g+2]=255<h?255:h,a[g+3]=a[g+3];while(--e)}while(--c)}})();(function(){Kinetic.Filters.Solarize=function(c){var a=c.data,d=c.width,b=4*d;c=c.height;do{var f=(c-1)*b,e=d;do{var g=f+4*(e-1),h=a[g],l=a[g+1],k=a[g+2];127<h&&(h=255-h);127<l&&(l=255-l);127<k&&(k=255-k);a[g]=h;a[g+1]=l;a[g+2]=k}while(--e)}while(--c)}})();(function(){var c=Kinetic.Util.createCanvasElement();Kinetic.Filters.Kaleidoscope=function(a){var d=a.width,b=a.height,f,e,g,h,l,k,m,n,r=Math.round(this.kaleidoscopePower()),p=Math.round(this.kaleidoscopeAngle());h=Math.floor(p%360*d/360);if(!(1>r)){c.width=d;c.height=b;p=c.getContext("2d").getImageData(0,0,d,b);f=a.data;e=p.data;var q=a.width;g=a.height;l=d/2||q/2;k=b/2||g/2;var t,u,x,z,y,A,w=Math.sqrt(l*l+k*k);t=q-l;u=g-k;A=Math.sqrt(t*t+u*u);var w=A>w?A:w,C,D=360/q*Math.PI/180;for(C=0;C<q;C+=1)for(m=Math.sin(C*D),n=Math.cos(C*D),A=0;A<g;A+=1)t=Math.floor(l+w*A/g*n),u=Math.floor(k+w*A/g*m),t=4*(u*q+t),u=f[t+0],x=f[t+1],z=f[t+2],y=f[t+3],t=4*(C+A*q),e[t+0]=u,e[t+1]=x,e[t+2]=z,e[t+3]=y;for(q=d/Math.pow(2,r);8>=q;)q*=2,--r;w=q=Math.ceil(q);A=0;C=w;D=1;h+q>d&&(A=w,C=0,D=-1);for(e=0;e<b;e+=1)for(f=A;f!==C;f+=D)g=Math.round(f+h)%d,m=4*(d*e+g),g=p.data[m+0],l=p.data[m+1],k=p.data[m+2],m=p.data[m+3],n=4*(d*e+f),p.data[n+0]=g,p.data[n+1]=l,p.data[n+2]=k,p.data[n+3]=m;for(e=0;e<b;e+=1)for(w=Math.floor(q),h=0;h<r;h+=1){for(f=0;f<w+1;f+=1)m=4*(d*e+f),g=p.data[m+0],l=p.data[m+1],k=p.data[m+2],m=p.data[m+3],n=4*(d*e+2*w-f-1),p.data[n+0]=g,p.data[n+1]=l,p.data[n+2]=k,p.data[n+3]=m;w*=2}g={polarRotation:0};d=p.data;a=a.data;b=p.width;p=p.height;r=g.polarCenterX||b/2;h=g.polarCenterY||p/2;f=Math.sqrt(r*r+h*h);e=b-r;q=p-h;e=Math.sqrt(e*e+q*q);f=e>f?e:f;g=g.polarRotation||0;for(e=0;e<b;e+=1)for(q=0;q<p;q+=1)k=e-r,w=q-h,l=Math.sqrt(k*k+w*w)*p/f,k=(180*Math.atan2(w,k)/Math.PI+360+g)%360,k=k*b/360,k=Math.floor(k),l=Math.floor(l),l=4*(l*b+k),k=d[l+0],w=d[l+1],A=d[l+2],C=d[l+3],l=4*(q*b+e),a[l+0]=k,a[l+1]=w,a[l+2]=A,a[l+3]=C}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)})();(function(){function c(b){Kinetic.root.setTimeout(b,1E3/60)}function a(){return b.apply(Kinetic.root,arguments)}var d=function(){return Kinetic.root.performance&&Kinetic.root.performance.now?function(){return Kinetic.root.performance.now()}:function(){return(new Date).getTime()}}(),b=Kinetic.root.requestAnimationFrame||Kinetic.root.webkitRequestAnimationFrame||Kinetic.root.mozRequestAnimationFrame||Kinetic.root.oRequestAnimationFrame||Kinetic.root.msRequestAnimationFrame||c;Kinetic.Animation=function(b,a){var c=Kinetic.Animation;this.func=b;this.setLayers(a);this.id=c.animIdCounter++;this.frame={time:0,timeDiff:0,lastTime:d()}};Kinetic.Animation.prototype={setLayers:function(b){this.layers=b?0<b.length?b:[b]:[]},getLayers:function(){return this.layers},addLayer:function(b){var a=this.layers,c,d;if(a)for(c=a.length,d=0;d<c;d++){if(a[d]._id===b._id)return!1}else this.layers=[];this.layers.push(b);return!0},isRunning:function(){var b=Kinetic.Animation.animations,a=b.length,d;for(d=0;d<a;d++)if(b[d].id===this.id)return!0;return!1},start:function(){var b=Kinetic.Animation;this.stop();this.frame.timeDiff=0;this.frame.lastTime=d();b._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(b){this.frame.timeDiff=b-this.frame.lastTime;this.frame.lastTime=b;this.frame.time+=this.frame.timeDiff;this.frame.frameRate=1E3/this.frame.timeDiff}};Kinetic.Animation.animations=[];Kinetic.Animation.animIdCounter=0;Kinetic.Animation.animRunning=!1;Kinetic.Animation._addAnimation=function(b){this.animations.push(b);this._handleAnimation()};Kinetic.Animation._removeAnimation=function(b){b=b.id;var a=this.animations,d=a.length,c;for(c=0;c<d;c++)if(a[c].id===b){this.animations.splice(c,1);break}};Kinetic.Animation._runFrames=function(){var b={},a=this.animations,c,f,k,m,n,r,p,q;for(m=0;m<a.length;m++){c=a[m];f=c.layers;k=c.func;c._updateFrameObject(d());r=f.length;for(n=0;n<r;n++)p=f[n],void 0!==p._id&&(b[p._id]=p);k&&k.call(c,c.frame)}for(q in b)b[q].draw()};Kinetic.Animation._animationLoop=function(){var b=Kinetic.Animation;b.animations.length?(a(b._animationLoop),b._runFrames()):b.animRunning=!1};Kinetic.Animation._handleAnimation=function(){this.animRunning||(this.animRunning=!0,this._animationLoop())};var f=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(b){f.call(this,b)};Kinetic.Layer.prototype.batchDraw=function(){var b=this,a=Kinetic.Animation;this.batchAnim||(this.batchAnim=new a(function(){b.lastBatchDrawTime&&500<d()-b.lastBatchDrawTime&&b.batchAnim.stop()},this));this.lastBatchDrawTime=d();this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())};Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(b){b.batchDraw()})}})((0,eval)("this"));(function(){var c={node:1,duration:1,easing:1,onFinish:1,yoyo:1},a=0;Kinetic.Tween=function(b){var f=this,e=b.node,g=e._id,h=b.duration||1,l=b.easing||Kinetic.Easings.Linear,k=!!b.yoyo,m;this.node=e;this._id=a++;this.anim=new Kinetic.Animation(function(){f.tween.onEnterFrame()},e.getLayer());this.tween=new d(m,function(b){f._tweenFunc(b)},l,0,1,1E3*h,k);this._addListeners();Kinetic.Tween.attrs[g]||(Kinetic.Tween.attrs[g]={});Kinetic.Tween.attrs[g][this._id]||(Kinetic.Tween.attrs[g][this._id]={});Kinetic.Tween.tweens[g]||(Kinetic.Tween.tweens[g]={});for(m in b)void 0===c[m]&&this._addAttr(m,b[m]);this.reset();this.onFinish=b.onFinish;this.onReset=b.onReset};Kinetic.Tween.attrs={};Kinetic.Tween.tweens={};Kinetic.Tween.prototype={_addAttr:function(b,a){var c=this.node,d=c._id,h,l,k;(h=Kinetic.Tween.tweens[d][b])&&delete Kinetic.Tween.attrs[d][h][b];c=c.getAttr(b);if(Kinetic.Util._isArray(a))for(h=[],k=a.length,l=0;l<k;l++)h.push(a[l]-c[l]);else h=a-c;Kinetic.Tween.attrs[d][this._id][b]={start:c,diff:h};Kinetic.Tween.tweens[d][b]=this._id},_tweenFunc:function(b){var a=this.node,c=Kinetic.Tween.attrs[a._id][this._id],d,h,l,k,m,n;for(d in c){h=c[d];l=h.start;h=h.diff;if(Kinetic.Util._isArray(l))for(k=[],n=l.length,m=0;m<n;m++)k.push(l[m]+h[m]*b);else k=l+h*b;a.setAttr(d,k)}},_addListeners:function(){var b=this;this.tween.onPlay=function(){b.anim.start()};this.tween.onReverse=function(){b.anim.start()};this.tween.onPause=function(){b.anim.stop()};this.tween.onFinish=function(){if(b.onFinish)b.onFinish()};this.tween.onReset=function(){if(b.onReset)b.onReset()}},play:function(){this.tween.play();return this},reverse:function(){this.tween.reverse();return this},reset:function(){this.tween.reset();return this},seek:function(b){this.tween.seek(1E3*b);return this},pause:function(){this.tween.pause();return this},finish:function(){this.tween.finish();return this},destroy:function(){var b=this.node._id,a=this._id,c=Kinetic.Tween.tweens[b],d;this.pause();for(d in c)delete Kinetic.Tween.tweens[b][d];delete Kinetic.Tween.attrs[b][a]}};var d=function(b,a,c,d,h,l,k){this.prop=b;this.propFunc=a;this._pos=this.begin=d;this.duration=l;this.prevPos=this._change=0;this.yoyo=k;this._finish=this._startTime=this._position=this._time=0;this.func=c;this._change=h-this.begin;this.pause()};d.prototype={fire:function(b){(b=this[b])&&b()},setTime:function(b){b>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>b?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=b,this.update())},getTime:function(){return this._time},setPosition:function(b){this.prevPos=this._pos;this.propFunc(b);this._pos=b},getPosition:function(b){void 0===b&&(b=this._time);return this.func(b,this.begin,this._change,this.duration)},play:function(){this.state=2;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onPlay")},reverse:function(){this.state=3;this._time=this.duration-this._time;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onReverse")},seek:function(b){this.pause();this._time=b;this.update();this.fire("onSeek")},reset:function(){this.pause();this._time=0;this.update();this.fire("onReset")},finish:function(){this.pause();this._time=this.duration;this.update();this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var b=this.getTimer()-this._startTime;2===this.state?this.setTime(b):3===this.state&&this.setTime(this.duration-b)},pause:function(){this.state=1;this.fire("onPause")},getTimer:function(){return(new Date).getTime()}};Kinetic.Easings={BackEaseIn:function(b,a,c,d){return c*(b/=d)*b*(2.70158*b-1.70158)+a},BackEaseOut:function(b,a,c,d){return c*((b=b/d-1)*b*(2.70158*b+1.70158)+1)+a},BackEaseInOut:function(b,a,c,d){var h=1.70158;return 1>(b/=d/2)?c/2*b*b*(((h*=1.525)+1)*b-h)+a:c/2*((b-=2)*b*(((h*=1.525)+1)*b+h)+2)+a},ElasticEaseIn:function(b,a,c,d,h,l){if(0===b)return a;if(1==(b/=d))return a+c;l||(l=.3*d);!h||h<Math.abs(c)?(h=c,c=l/4):c=l/(2*Math.PI)*Math.asin(c/h);return-(h*Math.pow(2,10*--b)*Math.sin(2*(b*d-c)*Math.PI/l))+a},ElasticEaseOut:function(b,a,c,d,h,l){var k;if(0===b)return a;if(1==(b/=d))return a+c;l||(l=.3*d);!h||h<Math.abs(c)?(h=c,k=l/4):k=l/(2*Math.PI)*Math.asin(c/h);return h*Math.pow(2,-10*b)*Math.sin(2*(b*d-k)*Math.PI/l)+c+a},ElasticEaseInOut:function(b,a,c,d,h,l){var k;if(0===b)return a;if(2==(b/=d/2))return a+c;l||(l=.3*d*1.5);!h||h<Math.abs(c)?(h=c,k=l/4):k=l/(2*Math.PI)*Math.asin(c/h);return 1>b?-.5*h*Math.pow(2,10*--b)*Math.sin(2*(b*d-k)*Math.PI/l)+a:h*Math.pow(2,-10*--b)*Math.sin(2*(b*d-k)*Math.PI/l)*.5+c+a},BounceEaseOut:function(b,a,c,d){return(b/=d)<1/2.75?7.5625*c*b*b+a:b<2/2.75?c*(7.5625*(b-=1.5/2.75)*b+.75)+a:b<2.5/2.75?c*(7.5625*(b-=2.25/2.75)*b+.9375)+a:c*(7.5625*(b-=2.625/2.75)*b+.984375)+a},BounceEaseIn:function(b,a,c,d){return c-Kinetic.Easings.BounceEaseOut(d-b,0,c,d)+a},BounceEaseInOut:function(b,a,c,d){return b<d/2?.5*Kinetic.Easings.BounceEaseIn(2*b,0,c,d)+a:.5*Kinetic.Easings.BounceEaseOut(2*b-d,0,c,d)+.5*c+a},EaseIn:function(b,a,c,d){return c*(b/=d)*b+a},EaseOut:function(b,a,c,d){return-c*(b/=d)*(b-2)+a},EaseInOut:function(b,a,c,d){return 1>(b/=d/2)?c/2*b*b+a:-c/2*(--b*(b-2)-1)+a},StrongEaseIn:function(b,a,c,d){return c*(b/=d)*b*b*b*b+a},StrongEaseOut:function(b,a,c,d){return c*((b=b/d-1)*b*b*b*b+1)+a},StrongEaseInOut:function(b,a,c,d){return 1>(b/=d/2)?c/2*b*b*b*b*b+a:c/2*((b-=2)*b*b*b*b+2)+a},Linear:function(b,a,c,d){return c*b/d+a}}})();(function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(a){var b=Kinetic.DD,c=b.node;if(c){if(!b.isDragging){var e=c.getStage().getPointerPosition(),g=c.dragDistance();if(Math.max(Math.abs(e.x-b.startPointerPos.x),Math.abs(e.y-b.startPointerPos.y))<g)return}c._setDragPosition(a);b.isDragging||(b.isDragging=!0,c.fire("dragstart",{type:"dragstart",target:c,evt:a},!0));c.fire("dragmove",{type:"dragmove",target:c,evt:a},!0)}},_endDragBefore:function(a){var b=Kinetic.DD,c=b.node,e;c&&(e=c.getLayer(),b.anim.stop(),b.isDragging&&(b.isDragging=!1,Kinetic.listenClickTap=!1,a&&(a.dragEndNode=c)),delete b.node,(e||c).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&b.fire("dragend",{type:"dragend",target:b,evt:a},!0)}};Kinetic.Node.prototype.startDrag=function(){var a=Kinetic.DD,b=this.getStage(),c=this.getLayer(),b=b.getPointerPosition(),e=this.getAbsolutePosition();b&&(a.node&&a.node.stopDrag(),a.node=this,a.startPointerPos=b,a.offset.x=b.x-e.x,a.offset.y=b.y-e.y,a.anim.setLayers(c||this.getLayers()),a.anim.start(),this._setDragPosition())};Kinetic.Node.prototype._setDragPosition=function(a){var b=Kinetic.DD,c=this.getStage().getPointerPosition(),e=this.getDragBoundFunc();c&&(b={x:c.x-b.offset.x,y:c.y-b.offset.y},void 0!==e&&(b=e.call(this,b,a)),this.setAbsolutePosition(b))};Kinetic.Node.prototype.stopDrag=function(){var a=Kinetic.DD,b={};a._endDragBefore(b);a._endDragAfter(b)};Kinetic.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a);this._dragChange()};var c=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var a=Kinetic.DD;a.node&&a.node._id===this._id&&this.stopDrag();c.call(this)};Kinetic.Node.prototype.isDragging=function(){var a=Kinetic.DD;return a.node&&a.node._id===this._id&&a.isDragging};Kinetic.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup();if("Stage"===this.getClassName())this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)});else this.on("mousedown.kinetic touchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)})};Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),b=Kinetic.DD;a&&b.node&&b.node._id===this._id&&b.node.stopDrag()}};Kinetic.Node.prototype._dragCleanup=function(){"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))};Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc");Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var a=Kinetic.document.documentElement;a.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0);a.addEventListener("touchend",Kinetic.DD._endDragBefore,!0);a.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1);a.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)})();(function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(c){this.children=new Kinetic.Collection;Kinetic.Node.call(this,c)},getChildren:function(c){if(c){var a=new Kinetic.Collection;this.children.each(function(d){c(d)&&a.push(d)});return a}return this.children},hasChildren:function(){return 0<this.getChildren().length},removeChildren:function(){for(var c=Kinetic.Collection.toCollection(this.children),a,d=0;d<c.length;d++)a=c[d],delete a.parent,a.index=0,a.hasChildren()&&a.removeChildren(),a.remove();this.children=new Kinetic.Collection;return this},destroyChildren:function(){for(var c=Kinetic.Collection.toCollection(this.children),a,d=0;d<c.length;d++)a=c[d],delete a.parent,a.index=0,a.destroy();this.children=new Kinetic.Collection;return this},add:function(c){if(1<arguments.length)for(var a=0;a<arguments.length;a++)this.add(arguments[a]);else if(c.getParent())c.moveTo(this);else return a=this.children,this._validateAdd(c),c.index=a.length,c.parent=this,a.push(c),this._fire("add",{child:c}),this},destroy:function(){this.hasChildren()&&this.destroyChildren();Kinetic.Node.prototype.destroy.call(this)},find:function(c){var a=[];c=c.replace(/ /g,"").split(",");var d=c.length,b,f,e,g,h;for(b=0;b<d;b++)if(e=c[b],"#"===e.charAt(0))(f=this._getNodeById(e.slice(1)))&&a.push(f);else if("."===e.charAt(0))f=this._getNodesByName(e.slice(1)),a=a.concat(f);else for(g=this.getChildren(),h=g.length,f=0;f<h;f++)a=a.concat(g[f]._get(e));return Kinetic.Collection.toCollection(a)},_getNodeById:function(c){c=Kinetic.ids[c];return void 0!==c&&this.isAncestorOf(c)?c:null},_getNodesByName:function(c){return this._getDescendants(Kinetic.names[c]||[])},_get:function(c){for(var a=Kinetic.Node.prototype._get.call(this,c),d=this.getChildren(),b=d.length,f=0;f<b;f++)a=a.concat(d[f]._get(c));return a},toObject:function(){var c=Kinetic.Node.prototype.toObject.call(this);c.children=[];for(var a=this.getChildren(),d=a.length,b=0;b<d;b++)c.children.push(a[b].toObject());return c},_getDescendants:function(c){for(var a=[],d=c.length,b=0;b<d;b++){var f=c[b];this.isAncestorOf(f)&&a.push(f)}return a},isAncestorOf:function(c){for(c=c.getParent();c;){if(c._id===this._id)return!0;c=c.getParent()}return!1},clone:function(c){var a=Kinetic.Node.prototype.clone.call(this,c);this.getChildren().each(function(c){a.add(c.clone())});return a},getAllIntersections:function(c){var a=[];this.find("Shape").each(function(d){d.isVisible()&&d.intersects(c)&&a.push(d)});return a},_setChildrenIndices:function(){this.children.each(function(c,a){c.index=a})},drawScene:function(c,a){var d=this.getLayer(),d=(c=c||d&&d.getCanvas())&&c.getContext(),b=this._cache.canvas,b=b&&b.scene;this.isVisible()&&(b?this._drawCachedSceneCanvas(d):this._drawChildren(c,"drawScene",a));return this},drawHit:function(c,a){var d=this.getLayer(),d=(c=c||d&&d.hitCanvas)&&c.getContext(),b=this._cache.canvas,b=b&&b.hit;this.shouldDrawHit()&&(b?this._drawCachedHitCanvas(d):this._drawChildren(c,"drawHit",a));return this},_drawChildren:function(c,a,d){var b=this.getLayer(),f=c&&c.getContext(),e=this.getClipWidth(),g=this.getClipHeight(),h=e&&g,l,k;h&&b&&(l=this.getClipX(),k=this.getClipY(),f.save(),b._applyTransform(this,f),f.beginPath(),f.rect(l,k,e,g),f.clip(),f.reset());this.children.each(function(b){b[a](c,d)});h&&f.restore()}});Kinetic.Util.extend(Kinetic.Container,Kinetic.Node);Kinetic.Container.prototype.get=Kinetic.Container.prototype.find;Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight");Kinetic.Collection.mapMethods(Kinetic.Container)})();(function(){function c(a){a.fill()}function a(a){a.stroke()}function d(a){a.fill()}function b(a){a.stroke()}function f(){this._clearCache("hasShadow")}Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(e){this.nodeType="Shape";this._fillFunc=c;this._strokeFunc=a;this._fillFuncHit=d;this._strokeFuncHit=b;for(var g=Kinetic.shapes,h;!(h=Kinetic.Util.getRandomColor())||h in g;);this.colorKey=h;g[h]=this;Kinetic.Node.call(this,e);this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic",f)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache("hasShadow",this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},intersects:function(a){var b=this.getStage().bufferHitCanvas;b.getContext().clear();this.drawScene(b);return 0<b.context.getImageData(Math.round(a.x),Math.round(a.y),1,1).data[3]},destroy:function(){Kinetic.Node.prototype.destroy.call(this);delete Kinetic.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()&&this.getStage()},drawScene:function(a,b){var c=this.getLayer();a=(a||c.getCanvas()).getContext();var d=this._cache.canvas,f=this.sceneFunc(),m=this.hasShadow(),n;this.isVisible()&&(d?this._drawCachedSceneCanvas(a):f&&(a.save(),this._useBufferCanvas()?(d=this.getStage(),d=d.bufferCanvas,n=d.getContext(),n.clear(),n.save(),n._applyLineJoin(this),c._applyTransform(this,n,b),f.call(this,n),n.restore(),m&&(a.save(),a._applyShadow(this),a.drawImage(d._canvas,0,0),a.restore()),a._applyOpacity(this),a.drawImage(d._canvas,0,0)):(a._applyLineJoin(this),c._applyTransform(this,a,b),m&&(a.save(),a._applyShadow(this),f.call(this,a),a.restore()),a._applyOpacity(this),f.call(this,a)),a.restore()));return this},drawHit:function(a,b){var c=this.getLayer();a=(a||c.hitCanvas).getContext();var d=this.hitFunc()||this.sceneFunc(),f=this._cache.canvas,f=f&&f.hit;this.shouldDrawHit()&&(f?this._drawCachedHitCanvas(a):d&&(a.save(),a._applyLineJoin(this),c._applyTransform(this,a,b),d.call(this,a),a.restore()));return this},drawHitFromCache:function(a){a=a||0;var b=this._cache.canvas,c=this._getCachedSceneCanvas(),d=c.getContext(),b=b.hit.getContext(),f=c.getWidth(),c=c.getHeight(),m,n,r,p,q,t,u,x;b.clear();try{m=d.getImageData(0,0,f,c);n=m.data;r=b.getImageData(0,0,f,c);p=r.data;q=n.length;t=Kinetic.Util._hexToRgb(this.colorKey);for(u=0;u<q;u+=4)x=n[u+3],x>a&&(p[u]=t.r,p[u+1]=t.g,p[u+2]=t.b,p[u+3]=255);b.putImageData(r,0,0)}catch(z){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+z.message)}return this}});Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat","repeat");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0);Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});Kinetic.Collection.mapMethods(Kinetic.Shape)})();(function(){function c(a,c){a.content.addEventListener(c,function(d){a["_"+c](d)},!1)}var a="mousedown mousemove mouseup mouseout touchstart touchmove touchend mouseover".split(" "),d=a.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(a){this.nodeType="Stage";Kinetic.Container.call(this,a);this._id=Kinetic.idCounter++;this._buildDOM();this._bindContentEvents();this._enableNestedTransforms=!1;Kinetic.stages.push(this)},_validateAdd:function(a){"Layer"!==a.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(a){if("string"===typeof a){var c=a;a=Kinetic.document.getElementById(a);if(!a)throw"Can not find container in document with id "+c;}this._setAttr("container",a);return this},shouldDrawHit:function(){return!0},draw:function(){Kinetic.Node.prototype.draw.call(this);return this},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this._resizeDOM();return this},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a);this._resizeDOM();return this},clear:function(){var a=this.children,c=a.length,d;for(d=0;d<c;d++)a[d].clear();return this},clone:function(a){a||(a={});a.container=Kinetic.document.createElement("div");return Kinetic.Container.prototype.clone.call(this,a)},destroy:function(){var a=this.content;Kinetic.Container.prototype.destroy.call(this);a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a);a=Kinetic.stages.indexOf(this);-1<a&&Kinetic.stages.splice(a,1)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){function c(h){var l=n[h].toDataURL(),q=new Kinetic.window.Image;q.onload=function(){m.drawImage(q,0,0);h<n.length-1?c(h+1):a.callback(k.toDataURL(d,g))};q.src=l}a=a||{};var d=a.mimeType||null,g=a.quality||null,h=a.x||0,l=a.y||0,k=new Kinetic.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),m=k.getContext()._context,n=this.children;(h||l)&&m.translate(-1*h,-1*l);c(0)},toImage:function(a){var c=a.callback;a.callback=function(a){Kinetic.Util._getImage(a,function(a){c(a)})};this.toDataURL(a)},getIntersection:function(a){var c=this.getChildren(),d,g;for(d=c.length-1;0<=d;d--)if(g=c[d].getIntersection(a))return g;return null},_resizeDOM:function(){if(this.content){var a=this.getWidth(),c=this.getHeight(),d=this.getChildren(),g=d.length,h,l;this.content.style.width=a+"px";this.content.style.height=c+"px";this.bufferCanvas.setSize(a,c);this.bufferHitCanvas.setSize(a,c);for(h=0;h<g;h++)l=d[h],l.getCanvas().setSize(a,c),l.hitCanvas.setSize(a,c),l.draw()}},add:function(a){if(1<arguments.length)for(var c=0;c<arguments.length;c++)this.add(arguments[c]);else return Kinetic.Container.prototype.add.call(this,a),a._setCanvasSize(this.width(),this.height()),a.draw(),this.content.appendChild(a.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var b=0;b<d;b++)c(this,a[b])},_mouseover:function(a){Kinetic.UA.mobile||(this._setPointerPosition(a),this._fire("contentMouseover",{evt:a}))},_mouseout:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var c=this.targetShape;c&&!Kinetic.isDragging()&&(c._fireAndBubble("mouseout",{evt:a}),c._fireAndBubble("mouseleave",{evt:a}),this.targetShape=null);this.pointerPos=void 0;this._fire("contentMouseout",{evt:a})}},_mousemove:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var c=Kinetic.DD,d=this.getIntersection(this.getPointerPosition());d&&d.isListening()?Kinetic.isDragging()||this.targetShape&&this.targetShape._id===d._id?d._fireAndBubble("mousemove",{evt:a}):(this.targetShape&&(this.targetShape._fireAndBubble("mouseout",{evt:a},d),this.targetShape._fireAndBubble("mouseleave",{evt:a},d)),d._fireAndBubble("mouseover",{evt:a},this.targetShape),d._fireAndBubble("mouseenter",{evt:a},this.targetShape),this.targetShape=d):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble("mouseout",{evt:a}),this.targetShape._fireAndBubble("mouseleave",{evt:a}),this.targetShape=null);this._fire("contentMousemove",{evt:a});c&&c._drag(a)}a.preventDefault&&a.preventDefault()},_mousedown:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var c=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0;c&&c.isListening()&&(this.clickStartShape=c,c._fireAndBubble("mousedown",{evt:a}));this._fire("contentMousedown",{evt:a})}a.preventDefault&&a.preventDefault()},_mouseup:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var c=this.getIntersection(this.getPointerPosition()),d=this.clickStartShape,g=!1;Kinetic.inDblClickWindow?(g=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0;setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow);c&&c.isListening()&&(c._fireAndBubble("mouseup",{evt:a}),Kinetic.listenClickTap&&d&&d._id===c._id&&(c._fireAndBubble("click",{evt:a}),g&&c._fireAndBubble("dblclick",{evt:a})));this._fire("contentMouseup",{evt:a});Kinetic.listenClickTap&&(this._fire("contentClick",{evt:a}),g&&this._fire("contentDblclick",{evt:a}));Kinetic.listenClickTap=!1}a.preventDefault&&a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var c=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0;c&&c.isListening()&&(this.tapStartShape=c,c._fireAndBubble("touchstart",{evt:a}),c.isListening()&&a.preventDefault&&a.preventDefault());this._fire("contentTouchstart",{evt:a})},_touchend:function(a){this._setPointerPosition(a);var c=this.getIntersection(this.getPointerPosition()),d=!1;Kinetic.inDblClickWindow?(d=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0;setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow);c&&c.isListening()&&(c._fireAndBubble("touchend",{evt:a}),Kinetic.listenClickTap&&c._id===this.tapStartShape._id&&(c._fireAndBubble("tap",{evt:a}),d&&c._fireAndBubble("dbltap",{evt:a})),c.isListening()&&a.preventDefault&&a.preventDefault());Kinetic.listenClickTap&&(this._fire("contentTouchend",{evt:a}),d&&this._fire("contentDbltap",{evt:a}));Kinetic.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);var c=Kinetic.DD,d=this.getIntersection(this.getPointerPosition());d&&d.isListening()&&(d._fireAndBubble("touchmove",{evt:a}),d.isListening()&&a.preventDefault&&a.preventDefault());this._fire("contentTouchmove",{evt:a});c&&c._drag(a)},_setPointerPosition:function(a){var c=this._getContentPosition(),d=a.offsetX,g=a.clientX,h=null,l=null;a=a?a:window.event;void 0!==a.touches?0<a.touches.length&&(a=a.touches[0],h=a.clientX-c.left,l=a.clientY-c.top):void 0!==d?(h=d,l=a.offsetY):"mozilla"===Kinetic.UA.browser?(h=a.layerX,l=a.layerY):void 0!==g&&c&&(h=g-c.left,l=a.clientY-c.top);null!==h&&null!==l&&(this.pointerPos={x:h,y:l})},_getContentPosition:function(){var a=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();if(!a){if(Kinetic.Util.isBrowser())throw"Stage has not container. But container is required";a=Kinetic.document.createElement("div")}a.innerHTML="";this.content=Kinetic.document.createElement("div");this.content.style.position="relative";this.content.style.display="inline-block";this.content.className="kineticjs-content";this.content.setAttribute("role","presentation");a.appendChild(this.content);this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1});this.bufferHitCanvas=new Kinetic.HitCanvas;this._resizeDOM()},_onContent:function(a,c){a=a.split(" ");var d=a.length,g,h;for(g=0;g<d;g++)h=a[g],this.content.addEventListener(h,c,!1)},cache:function(){Kinetic.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.")},clearCache:function(){}});Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container);Kinetic.Factory.addGetter(Kinetic.Stage,"container");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")})();(function(){Kinetic.Util.addMethods(Kinetic.BaseLayer,{___init:function(c){this.nodeType="Layer";Kinetic.Container.call(this,c)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(c){this.getContext().clear(c);this.getHitCanvas().getContext().clear(c);return this},setZIndex:function(c){Kinetic.Node.prototype.setZIndex.call(this,c);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),c<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[c+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas));return this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var c=this.getStage();c&&(c.content.removeChild(this.getCanvas()._canvas),c.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var c=this.getStage();c&&(c.content.removeChild(this.getCanvas()._canvas),this.index<c.getChildren().length-1?c.content.insertBefore(this.getCanvas()._canvas,c.getChildren()[this.index+1].getCanvas()._canvas):c.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var c=this.getStage();if(c){var a=c.getChildren();c.content.removeChild(this.getCanvas()._canvas);c.content.insertBefore(this.getCanvas()._canvas,a[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var c=this.getStage();if(c){var a=c.getChildren();c.content.removeChild(this.getCanvas()._canvas);c.content.insertBefore(this.getCanvas()._canvas,a[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var c=this.getCanvas()._canvas;Kinetic.Node.prototype.remove.call(this);c&&c.parentNode&&Kinetic.Util._isInDocument(c)&&c.parentNode.removeChild(c);return this},getStage:function(){return this.parent}});Kinetic.Util.extend(Kinetic.BaseLayer,Kinetic.Container);Kinetic.Factory.addGetterSetter(Kinetic.BaseLayer,"clearBeforeDraw",!0);Kinetic.Collection.mapMethods(Kinetic.BaseLayer)})();(function(){var c=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],a=c.length;Kinetic.Util.addMethods(Kinetic.Layer,{____init:function(a){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas;this.hitCanvas=new Kinetic.HitCanvas;Kinetic.BaseLayer.call(this,a)},_setCanvasSize:function(a,b){this.canvas.setSize(a,b);this.hitCanvas.setSize(a,b)},_validateAdd:function(a){a=a.getType();"Group"!==a&&"Shape"!==a&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(d){var b,f,e;if(this.hitGraphEnabled()&&this.isVisible())for(f=0;f<a;f++){b=c[f];b=this._getIntersection({x:d.x+b.x,y:d.y+b.y});if(e=b.shape)return e;if(!b.antialiased)return null}else return null},_getIntersection:function(a){a=this.hitCanvas.context._context.getImageData(a.x,a.y,1,1).data;var b=a[3];return 255===b?(a=Kinetic.Util._rgbToHex(a[0],a[1],a[2]),a=Kinetic.shapes["#"+a],{shape:a}):0<b?{antialiased:!0}:{}},drawScene:function(a,b){var c=this.getLayer();a=a||c&&c.getCanvas();this._fire("beforeDraw",{node:this});this.getClearBeforeDraw()&&a.getContext().clear();Kinetic.Container.prototype.drawScene.call(this,a,b);this._fire("draw",{node:this});return this},_applyTransform:function(a,b,c){a=a.getAbsoluteTransform(c).getMatrix();b.transform(a[0],a[1],a[2],a[3],a[4],a[5])},drawHit:function(a,b){var c=this.getLayer();a=a||c&&c.hitCanvas;c&&c.getClearBeforeDraw()&&c.getHitCanvas().getContext().clear();Kinetic.Container.prototype.drawHit.call(this,a,b);return this},clear:function(a){this.getContext().clear(a);this.getHitCanvas().getContext().clear(a);return this},setVisible:function(a){Kinetic.Node.prototype.setVisible.call(this,a);a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none");return this},enableHitGraph:function(){this.setHitGraphEnabled(!0);return this},disableHitGraph:function(){this.setHitGraphEnabled(!1);return this}});Kinetic.Util.extend(Kinetic.Layer,Kinetic.BaseLayer);Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",!0);Kinetic.Collection.mapMethods(Kinetic.Layer)})();(function(){Kinetic.Util.addMethods(Kinetic.FastLayer,{____init:function(c){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas;Kinetic.BaseLayer.call(this,c)},_validateAdd:function(c){"Shape"!==c.getType()&&Kinetic.Util.error("You may only add shapes to a fast layer.")},_setCanvasSize:function(c,a){this.canvas.setSize(c,a)},hitGraphEnabled:function(){return!1},getIntersection:function(){return null},drawScene:function(c){var a=this.getLayer();c=c||a&&a.getCanvas();this.getClearBeforeDraw()&&c.getContext().clear();Kinetic.Container.prototype.drawScene.call(this,c);return this},_applyTransform:function(c,a,d){d&&d._id===this._id||(c=c.getTransform().getMatrix(),a.transform(c[0],c[1],c[2],c[3],c[4],c[5]))},draw:function(){this.drawScene();return this},clear:function(c){this.getContext().clear(c);return this},setVisible:function(c){Kinetic.Node.prototype.setVisible.call(this,c);c?this.getCanvas()._canvas.style.display="block":this.getCanvas()._canvas.style.display="none";return this}});Kinetic.Util.extend(Kinetic.FastLayer,Kinetic.BaseLayer);Kinetic.Collection.mapMethods(Kinetic.FastLayer)})();(function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(c){this.nodeType="Group";Kinetic.Container.call(this,c)},_validateAdd:function(c){c=c.getType();"Group"!==c&&"Shape"!==c&&Kinetic.Util.error("You may only add groups and shapes to groups.")}});Kinetic.Util.extend(Kinetic.Group,Kinetic.Container);Kinetic.Collection.mapMethods(Kinetic.Group)})();(function(){Kinetic.Rect=function(c){this.___init(c)};Kinetic.Rect.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Rect";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.getCornerRadius(),d=this.getWidth(),b=this.getHeight();c.beginPath();a?(c.moveTo(a,0),c.lineTo(d-a,0),c.arc(d-a,a,a,3*Math.PI/2,0,!1),c.lineTo(d,b-a),c.arc(d-a,b-a,a,0,Math.PI/2,!1),c.lineTo(a,b),c.arc(a,b-a,a,Math.PI/2,Math.PI,!1),c.lineTo(0,a),c.arc(a,a,a,Math.PI,3*Math.PI/2,!1)):c.rect(0,0,d,b);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Rect)})();(function(){var c=2*Math.PI-1E-4;Kinetic.Circle=function(a){this.___init(a)};Kinetic.Circle.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Circle";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath();a.arc(0,0,this.getRadius(),0,c,!1);a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a);this.setRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this.setRadius(a/2)}};Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0);Kinetic.Collection.mapMethods(Kinetic.Circle)})();(function(){var c=2*Math.PI-1E-4;Kinetic.Ellipse=function(a){this.___init(a)};Kinetic.Ellipse.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Ellipse";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var d=this.getRadius(),b=d.x,d=d.y;a.beginPath();a.save();b!==d&&a.scale(1,d/b);a.arc(0,0,b,0,c,!1);a.restore();a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a);this.setRadius({x:a/2})},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this.setRadius({y:a/2})}};Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0);Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0);Kinetic.Collection.mapMethods(Kinetic.Ellipse)})();(function(){var c=2*Math.PI-1E-4;Kinetic.Ring=function(a){this.___init(a)};Kinetic.Ring.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Ring";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath();a.arc(0,0,this.getInnerRadius(),0,c,!1);a.moveTo(this.getOuterRadius(),0);a.arc(0,0,this.getOuterRadius(),c,0,!0);a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a);this.setOuterRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this.setOuterRadius(a/2)}};Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Ring,"outerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Ring)})();(function(){Kinetic.Wedge=function(c){this.___init(c)};Kinetic.Wedge.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Wedge";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){c.beginPath();c.arc(0,0,this.getRadius(),0,Kinetic.getAngle(this.getAngle()),this.getClockwise());c.lineTo(0,0);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1);Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});Kinetic.Collection.mapMethods(Kinetic.Wedge)})();(function(){Kinetic.Arc=function(c){this.___init(c)};Kinetic.Arc.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Arc";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=Kinetic.getAngle(this.angle()),d=this.clockwise();c.beginPath();c.arc(0,0,this.getOuterRadius(),0,a,d);c.arc(0,0,this.getInnerRadius(),a,0,!d);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"outerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",!1);Kinetic.Collection.mapMethods(Kinetic.Arc)})();(function(){Kinetic.Image=function(c){this.___init(c)};Kinetic.Image.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Image";this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_sceneFunc:function(c){var a=this.getWidth(),d=this.getHeight(),b=this.getImage(),f,e,g;b&&(f=this.getCrop(),e=f.width,g=f.height,f=e&&g?[b,f.x,f.y,e,g,0,0,a,d]:[b,0,0,a,d]);c.beginPath();c.rect(0,0,a,d);c.closePath();c.fillStrokeShape(this);b&&c.drawImage.apply(c,f)},_hitFunc:function(c){var a=this.getWidth(),d=this.getHeight();c.beginPath();c.rect(0,0,a,d);c.closePath();c.fillStrokeShape(this)},getWidth:function(){var c=this.getImage();return this.attrs.width||(c?c.width:0)},getHeight:function(){var c=this.getImage();return this.attrs.height||(c?c.height:0)}};Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Image,"image");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,"crop",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0);Kinetic.Collection.mapMethods(Kinetic.Image)})();(function(){function c(a){a.fillText(this.partialText,0,0)}function a(a){a.strokeText(this.partialText,0,0)}var d="fontFamily fontSize fontStyle fontVariant padding align lineHeight text width height wrap".split(" "),b=d.length,f=Kinetic.Util.createCanvasElement().getContext("2d");Kinetic.Text=function(a){this.___init(a)};Kinetic.Text.prototype={___init:function(e){void 0===e.width&&(e.width="auto");void 0===e.height&&(e.height="auto");Kinetic.Shape.call(this,e);this._fillFunc=c;this._strokeFunc=a;this.className="Text";for(e=0;e<b;e++)this.on(d[e]+"Change.kinetic",this._setTextData);this._setTextData();this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b=this.getPadding(),c=this.getTextHeight(),d=this.getLineHeight()*c,f=this.textArr,m=f.length,n=this.getWidth();a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();a.translate(b,0);a.translate(0,b+c/2);for(c=0;c<m;c++){var r=f[c],p=r.text,r=r.width;a.save();"right"===this.getAlign()?a.translate(n-r-2*b,0):"center"===this.getAlign()&&a.translate((n-r-2*b)/2,0);this.partialText=p;a.fillStrokeShape(this);a.restore();a.translate(0,d)}a.restore()},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath();a.rect(0,0,b,c);a.closePath();a.fillStrokeShape(this)},setText:function(a){a=Kinetic.Util._isString(a)?a:a.toString();this._setAttr("text",a);return this},getWidth:function(){return"auto"===this.attrs.width?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return"auto"===this.attrs.height?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b=this.getFontSize();f.save();f.font=this._getContextFont();a=f.measureText(a);f.restore();return{width:a.width,height:parseInt(b,10)}},_getContextFont:function(){return this.getFontStyle()+" "+this.getFontVariant()+" "+this.getFontSize()+"px "+this.getFontFamily()},_addTextLine:function(a,b){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return f.measureText(a).width},_setTextData:function(){var a=this.getText().split("\n"),b=+this.getFontSize(),c=0,d=this.getLineHeight()*b,k=this.attrs.width,m=this.attrs.height,n="auto"!==k,r="auto"!==m,p=this.getPadding(),k=k-2*p,m=m-2*p,p=0,q=this.getWrap(),t="none"!==q,q="char"!==q&&t;this.textArr=[];f.save();f.font=this._getContextFont();for(var u=0,x=a.length;u<x;++u){var z=a[u],y=this._getTextWidth(z);if(n&&y>k)for(;0<z.length;){for(var y=0,A=z.length,w="",C=0;y<A;){var D=y+A>>>1,I=z.slice(0,D+1),E=this._getTextWidth(I);E<=k?(y=D+1,w=I,C=E):A=D}if(w){q&&(A=Math.max(w.lastIndexOf(" "),w.lastIndexOf("-"))+1,0<A&&(y=A,w=w.slice(0,y),C=this._getTextWidth(w)));this._addTextLine(w,C);c=Math.max(c,C);p+=d;if(!t||r&&p+d>m)break;z=z.slice(y);if(0<z.length&&(y=this._getTextWidth(z),y<=k)){this._addTextLine(z,y);p+=d;c=Math.max(c,y);break}}else break}else this._addTextLine(z,y),p+=d,c=Math.max(c,y);if(r&&p+d>m)break}f.restore();this.textHeight=b;this.textWidth=c}};Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle","normal");Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontVariant","normal");Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0);Kinetic.Factory.addGetterSetter(Kinetic.Text,"align","left");Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1);Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap","word");Kinetic.Factory.addGetter(Kinetic.Text,"text","");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text");Kinetic.Collection.mapMethods(Kinetic.Text)})();(function(){Kinetic.Line=function(c){this.___init(c)};Kinetic.Line.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Line";this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.getPoints(),d=a.length,b=this.getTension(),f=this.getClosed(),e,g;c.beginPath();c.moveTo(a[0],a[1]);if(0!==b&&4<d){b=this.getTensionPoints();e=b.length;g=f?0:4;for(f||c.quadraticCurveTo(b[0],b[1],b[2],b[3]);g<e-2;)c.bezierCurveTo(b[g++],b[g++],b[g++],b[g++],b[g++],b[g++]);f||c.quadraticCurveTo(b[e-2],b[e-1],a[d-2],a[d-1])}else for(g=2;g<d;g+=2)c.lineTo(a[g],a[g+1]);f?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():Kinetic.Util._expandPoints(this.getPoints(),this.getTension())},_getTensionPointsClosed:function(){var c=this.getPoints(),a=c.length,d=this.getTension(),b=Kinetic.Util,f=b._getControlPoints(c[a-2],c[a-1],c[0],c[1],c[2],c[3],d),b=b._getControlPoints(c[a-4],c[a-3],c[a-2],c[a-1],c[0],c[1],d),d=Kinetic.Util._expandPoints(c,d);return[f[2],f[3]].concat(d).concat([b[0],b[1],c[a-2],c[a-1],b[2],b[3],f[0],f[1],c[0],c[1]])}};Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",!1);Kinetic.Factory.addGetterSetter(Kinetic.Line,"tension",0);Kinetic.Factory.addGetterSetter(Kinetic.Line,"points");Kinetic.Collection.mapMethods(Kinetic.Line)})();(function(){Kinetic.Sprite=function(c){this.___init(c)};Kinetic.Sprite.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Sprite";this.anim=new Kinetic.Animation;this.on("animationChange.kinetic",function(){this.frameIndex(0)});this.on("frameRateChange.kinetic",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())});this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(c){var a=this.getAnimation(),d=4*this.frameIndex(),b=this.getAnimations()[a],a=b[d+0],f=b[d+1],e=b[d+2],d=b[d+3];(b=this.getImage())&&c.drawImage(b,a,f,e,d,0,0,e,d)},_hitFunc:function(c){var a=this.getAnimation(),d=4*this.frameIndex(),b=this.getAnimations()[a],a=b[d+2],d=b[d+3];c.beginPath();c.rect(0,0,a,d);c.closePath();c.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_setInterval:function(){var c=this;this.interval=setInterval(function(){c._updateIndex()},1E3/this.getFrameRate())},start:function(){var c=this.getLayer();this.anim.setLayers(c);this._setInterval();this.anim.start()},stop:function(){this.anim.stop();clearInterval(this.interval)},isRunning:function(){return this.anim.isRunning()},_updateIndex:function(){var c=this.frameIndex(),a=this.getAnimation(),a=this.getAnimations()[a].length/4;c<a-1?this.frameIndex(c+1):this.frameIndex(0)}};Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17);Kinetic.Factory.backCompat(Kinetic.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});Kinetic.Collection.mapMethods(Kinetic.Sprite)})();(function(){Kinetic.Path=function(c){this.___init(c)};Kinetic.Path.prototype={___init:function(c){this.dataArray=[];var a=this;Kinetic.Shape.call(this,c);this.className="Path";this.dataArray=Kinetic.Path.parsePathData(this.getData());this.on("dataChange.kinetic",function(){a.dataArray=Kinetic.Path.parsePathData(this.getData())});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.dataArray,d=!1;c.beginPath();for(var b=0;b<a.length;b++){var f=a[b].points;switch(a[b].command){case "L":c.lineTo(f[0],f[1]);break;case "M":c.moveTo(f[0],f[1]);break;case "C":c.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case "Q":c.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case "A":var e=f[0],g=f[1],h=f[2],l=f[3],k=f[4],m=f[5],n=f[6],f=f[7],r=h>l?h:l,p=h>l?1:h/l,h=h>l?l/h:1;c.translate(e,g);c.rotate(n);c.scale(p,h);c.arc(0,0,r,k,k+m,1-f);c.scale(1/p,1/h);c.rotate(-n);c.translate(-e,-g);break;case "z":c.closePath(),d=!0}}d?c.fillStrokeShape(this):c.strokeShape(this)}};Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape);Kinetic.Path.getLineLength=function(c,a,d,b){return Math.sqrt((d-c)*(d-c)+(b-a)*(b-a))};Kinetic.Path.getPointOnLine=function(c,a,d,b,f,e,g){void 0===e&&(e=a);void 0===g&&(g=d);var h=(f-d)/(b-a+1E-8),l=Math.sqrt(c*c/(1+h*h));b<a&&(l*=-1);var k=h*l;if(b===a)a={x:e,y:g+k};else if((g-d)/(e-a+1E-8)===h)a={x:e+l,y:g+k};else{k=this.getLineLength(a,d,b,f);if(1E-8>k)return;l=((e-a)*(b-a)+(g-d)*(f-d))/(k*k);k=a+l*(b-a);d+=l*(f-d);e=this.getLineLength(e,g,k,d);c=Math.sqrt(c*c-e*e);l=Math.sqrt(c*c/(1+h*h));b<a&&(l*=-1);a={x:k+l,y:d+h*l}}return a};Kinetic.Path.getPointOnCubicBezier=function(c,a,d,b,f,e,g,h,l){return{x:h*c*c*c+3*e*c*c*(1-c)+3*b*c*(1-c)*(1-c)+a*(1-c)*(1-c)*(1-c),y:l*c*c*c+3*g*c*c*(1-c)+3*f*c*(1-c)*(1-c)+d*(1-c)*(1-c)*(1-c)}};Kinetic.Path.getPointOnQuadraticBezier=function(c,a,d,b,f,e,g){return{x:e*c*c+2*b*c*(1-c)+a*(1-c)*(1-c),y:g*c*c+2*f*c*(1-c)+d*(1-c)*(1-c)}};Kinetic.Path.getPointOnEllipticalArc=function(c,a,d,b,f,e){var g=Math.cos(e);e=Math.sin(e);d*=Math.cos(f);b*=Math.sin(f);return{x:c+(d*g-b*e),y:a+(d*e+b*g)}};Kinetic.Path.parsePathData=function(c){if(!c)return[];var a,d="mMlLvVhHzZcCqQtTsSaA".split("");a=c.replace(/ /g,",");for(c=0;c<d.length;c++)a=a.replace(new RegExp(d[c],"g"),"|"+d[c]);d=a.split("|");a=[];var b=0,f=0;for(c=1;c<d.length;c++){var e=d[c],g=e.charAt(0),e=e.slice(1),e=e.replace(/,-/g,"-"),e=e.replace(/-/g,",-"),e=e.replace(/e,-/g,"e-"),e=e.split(",");0<e.length&&""===e[0]&&e.shift();for(var h=0;h<e.length;h++)e[h]=parseFloat(e[h]);for(;0<e.length&&!isNaN(e[0]);){var l=null,k=[],h=b,m=f,n,r,p,q,t,u;switch(g){case "l":b+=e.shift();f+=e.shift();l="L";k.push(b,f);break;case "L":b=e.shift();f=e.shift();k.push(b,f);break;case "m":g=e.shift();n=e.shift();b+=g;f+=n;l="M";if(2<a.length&&"z"===a[a.length-1].command)for(r=a.length-2;0<=r;r--)if("M"===a[r].command){b=a[r].points[0]+g;f=a[r].points[1]+n;break}k.push(b,f);g="l";break;case "M":b=e.shift();f=e.shift();l="M";k.push(b,f);g="L";break;case "h":b+=e.shift();l="L";k.push(b,f);break;case "H":b=e.shift();l="L";k.push(b,f);break;case "v":f+=e.shift();l="L";k.push(b,f);break;case "V":f=e.shift();l="L";k.push(b,f);break;case "C":k.push(e.shift(),e.shift(),e.shift(),e.shift());b=e.shift();f=e.shift();k.push(b,f);break;case "c":k.push(b+e.shift(),f+e.shift(),b+e.shift(),f+e.shift());b+=e.shift();f+=e.shift();l="C";k.push(b,f);break;case "S":n=b;r=f;l=a[a.length-1];"C"===l.command&&(n=b+(b-l.points[2]),r=f+(f-l.points[3]));k.push(n,r,e.shift(),e.shift());b=e.shift();f=e.shift();l="C";k.push(b,f);break;case "s":n=b;r=f;l=a[a.length-1];"C"===l.command&&(n=b+(b-l.points[2]),r=f+(f-l.points[3]));k.push(n,r,b+e.shift(),f+e.shift());b+=e.shift();f+=e.shift();l="C";k.push(b,f);break;case "Q":k.push(e.shift(),e.shift());b=e.shift();f=e.shift();k.push(b,f);break;case "q":k.push(b+e.shift(),f+e.shift());b+=e.shift();f+=e.shift();l="Q";k.push(b,f);break;case "T":n=b;r=f;l=a[a.length-1];"Q"===l.command&&(n=b+(b-l.points[0]),r=f+(f-l.points[1]));b=e.shift();f=e.shift();l="Q";k.push(n,r,b,f);break;case "t":n=b;r=f;l=a[a.length-1];"Q"===l.command&&(n=b+(b-l.points[0]),r=f+(f-l.points[1]));b+=e.shift();f+=e.shift();l="Q";k.push(n,r,b,f);break;case "A":k=e.shift();n=e.shift();r=e.shift();p=e.shift();q=e.shift();t=b;u=f;b=e.shift();f=e.shift();l="A";k=this.convertEndpointToCenterParameterization(t,u,b,f,p,q,k,n,r);break;case "a":k=e.shift(),n=e.shift(),r=e.shift(),p=e.shift(),q=e.shift(),t=b,u=f,b+=e.shift(),f+=e.shift(),l="A",k=this.convertEndpointToCenterParameterization(t,u,b,f,p,q,k,n,r)}a.push({command:l||g,points:k,start:{x:h,y:m},pathLength:this.calcLength(h,m,l||g,k)})}"z"!==g&&"Z"!==g||a.push({command:"z",points:[],start:void 0,pathLength:0})}return a};Kinetic.Path.calcLength=function(c,a,d,b){var f,e,g,h=Kinetic.Path;switch(d){case "L":return h.getLineLength(c,a,b[0],b[1]);case "C":d=0;f=h.getPointOnCubicBezier(0,c,a,b[0],b[1],b[2],b[3],b[4],b[5]);for(g=.01;1>=g;g+=.01)e=h.getPointOnCubicBezier(g,c,a,b[0],b[1],b[2],b[3],b[4],b[5]),d+=h.getLineLength(f.x,f.y,e.x,e.y),f=e;return d;case "Q":d=0;f=h.getPointOnQuadraticBezier(0,c,a,b[0],b[1],b[2],b[3]);for(g=.01;1>=g;g+=.01)e=h.getPointOnQuadraticBezier(g,c,a,b[0],b[1],b[2],b[3]),d+=h.getLineLength(f.x,f.y,e.x,e.y),f=e;return d;case "A":d=0;e=b[4];g=b[5];c=b[4]+g;a=Math.PI/180;Math.abs(e-c)<a&&(a=Math.abs(e-c));f=h.getPointOnEllipticalArc(b[0],b[1],b[2],b[3],e,0);if(0>g)for(g=e-a;g>c;g-=a)e=h.getPointOnEllipticalArc(b[0],b[1],b[2],b[3],g,0),d+=h.getLineLength(f.x,f.y,e.x,e.y),f=e;else for(g=e+a;g<c;g+=a)e=h.getPointOnEllipticalArc(b[0],b[1],b[2],b[3],g,0),d+=h.getLineLength(f.x,f.y,e.x,e.y),f=e;e=h.getPointOnEllipticalArc(b[0],b[1],b[2],b[3],c,0);return d+=h.getLineLength(f.x,f.y,e.x,e.y)}return 0};Kinetic.Path.convertEndpointToCenterParameterization=function(c,a,d,b,f,e,g,h,l){l*=Math.PI/180;var k=Math.cos(l)*(c-d)/2+Math.sin(l)*(a-b)/2,m=-1*Math.sin(l)*(c-d)/2+Math.cos(l)*(a-b)/2,n=k*k/(g*g)+m*m/(h*h);1<n&&(g*=Math.sqrt(n),h*=Math.sqrt(n));n=Math.sqrt((g*g*h*h-g*g*m*m-h*h*k*k)/(g*g*m*m+h*h*k*k));f===e&&(n*=-1);isNaN(n)&&(n=0);f=n*g*m/h;n=n*-h*k/g;c=(c+d)/2+Math.cos(l)*f-Math.sin(l)*n;a=(a+b)/2+Math.sin(l)*f+Math.cos(l)*n;var r=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(a[0]*a[0]+a[1]*a[1])*Math.sqrt(b[0]*b[0]+b[1]*b[1]))},p=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(r(a,b))};b=p([1,0],[(k-f)/g,(m-n)/h]);d=[(k-f)/g,(m-n)/h];k=[(-1*k-f)/g,(-1*m-n)/h];m=p(d,k);-1>=r(d,k)&&(m=Math.PI);1<=r(d,k)&&(m=0);0===e&&0<m&&(m-=2*Math.PI);1===e&&0>m&&(m+=2*Math.PI);return[c,a,g,h,b,m,l,e]};Kinetic.Factory.addGetterSetter(Kinetic.Path,"data");Kinetic.Collection.mapMethods(Kinetic.Path)})();(function(){function c(a){a.fillText(this.partialText,0,0)}function a(a){a.strokeText(this.partialText,0,0)}Kinetic.TextPath=function(a){this.___init(a)};Kinetic.TextPath.prototype={___init:function(d){var b=this;this.dummyCanvas=Kinetic.Util.createCanvasElement();this.dataArray=[];Kinetic.Shape.call(this,d);this._fillFunc=c;this._strokeFunc=a;this._fillFuncHit=c;this._strokeFuncHit=a;this.className="TextPath";this.dataArray=Kinetic.Path.parsePathData(this.attrs.data);this.on("dataChange.kinetic",function(){b.dataArray=Kinetic.Path.parsePathData(this.attrs.data)});this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",b._setTextData);b._setTextData();this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();for(var b=this.glyphInfo,c=0;c<b.length;c++){a.save();var e=b[c].p0;a.translate(e.x,e.y);a.rotate(b[c].rotation);this.partialText=b[c].text;a.fillStrokeShape(this);a.restore()}a.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(a){Kinetic.Text.prototype.setText.call(this,a)},_getTextSize:function(a){var b=this.dummyCanvas.getContext("2d");b.save();b.font=this._getContextFont();a=b.measureText(a);b.restore();return{width:a.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this._getTextSize(this.attrs.text);this.textWidth=a.width;this.textHeight=a.height;this.glyphInfo=[];for(var a=this.attrs.text.split(""),b,c,e,g=-1,h=0,l=0;l<a.length;l++){var k=this._getTextSize(a[l]).width,m=0,n=0;for(c=void 0;.01<Math.abs(k-m)/k&&25>n;){n++;for(var r=m;void 0===e;){a:{h=0;e=this.dataArray;for(var p=g+1;p<e.length;p++)if(0<e[p].pathLength){g=p;e=e[p];break a}else"M"==e[p].command&&(b={x:e[p].points[0],y:e[p].points[1]});e={}}e&&r+e.pathLength<k&&(r+=e.pathLength,e=void 0)}if(e==={}||void 0===b)break;r=!1;switch(e.command){case "L":Kinetic.Path.getLineLength(b.x,b.y,e.points[0],e.points[1])>k?c=Kinetic.Path.getPointOnLine(k,b.x,b.y,e.points[0],e.points[1],b.x,b.y):e=void 0;break;case "A":c=e.points[4];var p=e.points[5],q=e.points[4]+p,h=0===h?c+1E-8:k>m?h+Math.PI/180*p/Math.abs(p):h-Math.PI/360*p/Math.abs(p);if(0>p&&h<q||0<=p&&h>q)h=q,r=!0;c=Kinetic.Path.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],h,e.points[6]);break;case "C":h=0===h?k>e.pathLength?1E-8:k/e.pathLength:k>m?h+(k-m)/e.pathLength:h-(m-k)/e.pathLength;1<h&&(h=1,r=!0);c=Kinetic.Path.getPointOnCubicBezier(h,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);break;case "Q":h=0===h?k/e.pathLength:k>m?h+(k-m)/e.pathLength:h-(m-k)/e.pathLength,1<h&&(h=1,r=!0),c=Kinetic.Path.getPointOnQuadraticBezier(h,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3])}void 0!==c&&(m=Kinetic.Path.getLineLength(b.x,b.y,c.x,c.y));r&&(e=void 0)}if(void 0===b||void 0===c)break;k=Kinetic.Path.getLineLength(b.x,b.y,c.x,c.y);k=Kinetic.Path.getPointOnLine(0+k/2,b.x,b.y,c.x,c.y);this.glyphInfo.push({transposeX:k.x,transposeY:k.y,text:a[l],rotation:Math.atan2(c.y-b.y,c.x-b.x),p0:b,p1:c});b=c}}};Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont;Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle","normal");Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontVariant","normal");Kinetic.Factory.addGetter(Kinetic.TextPath,"text","");Kinetic.Collection.mapMethods(Kinetic.TextPath)})();(function(){Kinetic.RegularPolygon=function(c){this.___init(c)};Kinetic.RegularPolygon.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="RegularPolygon";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.attrs.sides,d=this.attrs.radius,b,f,e;c.beginPath();c.moveTo(0,0-d);for(b=1;b<a;b++)f=d*Math.sin(2*b*Math.PI/a),e=-1*d*Math.cos(2*b*Math.PI/a),c.lineTo(f,e);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0);Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)})();(function(){Kinetic.Star=function(c){this.___init(c)};Kinetic.Star.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Star";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.innerRadius(),d=this.outerRadius(),b=this.numPoints();c.beginPath();c.moveTo(0,0-d);for(var f=1;f<2*b;f++){var e=0===f%2?d:a;c.lineTo(e*Math.sin(f*Math.PI/b),-1*e*Math.cos(f*Math.PI/b))}c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",5);Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Star)})();(function(){var c="fontFamily fontSize fontStyle padding lineHeight text".split(" "),a=c.length;Kinetic.Label=function(a){this.____init(a)};Kinetic.Label.prototype={____init:function(a){var b=this;this.className="Label";Kinetic.Group.call(this,a);this.on("add.kinetic",function(a){b._addListeners(a.child);b._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(d){var b=this,f,e=function(){b._sync()};for(f=0;f<a;f++)d.on(c[f]+"Change.kinetic",e)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var a=this.getText(),b=this.getTag(),c,e,g,h,l,k,m;if(a&&b){c=a.getWidth();e=a.getHeight();g=b.getPointerDirection();h=b.getPointerWidth();m=b.getPointerHeight();k=l=0;switch(g){case "up":l=c/2;k=-1*m;break;case "right":l=c+h;k=e/2;break;case "down":l=c/2;k=e+m;break;case "left":l=-1*h,k=e/2}b.setAttrs({x:-1*l,y:-1*k,width:c,height:e});a.setAttrs({x:-1*l,y:-1*k})}}};Kinetic.Util.extend(Kinetic.Label,Kinetic.Group);Kinetic.Collection.mapMethods(Kinetic.Label);Kinetic.Tag=function(a){this.___init(a)};Kinetic.Tag.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Tag";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getWidth(),c=this.getHeight(),e=this.getPointerDirection(),g=this.getPointerWidth(),h=this.getPointerHeight();a.beginPath();a.moveTo(0,0);"up"===e&&(a.lineTo((b-g)/2,0),a.lineTo(b/2,-1*h),a.lineTo((b+g)/2,0));a.lineTo(b,0);"right"===e&&(a.lineTo(b,(c-h)/2),a.lineTo(b+g,c/2),a.lineTo(b,(c+h)/2));a.lineTo(b,c);"down"===e&&(a.lineTo((b+g)/2,c),a.lineTo(b/2,c+h),a.lineTo((b-g)/2,c));a.lineTo(0,c);"left"===e&&(a.lineTo(0,(c+h)/2),a.lineTo(-1*g,c/2),a.lineTo(0,(c-h)/2));a.closePath();a.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection","none");Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Tag)})();