var EmpGlobalZoom=1,EmpGlobalLeft=0,EmpGlobalTop=0;function EmpAutoBodySize(){if(!isBuilderMode){var a=0,b=0,c=1,d=window.innerWidth,g=window.innerHeight;3==ResizePolicy?g>=winFixHeight&&d>=winFixWidth?(a=toInt((d-winFixWidth)/2),b=toInt((g-winFixHeight)/2),c=1):d/g>winFixWidth/winFixHeight?(c=g/winFixHeight,a=toInt((d-winFixWidth*c)/2)):(c=d/winFixWidth,b=toInt((g-winFixHeight*c)/2)):1==ResizePolicy?d>=winFixWidth?(c=1,a=toInt((d-winFixWidth)/2),b=toInt((g-winFixHeight)/2)):(c=d/winFixWidth,b=toInt((g-winFixHeight*c)/2),0>b&&(b=0),a=0):2==ResizePolicy?g>=winFixHeight?(c=1,a=toInt((d-winFixWidth)/2),b=toInt((g-winFixHeight)/2)):(c=g/winFixHeight,b=0,a=toInt((d-winFixWidth*c)/2)):4==ResizePolicy?(b=a=0,document.body.style.width="100%",document.body.style.height="100%"):(c=1,a=toInt((d-winFixWidth)/2),b=toInt((g-winFixHeight)/2),0>b&&(b=0),0>a&&(a=0));-1!==navigator.userAgent.indexOf("Firefox")?(document.body.style.left=a+"px",document.body.style.top=b+"px",document.body.style.MozTransformOrigin="top left",document.body.style.MozTransform="scale("+c+")"):-1!==navigator.userAgent.indexOf("Trident")||-1!==navigator.userAgent.indexOf("MSIE")?(document.body.style.left=toInt(a)+"px",document.body.style.top=toInt(b)+"px",document.body.style.zoom=c,EmpGlobalZoom=1,EmpGlobalLeft=toInt(a),EmpGlobalTop=toInt(b)):(document.body.style.left=toInt(a/c)+"px",document.body.style.top=toInt(b/c)+"px",EmpGlobalZoom=document.body.style.zoom=c,EmpGlobalLeft=toInt(a/c),EmpGlobalTop=toInt(b/c))}}function cancelTrans(a){a=a?a:window.event;window.event?a.cancelBubble=!0:a.stopPropagation()}function EmpDetectZoom(){var a=0,b=window.screen,c=navigator.userAgent.toLowerCase();void 0!==window.devicePixelRatio?a=window.devicePixelRatio:~c.indexOf("msie")?b.deviceXDPI&&b.logicalXDPI&&(a=b.deviceXDPI/b.logicalXDPI):void 0!==window.outerWidth&&void 0!==window.innerWidth&&(a=window.outerWidth/window.innerWidth);return a}function EmpGetSelfUrl(a){var b=window.location.href.split("?");if(2!=b.length)return"";for(var c in b[1]){var d=b[1].split("\x26"),g;for(g in d){var n=d[c].split("\x3d");if(n&&n[0]==a)return n[1]}}return""}var EmpSortBy=function(a){return function(b,c){var d,g;if("object"===typeof b&&"object"===typeof c&&b&&c)return d=b[a],g=c[a],d===g?0:typeof d===typeof g?d<g?-1:1:typeof d<typeof g?-1:1;throw"error";}};function toInt(a){return a&&+a|0||0}function EmpApplyKeyframeByJs(a,b,c){for(var d=[],g=a.data.sort(EmpSortBy("index")),n=0;n<a.count-1;++n)if(b>=g[n].index&&b<=g[n+1].index){var l=(b-g[n].index)/(g[n+1].index-g[n].index),m;for(m in g[n])d[m]=g[n][m]+(g[n+1][m]-g[n][m])*l}a=a.css;b={};var k,q,h,r,f;for(f in a)"background-color"==a[f]||"color"==a[f]?b[a[f]]="rgba("+toInt(d[a[f]+".r"])+","+toInt(d[a[f]+".g"])+","+toInt(d[a[f]+".b"])+","+d[a[f]+".a"]+")":"left"==a[f]||"top"==a[f]||"width"==a[f]||"height"==a[f]||"font-size"==a[f]||"text-indent"==a[f]||"letter-spacing"==a[f]?b[a[f]]=d[a[f]]+"px":"opacity"==a[f]||"font-weight"==a[f]||"line-height"==a[f]?b[a[f]]=d[a[f]]:"transform-origin"==a[f]?b[a[f]]=toInt(d[a[f]+".x"])+","+toInt(d[a[f]+".y"]):"box-shadow"==a[f]||"text-shadow"==a[f]?b[a[f]]=toInt(d[a[f]+".x"])+"px "+toInt(d[a[f]+".y"])+"px "+toInt(d[a[f]+".z"])+"px rgb("+toInt(d[a[f]+".r"])+","+toInt(d[a[f]+".g"])+","+toInt(d[a[f]+".b"])+")":"Transform.1RotateAngleDegree"==a[f]?r=" rotate("+d.rotate+"deg) ":"Transform.2SkewDegree"==a[f]?h=" skew("+d["skew.x"]+"deg,"+d["skew.y"]+"deg) ":"Transform.3Scale"==a[f]?q=" scale("+d["scale.x"]+","+d["scale.y"]+") ":"Transform.0Trans"==a[f]&&(k=" translate("+d["translate.x"]+"px,"+d["translate.y"]+"px) ");if(r||h||q||k)b.transform=(k?k:"")+(r?r:"")+(h?h:"")+(q?q:"");jQuery("#"+c).css(b)}var precentX=0,precentY=0,minPrecentY=null,maxPrecentY=null,factorY=null,minPrecentX=null,maxPrecentX=null,factorX=null;function setRangeSwipeMoveX(a,b,c){minPrecentX=a;maxPrecentX=b;factorX=c}function setRangeSwipeMoveY(a,b,c){minPrecentY=a;maxPrecentY=b;factorY=c}function empSwipeMove(a,b){a.preventDefault();b.originalEvent.preventDefault();var c=b.description.split(":");switch(c[0]){case "swipemove":if(1==c[1]){precentY+=b.delta[0].startY;precentX+=b.delta[0].startX;null!=maxPrecentY&&null!=minPrecentY&&null!=factorY&&(minPrecentY>=maxPrecentY?precentY=0:precentY>maxPrecentY/factorY?precentY=maxPrecentY/factorY:precentY<minPrecentY/factorY&&(precentY=minPrecentY/factorY));null!=maxPrecentX&&precentX>maxPrecentX/factorX?precentX=maxPrecentX/factorX:null!=minPrecentX&&precentX<minPrecentX/factorX&&(precentX=minPrecentX/factorX);for(var d in swipemoveData)swipemoveData[d](precentX,precentY)}}}function createEmpButton(a,b,c,d,g){var n=empGetElementByID(a,"div",null),l=empGetElementByID(a+"_button","div",n);n.appendChild(l);var m=b.normal,k=b.pressed?b.pressed:b.normal,q=b.hover?b.hover:b.normal;l.style.cssText=c;b.color&&jQuery(l).css("background-color",b.color);m&&jQuery(l).css("background-image",b.normal);jQuery(n).bind("touchstart mousedown",function(){jQuery(l).css({transform:"translate("+d+"px,"+g+"px)"});k&&jQuery(l).css("background-image",b.pressed);jQuery(document.body).one("touchend mouseup",function(){jQuery(l).css({transform:"translate(0px,0px)"});m&&jQuery(l).css("background-image",b.normal)})});b.hover&&(jQuery(n).mouseenter(function(){jQuery(l).css({transform:"translate(0px,0px)"});q&&jQuery(l).css("background-image",b.hover)}),jQuery(n).mouseleave(function(){jQuery(l).css({transform:"translate(0px,0px)"});m&&jQuery(l).css("background-image",b.normal)}));return l}function createZoomLens(a,b,c,d,g,n,l,m){var k=empGetElementByID(a,"div",null),q=empGetElementByID(a+"_zoomlens","div",k);k.appendChild(q);var k="border-radius:1024px;",h=parseInt(m.size)||0;m=m.color||"0xffffff";d!=g&&(k="");var k=k+("border: "+h+"px solid "+m+";"),r=parseInt(jQuery("#"+a).css("width")),f=parseInt(jQuery("#"+a).css("height"));q.style.cssText="visibility:hidden; pointer-events: none;"+k+" background-image:url('"+c+"');background-size:"+b*r/d+"% "+b*f/g+"%;background-repeat:no-repeat;position:absolute;left:0px;top:0px;width:"+d+"px;height:"+g+"px;opacity:1;";jQuery("#"+a+"_zoomlens").attr("emplenshidden",1);jQuery("#"+a).bind("touchmove mousemove",function(c){if(1!=jQuery("#"+a+"_zoomlens").attr("emplenshidden")){c.preventDefault();var e=!!c.originalEvent.touches,h=e?c.originalEvent.touches[0].pageX/EmpGlobalZoom-EmpGlobalLeft-c.originalEvent.currentTarget.offsetLeft:c.originalEvent.offsetX/EmpGlobalZoom,k=e?c.originalEvent.touches[0].pageY/EmpGlobalZoom-EmpGlobalTop-c.originalEvent.currentTarget.offsetTop:c.originalEvent.offsetY/EmpGlobalZoom,e=100*h/c.originalEvent.currentTarget.clientWidth;c=100*k/c.originalEvent.currentTarget.clientHeight;0>e||100<e||0>c||100<c||(jQuery("#"+a+"_zoomlens").css("visibility","visible"),h-=.5*d,k-=.5*g,e=-1*(b*r/100*e/100-d/2),c=-1*(b*f/100*c/100-g/2),jQuery("#"+a+"_zoomlens").css({left:n+h+"px",top:l+k+"px"}),jQuery("#"+a+"_zoomlens").css("background-position",e+"px "+c+"px"))}});jQuery("#"+a).bind("touchstart mousedown",function(){jQuery("#"+a+"_zoomlens").attr("emplenshidden",0);jQuery("#"+a).one("touchend mouseup",function(){jQuery("#"+a+"_zoomlens").css("visibility","hidden");jQuery("#"+a+"_zoomlens").attr("emplenshidden",1)});jQuery(document.body).one("touchend mouseup",function(){jQuery("#"+a+"_zoomlens").css("visibility","hidden");jQuery("#"+a+"_zoomlens").attr("emplenshidden",1)})})}function createSwitchImage(a){var b=!1,c=empGetElementByID(a.divid,"div",null),d=empGetElementByID(a.divid+"_mask","div",c);d.style.backgroundImage="url('"+a.maskImg+"')";d.style.backgroundSize="100% 100%";d.style.backgroundRepeat="no-repeat";d.style.pointerEvents="none";d.style.width=a.verticalFlag?"0px":c.style.width;d.style.height=a.verticalFlag?c.style.height:"0px";d.style.left="0px";d.style.top="0px";d.style.position="absolute";d=empGetElementByID(a.divid+"_seperator","div",c);d.style.backgroundImage="url('"+a.seperatorImg+"')";d.style.backgroundSize="100% 100%";d.style.backgroundRepeat="no-repeat";d.style.pointerEvents="none";d.style.width=a.verticalFlag?a.sepWidth+"px":parseInt(c.style.width)+2*a.sepWidth+"px";d.style.height=a.verticalFlag?parseInt(c.style.height)+2*a.sepHeight+"px":a.sepHeight+"px";d.style.left=a.verticalFlag?-.5*a.sepWidth+"px":-1*a.sepWidth+"px";d.style.top=a.verticalFlag?-1*a.sepHeight+"px":-.5*a.sepHeight+"px";d.style.position="absolute";jQuery("#"+a.divid).bind("touchmove mousemove",function(c){if(0!=b){c.preventDefault();var d=!!c.originalEvent.touches,l=d?c.originalEvent.touches[0].pageX/EmpGlobalZoom-EmpGlobalLeft-c.originalEvent.currentTarget.offsetLeft:c.originalEvent.offsetX/EmpGlobalZoom,d=d?c.originalEvent.touches[0].pageY/EmpGlobalZoom-EmpGlobalTop-c.originalEvent.currentTarget.offsetTop:c.originalEvent.offsetY/EmpGlobalZoom,m=100*l/c.originalEvent.currentTarget.clientWidth,k=100*d/c.originalEvent.currentTarget.clientHeight;0>m&&(l=m=0);100<m&&(m=100,l=c.originalEvent.currentTarget.clientWidth);0>k&&(d=k=0);100<k&&(k=100,d=c.originalEvent.currentTarget.clientHeight);a.verticalFlag?jQuery("#"+a.divid+"_mask").css({width:l+"px","background-size":1E4/m+"% 100%"}):jQuery("#"+a.divid+"_mask").css({height:d+"px","background-size":"100%"+1E4/k+"%"});a.verticalFlag?jQuery("#"+a.divid+"_seperator").css({left:l-.5*a.sepWidth+"px"}):jQuery("#"+a.divid+"_seperator").css({top:d-.5*a.sepHeight+"px"});c.preventDefault()}});jQuery("#"+a.divid).bind("touchstart mousedown",function(){b=!0;jQuery("#"+a.divid).one("touchend mouseup",function(){b=!1});jQuery(document.body).one("touchend mouseup",function(){b=!1})})}function empGetElementByID(a,b,c,d){var g=document.getElementById(a);null==g&&(g=document.createElement(b),g.id=a,c?c.appendChild(g):document.body.appendChild(g),"function"===typeof d&&d(g));return g}function empDeleteElementByID(a){(a=document.getElementById(a))&&a.parentNode.removeChild(a)}function empShowElementByID(a,b){var c=document.getElementById(a);c&&(c.style.visibility=b)}function empSetPEElementByID(a,b){var c=document.getElementById(a);c&&(c.style.pointerEvents=b)}function empSetOpacityElementByID(a,b){var c=document.getElementById(a);c&&(c.style.opacity=b)}function empSetFullScreen(a){a.requestFullscreen?a.requestFullscreen():a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen?a.webkitRequestFullScreen():a.msRequestFullscreen&&a.msRequestFullscreen()}function empExitFullScreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}function empIsFullScreen(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled}window.addEventListener("load",function(){EmpAutoBodySize()},!1);isBuilderMode||window.addEventListener("resize",EmpAutoBodySize,!1);(function(a,b,c,d){function g(b,c,d,g){var q={duration:1,animation:null,iterate:2,delay:0,timing:"linear",keep:!1,fillmode:"forwards"};this.prefixes=["","-moz-","-o-animation-","-webkit-","-ms-"];this.element=a(b);this.bare=b;this.queue=[];this.listening=!1;b="function"==typeof d?d:g;switch(c){case "blur":q={amount:3,duration:.5,focusAfter:null};this.options=a.extend(q,d);this._blur(b);break;case "focus":this._focus();break;case "rotate":q={degrees:15,duration:.5};this.options=a.extend(q,d);this._rotate(b);break;case "cleanse":this.cleanse();break;default:this.options=a.extend(q,c),this.init(b)}}g.prototype={init:function(b){"[object Array]"===Object.prototype.toString.call(this.options.animation)?a.merge(this.queue,this.options.animation):this.queue.push(this.options.animation);this.cleanse();this.animate(b)},animate:function(a){this.element.addClass("animated");this.element.addClass(this.queue[0]);this.element.data("animo",this.queue[0]);for(var b=this.prefixes.length;b--;)this.element.css(this.prefixes[b]+"animation-duration",this.options.duration+"s"),this.element.css(this.prefixes[b]+"animation-delay",this.options.delay+"s"),this.element.css(this.prefixes[b]+"animation-iteration-count",this.options.iterate),this.element.css(this.prefixes[b]+"animation-timing-function",this.options.timing),this.element.css(this.prefixes[b]+"animation-fill-mode",this.options.fillmode);var c=this,b=a;1<c.queue.length&&(b=null);this._end("AnimationEnd",function(){c.element.hasClass(c.queue[0])&&(c.options.keep||c.cleanse(),c.queue.shift(),c.queue.length&&c.animate(a))},b)},cleanse:function(){this.element.removeClass("animated");this.element.removeClass(this.queue[0]);this.element.removeClass(this.element.data("animo"));for(var a=this.prefixes.length;a--;)this.element.css(this.prefixes[a]+"animation-duration",""),this.element.css(this.prefixes[a]+"animation-delay",""),this.element.css(this.prefixes[a]+"animation-iteration-count",""),this.element.css(this.prefixes[a]+"animation-timing-function",""),this.element.css(this.prefixes[a]+"animation-fill-mode",""),this.element.css(this.prefixes[a]+"transition",""),this.element.css(this.prefixes[a]+"transform",""),this.element.css(this.prefixes[a]+"filter","")},_blur:function(c){if(this.element.is("img")){var d="svg_"+(16777216*(1+Math.random())|0).toString(16).substring(1),g="filter_"+(16777216*(1+Math.random())|0).toString(16).substring(1);a("body").append('\x3csvg version\x3d"1.1" xmlns\x3d"http://www.w3.org/2000/svg" id\x3d"'+d+'" style\x3d"height:0;position:absolute;top:-1000px;"\x3e\x3cfilter id\x3d"'+g+'"\x3e\x3cfeGaussianBlur stdDeviation\x3d"'+this.options.amount+'" /\x3e\x3c/filter\x3e\x3c/svg\x3e');for(var k=this.prefixes.length;k--;)this.element.css(this.prefixes[k]+"filter","blur("+this.options.amount+"px)"),this.element.css(this.prefixes[k]+"transition",this.options.duration+"s all linear");this.element.css("filter","url(#"+g+")");this.element.data("svgid",d)}else{d=this.element.css("color");for(k=this.prefixes.length;k--;)this.element.css(this.prefixes[k]+"transition","all "+this.options.duration+"s linear");this.element.css("text-shadow","0 0 "+this.options.amount+"px "+d);this.element.css("color","transparent")}this._end("TransitionEnd",null,c);var q=this;if(this.options.focusAfter)var h=b.setTimeout(function(){q._focus();h=b.clearTimeout(h)},1E3*this.options.focusAfter)},_focus:function(){var b=this.prefixes.length;if(this.element.is("img")){for(;b--;)this.element.css(this.prefixes[b]+"filter",""),this.element.css(this.prefixes[b]+"transition","");a("#"+this.element.data("svgid")).remove()}else{for(;b--;)this.element.css(this.prefixes[b]+"transition","");this.element.css("text-shadow","");this.element.css("color","")}},_rotate:function(a){for(var b=this.prefixes.length;b--;)this.element.css(this.prefixes[b]+"transition","all "+this.options.duration+"s linear"),this.element.css(this.prefixes[b]+"transform","rotate("+this.options.degrees+"deg)");this._end("TransitionEnd",null,a)},_end:function(a,b,c){var d=this,g=a.toLowerCase()+" webkit"+a+" o"+a+" MS"+a;this.element.bind(g,function(){d.element.unbind(g);"function"==typeof b&&b();"function"==typeof c&&c(d)})}};a.fn.animo=function(a,b,c){return this.each(function(){new g(this,a,b,c)})}})(jQuery,window,document);var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!(!window.WebGLRenderingContext||!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";a.style.textAlign="center";a.style.background="#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";this.webgl||(a.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support \x3ca href\x3d"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style\x3d"color:#000"\x3eWebGL\x3c/a\x3e.\x3cbr /\x3e\nFind out how to get it \x3ca href\x3d"http://get.webgl.org/" style\x3d"color:#000"\x3ehere\x3c/a\x3e.':'Your browser does not seem to support \x3ca href\x3d"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style\x3d"color:#000"\x3eWebGL\x3c/a\x3e.\x3cbr/\x3e\nFind out how to get it \x3ca href\x3d"http://get.webgl.org/" style\x3d"color:#000"\x3ehere\x3c/a\x3e.');return a},addGetWebGLMessage:function(a){var b,c;a=a||{};b=void 0!==a.parent?a.parent:document.body;a=void 0!==a.id?a.id:"oldie";c=Detector.getWebGLErrorMessage();c.id=a;b.appendChild(c)}};"object"===typeof module&&(module.exports=Detector);THREE.OrbitControls=function(a,b){function c(){return Math.pow(.95,e.zoomSpeed)}function d(a){e.object instanceof THREE.PerspectiveCamera?D/=a:e.object instanceof THREE.OrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*a)),e.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function g(a){e.object instanceof THREE.PerspectiveCamera?D*=a:e.object instanceof THREE.OrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/a)),e.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function n(a){if(!1!==e.enabled){a.preventDefault();if(a.button===e.mouseButtons.ORBIT){if(!1===e.enableRotate)return;F.set(a.clientX,a.clientY);w=p.ROTATE}else if(a.button===e.mouseButtons.ZOOM){if(!1===e.enableZoom)return;J.set(a.clientX,a.clientY);w=p.DOLLY}else if(a.button===e.mouseButtons.PAN){if(!1===e.enablePan)return;G.set(a.clientX,a.clientY);w=p.PAN}w!==p.NONE&&(document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",m,!1),document.addEventListener("mouseout",m,!1),e.dispatchEvent(A))}}function l(a){!1!==e.enabled&&(a.preventDefault(),w===p.ROTATE?!1!==e.enableRotate&&(H.set(a.clientX,a.clientY),L.subVectors(H,F),a=e.domElement===document?e.domElement.body:e.domElement,t.theta-=2*Math.PI*L.x/a.clientWidth*e.rotateSpeed,t.phi-=2*Math.PI*L.y/a.clientHeight*e.rotateSpeed,F.copy(H),e.update()):w===p.DOLLY?!1!==e.enableZoom&&(N.set(a.clientX,a.clientY),O.subVectors(N,J),0<O.y?d(c()):0>O.y&&g(c()),J.copy(N),e.update()):w===p.PAN&&!1!==e.enablePan&&(z.set(a.clientX,a.clientY),y.subVectors(z,G),M(y.x,y.y),G.copy(z),e.update()))}function m(a){!1!==e.enabled&&(document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",m,!1),document.removeEventListener("mouseout",m,!1),e.dispatchEvent(x),w=p.NONE)}function k(a){if(!1!==e.enabled&&!1!==e.enableZoom&&w===p.NONE){a.preventDefault();a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);0<b?g(c()):0>b&&d(c());e.update();e.dispatchEvent(A);e.dispatchEvent(x)}}function q(a){if(!1!==e.enabled&&!1!==e.enableKeys&&!1!==e.enablePan)switch(a.keyCode){case e.keys.UP:M(0,e.keyPanSpeed);e.update();break;case e.keys.BOTTOM:M(0,-e.keyPanSpeed);e.update();break;case e.keys.LEFT:M(e.keyPanSpeed,0);e.update();break;case e.keys.RIGHT:M(-e.keyPanSpeed,0),e.update()}}function h(a){if(!1!==e.enabled){switch(a.touches.length){case 1:if(!1===e.enableRotate)return;F.set(a.touches[0].pageX,a.touches[0].pageY);w=p.TOUCH_ROTATE;break;case 2:if(!1===e.enableZoom)return;var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;J.set(0,Math.sqrt(b*b+a*a));w=p.TOUCH_DOLLY;break;case 3:if(!1===e.enablePan)return;G.set(a.touches[0].pageX,a.touches[0].pageY);w=p.TOUCH_PAN;break;default:w=p.NONE}w!==p.NONE&&e.dispatchEvent(A)}}function r(a){if(!1!==e.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(!1===e.enableRotate)break;if(w!==p.TOUCH_ROTATE)break;H.set(a.touches[0].pageX,a.touches[0].pageY);L.subVectors(H,F);var b=e.domElement===document?e.domElement.body:e.domElement;t.theta-=2*Math.PI*L.x/b.clientWidth*e.rotateSpeed;t.phi-=2*Math.PI*L.y/b.clientHeight*e.rotateSpeed;F.copy(H);e.update();break;case 2:if(!1===e.enableZoom)break;if(w!==p.TOUCH_DOLLY)break;b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;N.set(0,Math.sqrt(b*b+a*a));O.subVectors(N,J);0<O.y?g(c()):0>O.y&&d(c());J.copy(N);e.update();break;case 3:if(!1===e.enablePan)break;if(w!==p.TOUCH_PAN)break;z.set(a.touches[0].pageX,a.touches[0].pageY);y.subVectors(z,G);M(y.x,y.y);G.copy(z);e.update();break;default:w=p.NONE}}function f(a){!1!==e.enabled&&(e.dispatchEvent(x),w=p.NONE)}function u(a){a.preventDefault()}this.object=a;this.domElement=void 0!==b?b:document;this.enabled=!0;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=.25;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.getPolarAngle=function(){return phi};this.getAzimuthalAngle=function(){return theta};this.reset=function(){e.target.copy(e.target0);e.object.position.copy(e.position0);e.object.zoom=e.zoom0;e.object.updateProjectionMatrix();e.dispatchEvent(v);e.update();w=p.NONE};this.update=function(){var b=new THREE.Vector3,c=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),d=c.clone().inverse(),h=new THREE.Vector3,g=new THREE.Quaternion;return function(){var a=e.object.position;b.copy(a).sub(e.target);b.applyQuaternion(c);C.setFromVector3(b);e.autoRotate&&w===p.NONE&&(t.theta-=2*Math.PI/60/60*e.autoRotateSpeed);C.theta+=t.theta;C.phi+=t.phi;C.theta=Math.max(e.minAzimuthAngle,Math.min(e.maxAzimuthAngle,C.theta));C.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,C.phi));C.makeSafe();C.radius*=D;C.radius=Math.max(e.minDistance,Math.min(e.maxDistance,C.radius));e.target.add(B);b.setFromSpherical(C);b.applyQuaternion(d);a.copy(e.target).add(b);e.object.lookAt(e.target);!0===e.enableDamping?(t.theta*=1-e.dampingFactor,t.phi*=1-e.dampingFactor):t.set(0,0,0);D=1;B.set(0,0,0);return E||h.distanceToSquared(e.object.position)>I||8*(1-g.dot(e.object.quaternion))>I?(e.dispatchEvent(v),h.copy(e.object.position),g.copy(e.object.quaternion),E=!1,!0):!1}}();this.dispose=function(){e.domElement.removeEventListener("contextmenu",u,!1);e.domElement.removeEventListener("mousedown",n,!1);e.domElement.removeEventListener("mousewheel",k,!1);e.domElement.removeEventListener("MozMousePixelScroll",k,!1);e.domElement.removeEventListener("touchstart",h,!1);e.domElement.removeEventListener("touchend",f,!1);e.domElement.removeEventListener("touchmove",r,!1);document.removeEventListener("mousemove",l,!1);document.removeEventListener("mouseup",m,!1);document.removeEventListener("mouseout",m,!1);window.removeEventListener("keydown",q,!1)};var e=this,v={type:"change"},A={type:"start"},x={type:"end"},p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},w=p.NONE,I=1E-6,C=new THREE.Spherical,t=new THREE.Spherical,D=1,B=new THREE.Vector3,E=!1,F=new THREE.Vector2,H=new THREE.Vector2,L=new THREE.Vector2,G=new THREE.Vector2,z=new THREE.Vector2,y=new THREE.Vector2,J=new THREE.Vector2,N=new THREE.Vector2,O=new THREE.Vector2;this.handleResize=function(){};var K=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,0);a.multiplyScalar(-b);B.add(a)}}(),P=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,1);a.multiplyScalar(b);B.add(a)}}(),M=function(){var a=new THREE.Vector3;return function(b,c){var d=e.domElement===document?e.domElement.body:e.domElement;if(e.object instanceof THREE.PerspectiveCamera){a.copy(e.object.position).sub(e.target);var h=a.length(),h=h*Math.tan(e.object.fov/2*Math.PI/180);K(2*b*h/d.clientHeight,e.object.matrix);P(2*c*h/d.clientHeight,e.object.matrix)}else e.object instanceof THREE.OrthographicCamera?(K(b*(e.object.right-e.object.left)/e.object.zoom/d.clientWidth,e.object.matrix),P(c*(e.object.top-e.object.bottom)/e.object.zoom/d.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();e.domElement.addEventListener("contextmenu",u,!1);e.domElement.addEventListener("mousedown",n,!1);e.domElement.addEventListener("mousewheel",k,!1);e.domElement.addEventListener("MozMousePixelScroll",k,!1);e.domElement.addEventListener("touchstart",h,!1);e.domElement.addEventListener("touchend",f,!1);e.domElement.addEventListener("touchmove",r,!1);window.addEventListener("keydown",q,!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){console.warn("THREE.OrbitControls: .center has been renamed to .target");return this.target}},noZoom:{get:function(){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");return!this.enableZoom},set:function(a){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");this.enableZoom=!a}},noRotate:{get:function(){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");return!this.enableRotate},set:function(a){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!a}},noPan:{get:function(){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");return!this.enablePan},set:function(a){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");this.enablePan=!a}},noKeys:{get:function(){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");return!this.enableKeys},set:function(a){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!a}},staticMoving:{get:function(){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");return!this.constraint.enableDamping},set:function(a){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");this.constraint.enableDamping=!a}},dynamicDampingFactor:{get:function(){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");return this.constraint.dampingFactor},set:function(a){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.constraint.dampingFactor=a}}});THREE.TrackballControls=function(a,b){function c(a){!1!==f.enabled&&(window.removeEventListener("keydown",c),A=v,v===u.NONE)&&(a.keyCode!==f.keys[u.ROTATE]||f.noRotate?a.keyCode!==f.keys[u.ZOOM]||f.noZoom?a.keyCode!==f.keys[u.PAN]||f.noPan||(v=u.PAN):v=u.ZOOM:v=u.ROTATE)}function d(a){!1!==f.enabled&&(v=A,window.addEventListener("keydown",c,!1))}function g(a){!1!==f.enabled&&(a.preventDefault(),a.stopPropagation(),v===u.NONE&&(v=a.button),v!==u.ROTATE||f.noRotate?v!==u.ZOOM||f.noZoom?v!==u.PAN||f.noPan||(F.copy(y(a.pageX,a.pageY)),H.copy(F)):(t.copy(y(a.pageX,a.pageY)),D.copy(t)):(w.copy(J(a.pageX,a.pageY)),p.copy(w)),document.addEventListener("mousemove",n,!1),document.addEventListener("mouseup",l,!1),f.dispatchEvent(G))}function n(a){!1!==f.enabled&&(a.preventDefault(),a.stopPropagation(),v!==u.ROTATE||f.noRotate?v!==u.ZOOM||f.noZoom?v!==u.PAN||f.noPan||H.copy(y(a.pageX,a.pageY)):D.copy(y(a.pageX,a.pageY)):(p.copy(w),w.copy(J(a.pageX,a.pageY))))}function l(a){!1!==f.enabled&&(a.preventDefault(),a.stopPropagation(),v=u.NONE,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",l),f.dispatchEvent(z))}function m(a){if(!1!==f.enabled){a.preventDefault();a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3);t.y+=.01*b;f.dispatchEvent(G);f.dispatchEvent(z)}}function k(a){if(!1!==f.enabled){switch(a.touches.length){case 1:v=u.TOUCH_ROTATE;w.copy(J(a.touches[0].pageX,a.touches[0].pageY));p.copy(w);break;case 2:v=u.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;E=B=Math.sqrt(b*b+c*c);F.copy(y((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));H.copy(F);break;default:v=u.NONE}f.dispatchEvent(G)}}function q(a){if(!1!==f.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:p.copy(w);w.copy(J(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;E=Math.sqrt(b*b+c*c);H.copy(y((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));break;default:v=u.NONE}}function h(a){if(!1!==f.enabled){switch(a.touches.length){case 1:p.copy(w);w.copy(J(a.touches[0].pageX,a.touches[0].pageY));break;case 2:B=E=0,H.copy(y((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2)),F.copy(H)}v=u.NONE;f.dispatchEvent(z)}}function r(a){a.preventDefault()}var f=this,u={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a;this.domElement=void 0!==b?b:document;this.enabled=!0;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var e=new THREE.Vector3,v=u.NONE,A=u.NONE,x=new THREE.Vector3,p=new THREE.Vector2,w=new THREE.Vector2,I=new THREE.Vector3,C=0,t=new THREE.Vector2,D=new THREE.Vector2,B=0,E=0,F=new THREE.Vector2,H=new THREE.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var L={type:"change"},G={type:"start"},z={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=a.top+window.pageYOffset-b.clientTop;this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var y=function(){var a=new THREE.Vector2;return function(b,c){a.set((b-f.screen.left)/f.screen.width,(c-f.screen.top)/f.screen.height);return a}}(),J=function(){var a=new THREE.Vector2;return function(b,c){a.set((b-.5*f.screen.width-f.screen.left)/(.5*f.screen.width),(f.screen.height+2*(f.screen.top-c))/f.screen.width);return a}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion,c=new THREE.Vector3,d=new THREE.Vector3,h=new THREE.Vector3,e=new THREE.Vector3,g;return function(){e.set(w.x-p.x,w.y-p.y,0);(g=e.length())?(x.copy(f.object.position).sub(f.target),c.copy(x).normalize(),d.copy(f.object.up).normalize(),h.crossVectors(d,c).normalize(),d.setLength(w.y-p.y),h.setLength(w.x-p.x),e.copy(d.add(h)),a.crossVectors(e,x).normalize(),g*=f.rotateSpeed,b.setFromAxisAngle(a,g),x.applyQuaternion(b),f.object.up.applyQuaternion(b),I.copy(a),C=g):!f.staticMoving&&C&&(C*=Math.sqrt(1-f.dynamicDampingFactor),x.copy(f.object.position).sub(f.target),b.setFromAxisAngle(I,C),x.applyQuaternion(b),f.object.up.applyQuaternion(b));p.copy(w)}}();this.zoomCamera=function(){var a;v===u.TOUCH_ZOOM_PAN?(a=B/E,B=E,x.multiplyScalar(a)):(a=1+(D.y-t.y)*f.zoomSpeed,1!==a&&0<a&&(x.multiplyScalar(a),f.staticMoving?t.copy(D):t.y+=(D.y-t.y)*this.dynamicDampingFactor))};this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(H).sub(F);a.lengthSq()&&(a.multiplyScalar(x.length()*f.panSpeed),c.copy(x).cross(f.object.up).setLength(a.x),c.add(b.copy(f.object.up).setLength(a.y)),f.object.position.add(c),f.target.add(c),f.staticMoving?F.copy(H):F.add(a.subVectors(H,F).multiplyScalar(f.dynamicDampingFactor)))}}();this.checkDistances=function(){f.noZoom&&f.noPan||(x.lengthSq()>f.maxDistance*f.maxDistance&&(f.object.position.addVectors(f.target,x.setLength(f.maxDistance)),t.copy(D)),x.lengthSq()<f.minDistance*f.minDistance&&(f.object.position.addVectors(f.target,x.setLength(f.minDistance)),t.copy(D)))};this.update=function(){x.subVectors(f.object.position,f.target);f.noRotate||f.rotateCamera();f.noZoom||f.zoomCamera();f.noPan||f.panCamera();f.object.position.addVectors(f.target,x);f.checkDistances();f.object.lookAt(f.target);1E-6<e.distanceToSquared(f.object.position)&&(f.dispatchEvent(L),e.copy(f.object.position))};this.reset=function(){A=v=u.NONE;f.target.copy(f.target0);f.object.position.copy(f.position0);f.object.up.copy(f.up0);x.subVectors(f.object.position,f.target);f.object.lookAt(f.target);f.dispatchEvent(L);e.copy(f.object.position)};this.dispose=function(){this.domElement.removeEventListener("contextmenu",r,!1);this.domElement.removeEventListener("mousedown",g,!1);this.domElement.removeEventListener("mousewheel",m,!1);this.domElement.removeEventListener("MozMousePixelScroll",m,!1);this.domElement.removeEventListener("touchstart",k,!1);this.domElement.removeEventListener("touchend",h,!1);this.domElement.removeEventListener("touchmove",q,!1);document.removeEventListener("mousemove",n,!1);document.removeEventListener("mouseup",l,!1);window.removeEventListener("keydown",c,!1);window.removeEventListener("keyup",d,!1)};this.domElement.addEventListener("contextmenu",r,!1);this.domElement.addEventListener("mousedown",g,!1);this.domElement.addEventListener("mousewheel",m,!1);this.domElement.addEventListener("MozMousePixelScroll",m,!1);this.domElement.addEventListener("touchstart",k,!1);this.domElement.addEventListener("touchend",h,!1);this.domElement.addEventListener("touchmove",q,!1);window.addEventListener("keydown",c,!1);window.addEventListener("keyup",d,!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;(function(){var a=function(a){THREE.MeshBasicMaterial.call(this);this.depthWrite=this.depthTest=!1;this.side=THREE.FrontSide;this.transparent=!0;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);a.prototype.constructor=a;var b=function(a){THREE.LineBasicMaterial.call(this);this.depthWrite=this.depthTest=!1;this.transparent=!0;this.linewidth=1;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype);b.prototype.constructor=b;var c=new a({visible:!1,transparent:!1});THREE.TransformGizmo=function(){this.init=function(){THREE.Object3D.call(this);this.handles=new THREE.Object3D;this.pickers=new THREE.Object3D;this.planes=new THREE.Object3D;this.add(this.handles);this.add(this.pickers);this.add(this.planes);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({visible:!1,side:THREE.DoubleSide}),a={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=a.XYZE;a.YZ.rotation.set(0,Math.PI/2,0);a.XZ.rotation.set(-Math.PI/2,0,0);for(var c in a)a[c].name=c,this.planes.add(a[c]),this.planes[c]=a[c];a=function(a,b){for(var d in a)for(c=a[d].length;c--;){var g=a[d][c][0],h=a[d][c][1],r=a[d][c][2];g.name=d;h&&g.position.set(h[0],h[1],h[2]);r&&g.rotation.set(r[0],r[1],r[2]);b.add(g)}};a(this.handleGizmos,this.handles);a(this.pickerGizmos,this.pickers);this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=a.geometry.clone();b.applyMatrix(a.matrix);a.geometry=b;a.position.set(0,0,0);a.rotation.set(0,0,0);a.scale.set(1,1,1)}})};this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name===a?b.material.highlight(!0):b.material.highlight(!1))})}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo;THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),l=new THREE.Vector3(0,1,0),m=new THREE.Matrix4;this.traverse(function(k){-1!==k.name.search("E")?k.quaternion.setFromRotationMatrix(m.lookAt(b,c,l)):-1===k.name.search("X")&&-1===k.name.search("Y")&&-1===k.name.search("Z")||k.quaternion.setFromEuler(a)})};THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var d=new THREE.Geometry,g=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1));g.position.y=.5;g.updateMatrix();d.merge(g.geometry,g.matrix);g=new THREE.BufferGeometry;g.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var n=new THREE.BufferGeometry;n.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var l=new THREE.BufferGeometry;l.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.handleGizmos={X:[[new THREE.Mesh(d,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(g,new b({color:16711680}))]],Y:[[new THREE.Mesh(d,new a({color:65280})),[0,.5,0]],[new THREE.Line(n,new b({color:65280}))]],Z:[[new THREE.Mesh(d,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(l,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),c)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,0,.2],[-Math.PI/2,0,0]]]};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"===a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"===a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"===a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"===a&&(this.activePlane=this.planes.XYZE);"XY"===a&&(this.activePlane=this.planes.XY);"YZ"===a&&(this.activePlane=this.planes.YZ);"XZ"===a&&(this.activePlane=this.planes.XZ)};this.init()};THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate;THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var a=function(a,b,c){var d=new THREE.BufferGeometry,k=[];c=c?c:1;for(var q=0;q<=64*c;++q)"x"===b&&k.push(0,Math.cos(q/32*Math.PI)*a,Math.sin(q/32*Math.PI)*a),"y"===b&&k.push(Math.cos(q/32*Math.PI)*a,0,Math.sin(q/32*Math.PI)*a),"z"===b&&k.push(Math.sin(q/32*Math.PI)*a,Math.cos(q/32*Math.PI)*a,0);d.addAttribute("position",new THREE.Float32Attribute(k,3));return d};this.handleGizmos={X:[[new THREE.Line(new a(1,"x",.5),new b({color:16711680}))]],Y:[[new THREE.Line(new a(1,"y",.5),new b({color:65280}))]],Z:[[new THREE.Line(new a(1,"z",.5),new b({color:255}))]],E:[[new THREE.Line(new a(1.25,"z",1),new b({color:13421568}))]],XYZE:[[new THREE.Line(new a(1,"z",1),new b({color:7895160}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),c)]],XYZE:[[new THREE.Mesh(new THREE.Geometry)]]};this.setActivePlane=function(a){"E"===a&&(this.activePlane=this.planes.XYZE);"X"===a&&(this.activePlane=this.planes.YZ);"Y"===a&&(this.activePlane=this.planes.XZ);"Z"===a&&(this.activePlane=this.planes.XY)};this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),k=new THREE.Quaternion,q=new THREE.Vector3(1,0,0),h=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),f=new THREE.Quaternion,u=new THREE.Quaternion,e=new THREE.Quaternion,v=b.clone();d.copy(this.planes.XY.rotation);k.setFromEuler(d);c.makeRotationFromQuaternion(k).getInverse(c);v.applyMatrix4(c);this.traverse(function(a){k.setFromEuler(d);"X"===a.name&&(f.setFromAxisAngle(q,Math.atan2(-v.y,v.z)),k.multiplyQuaternions(k,f),a.quaternion.copy(k));"Y"===a.name&&(u.setFromAxisAngle(h,Math.atan2(v.x,v.z)),k.multiplyQuaternions(k,u),a.quaternion.copy(k));"Z"===a.name&&(e.setFromAxisAngle(r,Math.atan2(v.y,v.x)),k.multiplyQuaternions(k,e),a.quaternion.copy(k))})};this.init()};THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate;THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var d=new THREE.Geometry,g=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));g.position.y=.5;g.updateMatrix();d.merge(g.geometry,g.matrix);g=new THREE.BufferGeometry;g.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var n=new THREE.BufferGeometry;n.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var l=new THREE.BufferGeometry;l.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.handleGizmos={X:[[new THREE.Mesh(d,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(g,new b({color:16711680}))]],Y:[[new THREE.Mesh(d,new a({color:65280})),[0,.5,0]],[new THREE.Line(n,new b({color:65280}))]],Z:[[new THREE.Mesh(d,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(l,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),c)]]};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"===a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"===a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"===a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"===a&&(this.activePlane=this.planes.XYZE)};this.init()};THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale;THREE.TransformControls=function(a,b){function c(a){if(void 0!==h.object&&!0!==f&&(void 0===a.button||0===a.button)){var b=q(a.changedTouches?a.changedTouches[0]:a,u[r].pickers.children),e=null;b&&(e=b.object.name,a.preventDefault());h.axis!==e&&(h.axis=e,h.update(),h.dispatchEvent(A))}}function l(a){if(void 0!==h.object&&!0!==f&&(void 0===a.button||0===a.button)){var b=a.changedTouches?a.changedTouches[0]:a;if(0===b.button||void 0===b.button){var c=q(b,u[r].pickers.children);c&&(a.preventDefault(),a.stopPropagation(),h.dispatchEvent(x),h.axis=c.object.name,h.update(),L.copy(X).sub(S).normalize(),u[r].setActivePlane(h.axis,L),a=q(b,[u[r].activePlane]))&&(Y.copy(h.object.position),R.copy(h.object.scale),Z.extractRotation(h.object.matrix),Q.extractRotation(h.object.matrixWorld),U.extractRotation(h.object.parent.matrixWorld),V.setFromMatrixScale(G.getInverse(h.object.parent.matrixWorld)),D.copy(a.point))}f=!0}}function m(a){if(void 0!==h.object&&null!==h.axis&&!1!==f&&(void 0===a.button||0===a.button)){var b=q(a.changedTouches?a.changedTouches[0]:a,[u[r].activePlane]);if(!1!==b){a.preventDefault();a.stopPropagation();t.copy(b.point);if("translate"===r){t.sub(D);t.multiply(V);"local"===h.space&&(t.applyMatrix4(G.getInverse(Q)),-1===h.axis.search("X")&&(t.x=0),-1===h.axis.search("Y")&&(t.y=0),-1===h.axis.search("Z")&&(t.z=0),t.applyMatrix4(Z),h.object.position.copy(Y),h.object.position.add(t));if("world"===h.space||-1!==h.axis.search("XYZ"))-1===h.axis.search("X")&&(t.x=0),-1===h.axis.search("Y")&&(t.y=0),-1===h.axis.search("Z")&&(t.z=0),t.applyMatrix4(G.getInverse(U)),h.object.position.copy(Y),h.object.position.add(t);null!==h.translationSnap&&("local"===h.space&&h.object.position.applyMatrix4(G.getInverse(Q)),-1!==h.axis.search("X")&&(h.object.position.x=Math.round(h.object.position.x/h.translationSnap)*h.translationSnap),-1!==h.axis.search("Y")&&(h.object.position.y=Math.round(h.object.position.y/h.translationSnap)*h.translationSnap),-1!==h.axis.search("Z")&&(h.object.position.z=Math.round(h.object.position.z/h.translationSnap)*h.translationSnap),"local"===h.space&&h.object.position.applyMatrix4(Q))}else"scale"===r?(t.sub(D),t.multiply(V),"local"===h.space&&("XYZ"===h.axis?(F=1+t.y/50,h.object.scale.x=R.x*F,h.object.scale.y=R.y*F,h.object.scale.z=R.z*F):(t.applyMatrix4(G.getInverse(Q)),"X"===h.axis&&(h.object.scale.x=R.x*(1+t.x/50)),"Y"===h.axis&&(h.object.scale.y=R.y*(1+t.y/50)),"Z"===h.axis&&(h.object.scale.z=R.z*(1+t.z/50))))):"rotate"===r&&(t.sub(S),t.multiply(V),z.copy(D).sub(S),z.multiply(V),"E"===h.axis?(t.applyMatrix4(G.getInverse(H)),z.applyMatrix4(G.getInverse(H)),B.set(Math.atan2(t.z,t.y),Math.atan2(t.x,t.z),Math.atan2(t.y,t.x)),E.set(Math.atan2(z.z,z.y),Math.atan2(z.x,z.z),Math.atan2(z.y,z.x)),y.setFromRotationMatrix(G.getInverse(U)),W.setFromAxisAngle(L,B.z-E.z),K.setFromRotationMatrix(Q),y.multiplyQuaternions(y,W),y.multiplyQuaternions(y,K),h.object.quaternion.copy(y)):"XYZE"===h.axis?(W.setFromEuler(t.clone().cross(z).normalize()),y.setFromRotationMatrix(G.getInverse(U)),P.setFromAxisAngle(W,-t.clone().angleTo(z)),K.setFromRotationMatrix(Q),y.multiplyQuaternions(y,P),y.multiplyQuaternions(y,K),h.object.quaternion.copy(y)):"local"===h.space?(t.applyMatrix4(G.getInverse(Q)),z.applyMatrix4(G.getInverse(Q)),B.set(Math.atan2(t.z,t.y),Math.atan2(t.x,t.z),Math.atan2(t.y,t.x)),E.set(Math.atan2(z.z,z.y),Math.atan2(z.x,z.z),Math.atan2(z.y,z.x)),K.setFromRotationMatrix(Z),null!==h.rotationSnap?(P.setFromAxisAngle(J,Math.round((B.x-E.x)/h.rotationSnap)*h.rotationSnap),M.setFromAxisAngle(N,Math.round((B.y-E.y)/h.rotationSnap)*h.rotationSnap),T.setFromAxisAngle(O,Math.round((B.z-E.z)/h.rotationSnap)*h.rotationSnap)):(P.setFromAxisAngle(J,B.x-E.x),M.setFromAxisAngle(N,B.y-E.y),T.setFromAxisAngle(O,B.z-E.z)),"X"===h.axis&&K.multiplyQuaternions(K,P),"Y"===h.axis&&K.multiplyQuaternions(K,M),"Z"===h.axis&&K.multiplyQuaternions(K,T),h.object.quaternion.copy(K)):"world"===h.space&&(B.set(Math.atan2(t.z,t.y),Math.atan2(t.x,t.z),Math.atan2(t.y,t.x)),E.set(Math.atan2(z.z,z.y),Math.atan2(z.x,z.z),Math.atan2(z.y,z.x)),y.setFromRotationMatrix(G.getInverse(U)),null!==h.rotationSnap?(P.setFromAxisAngle(J,Math.round((B.x-E.x)/h.rotationSnap)*h.rotationSnap),M.setFromAxisAngle(N,Math.round((B.y-E.y)/h.rotationSnap)*h.rotationSnap),T.setFromAxisAngle(O,Math.round((B.z-E.z)/h.rotationSnap)*h.rotationSnap)):(P.setFromAxisAngle(J,B.x-E.x),M.setFromAxisAngle(N,B.y-E.y),T.setFromAxisAngle(O,B.z-E.z)),K.setFromRotationMatrix(Q),"X"===h.axis&&y.multiplyQuaternions(y,P),"Y"===h.axis&&y.multiplyQuaternions(y,M),"Z"===h.axis&&y.multiplyQuaternions(y,T),y.multiplyQuaternions(y,K),h.object.quaternion.copy(y)));h.update();h.dispatchEvent(A);h.dispatchEvent(w)}}}function k(a){if(void 0===a.button||0===a.button)f&&null!==h.axis&&(p.mode=r,h.dispatchEvent(p)),f=!1,c(a)}function q(c,e){var h=b.getBoundingClientRect();C.set((c.clientX-h.left)/h.width*2-1,-((c.clientY-h.top)/h.height*2)+1);I.setFromCamera(C,a);h=I.intersectObjects(e,!0);return h[0]?h[0]:!1}THREE.Object3D.call(this);b=void 0!==b?b:document;this.object=void 0;this.visible=!1;this.rotationSnap=this.translationSnap=null;this.space="world";this.size=1;this.axis=null;var h=this,r="translate",f=!1,u={translate:new THREE.TransformGizmoTranslate,rotate:new THREE.TransformGizmoRotate,scale:new THREE.TransformGizmoScale},e;for(e in u){var v=u[e];v.visible=e===r;this.add(v)}var A={type:"change"},x={type:"mouseDown"},p={type:"mouseUp",mode:r},w={type:"objectChange"},I=new THREE.Raycaster,C=new THREE.Vector2,t=new THREE.Vector3,D=new THREE.Vector3,B=new THREE.Vector3,E=new THREE.Vector3,F=1,H=new THREE.Matrix4,L=new THREE.Vector3,G=new THREE.Matrix4,z=new THREE.Vector3,y=new THREE.Quaternion,J=new THREE.Vector3(1,0,0),N=new THREE.Vector3(0,1,0),O=new THREE.Vector3(0,0,1),K=new THREE.Quaternion,P=new THREE.Quaternion,M=new THREE.Quaternion,T=new THREE.Quaternion,W=new THREE.Quaternion,Y=new THREE.Vector3,R=new THREE.Vector3,Z=new THREE.Matrix4,U=new THREE.Matrix4,V=new THREE.Vector3,S=new THREE.Vector3,aa=new THREE.Euler,Q=new THREE.Matrix4,X=new THREE.Vector3,ba=new THREE.Euler;b.addEventListener("mousedown",l,!1);b.addEventListener("touchstart",l,!1);b.addEventListener("mousemove",c,!1);b.addEventListener("touchmove",c,!1);b.addEventListener("mousemove",m,!1);b.addEventListener("touchmove",m,!1);b.addEventListener("mouseup",k,!1);b.addEventListener("mouseout",k,!1);b.addEventListener("touchend",k,!1);b.addEventListener("touchcancel",k,!1);b.addEventListener("touchleave",k,!1);this.dispose=function(){b.removeEventListener("mousedown",l);b.removeEventListener("touchstart",l);b.removeEventListener("mousemove",c);b.removeEventListener("touchmove",c);b.removeEventListener("mousemove",m);b.removeEventListener("touchmove",m);b.removeEventListener("mouseup",k);b.removeEventListener("mouseout",k);b.removeEventListener("touchend",k);b.removeEventListener("touchcancel",k);b.removeEventListener("touchleave",k)};this.attach=function(a){this.object=a;this.visible=!0;this.update()};this.detach=function(){this.object=void 0;this.visible=!1;this.axis=null};this.getMode=function(){return r};this.setMode=function(a){r=a?a:r;"scale"===r&&(h.space="local");for(var b in u)u[b].visible=b===r;this.update();h.dispatchEvent(A)};this.setTranslationSnap=function(a){h.translationSnap=a};this.setRotationSnap=function(a){h.rotationSnap=a};this.setSize=function(a){h.size=a;this.update();h.dispatchEvent(A)};this.setSpace=function(a){h.space=a;this.update();h.dispatchEvent(A)};this.update=function(){void 0!==h.object&&(h.object.updateMatrixWorld(),S.setFromMatrixPosition(h.object.matrixWorld),aa.setFromRotationMatrix(G.extractRotation(h.object.matrixWorld)),a.updateMatrixWorld(),X.setFromMatrixPosition(a.matrixWorld),ba.setFromRotationMatrix(G.extractRotation(a.matrixWorld)),F=S.distanceTo(X)/6*h.size,this.position.copy(S),this.scale.set(F,F,F),L.copy(X).sub(S).normalize(),"local"===h.space?u[r].update(aa,L):"world"===h.space&&u[r].update(new THREE.Euler,L),u[r].highlight(h.axis))}};THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformControls.prototype.constructor=THREE.TransformControls})();var LZMA=LZMA||{};LZMA.OutWindow=function(){this._windowSize=0};LZMA.OutWindow.prototype.create=function(a){this._buffer&&this._windowSize===a||(this._buffer=[]);this._windowSize=a;this._streamPos=this._pos=0};LZMA.OutWindow.prototype.flush=function(){var a=this._pos-this._streamPos;if(0!==a){for(;a--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0);this._streamPos=this._pos}};LZMA.OutWindow.prototype.releaseStream=function(){this.flush();this._stream=null};LZMA.OutWindow.prototype.setStream=function(a){this.releaseStream();this._stream=a};LZMA.OutWindow.prototype.init=function(a){a||(this._pos=this._streamPos=0)};LZMA.OutWindow.prototype.copyBlock=function(a,b){var c=this._pos-a-1;for(0>c&&(c+=this._windowSize);b--;)c>=this._windowSize&&(c=0),this._buffer[this._pos++]=this._buffer[c++],this._pos>=this._windowSize&&this.flush()};LZMA.OutWindow.prototype.putByte=function(a){this._buffer[this._pos++]=a;this._pos>=this._windowSize&&this.flush()};LZMA.OutWindow.prototype.getByte=function(a){a=this._pos-a-1;0>a&&(a+=this._windowSize);return this._buffer[a]};LZMA.RangeDecoder=function(){};LZMA.RangeDecoder.prototype.setStream=function(a){this._stream=a};LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null};LZMA.RangeDecoder.prototype.init=function(){var a=5;this._code=0;for(this._range=-1;a--;)this._code=this._code<<8|this._stream.readByte()};LZMA.RangeDecoder.prototype.decodeDirectBits=function(a){for(var b=0,c;a--;)this._range>>>=1,c=this._code-this._range>>>31,this._code-=this._range&c-1,b=b<<1|1-c,0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return b};LZMA.RangeDecoder.prototype.decodeBit=function(a,b){var c=a[b],d=(this._range>>>11)*c;if((this._code^2147483648)<(d^2147483648))return this._range=d,a[b]+=2048-c>>>5,0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0;this._range-=d;this._code-=d;a[b]-=c>>>5;0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return 1};LZMA.initBitModels=function(a,b){for(;b--;)a[b]=1024};LZMA.BitTreeDecoder=function(a){this._models=[];this._numBitLevels=a};LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.decode=function(a){for(var b=1,c=this._numBitLevels;c--;)b=b<<1|a.decodeBit(this._models,b);return b-(1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.reverseDecode=function(a){for(var b=1,c=0,d=0,g;d<this._numBitLevels;++d)g=a.decodeBit(this._models,b),b=b<<1|g,c|=g<<d;return c};LZMA.reverseDecode2=function(a,b,c,d){for(var g=1,n=0,l=0,m;l<d;++l)m=c.decodeBit(a,b+g),g=g<<1|m,n|=m<<l;return n};LZMA.LenDecoder=function(){this._choice=[];this._lowCoder=[];this._midCoder=[];this._highCoder=new LZMA.BitTreeDecoder(8);this._numPosStates=0};LZMA.LenDecoder.prototype.create=function(a){for(;this._numPosStates<a;++this._numPosStates)this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)};LZMA.LenDecoder.prototype.init=function(){var a=this._numPosStates;for(LZMA.initBitModels(this._choice,2);a--;)this._lowCoder[a].init(),this._midCoder[a].init();this._highCoder.init()};LZMA.LenDecoder.prototype.decode=function(a,b){return 0===a.decodeBit(this._choice,0)?this._lowCoder[b].decode(a):0===a.decodeBit(this._choice,1)?8+this._midCoder[b].decode(a):16+this._highCoder.decode(a)};LZMA.Decoder2=function(){this._decoders=[]};LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)};LZMA.Decoder2.prototype.decodeNormal=function(a){var b=1;do b=b<<1|a.decodeBit(this._decoders,b);while(256>b);return b&255};LZMA.Decoder2.prototype.decodeWithMatchByte=function(a,b){var c=1,d,g;do if(d=b>>7&1,b<<=1,g=a.decodeBit(this._decoders,(1+d<<8)+c),c=c<<1|g,d!==g){for(;256>c;)c=c<<1|a.decodeBit(this._decoders,c);break}while(256>c);return c&255};LZMA.LiteralDecoder=function(){};LZMA.LiteralDecoder.prototype.create=function(a,b){var c;if(!this._coders||this._numPrevBits!==b||this._numPosBits!==a)for(this._numPosBits=a,this._posMask=(1<<a)-1,this._numPrevBits=b,this._coders=[],c=1<<this._numPrevBits+this._numPosBits;c--;)this._coders[c]=new LZMA.Decoder2};LZMA.LiteralDecoder.prototype.init=function(){for(var a=1<<this._numPrevBits+this._numPosBits;a--;)this._coders[a].init()};LZMA.LiteralDecoder.prototype.getDecoder=function(a,b){return this._coders[((a&this._posMask)<<this._numPrevBits)+((b&255)>>>8-this._numPrevBits)]};LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow;this._rangeDecoder=new LZMA.RangeDecoder;this._isMatchDecoders=[];this._isRepDecoders=[];this._isRepG0Decoders=[];this._isRepG1Decoders=[];this._isRepG2Decoders=[];this._isRep0LongDecoders=[];this._posSlotDecoder=[];this._posDecoders=[];this._posAlignDecoder=new LZMA.BitTreeDecoder(4);this._lenDecoder=new LZMA.LenDecoder;this._repLenDecoder=new LZMA.LenDecoder;this._literalDecoder=new LZMA.LiteralDecoder;this._dictionarySizeCheck=this._dictionarySize=-1;this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)};LZMA.Decoder.prototype.setDictionarySize=function(a){if(0>a)return!1;this._dictionarySize!==a&&(this._dictionarySize=a,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096)));return!0};LZMA.Decoder.prototype.setLcLpPb=function(a,b,c){var d=1<<c;if(8<a||4<b||4<c)return!1;this._literalDecoder.create(b,a);this._lenDecoder.create(d);this._repLenDecoder.create(d);this._posStateMask=d-1;return!0};LZMA.Decoder.prototype.init=function(){var a=4;this._outWindow.init(!1);LZMA.initBitModels(this._isMatchDecoders,192);LZMA.initBitModels(this._isRep0LongDecoders,192);LZMA.initBitModels(this._isRepDecoders,12);LZMA.initBitModels(this._isRepG0Decoders,12);LZMA.initBitModels(this._isRepG1Decoders,12);LZMA.initBitModels(this._isRepG2Decoders,12);LZMA.initBitModels(this._posDecoders,114);for(this._literalDecoder.init();a--;)this._posSlotDecoder[a].init();this._lenDecoder.init();this._repLenDecoder.init();this._posAlignDecoder.init();this._rangeDecoder.init()};LZMA.Decoder.prototype.decode=function(a,b,c){var d=0,g=0,n=0,l=0,m=0,k=0,q=0;this._rangeDecoder.setStream(a);this._outWindow.setStream(b);for(this.init();0>c||k<c;)if(a=k&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(d<<4)+a))q=this._literalDecoder.getDecoder(k++,q),q=7<=d?q.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(g)):q.decodeNormal(this._rangeDecoder),this._outWindow.putByte(q),d=4>d?0:d-(10>d?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,d))q=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,d)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(d<<4)+a)&&(d=7>d?9:11,q=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,d)?b=n:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,d)?b=l:(b=m,m=l),l=n),n=g,g=b),0===q&&(q=2+this._repLenDecoder.decode(this._rangeDecoder,a),d=7>d?8:11);else if(m=l,l=n,n=g,q=2+this._lenDecoder.decode(this._rangeDecoder,a),d=7>d?7:10,a=this._posSlotDecoder[5>=q?q-2:3].decode(this._rangeDecoder),4<=a)if(b=(a>>1)-1,g=(2|a&1)<<b,14>a)g+=LZMA.reverseDecode2(this._posDecoders,g-a-1,this._rangeDecoder,b);else{if(g+=this._rangeDecoder.decodeDirectBits(b-4)<<4,g+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),0>g){if(-1===g)break;return!1}}else g=a;if(g>=k||g>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(g,q);k+=q;q=this._outWindow.getByte(0)}this._outWindow.flush();this._outWindow.releaseStream();this._rangeDecoder.releaseStream();return!0};LZMA.Decoder.prototype.setDecoderProperties=function(a){var b,c;if(5>a.size)return!1;b=a.readByte();c=b%9;b=~~(b/9);if(!this.setLcLpPb(c,b%5,~~(b/5)))return!1;b=a.readByte();b|=a.readByte()<<8;b|=a.readByte()<<16;b+=16777216*a.readByte();return this.setDictionarySize(b)};LZMA.decompress=function(a,b,c,d){var g=new LZMA.Decoder;if(!g.setDecoderProperties(a))throw"Incorrect stream properties";if(!g.decode(b,c,d))throw"Error in data stream";return!0};LZMA.decompressFile=function(a,b){var c=new LZMA.Decoder,d;if(!c.setDecoderProperties(a))throw"Incorrect stream properties";d=a.readByte();d|=a.readByte()<<8;d|=a.readByte()<<16;d+=16777216*a.readByte();a.readByte();a.readByte();a.readByte();a.readByte();if(!c.decode(a,b,d))throw"Error in data stream";return!0};EMPLZMAUncompress=function(a){a=new Uint8Array(a);var b={data:[],position:0,writeByte:function(a){this.data[this.position++]=a}};LZMA.decompressFile({data:a,position:0,readByte:function(){return this.data[this.position++]}},b);return(new Uint8Array(b.data)).buffer};THREE.JsonEmpLoader=function(a){"boolean"===typeof a&&(console.warn("THREE.JsonEmpLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.withCredentials=!1};THREE.JsonEmpLoader.prototype={constructor:THREE.JsonEmpLoader,get statusDomElement(){void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div"));console.warn("THREE.JsonEmpLoader: .statusDomElement has been removed.");return this._statusDomElement},load:function(a,b,c,d,g,n){var l=this,m=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(a),k=new THREE.XHRLoader(this.manager);k.setWithCredentials(this.withCredentials);k.load(a,function(a){var h=JSON.parse(a);a=m+"index.lz.js";var d=new THREE.XHRLoader(this.manager);d.setWithCredentials(this.withCredentials);d.setPath(this.path);d.setResponseType("arraybuffer");d.load(a,function(a){if("undefined"!==typeof h.guid)for(key in h.guid){var d=h.guid[key],e=new Uint8Array(a,d.l0,d.l1);l.convertBufferToJson(d,e,m);var e=d.metadata,d=l.parse(d,m),g=new THREE.Matrix4;e.notOrth||g.set(e.mat_wts[0],e.mat_wts[1],e.mat_wts[2],e.mat_wts[3],e.mat_wts[4],e.mat_wts[5],e.mat_wts[6],e.mat_wts[7],e.mat_wts[8],e.mat_wts[9],e.mat_wts[10],e.mat_wts[11],e.mat_wts[12],e.mat_wts[13],e.mat_wts[14],e.mat_wts[15]);d=b(d.geometry,d.materials,g);d.name=e.meshName;d.visible=e.visible;d.uuid=key}if("undefined"!==typeof h.guidCam)for(key in h.guidCam){d=h.guidCam[key];if(void 0===d.metadata||0!=d.metadata.isAniCamera)e=new Uint8Array(a,d.l0,d.l1),l.convertBufferToJson(d,e);e=d.metadata;d=l.parseCamera(d,m);d=c(d);d.name=e.name}"function"==typeof n&&n()})},d,g)},setTexturePath:function(a){this.texturePath=a},convertBufferToJson:function(a,b){var c=EMPLZMAUncompress(b);a.vertices=this._loadBinFileWithBuffer(a.vertices,c,"float");a.normals=this._loadBinFileWithBuffer(a.normals,c,"float");void 0!==a.uvs&&void 0!==a.uvs[0]&&(a.uvs[0]=this._loadBinFileWithBuffer(a.uvs[0],c,"float"));void 0!==a.uvs&&void 0!==a.uvs[1]&&(a.uvs[1]=this._loadBinFileWithBuffer(a.uvs[1],c,"float"));a.faces=this._loadBinFileWithBuffer(a.faces,c,"int32");if("undefined"!==typeof a.animations&&"undefined"!=typeof a.animations.tracks)for(keyIdx in a.animations.tracks){var d=a.animations.tracks[keyIdx];"vector3"===d.type?d.keys=this._loadBinFileWithBuffer(d.keys,c,"timeVector3"):"quaternion"===d.type?d.keys=this._loadBinFileWithBuffer(d.keys,c,"timeQuaternion"):"float"===d.type&&(d.keys=this._loadBinFileWithBuffer(d.keys,c,"timefloat"))}},_loadBinFileWithBuffer:function(a,b,c){if(void 0!==a&&void 0!==b&&void 0!==a.offset&&void 0!==a.length&&0<a.length){var d=[];if("float"==c)return a=new Float32Array(b,a.offset,a.length/4);if("int32"===c)return a=new Int32Array(b,a.offset,a.length/4);if("timeVector3"===c){b=new Float32Array(b,a.offset,a.length/4);for(c=0;c<a.length/4;){var g={time:b[c],value:[b[c+1],b[c+2],b[c+3]]};c+=4;d.push(g)}return d}if("timeQuaternion"===c){b=new Float32Array(b,a.offset,a.length/4);for(c=0;c<a.length/4;)g={time:b[c],value:[b[c+1],b[c+2],b[c+3],b[c+4]]},c+=5,d.push(g);return d}if("timefloat"===c){b=new Float32Array(b,a.offset,a.length/4);for(c=0;c<a.length/4;)g={time:b[c],value:b[c+1]},c+=2,d.push(g);return d}}},parseCamera:function(a){var b=[],c=[];void 0!==a.animation&&c.push(a.animation);void 0!==a.animations&&(a.animations.length?c=c.concat(a.animations):c.push(a.animations));if(c)for(a=0;a<c.length;a++){var d=THREE.AnimationClip.parse(c[a]);d&&b.push(d)}return b},parse:function(a,b){var c=new THREE.Geometry,d=void 0!==a.scale?1/a.scale:1;(function(b){var d,l,m,k,q,h,r,f,u,e,v,A,x,p=a.faces;h=a.vertices;var w=a.normals,I=a.colors,C=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&C++;for(d=0;d<C;d++)c.faceVertexUvs[d]=[]}k=0;for(q=h.length;k<q;)d=new THREE.Vector3,d.x=h[k++]*b,d.y=h[k++]*b,d.z=h[k++]*b,c.vertices.push(d);k=0;for(q=p.length;k<q;)if(b=p[k++],u=b&1,m=b&2,d=b&8,r=b&16,e=b&32,h=b&64,b&=128,u){u=new THREE.Face3;u.a=p[k];u.b=p[k+1];u.c=p[k+3];v=new THREE.Face3;v.a=p[k+1];v.b=p[k+2];v.c=p[k+3];k+=4;m&&(m=p[k++],u.materialIndex=m,v.materialIndex=m);m=c.faces.length;if(d)for(d=0;d<C;d++)for(A=a.uvs[d],c.faceVertexUvs[d][m]=[],c.faceVertexUvs[d][m+1]=[],l=0;4>l;l++)f=p[k++],x=A[2*f],f=A[2*f+1],x=new THREE.Vector2(x,f),2!==l&&c.faceVertexUvs[d][m].push(x),0!==l&&c.faceVertexUvs[d][m+1].push(x);r&&(r=3*p[k++],u.normal.set(w[r++],w[r++],w[r]),v.normal.copy(u.normal));if(e)for(d=0;4>d;d++)r=3*p[k++],e=new THREE.Vector3(w[r++],w[r++],w[r]),2!==d&&u.vertexNormals.push(e),0!==d&&v.vertexNormals.push(e);h&&(h=p[k++],h=I[h],u.color.setHex(h),v.color.setHex(h));if(b)for(d=0;4>d;d++)h=p[k++],h=I[h],2!==d&&u.vertexColors.push(new THREE.Color(h)),0!==d&&v.vertexColors.push(new THREE.Color(h));c.faces.push(u);c.faces.push(v)}else{u=new THREE.Face3;u.a=p[k++];u.b=p[k++];u.c=p[k++];m&&(m=p[k++],u.materialIndex=m);m=c.faces.length;if(d)for(d=0;d<C;d++)for(A=a.uvs[d],c.faceVertexUvs[d][m]=[],l=0;3>l;l++)f=p[k++],x=A[2*f],f=A[2*f+1],x=new THREE.Vector2(x,f),c.faceVertexUvs[d][m].push(x);r&&(r=3*p[k++],u.normal.set(w[r++],w[r++],w[r]));if(e)for(d=0;3>d;d++)r=3*p[k++],e=new THREE.Vector3(w[r++],w[r++],w[r]),u.vertexNormals.push(e);h&&(h=p[k++],u.color.setHex(I[h]));if(b)for(d=0;3>d;d++)h=p[k++],u.vertexColors.push(new THREE.Color(I[h]));c.faces.push(u)}})(d);(function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,l=a.skinWeights.length;d<l;d+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[d],1<b?a.skinWeights[d+1]:0,2<b?a.skinWeights[d+2]:0,3<b?a.skinWeights[d+3]:0));if(a.skinIndices)for(d=0,l=a.skinIndices.length;d<l;d+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[d],1<b?a.skinIndices[d+1]:0,2<b?a.skinIndices[d+2]:0,3<b?a.skinIndices[d+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.")})();(function(b){if(void 0!==a.morphTargets)for(var d=0,l=a.morphTargets.length;d<l;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var m=c.morphTargets[d].vertices,k=a.morphTargets[d].vertices,q=0,h=k.length;q<h;q+=3){var r=new THREE.Vector3;r.x=k[q]*b;r.y=k[q+1]*b;r.z=k[q+2]*b;m.push(r)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JsonEmpLoader: "morphColors" no longer supported. Using them as face colors.'),b=c.faces,m=a.morphColors[0].colors,d=0,l=b.length;d<l;d++)b[d].color.fromArray(m,3*d)})(d);(function(){var b=[],d=[];void 0!==a.animation&&d.push(a.animation);void 0!==a.animations&&(a.animations.length?d=d.concat(a.animations):d.push(a.animations));if(c.bones&&0<c.bones.length)for(var l=0;l<d.length;l++){var m=THREE.AnimationClip.parseAnimation(d[l],c.bones);m&&b.push(m)}c.morphTargets&&(l=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(l));if(d)for(l=0;l<d.length;l++)(m=THREE.AnimationClip.parse(d[l]))&&b.push(m);0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};d=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:d}}};(function(){!1==="performance"in window&&(window.performance={});Date.now=Date.now||function(){return(new Date).getTime()};if(!1==="now"in window.performance){var a=window.performance.timing&&window.performance.timing.navigationStart?window.performance.timing.navigationStart:Date.now();window.performance.now=function(){return Date.now()-a}}})();var TWEEN=TWEEN||function(){var a=[];return{getAll:function(){return a},removeAll:function(){a=[]},add:function(b){a.push(b)},remove:function(b){b=a.indexOf(b);-1!==b&&a.splice(b,1)},update:function(b){if(0===a.length)return!1;var c=0;for(b=void 0!==b?b:window.performance.now();c<a.length;)a[c].update(b)?c++:a.splice(c,1);return!0}}}();TWEEN.Tween=function(a){var b={},c={},d={},g=1E3,n=0,l=!1,m=!1,k=0,q=null,h=TWEEN.Easing.Linear.None,r=TWEEN.Interpolation.Linear,f=[],u=null,e=!1,v=null,A=null,x=null,p;for(p in a)b[p]=parseFloat(a[p],10);this.to=function(a,b){void 0!==b&&(g=b);c=a;return this};this.start=function(h){TWEEN.add(this);m=!0;e=!1;q=void 0!==h?h:window.performance.now();q+=k;for(var f in c){if(c[f]instanceof Array){if(0===c[f].length)continue;c[f]=[a[f]].concat(c[f])}b[f]=a[f];!1===b[f]instanceof Array&&(b[f]*=1);d[f]=b[f]||0}return this};this.stop=function(){if(!m)return this;TWEEN.remove(this);m=!1;null!==x&&x.call(a);this.stopChainedTweens();return this};this.stopChainedTweens=function(){for(var a=0,b=f.length;a<b;a++)f[a].stop()};this.delay=function(a){k=a;return this};this.repeat=function(a){n=a;return this};this.yoyo=function(a){l=a;return this};this.easing=function(a){h=a;return this};this.interpolation=function(a){r=a;return this};this.chain=function(){f=arguments;return this};this.onStart=function(a){u=a;return this};this.onUpdate=function(a){v=a;return this};this.onComplete=function(a){A=a;return this};this.onStop=function(a){x=a;return this};this.update=function(m){var p,x,t;if(m<q)return!0;!1===e&&(null!==u&&u.call(a),e=!0);x=(m-q)/g;x=1<x?1:x;t=h(x);for(p in c){var D=b[p]||0,B=c[p];B instanceof Array?a[p]=r(B,t):("string"===typeof B&&(B=D+parseFloat(B,10)),"number"===typeof B&&(a[p]=D+(B-D)*t))}null!==v&&v.call(a,t);if(1===x)if(0<n){isFinite(n)&&n--;for(p in d)"string"===typeof c[p]&&(d[p]+=parseFloat(c[p],10)),l&&(x=d[p],d[p]=c[p],c[p]=x),b[p]=d[p];q=m+k}else{null!==A&&A.call(a);m=0;for(p=f.length;m<p;m++)f[m].start(q+g);return!1}return!0}};TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI);return-(c*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/.4))},Out:function(a){var b,c=.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI);return c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/.4)+1},InOut:function(a){var b,c=.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI);return 1>(a*=2)?-.5*c*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/.4):c*Math.pow(2,-10*--a)*Math.sin(2*(a-b)*Math.PI/.4)*.5+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*a-1)+.5}}};TWEEN.Interpolation={Linear:function(a,b){var c=a.length-1,d=c*b,g=Math.floor(d),n=TWEEN.Interpolation.Utils.Linear;return 0>b?n(a[0],a[1],d):1<b?n(a[c],a[c-1],c-d):n(a[g],a[g+1>c?c:g+1],d-g)},Bezier:function(a,b){for(var c=0,d=a.length-1,g=Math.pow,n=TWEEN.Interpolation.Utils.Bernstein,l=0;l<=d;l++)c+=g(1-b,d-l)*g(b,l)*a[l]*n(d,l);return c},CatmullRom:function(a,b){var c=a.length-1,d=c*b,g=Math.floor(d),n=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>b&&(g=Math.floor(d=c*(1+b))),n(a[(g-1+c)%c],a[g],a[(g+1)%c],a[(g+2)%c],d-g)):0>b?a[0]-(n(a[0],a[0],a[1],a[1],-d)-a[0]):1<b?a[c]-(n(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):n(a[g?g-1:0],a[g],a[c<g+1?c:g+1],a[c<g+2?c:g+2],d-g)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var c=TWEEN.Interpolation.Utils.Factorial;return c(a)/c(b)/c(a-b)},Factorial:function(){var a=[1];return function(b){var c=1;if(a[b])return a[b];for(var d=b;1<d;d--)c*=d;return a[b]=c}}(),CatmullRom:function(a,b,c,d,g){a=.5*(c-a);d=.5*(d-b);var n=g*g;return(2*b-2*c+a+d)*g*n+(-3*b+3*c-2*a-d)*n+a*g+b}}};(function(a){"function"===typeof define&&define.amd?define([],function(){return TWEEN}):"object"===typeof exports?module.exports=TWEEN:void 0!==a&&(a.TWEEN=TWEEN)})(this);var scene3D=[],scene3DFunction=[];EmpScene=function(){this.name="empscene";this.scene=this.controls=this.camera=this.container=this.renderer=null;this.valid=!1;this.stats=this.grid=null;this.sceneBoundingBox=new THREE.Box3;this.sceneBoundingBox.makeEmpty();this.clearColor=3829413;this.clearAlpha=1;this.selected=null;this.raycaster=new THREE.Raycaster;this.autoCamClip=this.actived=!1;this.sceneHelpers=null;this.showSkyboxFlag=this.showGridFlag=this.showAxisFlag=!1;this.clock=this.mixer=this.skyboxCamera=this.skyboxMesh=this.skyboxTexture=this.skyboxScene=null;this.group={};this.bindingDomUI=[];this.cameras=[]};EmpScene.prototype={constructor:EmpScene,setScene:function(a){this.scene.uuid=a.uuid;this.scene.name=a.name;for(this.scene.userData=JSON.parse(JSON.stringify(a.userData));0<a.children.length;)this.addObject(a.children[0])},select:function(a){this.selected!==a&&(this.selected=a)},selectById:function(a){a===this.camera.id?this.select(this.camera):this.select(this.scene.getObjectById(a,!0))},selectByUuid:function(a){var b=this;this.scene.traverse(function(c){c.uuid===a&&b.select(c)})},deselect:function(){this.select(null)},findObjectByName:function(a){if(!this.scene)return null;for(var b in this.scene.children){var c=this.scene.children[b];if(c.name==a)return c}return null},findObjectByUUID:function(a){if(!this.scene)return null;for(var b in this.scene.children){var c=this.scene.children[b];if(c.uuid==a)return c}return null},removeObjectByName:function(a){(a=this.findObjectByName(a))&&a.parent.remove(a)},addObject:function(a){this.findObjectByName(a.name)||this.scene.add(a)},addHelper:function(){var a=new THREE.BoxHelper;a.material.depthTest=!1;a.material.transparent=!0;a.name="EMPBOX";a.visible=!1;this.sceneHelpers.add(a);a=new THREE.GridHelper(1E3,10);a.name="EMPGROUND";a.visible=!1;this.sceneHelpers.add(a);a=new THREE.AxisHelper(500);a.name="EMPAXIS";a.visible=!1;this.sceneHelpers.add(a);this.skyboxCamera=new THREE.PerspectiveCamera(70,this.container.offsetWidth/this.container.offsetHeight,1,1E5);this.skyboxTexture=(new THREE.CubeTextureLoader).load("empcommon/emp/c_RT.jpg empcommon/emp/c_LF.jpg empcommon/emp/c_UP.jpg empcommon/emp/c_DN.jpg empcommon/emp/c_BK.jpg empcommon/emp/c_FR.jpg".split(" "));this.skyboxTexture.format=THREE.RGBFormat;this.skyboxTexture.mapping=THREE.CubeReflectionMapping;a=THREE.ShaderLib.cube;a=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:a.uniforms,depthWrite:!1,side:THREE.BackSide});a.uniforms.tCube.value=this.skyboxTexture;this.skyboxMesh=new THREE.Mesh(new THREE.BoxGeometry(1E3,1E3,1E3),a);this.skyboxScene.add(this.skyboxMesh)},showAxis:function(a){this.showAxisFlag=a;for(var b in this.sceneHelpers.children)a=this.sceneHelpers.children[b],"EMPAXIS"==a.name&&(a.visible=this.showAxisFlag)},showGround:function(a){this.showGridFlag=a;for(var b in this.sceneHelpers.children)a=this.sceneHelpers.children[b],"EMPGROUND"==a.name&&(a.visible=this.showGridFlag)},showSkybox:function(a){this.showSkyboxFlag=a;this.skyboxMesh.visible=this.showSkyboxFlag},setClearColor:function(a,b){"undefined"!==typeof a&&(this.clearColor=a);"undefined"!==typeof b&&(this.clearAlpha=b);this.renderer.setClearColor(this.clearColor,this.clearAlpha)},setControlType:function(a){void 0==a&&(a="orbit");"orbit"==a?(this.controls=new THREE.OrbitControls(this.camera,this.container),this.controls.enableDamping=!0,this.controls.dampingFactor=.1,this.controls.enableZoom=!0,this.controls.rotateSpeed=.1):"fly"==a?(this.controls=new THREE.FlyControls(this.camera,this.container),this.controls.movementSpeed=1E3,this.controls.rollSpeed=Math.PI/24,this.controls.autoForward=!1,this.controls.dragToLook=!1):"trackball"==a&&(this.controls=new THREE.TrackballControls(this.camera,this.container));isBuilderMode&&(this.controls.enabled=!1)},clearScene:function(){this.camera.position.set(500,250,500);this.camera.lookAt(new THREE.Vector3);for(var a=this.scene.children;0<a.length;)this.removeObject(a[0]);this.geometries={};this.materials={};this.textures={};this.scripts={};this.deselect()},removeHelper:function(a){},removeObject:function(a){if(void 0!==a.parent){var b=this;a.traverse(function(a){b.removeHelper(a)});a.parent.remove(a)}},getElapsedTime:function(){return this.clock?this.clock.getElapsedTime():0},initScene:function(a,b){function c(a){a.preventDefault();var b=new THREE.Vector2,c=!!a.touches,m=c?a.touches[0].pageX/EmpGlobalZoom-EmpGlobalLeft-a.currentTarget.offsetLeft:a.offsetX/EmpGlobalZoom,c=c?a.touches[0].pageY/EmpGlobalZoom-EmpGlobalTop-a.currentTarget.offsetTop:a.offsetY/EmpGlobalZoom,m=m/a.currentTarget.clientWidth,c=c/a.currentTarget.clientHeight;b.x=2*m-1;b.y=1-2*c;d.raycaster.setFromCamera(b,d.camera);b=d.raycaster.intersectObjects(d.scene.children);if(0<b.length&&(b=b[0].object)&&"Mesh"==b.type)if("mouseup"==a.type||"touchend"==a.type){if("function"==typeof scene3DFunction[b.name+"_up"])scene3DFunction[b.name+"_up"]()}else if(("mousedown"==a.type||"touchstart"==a.type)&&"function"==typeof scene3DFunction[b.name+"_down"])scene3DFunction[b.name+"_down"]()}this.valid=!1;this.container=document.getElementById(a);if(!this.container)return null;this.clock=new THREE.Clock;this.scene=new THREE.Scene;this.sceneHelpers=new THREE.Scene;this.skyboxScene=new THREE.Scene;this.addHelper();this.camera=new THREE.PerspectiveCamera(50,this.container.offsetWidth/this.container.offsetHeight,.1,1E4);this.createRender(!0);var d=this;this.container.addEventListener("mousedown",c,!1);this.container.addEventListener("mouseup",c,!1);this.container.addEventListener("touchstart",c,!1);this.container.addEventListener("touchend",c,!1)},createRender:function(a){a=new THREE.WebGLRenderer({antialias:a,alpha:!0});a.setClearColor(this.clearColor,this.clearAlpha);a.setPixelRatio(window.devicePixelRatio);a.autoClear=!1;a.autoUpdateScene=!1;a.setSize(this.container.offsetWidth,this.container.offsetHeight);this.container.appendChild(a.domElement);this.renderer=a},createStat:function(){var a=new Stats;a.domElement.style.position="absolute";a.domElement.style.top="0px";this.container.appendChild(a.domElement);this.stats=a},getMaterialByObjName:function(a){return(a=this.findObjectByName(a))&&"Mesh"==a.type?a.material:null},setMaterialByObjName:function(a,b){var c=this.findObjectByName(a);c?"Mesh"==c.type?c.material=b:console.log("obj not mesh",a):console.log("obj not found",a)},showModelByName:function(a,b){for(var c in this.scene.children){var d=this.scene.children[c];"Mesh"!=d.type||a!=d.name&&"EMPALLMODEL"!=a||(d.visible=b)}},showGroupByName:function(a,b){for(var c in this.group[a]){var d=this.group[a][c];"Mesh"==d.type&&(d.visible=b)}},getGroupBoundingBox:function(a){var b=new THREE.Box3;b.makeEmpty();for(var c in this.group[a]){var d=this.group[a][c];"Mesh"==d.type&&(d=d.geometry.boundingBox,b.expandByPoint(d.min),b.expandByPoint(d.max))}return b},loadEmpObjs:function(a,b,c,d,g){var n=this,l=new THREE.JsonEmpLoader,m=[];this.group[b]=m;l.load(a,function(a,b,h){b=b[0];"undefined"!==typeof d&&d.computNormal&&(a.computeFaceNormals(),a.computeVertexNormals());mesh1=new THREE.Mesh(a,b);c||(c="");mesh1.name=c+a.name;mesh1.visible=a.visible;mesh1.applyMatrix(h);mesh1.updateMatrixWorld(!0);a.computeBoundingBox();h=new THREE.Box3;h.copy(a.boundingBox);h.applyMatrix4(mesh1.matrixWorld);n.sceneBoundingBox.expandByPoint(h.min);n.sceneBoundingBox.expandByPoint(h.max);n.sceneBoundingBox.getBoundingSphere();n.sceneBoundingBox.center();n.scene.add(mesh1);m.push(mesh1);"undefined"!==typeof d&&d.autoPlay&&(n.mixer||(n.mixer=new THREE.AnimationMixer(n.scene)),a.animations&&n.mixer.clipAction(a.animations[0],mesh1).setDuration(30*a.animations[0].duration).startAt(0).play());return mesh1},function(a){var b=new THREE.PerspectiveCamera(50,n.container.offsetWidth/n.container.offsetHeight,.1,1E4);void 0!==a&&1<=a.length&&(b.animations=a);n.cameras.push(b);return b},void 0,void 0,g)},resetAniModel:function(){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(var a in this.scene.children){var b=this.scene.children[a];"Mesh"==b.type&&b.geometry.animations&&this.mixer.clipAction(b.geometry.animations[0],b).stop()}},resetAniCamera:function(a){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(key in this.cameras){var b=this.cameras[key];b.name==a&&b.animations&&this.mixer.clipAction(b.animations[0],this.controls).stop()}},pauseAniCamera:function(a){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(key in this.cameras){var b=this.cameras[key];b.name==a&&b.animations&&(this.mixer.clipAction(b.animations[0],this.controls).paused=!0)}},replayAniCamera:function(a){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(key in this.cameras){var b=this.cameras[key];b.name==a&&b.animations&&(this.mixer.clipAction(b.animations[0],this.controls).paused=!1)}},pauseAniModel:function(){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(var a in this.scene.children){var b=this.scene.children[a];"Mesh"==b.type&&b.geometry.animations&&(this.mixer.clipAction(b.geometry.animations[0],b).paused=!0)}},replayAniModel:function(){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(var a in this.scene.children){var b=this.scene.children[a];"Mesh"==b.type&&b.geometry.animations&&(this.mixer.clipAction(b.geometry.animations[0],b).paused=!1)}},playAniModel:function(a,b,c){var d=1;"undefined"!==typeof b&&(d=b);b=!1;"undefined"!=typeof c&&(b=c);this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));a=parseFloat(a);isNaN(a)&&(a=1);for(var g in this.scene.children)c=this.scene.children[g],"Mesh"==c.type&&c.geometry.animations&&(this.mixer.clipAction(c.geometry.animations[0],c).setDuration(30*c.geometry.animations[0].duration*a).startAt(0).setLoop(THREE.LoopRepeat,d).play().clampWhenFinished=b)},palyAniCamera:function(a,b,c,d){var g=1;"undefined"!==typeof c&&(g=c);b=parseFloat(b);isNaN(b)&&(b=1);c=!1;"undefined"!=typeof d&&(c=d);this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(key in this.cameras)d=this.cameras[key],d.name==a&&d.animations&&(this.mixer.clipAction(d.animations[0],this.controls).setDuration(30*d.animations[0].duration*b).startAt(0).setLoop(THREE.LoopRepeat,g).play().clampWhenFinished=c)},switchCamera:function(a,b,c,d){this.controls.target=c;this.controls.object.position.copy(d);this.controls.object.up.copy(new THREE.Vector3(0,1,0))},switchToCameraAni:function(a,b,c){this.controls.object.up.copy(new THREE.Vector3(0,1,0));b&&(new TWEEN.Tween(this.controls.object.position)).to(b,c).easing(TWEEN.Easing.Exponential.InOut).start();a&&(new TWEEN.Tween(this.controls.target)).to(a,c).easing(TWEEN.Easing.Exponential.InOut).start()},addBindingDomUI:function(a,b,c){this.bindingDomUI[a]={domID:a,meshName:b,offset:c}},bindDomUI:function(a){var b=this.findObjectByName(a.meshName);if(b&&b.geometry&&(b=b.geometry.boundingBox.center(),b.x+=a.offset.x,b.y+=a.offset.y,b.z+=a.offset.z,b=b.project(this.camera),a=document.getElementById(a.domID))){var c=(1-b.y)*this.container.offsetHeight/2+this.container.offsetTop-a.offsetHeight/2;a.style.left=((b.x+1)*this.container.offsetWidth/2+this.container.offsetLeft-a.offsetWidth/2).toFixed(0)+"px";a.style.top=c.toFixed(0)+"px"}},enable:function(){this.actived=!0;this.reszieScene();this.animate()},disable:function(){this.actived=!1},animate:function(){if(0!=this.actived){var a=this.clock.getDelta();TWEEN.update();this.stats&&this.stats.update();if(this.autoCamClip){var b=new THREE.Sphere;this.sceneBoundingBox.getBoundingSphere(b);var c=new THREE.Vector3;c.subVectors(this.controls.object.position,b.center);c=c.length();this.camera.near=Math.max(.1,c-b.radius);this.camera.far=Math.max(1E3,c+b.radius+1);this.camera.updateProjectionMatrix()}this.controls&&this.controls.update();for(key in this.bindingDomUI)this.bindDomUI(this.bindingDomUI[key]);this.mixer&&this.mixer.update(a);this.render();requestAnimationFrame(animateGlobal)}},render:function(){this.actived&&(this.scene.updateMatrixWorld(),this.skyboxCamera.rotation.copy(this.camera.rotation),this.renderer.clear(),this.renderer.render(this.skyboxScene,this.skyboxCamera),this.renderer.render(this.scene,this.camera),this.renderer.render(this.sceneHelpers,this.camera))},reszieScene:function(){this.controls&&"function"===typeof this.controls.handleResize&&this.controls.handleResize();this.camera.aspect=this.container.offsetWidth/this.container.offsetHeight;this.camera.updateProjectionMatrix();this.skyboxCamera.aspect=this.container.offsetWidth/this.container.offsetHeight;this.skyboxCamera.updateProjectionMatrix();this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight);this.render()},setSceneSize:function(a,b){this.controls&&"function"===typeof this.controls.handleResize&&this.controls.handleResize();this.camera.aspect=a/b;this.camera.updateProjectionMatrix();this.skyboxCamera.aspect=a/b;this.skyboxCamera.updateProjectionMatrix();this.renderer.setSize(a,b)}};function QueryCamInfo(a){var b="";if(a=scene3D[a]){var b=b+("\u76f8\u673a\u4f4d\u7f6e:"+a.camera.position.x.toFixed(2)+","+a.camera.position.y.toFixed(2)+","+a.camera.position.z.toFixed(2)),b=b+("\r\n\u76ee\u6807\u4f4d\u7f6e:"+a.controls.target.x.toFixed(2)+","+a.controls.target.y.toFixed(2)+","+a.controls.target.z.toFixed(2)),b=b+("\r\n\u6700\u5c0f\u8ddd\u79bb:"+a.controls.minDistance.toFixed(2)),b=b+("\r\n\u6700\u5927\u8ddd\u79bb:"+a.controls.maxDistance.toFixed(2)),c=new THREE.Vector3;c.subVectors(a.controls.object.position,a.controls.target);b+="\r\n\u5f53\u524d\u8ddd\u79bb:"+c.length().toFixed(2)}return b}function QueryMeshInfo(a){var b="",c=a.split(".");if(2!=c.length)return b;var d=scene3D[c[0]];if(d&&(c=d.findObjectByUUID(c[1]))){var g=c.geometry,b=b+("\u9876\u70b9\u4e2a\u6570:"+g.vertices.length),b=b+("\r\n\u4e09\u89d2\u9762\u4e2a\u6570:"+g.faces.length),b=b+("\r\nUV\u901a\u9053\u6570:"+g.faceVertexUvs.length+"\u5c42"),d=new THREE.Box3;d.copy(g.boundingBox);d.applyMatrix4(c.matrixWorld);g=d.getBoundingSphere();b+="\r\n\u5305\u56f4\u5706\u4e2d\u5fc3\u70b9:"+g.center.x.toFixed(2)+","+g.center.y.toFixed(2)+","+g.center.z.toFixed(2)+", \u534a\u5f84"+g.radius.toFixed(2);b+="\r\n\u5305\u56f4\u76d2:"+d.min.x.toFixed(2)+","+d.min.y.toFixed(2)+","+d.min.z.toFixed(2)+" ~ "+d.max.x.toFixed(2)+","+d.max.y.toFixed(2)+","+d.max.z.toFixed(2);c=c.matrix.elements;b+="\r\n\u77e9\u9635:\r\n  "+c[0].toFixed(4)+","+c[1].toFixed(4)+","+c[2].toFixed(4)+","+c[3].toFixed(4)+",\r\n  "+c[4].toFixed(4)+","+c[5].toFixed(4)+","+c[6].toFixed(4)+","+c[7].toFixed(4)+",\r\n  "+c[8].toFixed(4)+","+c[9].toFixed(4)+","+c[10].toFixed(4)+","+c[11].toFixed(4)+",\r\n  "+c[12].toFixed(4)+","+c[13].toFixed(4)+","+c[14].toFixed(4)+","+c[15].toFixed(4)}console.log("QueryMeshInfo",a,b);return b}function _local_replaceColon(a){return a.replace(/:/g,"%3A")}function EMPLyuQuery(a){console.log("EMPLyuQuery",a);var b="QueryInfo:";a=a.split(":");if(3!=a.length)return"";"QueryCamInfo"==a[0]?(b+=a[0]+":",b+=_local_replaceColon(QueryCamInfo(a[1])),b+=":"+a[2]):"QueryMeshInfo"==a[0]&&(b+=a[0]+":",b+=_local_replaceColon(QueryMeshInfo(a[1])),b+=":"+a[2]);"function"==typeof MsgBuilder&&MsgBuilder(b)}function dom3dReszie(){for(var a in scene3D)scene3D[a].actived&&scene3D[a].reszieScene()}window.addEventListener("resize",dom3dReszie,!1);function animateGlobal(){for(var a in scene3D)scene3D[a].actived&&scene3D[a].animate()}function create3dScene(a,b){var c=scene3D[a];null==c?(c=new EmpScene,c.initScene(a),scene3D[a]=c,b&&("undefined"!==typeof b.size&&c.setSceneSize(b.size[0],b.size[1]),c.setClearColor(b.bgcolor,b.bgalpha),"undefined"!==typeof b.controls&&c.setControlType(b.controls),"undefined"!==typeof b.jsonfile&&c.loadEmpObjs(b.jsonfile,"","",{},b.fileLoadEndFunc))):b&&("undefined"!==typeof b.size&&c.setSceneSize(b.size[0],b.size[1]),c.setClearColor(b.bgcolor,b.bgalpha),"undefined"!==typeof b.controls&&c.setControlType(b.controls));return c}(function(a){function b(a){a.startMove=a.startMove?a.startMove:{startX:null,startY:null,timestamp:null};var b=(new Date).getTime(),c,d;if(a.touches){d=[{lastX:a.deltaX,lastY:a.deltaY,moved:null,startX:a.screenX-a.startMove.screenX,startY:a.screenY-a.startMove.screenY}];c={vector:a.vector||null,orientation:window.orientation||null,lastX:0<d[0].lastX?1:0>d[0].lastX?-1:0,lastY:0<d[0].lastY?1:0>d[0].lastY?-1:0,startX:0<d[0].startX?1:0>d[0].startX?-1:0,startY:0<d[0].startY?1:0>d[0].startY?-1:0};d[0].moved=Math.sqrt(Math.pow(Math.abs(d[0].startX),2)+Math.pow(Math.abs(d[0].startY),2));var e=d[0].lastX,g=d[0].lastY;direction=null;0==e||-2>=g/e||2<=g/e?0<g?direction="down":0>g&&(direction="up"):0==g||-2>=e/g||2<=e/g?0<e?direction="right":0>e&&(direction="left"):.5<g/e&&2>g/e?0<g?direction="rightdown":0>g&&(direction="leftup"):-2<g/e&&-.5>g/e&&(0<g?direction="leftdown":0>g&&(direction="rightup"));c.name=direction}return{type:a.type||null,originalEvent:a.event||null,delta:d||null,direction:c||{orientation:window.orientation||null,vector:a.vector||null},duration:a.duration?a.duration:a.startMove.timestamp?b-a.timestamp:null,rotation:a.rotation||null,scale:a.scale||null,description:a.description||[a.type,":",a.touches,":",0!=d[0].lastX?0<d[0].lastX?"right":"left":"steady",":",0!=d[0].lastY?0<d[0].lastY?"down":"up":"steady"].join("")}}function c(b){a(window).triggerHandler("orientationchange",{direction:{orientation:window.orientation},description:["orientationchange:",["landscape:clockwise:","portrait:default:","landscape:counterclockwise:","portrait:upsidedown:"][window.orientation/90+1],window.orientation].join("")})}function d(c){var d,f=jQuery(window),g=f.data("ojQueryGestures"),e=a.jGestures.defaults.thresholdShake,k=g.oDeviceMotionLastDevicePosition||{accelerationIncludingGravity:{x:0,y:0,z:0},shake:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakeleftright:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakefrontback:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakeupdown:{eventCount:0,intervalsPassed:0,intervalsFreeze:0}},k={accelerationIncludingGravity:{x:c.accelerationIncludingGravity.x,y:c.accelerationIncludingGravity.y,z:c.accelerationIncludingGravity.z},shake:{eventCount:k.shake.eventCount,intervalsPassed:k.shake.intervalsPassed,intervalsFreeze:k.shake.intervalsFreeze},shakeleftright:{eventCount:k.shakeleftright.eventCount,intervalsPassed:k.shakeleftright.intervalsPassed,intervalsFreeze:k.shakeleftright.intervalsFreeze},shakefrontback:{eventCount:k.shakefrontback.eventCount,intervalsPassed:k.shakefrontback.intervalsPassed,intervalsFreeze:k.shakefrontback.intervalsFreeze},shakeupdown:{eventCount:k.shakeupdown.eventCount,intervalsPassed:k.shakeupdown.intervalsPassed,intervalsFreeze:k.shakeupdown.intervalsFreeze}},l;for(d in g){switch(d){case "shake":case "shakeleftright":case "shakefrontback":case "shakeupdown":l=[],l.push(d),++k[d].intervalsFreeze>e.freezeShakes&&k[d].intervalsFreeze<2*e.freezeShakes||(k[d].intervalsFreeze=0,k[d].intervalsPassed++,"shake"!==d&&"shakeleftright"!==d||!(k.accelerationIncludingGravity.x>e.leftright.sensitivity||k.accelerationIncludingGravity.x<-1*e.leftright.sensitivity)||(l.push("leftright"),l.push("x-axis")),"shake"!==d&&"shakefrontback"!==d||!(k.accelerationIncludingGravity.y>e.frontback.sensitivity||k.accelerationIncludingGravity.y<-1*e.frontback.sensitivity)||(l.push("frontback"),l.push("y-axis")),"shake"!==d&&"shakeupdown"!==d||!(k.accelerationIncludingGravity.z+9.81>e.updown.sensitivity||k.accelerationIncludingGravity.z+9.81<-1*e.updown.sensitivity)||(l.push("updown"),l.push("z-axis")),1<l.length&&(++k[d].eventCount==e.requiredShakes&&k[d].intervalsPassed<e.freezeShakes?(f.triggerHandler(d,b({type:d,description:l.join(":"),event:c,duration:5*k[d].intervalsPassed})),k[d].eventCount=0,k[d].intervalsPassed=0,k[d].intervalsFreeze=e.freezeShakes+1):k[d].eventCount==e.requiredShakes&&k[d].intervalsPassed>e.freezeShakes&&(k[d].eventCount=0,k[d].intervalsPassed=0)))}l={};l.oDeviceMotionLastDevicePosition=k;f.data("ojQueryGestures",a.extend(!0,g,l))}}function g(b){var c=jQuery(b.currentTarget);c.triggerHandler(a.jGestures.events.touchstart,b);a.hasGestures?(b.currentTarget.addEventListener("touchmove",n,!1),b.currentTarget.addEventListener("touchend",l,!1)):(c.bind("mousemove",n),c.bind("mouseup",l));var d=c.data("ojQueryGestures");b=b.touches?b.touches[0]:b;var g={};g.oLastSwipemove={screenX:b.screenX,screenY:b.screenY,timestamp:(new Date).getTime()};g.oStartTouch={screenX:b.screenX,screenY:b.screenY,timestamp:(new Date).getTime()};c.data("ojQueryGestures",a.extend(!0,d,g))}function n(c){var d=jQuery(c.currentTarget);c.preventDefault();var f=d.data("ojQueryGestures"),g=!!c.touches,e=g?c.changedTouches[0].screenX:c.screenX,k=g?c.changedTouches[0].screenY:c.screenY,l=f.oLastSwipemove,m=e-l.screenX,n=k-l.screenY;f.oLastSwipemove&&(g=b({type:"swipemove",touches:g?c.touches.length:"1",screenY:k,screenX:e,deltaY:n,deltaX:m,startMove:l,event:c,timestamp:l.timestamp}),d.triggerHandler(g.type,g));g={};c=c.touches?c.touches[0]:c;g.oLastSwipemove={screenX:c.screenX,screenY:c.screenY,timestamp:(new Date).getTime()};d.data("ojQueryGestures",a.extend(!0,f,g))}function l(c){var d=jQuery(c.currentTarget),f=!!c.changedTouches,g=f?c.changedTouches.length:"1",e=f?c.changedTouches[0].screenX:c.screenX,k=f?c.changedTouches[0].screenY:c.screenY;d.triggerHandler(a.jGestures.events.touchendStart,c);a.hasGestures?(c.currentTarget.removeEventListener("touchmove",n,!1),c.currentTarget.removeEventListener("touchend",l,!1)):(d.unbind("mousemove",n),d.unbind("mouseup",l));var m=d.data("ojQueryGestures"),q=Math.abs(m.oStartTouch.screenX-e)>a.jGestures.defaults.thresholdMove||Math.abs(m.oStartTouch.screenY-k)>a.jGestures.defaults.thresholdMove?!0:!1,p=Math.abs(m.oStartTouch.screenX-e)>a.jGestures.defaults.thresholdSwipe||Math.abs(m.oStartTouch.screenY-k)>a.jGestures.defaults.thresholdSwipe?!0:!1,w,I,C,t,D=["zero","one","two","three","four"];for(w in m){I=m.oStartTouch;e=f?c.changedTouches[0].screenX:c.screenX;k=f?c.changedTouches[0].screenY:c.screenY;C=e-I.screenX;t=k-I.screenY;e=b({type:"swipe",touches:g,screenY:k,screenX:e,deltaY:t,deltaX:C,startMove:I,event:c,timestamp:I.timestamp});switch(w){case "swipeone":case "swipetwo":case "swipethree":case "swipefour":case "swipeup":case "swiperightup":case "swiperight":case "swiperightdown":case "swipedown":case "swipeleftdown":case "swipeleft":case "swipeleftup":if(!1===f&&1<=g&&!1===q)break;if(!1===f||1<=g&&!0===q&&!0===p)e.type=["swipe",D[g]].join(""),e.type==w?d.triggerHandler(e.type,e):null!==e.direction.name&&(e.type="swipe"+e.direction.name,e.type==w&&d.triggerHandler(e.type,e));break;case "tapone":case "taptwo":case "tapthree":case "tapfour":!0!==q&&D[g]==w.slice(3)&&(e.description=["tap",D[g]].join(""),e.type=["tap",D[g]].join(""),e.type==w&&d.triggerHandler(e.type,e))}e={};d.data("ojQueryGestures",a.extend(!0,m,e));d.data("ojQueryGestures",a.extend(!0,m,e))}d.triggerHandler(a.jGestures.events.touchendProcessed,c);d.triggerHandler("EmpUpEnd",c)}function m(b){var c=jQuery(b.currentTarget);c.triggerHandler(a.jGestures.events.gesturestart,b);b=c.data("ojQueryGestures");var d={};d.oStartTouch={timestamp:(new Date).getTime()};c.data("ojQueryGestures",a.extend(!0,b,d))}function k(c){var d=jQuery(c.currentTarget),f,g,e=d.data("ojQueryGestures"),k;for(k in e)switch(k){case "pinch":f=c.scale;if(1>f&&f%1<1-a.jGestures.defaults.thresholdPinchclose||1<f&&f%1>a.jGestures.defaults.thresholdPinchopen)g=1>f?-1:1,f=b({type:"pinch",scale:f,touches:null,startMove:e.oStartTouch,event:c,timestamp:e.oStartTouch.timestamp,vector:g,description:["pinch:",g,":",1>f?"close":"open"].join("")}),d.triggerHandler(f.type,f);break;case "rotate":if(f=c.rotation,1>f&&-1*f>a.jGestures.defaults.thresholdRotateccw||1<f&&f>a.jGestures.defaults.thresholdRotatecw)g=1>f?-1:1,f=b({type:"rotate",rotation:f,touches:null,startMove:e.oStartTouch,event:c,timestamp:e.oStartTouch.timestamp,vector:g,description:["rotate:",g,":",1>f?"counterclockwise":"clockwise"].join("")}),d.triggerHandler(f.type,f)}}function q(c){var d=jQuery(c.currentTarget);d.triggerHandler(a.jGestures.events.gestureendStart,c);var f,g=d.data("ojQueryGestures"),e;for(e in g)switch(e){case "pinchclose":f=c.scale;1>f&&f%1<1-a.jGestures.defaults.thresholdPinchclose&&d.triggerHandler("pinchclose",b({type:"pinchclose",scale:f,vector:-1,touches:null,startMove:g.oStartTouch,event:c,timestamp:g.oStartTouch.timestamp,description:"pinch:-1:close"}));break;case "pinchopen":f=c.scale;1<f&&f%1>a.jGestures.defaults.thresholdPinchopen&&d.triggerHandler("pinchopen",b({type:"pinchopen",scale:f,vector:1,touches:null,startMove:g.oStartTouch,event:c,timestamp:g.oStartTouch.timestamp,description:"pinch:+1:open"}));break;case "rotatecw":f=c.rotation;1<f&&f>a.jGestures.defaults.thresholdRotatecw&&d.triggerHandler("rotatecw",b({type:"rotatecw",rotation:f,vector:1,touches:null,startMove:g.oStartTouch,event:c,timestamp:g.oStartTouch.timestamp,description:"rotate:+1:clockwise"}));break;case "rotateccw":f=c.rotation,1>f&&-1*f>a.jGestures.defaults.thresholdRotateccw&&d.triggerHandler("rotateccw",b({type:"rotateccw",rotation:f,vector:-1,touches:null,startMove:g.oStartTouch,event:c,timestamp:g.oStartTouch.timestamp,description:"rotate:-1:counterclockwise"}))}d.triggerHandler(a.jGestures.events.gestureendProcessed,c)}a.jGestures={};a.jGestures.defaults={};a.jGestures.defaults.thresholdShake={requiredShakes:10,freezeShakes:100,frontback:{sensitivity:10},leftright:{sensitivity:10},updown:{sensitivity:10}};a.jGestures.defaults.thresholdPinchopen=.05;a.jGestures.defaults.thresholdPinchmove=.05;a.jGestures.defaults.thresholdPinch=.05;a.jGestures.defaults.thresholdPinchclose=.05;a.jGestures.defaults.thresholdRotatecw=5;a.jGestures.defaults.thresholdRotateccw=5;a.jGestures.defaults.thresholdMove=20;a.jGestures.defaults.thresholdSwipe=100;a.jGestures.data={};a.jGestures.data.capableDevicesInUserAgentString=["iPad","iPhone","iPod","Mobile Safari"];a.jGestures.data.hasGestures=function(){var b;for(b=0;b<a.jGestures.data.capableDevicesInUserAgentString.length;b++)if(-1!==navigator.userAgent.indexOf(a.jGestures.data.capableDevicesInUserAgentString[b]))return!0;return!1}();a.hasGestures=a.jGestures.data.hasGestures;a.jGestures.events={touchstart:"jGestures.touchstart",touchendStart:"jGestures.touchend;start",touchendProcessed:"jGestures.touchend;processed",gesturestart:"jGestures.gesturestart",gestureendStart:"jGestures.gestureend;start",gestureendProcessed:"jGestures.gestureend;processed"};jQuery.each({orientationchange_orientationchange01:"orientationchange",gestureend_pinchopen01:"pinchopen",gestureend_pinchclose01:"pinchclose",gestureend_rotatecw01:"rotatecw",gestureend_rotateccw01:"rotateccw",gesturechange_pinch01:"pinch",gesturechange_rotate01:"rotate",touchstart_swipe13:"swipemove",touchstart_swipe01:"swipeone",touchstart_swipe02:"swipetwo",touchstart_swipe03:"swipethree",touchstart_swipe04:"swipefour",touchstart_swipe05:"swipeup",touchstart_swipe06:"swiperightup",touchstart_swipe07:"swiperight",touchstart_swipe08:"swiperightdown",touchstart_swipe09:"swipedown",touchstart_swipe10:"swipeleftdown",touchstart_swipe11:"swipeleft",touchstart_swipe12:"swipeleftup",touchstart_tap01:"tapone",touchstart_tap02:"taptwo",touchstart_tap03:"tapthree",touchstart_tap04:"tapfour",devicemotion_shake01:"shake",devicemotion_shake02:"shakefrontback",devicemotion_shake03:"shakeleftright",devicemotion_shake04:"shakeupdown"},function(b,r){jQuery.event.special[r]={setup:function(){var f=b.split("_"),l=f[0],f=f[1].slice(0,f[1].length-2),e=jQuery(this),n,r;if(!e.data("ojQueryGestures")||!e.data("ojQueryGestures")[l])if(n=e.data("ojQueryGestures")||{},r={},r[l]=!0,a.extend(!0,n,r),e.data("ojQueryGestures",n),a.hasGestures)switch(f){case "orientationchange":e.get(0).addEventListener("orientationchange",c,!1);break;case "shake":case "shakefrontback":case "shakeleftright":case "shakeupdown":case "tilt":e.get(0).addEventListener("devicemotion",d,!1);break;case "tap":case "swipe":case "swipeup":case "swiperightup":case "swiperight":case "swiperightdown":case "swipedown":case "swipeleftdown":case "swipeleft":e.get(0).addEventListener("touchstart",g,!1);break;case "pinchopen":case "pinchclose":case "rotatecw":case "rotateccw":e.get(0).addEventListener("gesturestart",m,!1);e.get(0).addEventListener("gestureend",q,!1);break;case "pinch":case "rotate":e.get(0).addEventListener("gesturestart",m,!1),e.get(0).addEventListener("gesturechange",k,!1)}else switch(f){case "tap":case "swipe":e.bind("mousedown",g)}return!1},add:function(a){jQuery(this).data("ojQueryGestures")[a.type]={originalType:a.type};return!1},remove:function(a){var b=jQuery(this),c=b.data("ojQueryGestures");c[a.type]=!1;b.data("ojQueryGestures",c);return!1},teardown:function(){var f=b.split("_"),r=f[0],f=f[1].slice(0,f[1].length-2),e=jQuery(this),v,A;if(!e.data("ojQueryGestures")||!e.data("ojQueryGestures")[r])if(v=e.data("ojQueryGestures")||{},A={},A[r]=!1,a.extend(!0,v,A),e.data("ojQueryGestures",v),a.hasGestures)switch(f){case "orientationchange":e.get(0).removeEventListener("orientationchange",c,!1);break;case "shake":case "shakefrontback":case "shakeleftright":case "shakeupdown":case "tilt":e.get(0).removeEventListener("devicemotion",d,!1);break;case "tap":case "swipe":case "swipeup":case "swiperightup":case "swiperight":case "swiperightdown":case "swipedown":case "swipeleftdown":case "swipeleft":case "swipeleftup":e.get(0).removeEventListener("touchstart",g,!1);e.get(0).removeEventListener("touchmove",n,!1);e.get(0).removeEventListener("touchend",l,!1);break;case "pinchopen":case "pinchclose":case "rotatecw":case "rotateccw":e.get(0).removeEventListener("gesturestart",m,!1);e.get(0).removeEventListener("gestureend",q,!1);break;case "pinch":case "rotate":e.get(0).removeEventListener("gesturestart",m,!1),e.get(0).removeEventListener("gesturechange",k,!1)}else switch(f){case "tap":case "swipe":e.unbind("mousedown",g),e.unbind("mousemove",n),e.unbind("mouseup",l)}return!1}}})})(jQuery);var Stats=function(){var a=Date.now(),b=a,c=0,d=Infinity,g=0,n=0,l=Infinity,m=0,k=0,q=0,h=document.createElement("div");h.id="stats";h.addEventListener("mousedown",function(a){a.preventDefault();p(++q%2)},!1);h.style.cssText="width:80px;opacity:0.9;cursor:pointer";var r=document.createElement("div");r.id="fps";r.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";h.appendChild(r);var f=document.createElement("div");f.id="fpsText";f.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";f.innerHTML="FPS";r.appendChild(f);var u=document.createElement("div");u.id="fpsGraph";u.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(r.appendChild(u);74>u.children.length;){var e=document.createElement("span");e.style.cssText="width:1px;height:30px;float:left;background-color:#113";u.appendChild(e)}var v=document.createElement("div");v.id="ms";v.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";h.appendChild(v);var A=document.createElement("div");A.id="msText";A.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";A.innerHTML="MS";v.appendChild(A);var x=document.createElement("div");x.id="msGraph";x.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(v.appendChild(x);74>x.children.length;)e=document.createElement("span"),e.style.cssText="width:1px;height:30px;float:left;background-color:#131",x.appendChild(e);var p=function(a){q=a;switch(q){case 0:r.style.display="block";v.style.display="none";break;case 1:r.style.display="none",v.style.display="block"}};return{REVISION:11,domElement:h,setMode:p,begin:function(){a=Date.now()},end:function(){var e=Date.now();c=e-a;d=Math.min(d,c);g=Math.max(g,c);A.textContent=c+" MS ("+d+"-"+g+")";var h=Math.min(30,30-c/200*30);x.appendChild(x.firstChild).style.height=h+"px";k++;e>b+1E3&&(n=Math.round(1E3*k/(e-b)),l=Math.min(l,n),m=Math.max(m,n),f.textContent=n+" FPS ("+l+"-"+m+")",h=Math.min(30,30-n/100*30),u.appendChild(u.firstChild).style.height=h+"px",b=e,k=0);return e},update:function(){a=this.end()}}};