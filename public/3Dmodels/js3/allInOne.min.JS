var EmpGlobalZoom=1,EmpGlobalLeft=0,EmpGlobalTop=0;function EmpAutoBodySize(){if(!isBuilderMode){var a=0,b=0,c=1,d=window.innerWidth,f=window.innerHeight;3==ResizePolicy?f>=winFixHeight&&d>=winFixWidth?(a=toInt((d-winFixWidth)/2),b=toInt((f-winFixHeight)/2),c=1):d/f>winFixWidth/winFixHeight?(c=f/winFixHeight,a=toInt((d-winFixWidth*c)/2)):(c=d/winFixWidth,b=toInt((f-winFixHeight*c)/2)):1==ResizePolicy?d>=winFixWidth?(c=1,a=toInt((d-winFixWidth)/2),b=toInt((f-winFixHeight)/2)):(c=d/winFixWidth,b=toInt((f-winFixHeight*c)/2),0>b&&(b=0),a=0):2==ResizePolicy?f>=winFixHeight?(c=1,a=toInt((d-winFixWidth)/2),b=toInt((f-winFixHeight)/2)):(c=f/winFixHeight,b=0,a=toInt((d-winFixWidth*c)/2)):4==ResizePolicy?(b=a=0,document.body.style.width="100%",document.body.style.height="100%"):(c=1,a=toInt((d-winFixWidth)/2),b=toInt((f-winFixHeight)/2),0>b&&(b=0),0>a&&(a=0));-1!==navigator.userAgent.indexOf("Firefox")?(document.body.style.left=a+"px",document.body.style.top=b+"px",document.body.style.MozTransformOrigin="top left",document.body.style.MozTransform="scale("+c+")"):-1!==navigator.userAgent.indexOf("Trident")||-1!==navigator.userAgent.indexOf("MSIE")?(document.body.style.left=toInt(a)+"px",document.body.style.top=toInt(b)+"px",document.body.style.zoom=c,EmpGlobalZoom=1,EmpGlobalLeft=toInt(a),EmpGlobalTop=toInt(b)):(document.body.style.left=toInt(a/c)+"px",document.body.style.top=toInt(b/c)+"px",EmpGlobalZoom=document.body.style.zoom=c,EmpGlobalLeft=toInt(a/c),EmpGlobalTop=toInt(b/c))}}function cancelTrans(a){a=a?a:window.event;window.event?a.cancelBubble=!0:a.stopPropagation()}function EmpDetectZoom(){var a=0,b=window.screen,c=navigator.userAgent.toLowerCase();void 0!==window.devicePixelRatio?a=window.devicePixelRatio:~c.indexOf("msie")?b.deviceXDPI&&b.logicalXDPI&&(a=b.deviceXDPI/b.logicalXDPI):void 0!==window.outerWidth&&void 0!==window.innerWidth&&(a=window.outerWidth/window.innerWidth);return a}function EmpGetSelfUrl(a){var b=window.location.href.split("?");if(2!=b.length)return"";for(var c in b[1]){var d=b[1].split("\x26"),f;for(f in d){var t=d[c].split("\x3d");if(t&&t[0]==a)return t[1]}}return""}var EmpSortBy=function(a){return function(b,c){var d,f;if("object"===typeof b&&"object"===typeof c&&b&&c)return d=b[a],f=c[a],d===f?0:typeof d===typeof f?d<f?-1:1:typeof d<typeof f?-1:1;throw"error";}};function toInt(a){return a&&+a|0||0}function EmpApplyKeyframeByJs(a,b,c){for(var d=[],f=a.data.sort(EmpSortBy("index")),t=0;t<a.count-1;++t)if(b>=f[t].index&&b<=f[t+1].index){var m=(b-f[t].index)/(f[t+1].index-f[t].index),n;for(n in f[t])d[n]=f[t][n]+(f[t+1][n]-f[t][n])*m}a=a.css;b={};var k,r,h,p,g;for(g in a)"background-color"==a[g]||"color"==a[g]?b[a[g]]="rgba("+toInt(d[a[g]+".r"])+","+toInt(d[a[g]+".g"])+","+toInt(d[a[g]+".b"])+","+d[a[g]+".a"]+")":"left"==a[g]||"top"==a[g]||"width"==a[g]||"height"==a[g]||"font-size"==a[g]||"text-indent"==a[g]||"letter-spacing"==a[g]?b[a[g]]=d[a[g]]+"px":"opacity"==a[g]||"font-weight"==a[g]||"line-height"==a[g]?b[a[g]]=d[a[g]]:"transform-origin"==a[g]?b[a[g]]=toInt(d[a[g]+".x"])+","+toInt(d[a[g]+".y"]):"box-shadow"==a[g]||"text-shadow"==a[g]?b[a[g]]=toInt(d[a[g]+".x"])+"px "+toInt(d[a[g]+".y"])+"px "+toInt(d[a[g]+".z"])+"px rgb("+toInt(d[a[g]+".r"])+","+toInt(d[a[g]+".g"])+","+toInt(d[a[g]+".b"])+")":"Transform.1RotateAngleDegree"==a[g]?p=" rotate("+d.rotate+"deg) ":"Transform.2SkewDegree"==a[g]?h=" skew("+d["skew.x"]+"deg,"+d["skew.y"]+"deg) ":"Transform.3Scale"==a[g]?r=" scale("+d["scale.x"]+","+d["scale.y"]+") ":"Transform.0Trans"==a[g]&&(k=" translate("+d["translate.x"]+"px,"+d["translate.y"]+"px) ");if(p||h||r||k)b.transform=(k?k:"")+(p?p:"")+(h?h:"")+(r?r:"");jQuery("#"+c).css(b)}var precentX=0,precentY=0,minPrecentY=null,maxPrecentY=null,factorY=null,minPrecentX=null,maxPrecentX=null,factorX=null;function setRangeSwipeMoveX(a,b,c){minPrecentX=a;maxPrecentX=b;factorX=c}function setRangeSwipeMoveY(a,b,c){minPrecentY=a;maxPrecentY=b;factorY=c}function empSwipeMove(a,b){a.preventDefault();b.originalEvent.preventDefault();var c=b.description.split(":");switch(c[0]){case "swipemove":if(1==c[1]){precentY+=b.delta[0].startY;precentX+=b.delta[0].startX;null!=maxPrecentY&&null!=minPrecentY&&null!=factorY&&(minPrecentY>=maxPrecentY?precentY=0:precentY>maxPrecentY/factorY?precentY=maxPrecentY/factorY:precentY<minPrecentY/factorY&&(precentY=minPrecentY/factorY));null!=maxPrecentX&&precentX>maxPrecentX/factorX?precentX=maxPrecentX/factorX:null!=minPrecentX&&precentX<minPrecentX/factorX&&(precentX=minPrecentX/factorX);for(var d in swipemoveData)swipemoveData[d](precentX,precentY)}}}function createEmpButton(a,b,c,d,f){var t=empGetElementByID(a,"div",null),m=empGetElementByID(a+"_button","div",t);t.appendChild(m);var n=b.normal,k=b.pressed?b.pressed:b.normal,r=b.hover?b.hover:b.normal;m.style.cssText=c;b.color&&jQuery(m).css("background-color",b.color);n&&jQuery(m).css("background-image",b.normal);jQuery(t).bind("touchstart mousedown",function(){jQuery(m).css({transform:"translate("+d+"px,"+f+"px)"});k&&jQuery(m).css("background-image",b.pressed);jQuery(document.body).one("touchend mouseup",function(){jQuery(m).css({transform:"translate(0px,0px)"});n&&jQuery(m).css("background-image",b.normal)})});b.hover&&(jQuery(t).mouseenter(function(){jQuery(m).css({transform:"translate(0px,0px)"});r&&jQuery(m).css("background-image",b.hover)}),jQuery(t).mouseleave(function(){jQuery(m).css({transform:"translate(0px,0px)"});n&&jQuery(m).css("background-image",b.normal)}));return m}function createZoomLens(a,b,c,d,f,t,m,n){var k=empGetElementByID(a,"div",null),r=empGetElementByID(a+"_zoomlens","div",k);k.appendChild(r);var k="border-radius:1024px;",h=parseInt(n.size)||0;n=n.color||"0xffffff";d!=f&&(k="");var k=k+("border: "+h+"px solid "+n+";"),p=parseInt(jQuery("#"+a).css("width")),g=parseInt(jQuery("#"+a).css("height"));r.style.cssText="visibility:hidden; pointer-events: none;"+k+" background-image:url('"+c+"');background-size:"+b*p/d+"% "+b*g/f+"%;background-repeat:no-repeat;position:absolute;left:0px;top:0px;width:"+d+"px;height:"+f+"px;opacity:1;";jQuery("#"+a+"_zoomlens").attr("emplenshidden",1);jQuery("#"+a).bind("touchmove mousemove",function(c){if(1!=jQuery("#"+a+"_zoomlens").attr("emplenshidden")){c.preventDefault();var h=!!c.originalEvent.touches,l=h?c.originalEvent.touches[0].pageX/EmpGlobalZoom-EmpGlobalLeft-c.originalEvent.currentTarget.offsetLeft:c.originalEvent.offsetX/EmpGlobalZoom,k=h?c.originalEvent.touches[0].pageY/EmpGlobalZoom-EmpGlobalTop-c.originalEvent.currentTarget.offsetTop:c.originalEvent.offsetY/EmpGlobalZoom,h=100*l/c.originalEvent.currentTarget.clientWidth;c=100*k/c.originalEvent.currentTarget.clientHeight;0>h||100<h||0>c||100<c||(jQuery("#"+a+"_zoomlens").css("visibility","visible"),l-=.5*d,k-=.5*f,h=-1*(b*p/100*h/100-d/2),c=-1*(b*g/100*c/100-f/2),jQuery("#"+a+"_zoomlens").css({left:t+l+"px",top:m+k+"px"}),jQuery("#"+a+"_zoomlens").css("background-position",h+"px "+c+"px"))}});jQuery("#"+a).bind("touchstart mousedown",function(){jQuery("#"+a+"_zoomlens").attr("emplenshidden",0);jQuery("#"+a).one("touchend mouseup",function(){jQuery("#"+a+"_zoomlens").css("visibility","hidden");jQuery("#"+a+"_zoomlens").attr("emplenshidden",1)});jQuery(document.body).one("touchend mouseup",function(){jQuery("#"+a+"_zoomlens").css("visibility","hidden");jQuery("#"+a+"_zoomlens").attr("emplenshidden",1)})})}function createSwitchImage(a){var b=!1,c=empGetElementByID(a.divid,"div",null),d=empGetElementByID(a.divid+"_mask","div",c);d.style.backgroundImage="url('"+a.maskImg+"')";d.style.backgroundSize="100% 100%";d.style.backgroundRepeat="no-repeat";d.style.pointerEvents="none";d.style.width=a.verticalFlag?"0px":c.style.width;d.style.height=a.verticalFlag?c.style.height:"0px";d.style.left="0px";d.style.top="0px";d.style.position="absolute";d=empGetElementByID(a.divid+"_seperator","div",c);d.style.backgroundImage="url('"+a.seperatorImg+"')";d.style.backgroundSize="100% 100%";d.style.backgroundRepeat="no-repeat";d.style.pointerEvents="none";d.style.width=a.verticalFlag?a.sepWidth+"px":parseInt(c.style.width)+2*a.sepWidth+"px";d.style.height=a.verticalFlag?parseInt(c.style.height)+2*a.sepHeight+"px":a.sepHeight+"px";d.style.left=a.verticalFlag?-.5*a.sepWidth+"px":-1*a.sepWidth+"px";d.style.top=a.verticalFlag?-1*a.sepHeight+"px":-.5*a.sepHeight+"px";d.style.position="absolute";jQuery("#"+a.divid).bind("touchmove mousemove",function(c){if(0!=b){c.preventDefault();var d=!!c.originalEvent.touches,m=d?c.originalEvent.touches[0].pageX/EmpGlobalZoom-EmpGlobalLeft-c.originalEvent.currentTarget.offsetLeft:c.originalEvent.offsetX/EmpGlobalZoom,d=d?c.originalEvent.touches[0].pageY/EmpGlobalZoom-EmpGlobalTop-c.originalEvent.currentTarget.offsetTop:c.originalEvent.offsetY/EmpGlobalZoom,n=100*m/c.originalEvent.currentTarget.clientWidth,k=100*d/c.originalEvent.currentTarget.clientHeight;0>n&&(m=n=0);100<n&&(n=100,m=c.originalEvent.currentTarget.clientWidth);0>k&&(d=k=0);100<k&&(k=100,d=c.originalEvent.currentTarget.clientHeight);a.verticalFlag?jQuery("#"+a.divid+"_mask").css({width:m+"px","background-size":1E4/n+"% 100%"}):jQuery("#"+a.divid+"_mask").css({height:d+"px","background-size":"100%"+1E4/k+"%"});a.verticalFlag?jQuery("#"+a.divid+"_seperator").css({left:m-.5*a.sepWidth+"px"}):jQuery("#"+a.divid+"_seperator").css({top:d-.5*a.sepHeight+"px"});c.preventDefault()}});jQuery("#"+a.divid).bind("touchstart mousedown",function(){b=!0;jQuery("#"+a.divid).one("touchend mouseup",function(){b=!1});jQuery(document.body).one("touchend mouseup",function(){b=!1})})}function empGetElementByID(a,b,c,d){var f=document.getElementById(a);null==f&&(f=document.createElement(b),f.id=a,c?c.appendChild(f):document.body.appendChild(f),"function"===typeof d&&d(f));return f}function empDeleteElementByID(a){(a=document.getElementById(a))&&a.parentNode.removeChild(a)}function empShowElementByID(a,b){var c=document.getElementById(a);c&&(c.style.visibility=b)}function empSetPEElementByID(a,b){var c=document.getElementById(a);c&&(c.style.pointerEvents=b)}function empSetOpacityElementByID(a,b){var c=document.getElementById(a);c&&(c.style.opacity=b)}function empSetFullScreen(a){a.requestFullscreen?a.requestFullscreen():a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen?a.webkitRequestFullScreen():a.msRequestFullscreen&&a.msRequestFullscreen()}function empExitFullScreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}function empIsFullScreen(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled}window.addEventListener("load",function(){EmpAutoBodySize()},!1);isBuilderMode||window.addEventListener("resize",EmpAutoBodySize,!1);(function(a,b,c,d){function f(b,c,d,f){var r={duration:1,animation:null,iterate:2,delay:0,timing:"linear",keep:!1,fillmode:"forwards"};this.prefixes=["","-moz-","-o-animation-","-webkit-","-ms-"];this.element=a(b);this.bare=b;this.queue=[];this.listening=!1;b="function"==typeof d?d:f;switch(c){case "blur":r={amount:3,duration:.5,focusAfter:null};this.options=a.extend(r,d);this._blur(b);break;case "focus":this._focus();break;case "rotate":r={degrees:15,duration:.5};this.options=a.extend(r,d);this._rotate(b);break;case "cleanse":this.cleanse();break;default:this.options=a.extend(r,c),this.init(b)}}f.prototype={init:function(b){"[object Array]"===Object.prototype.toString.call(this.options.animation)?a.merge(this.queue,this.options.animation):this.queue.push(this.options.animation);this.cleanse();this.animate(b)},animate:function(a){this.element.addClass("animated");this.element.addClass(this.queue[0]);this.element.data("animo",this.queue[0]);for(var b=this.prefixes.length;b--;)this.element.css(this.prefixes[b]+"animation-duration",this.options.duration+"s"),this.element.css(this.prefixes[b]+"animation-delay",this.options.delay+"s"),this.element.css(this.prefixes[b]+"animation-iteration-count",this.options.iterate),this.element.css(this.prefixes[b]+"animation-timing-function",this.options.timing),this.element.css(this.prefixes[b]+"animation-fill-mode",this.options.fillmode);var c=this,b=a;1<c.queue.length&&(b=null);this._end("AnimationEnd",function(){c.element.hasClass(c.queue[0])&&(c.options.keep||c.cleanse(),c.queue.shift(),c.queue.length&&c.animate(a))},b)},cleanse:function(){this.element.removeClass("animated");this.element.removeClass(this.queue[0]);this.element.removeClass(this.element.data("animo"));for(var a=this.prefixes.length;a--;)this.element.css(this.prefixes[a]+"animation-duration",""),this.element.css(this.prefixes[a]+"animation-delay",""),this.element.css(this.prefixes[a]+"animation-iteration-count",""),this.element.css(this.prefixes[a]+"animation-timing-function",""),this.element.css(this.prefixes[a]+"animation-fill-mode",""),this.element.css(this.prefixes[a]+"transition",""),this.element.css(this.prefixes[a]+"transform",""),this.element.css(this.prefixes[a]+"filter","")},_blur:function(c){if(this.element.is("img")){var d="svg_"+(16777216*(1+Math.random())|0).toString(16).substring(1),f="filter_"+(16777216*(1+Math.random())|0).toString(16).substring(1);a("body").append('\x3csvg version\x3d"1.1" xmlns\x3d"http://www.w3.org/2000/svg" id\x3d"'+d+'" style\x3d"height:0;position:absolute;top:-1000px;"\x3e\x3cfilter id\x3d"'+f+'"\x3e\x3cfeGaussianBlur stdDeviation\x3d"'+this.options.amount+'" /\x3e\x3c/filter\x3e\x3c/svg\x3e');for(var k=this.prefixes.length;k--;)this.element.css(this.prefixes[k]+"filter","blur("+this.options.amount+"px)"),this.element.css(this.prefixes[k]+"transition",this.options.duration+"s all linear");this.element.css("filter","url(#"+f+")");this.element.data("svgid",d)}else{d=this.element.css("color");for(k=this.prefixes.length;k--;)this.element.css(this.prefixes[k]+"transition","all "+this.options.duration+"s linear");this.element.css("text-shadow","0 0 "+this.options.amount+"px "+d);this.element.css("color","transparent")}this._end("TransitionEnd",null,c);var r=this;if(this.options.focusAfter)var h=b.setTimeout(function(){r._focus();h=b.clearTimeout(h)},1E3*this.options.focusAfter)},_focus:function(){var b=this.prefixes.length;if(this.element.is("img")){for(;b--;)this.element.css(this.prefixes[b]+"filter",""),this.element.css(this.prefixes[b]+"transition","");a("#"+this.element.data("svgid")).remove()}else{for(;b--;)this.element.css(this.prefixes[b]+"transition","");this.element.css("text-shadow","");this.element.css("color","")}},_rotate:function(a){for(var b=this.prefixes.length;b--;)this.element.css(this.prefixes[b]+"transition","all "+this.options.duration+"s linear"),this.element.css(this.prefixes[b]+"transform","rotate("+this.options.degrees+"deg)");this._end("TransitionEnd",null,a)},_end:function(a,b,c){var d=this,f=a.toLowerCase()+" webkit"+a+" o"+a+" MS"+a;this.element.bind(f,function(){d.element.unbind(f);"function"==typeof b&&b();"function"==typeof c&&c(d)})}};a.fn.animo=function(a,b,c){return this.each(function(){new f(this,a,b,c)})}})(jQuery,window,document);var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!(!window.WebGLRenderingContext||!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";a.style.textAlign="center";a.style.background="#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";this.webgl||(a.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support \x3ca href\x3d"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style\x3d"color:#000"\x3eWebGL\x3c/a\x3e.\x3cbr /\x3e\nFind out how to get it \x3ca href\x3d"http://get.webgl.org/" style\x3d"color:#000"\x3ehere\x3c/a\x3e.':'Your browser does not seem to support \x3ca href\x3d"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style\x3d"color:#000"\x3eWebGL\x3c/a\x3e.\x3cbr/\x3e\nFind out how to get it \x3ca href\x3d"http://get.webgl.org/" style\x3d"color:#000"\x3ehere\x3c/a\x3e.');return a},addGetWebGLMessage:function(a){var b,c;a=a||{};b=void 0!==a.parent?a.parent:document.body;a=void 0!==a.id?a.id:"oldie";c=Detector.getWebGLErrorMessage();c.id=a;b.appendChild(c)}};"object"===typeof module&&(module.exports=Detector);THREE.OrbitControls=function(a,b){function c(){return Math.pow(.95,e.zoomSpeed)}function d(a){e.object instanceof THREE.PerspectiveCamera?D/=a:e.object instanceof THREE.OrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*a)),e.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function f(a){e.object instanceof THREE.PerspectiveCamera?D*=a:e.object instanceof THREE.OrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/a)),e.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function t(a){if(!1!==e.enabled){a.preventDefault();if(a.button===e.mouseButtons.ORBIT){if(!1===e.enableRotate)return;F.set(a.clientX,a.clientY);w=q.ROTATE}else if(a.button===e.mouseButtons.ZOOM){if(!1===e.enableZoom)return;J.set(a.clientX,a.clientY);w=q.DOLLY}else if(a.button===e.mouseButtons.PAN){if(!1===e.enablePan)return;G.set(a.clientX,a.clientY);w=q.PAN}w!==q.NONE&&(document.addEventListener("mousemove",m,!1),document.addEventListener("mouseup",n,!1),document.addEventListener("mouseout",n,!1),e.dispatchEvent(A))}}function m(a){!1!==e.enabled&&(a.preventDefault(),w===q.ROTATE?!1!==e.enableRotate&&(H.set(a.clientX,a.clientY),L.subVectors(H,F),a=e.domElement===document?e.domElement.body:e.domElement,u.theta-=2*Math.PI*L.x/a.clientWidth*e.rotateSpeed,u.phi-=2*Math.PI*L.y/a.clientHeight*e.rotateSpeed,F.copy(H),e.update()):w===q.DOLLY?!1!==e.enableZoom&&(N.set(a.clientX,a.clientY),O.subVectors(N,J),0<O.y?d(c()):0>O.y&&f(c()),J.copy(N),e.update()):w===q.PAN&&!1!==e.enablePan&&(z.set(a.clientX,a.clientY),y.subVectors(z,G),M(y.x,y.y),G.copy(z),e.update()))}function n(a){!1!==e.enabled&&(document.removeEventListener("mousemove",m,!1),document.removeEventListener("mouseup",n,!1),document.removeEventListener("mouseout",n,!1),e.dispatchEvent(x),w=q.NONE)}function k(a){if(!1!==e.enabled&&!1!==e.enableZoom&&w===q.NONE){a.preventDefault();a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);0<b?f(c()):0>b&&d(c());e.update();e.dispatchEvent(A);e.dispatchEvent(x)}}function r(a){if(!1!==e.enabled&&!1!==e.enableKeys&&!1!==e.enablePan)switch(a.keyCode){case e.keys.UP:M(0,e.keyPanSpeed);e.update();break;case e.keys.BOTTOM:M(0,-e.keyPanSpeed);e.update();break;case e.keys.LEFT:M(e.keyPanSpeed,0);e.update();break;case e.keys.RIGHT:M(-e.keyPanSpeed,0),e.update()}}function h(a){if(!1!==e.enabled){switch(a.touches.length){case 1:if(!1===e.enableRotate)return;F.set(a.touches[0].pageX,a.touches[0].pageY);w=q.TOUCH_ROTATE;break;case 2:if(!1===e.enableZoom)return;var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;J.set(0,Math.sqrt(b*b+a*a));w=q.TOUCH_DOLLY;break;case 3:if(!1===e.enablePan)return;G.set(a.touches[0].pageX,a.touches[0].pageY);w=q.TOUCH_PAN;break;default:w=q.NONE}w!==q.NONE&&e.dispatchEvent(A)}}function p(a){if(!1!==e.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(!1===e.enableRotate)break;if(w!==q.TOUCH_ROTATE)break;H.set(a.touches[0].pageX,a.touches[0].pageY);L.subVectors(H,F);var b=e.domElement===document?e.domElement.body:e.domElement;u.theta-=2*Math.PI*L.x/b.clientWidth*e.rotateSpeed;u.phi-=2*Math.PI*L.y/b.clientHeight*e.rotateSpeed;F.copy(H);e.update();break;case 2:if(!1===e.enableZoom)break;if(w!==q.TOUCH_DOLLY)break;b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;N.set(0,Math.sqrt(b*b+a*a));O.subVectors(N,J);0<O.y?f(c()):0>O.y&&d(c());J.copy(N);e.update();break;case 3:if(!1===e.enablePan)break;if(w!==q.TOUCH_PAN)break;z.set(a.touches[0].pageX,a.touches[0].pageY);y.subVectors(z,G);M(y.x,y.y);G.copy(z);e.update();break;default:w=q.NONE}}function g(a){!1!==e.enabled&&(e.dispatchEvent(x),w=q.NONE)}function v(a){a.preventDefault()}this.object=a;this.domElement=void 0!==b?b:document;this.enabled=!0;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=.25;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.getPolarAngle=function(){return phi};this.getAzimuthalAngle=function(){return theta};this.reset=function(){e.target.copy(e.target0);e.object.position.copy(e.position0);e.object.zoom=e.zoom0;e.object.updateProjectionMatrix();e.dispatchEvent(l);e.update();w=q.NONE};this.update=function(){var b=new THREE.Vector3,c=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),d=c.clone().inverse(),h=new THREE.Vector3,f=new THREE.Quaternion;return function(){var a=e.object.position;b.copy(a).sub(e.target);b.applyQuaternion(c);C.setFromVector3(b);e.autoRotate&&w===q.NONE&&(u.theta-=2*Math.PI/60/60*e.autoRotateSpeed);C.theta+=u.theta;C.phi+=u.phi;C.theta=Math.max(e.minAzimuthAngle,Math.min(e.maxAzimuthAngle,C.theta));C.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,C.phi));C.makeSafe();C.radius*=D;C.radius=Math.max(e.minDistance,Math.min(e.maxDistance,C.radius));e.target.add(B);b.setFromSpherical(C);b.applyQuaternion(d);a.copy(e.target).add(b);e.object.lookAt(e.target);!0===e.enableDamping?(u.theta*=1-e.dampingFactor,u.phi*=1-e.dampingFactor):u.set(0,0,0);D=1;B.set(0,0,0);return E||h.distanceToSquared(e.object.position)>I||8*(1-f.dot(e.object.quaternion))>I?(e.dispatchEvent(l),h.copy(e.object.position),f.copy(e.object.quaternion),E=!1,!0):!1}}();this.dispose=function(){e.domElement.removeEventListener("contextmenu",v,!1);e.domElement.removeEventListener("mousedown",t,!1);e.domElement.removeEventListener("mousewheel",k,!1);e.domElement.removeEventListener("MozMousePixelScroll",k,!1);e.domElement.removeEventListener("touchstart",h,!1);e.domElement.removeEventListener("touchend",g,!1);e.domElement.removeEventListener("touchmove",p,!1);document.removeEventListener("mousemove",m,!1);document.removeEventListener("mouseup",n,!1);document.removeEventListener("mouseout",n,!1);window.removeEventListener("keydown",r,!1)};var e=this,l={type:"change"},A={type:"start"},x={type:"end"},q={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},w=q.NONE,I=1E-6,C=new THREE.Spherical,u=new THREE.Spherical,D=1,B=new THREE.Vector3,E=!1,F=new THREE.Vector2,H=new THREE.Vector2,L=new THREE.Vector2,G=new THREE.Vector2,z=new THREE.Vector2,y=new THREE.Vector2,J=new THREE.Vector2,N=new THREE.Vector2,O=new THREE.Vector2;this.handleResize=function(){};var K=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,0);a.multiplyScalar(-b);B.add(a)}}(),P=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,1);a.multiplyScalar(b);B.add(a)}}(),M=function(){var a=new THREE.Vector3;return function(b,c){var d=e.domElement===document?e.domElement.body:e.domElement;if(e.object instanceof THREE.PerspectiveCamera){a.copy(e.object.position).sub(e.target);var h=a.length(),h=h*Math.tan(e.object.fov/2*Math.PI/180);K(2*b*h/d.clientHeight,e.object.matrix);P(2*c*h/d.clientHeight,e.object.matrix)}else e.object instanceof THREE.OrthographicCamera?(K(b*(e.object.right-e.object.left)/e.object.zoom/d.clientWidth,e.object.matrix),P(c*(e.object.top-e.object.bottom)/e.object.zoom/d.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();e.domElement.addEventListener("contextmenu",v,!1);e.domElement.addEventListener("mousedown",t,!1);e.domElement.addEventListener("mousewheel",k,!1);e.domElement.addEventListener("MozMousePixelScroll",k,!1);e.domElement.addEventListener("touchstart",h,!1);e.domElement.addEventListener("touchend",g,!1);e.domElement.addEventListener("touchmove",p,!1);window.addEventListener("keydown",r,!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){console.warn("THREE.OrbitControls: .center has been renamed to .target");return this.target}},noZoom:{get:function(){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");return!this.enableZoom},set:function(a){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");this.enableZoom=!a}},noRotate:{get:function(){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");return!this.enableRotate},set:function(a){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!a}},noPan:{get:function(){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");return!this.enablePan},set:function(a){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");this.enablePan=!a}},noKeys:{get:function(){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");return!this.enableKeys},set:function(a){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!a}},staticMoving:{get:function(){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");return!this.constraint.enableDamping},set:function(a){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");this.constraint.enableDamping=!a}},dynamicDampingFactor:{get:function(){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");return this.constraint.dampingFactor},set:function(a){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.constraint.dampingFactor=a}}});THREE.TrackballControls=function(a,b){function c(a){!1!==g.enabled&&(window.removeEventListener("keydown",c),A=l,l===v.NONE)&&(a.keyCode!==g.keys[v.ROTATE]||g.noRotate?a.keyCode!==g.keys[v.ZOOM]||g.noZoom?a.keyCode!==g.keys[v.PAN]||g.noPan||(l=v.PAN):l=v.ZOOM:l=v.ROTATE)}function d(a){!1!==g.enabled&&(l=A,window.addEventListener("keydown",c,!1))}function f(a){!1!==g.enabled&&(a.preventDefault(),a.stopPropagation(),l===v.NONE&&(l=a.button),l!==v.ROTATE||g.noRotate?l!==v.ZOOM||g.noZoom?l!==v.PAN||g.noPan||(F.copy(y(a.pageX,a.pageY)),H.copy(F)):(u.copy(y(a.pageX,a.pageY)),D.copy(u)):(w.copy(J(a.pageX,a.pageY)),q.copy(w)),document.addEventListener("mousemove",t,!1),document.addEventListener("mouseup",m,!1),g.dispatchEvent(G))}function t(a){!1!==g.enabled&&(a.preventDefault(),a.stopPropagation(),l!==v.ROTATE||g.noRotate?l!==v.ZOOM||g.noZoom?l!==v.PAN||g.noPan||H.copy(y(a.pageX,a.pageY)):D.copy(y(a.pageX,a.pageY)):(q.copy(w),w.copy(J(a.pageX,a.pageY))))}function m(a){!1!==g.enabled&&(a.preventDefault(),a.stopPropagation(),l=v.NONE,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",m),g.dispatchEvent(z))}function n(a){if(!1!==g.enabled){a.preventDefault();a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3);u.y+=.01*b;g.dispatchEvent(G);g.dispatchEvent(z)}}function k(a){if(!1!==g.enabled){switch(a.touches.length){case 1:l=v.TOUCH_ROTATE;w.copy(J(a.touches[0].pageX,a.touches[0].pageY));q.copy(w);break;case 2:l=v.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;E=B=Math.sqrt(b*b+c*c);F.copy(y((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));H.copy(F);break;default:l=v.NONE}g.dispatchEvent(G)}}function r(a){if(!1!==g.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:q.copy(w);w.copy(J(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;E=Math.sqrt(b*b+c*c);H.copy(y((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));break;default:l=v.NONE}}function h(a){if(!1!==g.enabled){switch(a.touches.length){case 1:q.copy(w);w.copy(J(a.touches[0].pageX,a.touches[0].pageY));break;case 2:B=E=0,H.copy(y((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2)),F.copy(H)}l=v.NONE;g.dispatchEvent(z)}}function p(a){a.preventDefault()}var g=this,v={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a;this.domElement=void 0!==b?b:document;this.enabled=!0;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var e=new THREE.Vector3,l=v.NONE,A=v.NONE,x=new THREE.Vector3,q=new THREE.Vector2,w=new THREE.Vector2,I=new THREE.Vector3,C=0,u=new THREE.Vector2,D=new THREE.Vector2,B=0,E=0,F=new THREE.Vector2,H=new THREE.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var L={type:"change"},G={type:"start"},z={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=a.top+window.pageYOffset-b.clientTop;this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var y=function(){var a=new THREE.Vector2;return function(b,c){a.set((b-g.screen.left)/g.screen.width,(c-g.screen.top)/g.screen.height);return a}}(),J=function(){var a=new THREE.Vector2;return function(b,c){a.set((b-.5*g.screen.width-g.screen.left)/(.5*g.screen.width),(g.screen.height+2*(g.screen.top-c))/g.screen.width);return a}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion,c=new THREE.Vector3,d=new THREE.Vector3,h=new THREE.Vector3,f=new THREE.Vector3,e;return function(){f.set(w.x-q.x,w.y-q.y,0);(e=f.length())?(x.copy(g.object.position).sub(g.target),c.copy(x).normalize(),d.copy(g.object.up).normalize(),h.crossVectors(d,c).normalize(),d.setLength(w.y-q.y),h.setLength(w.x-q.x),f.copy(d.add(h)),a.crossVectors(f,x).normalize(),e*=g.rotateSpeed,b.setFromAxisAngle(a,e),x.applyQuaternion(b),g.object.up.applyQuaternion(b),I.copy(a),C=e):!g.staticMoving&&C&&(C*=Math.sqrt(1-g.dynamicDampingFactor),x.copy(g.object.position).sub(g.target),b.setFromAxisAngle(I,C),x.applyQuaternion(b),g.object.up.applyQuaternion(b));q.copy(w)}}();this.zoomCamera=function(){var a;l===v.TOUCH_ZOOM_PAN?(a=B/E,B=E,x.multiplyScalar(a)):(a=1+(D.y-u.y)*g.zoomSpeed,1!==a&&0<a&&(x.multiplyScalar(a),g.staticMoving?u.copy(D):u.y+=(D.y-u.y)*this.dynamicDampingFactor))};this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(H).sub(F);a.lengthSq()&&(a.multiplyScalar(x.length()*g.panSpeed),c.copy(x).cross(g.object.up).setLength(a.x),c.add(b.copy(g.object.up).setLength(a.y)),g.object.position.add(c),g.target.add(c),g.staticMoving?F.copy(H):F.add(a.subVectors(H,F).multiplyScalar(g.dynamicDampingFactor)))}}();this.checkDistances=function(){g.noZoom&&g.noPan||(x.lengthSq()>g.maxDistance*g.maxDistance&&(g.object.position.addVectors(g.target,x.setLength(g.maxDistance)),u.copy(D)),x.lengthSq()<g.minDistance*g.minDistance&&(g.object.position.addVectors(g.target,x.setLength(g.minDistance)),u.copy(D)))};this.update=function(){x.subVectors(g.object.position,g.target);g.noRotate||g.rotateCamera();g.noZoom||g.zoomCamera();g.noPan||g.panCamera();g.object.position.addVectors(g.target,x);g.checkDistances();g.object.lookAt(g.target);1E-6<e.distanceToSquared(g.object.position)&&(g.dispatchEvent(L),e.copy(g.object.position))};this.reset=function(){A=l=v.NONE;g.target.copy(g.target0);g.object.position.copy(g.position0);g.object.up.copy(g.up0);x.subVectors(g.object.position,g.target);g.object.lookAt(g.target);g.dispatchEvent(L);e.copy(g.object.position)};this.dispose=function(){this.domElement.removeEventListener("contextmenu",p,!1);this.domElement.removeEventListener("mousedown",f,!1);this.domElement.removeEventListener("mousewheel",n,!1);this.domElement.removeEventListener("MozMousePixelScroll",n,!1);this.domElement.removeEventListener("touchstart",k,!1);this.domElement.removeEventListener("touchend",h,!1);this.domElement.removeEventListener("touchmove",r,!1);document.removeEventListener("mousemove",t,!1);document.removeEventListener("mouseup",m,!1);window.removeEventListener("keydown",c,!1);window.removeEventListener("keyup",d,!1)};this.domElement.addEventListener("contextmenu",p,!1);this.domElement.addEventListener("mousedown",f,!1);this.domElement.addEventListener("mousewheel",n,!1);this.domElement.addEventListener("MozMousePixelScroll",n,!1);this.domElement.addEventListener("touchstart",k,!1);this.domElement.addEventListener("touchend",h,!1);this.domElement.addEventListener("touchmove",r,!1);window.addEventListener("keydown",c,!1);window.addEventListener("keyup",d,!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;(function(){var a=function(a){THREE.MeshBasicMaterial.call(this);this.depthWrite=this.depthTest=!1;this.side=THREE.FrontSide;this.transparent=!0;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);a.prototype.constructor=a;var b=function(a){THREE.LineBasicMaterial.call(this);this.depthWrite=this.depthTest=!1;this.transparent=!0;this.linewidth=1;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype);b.prototype.constructor=b;var c=new a({visible:!1,transparent:!1});THREE.TransformGizmo=function(){this.init=function(){THREE.Object3D.call(this);this.handles=new THREE.Object3D;this.pickers=new THREE.Object3D;this.planes=new THREE.Object3D;this.add(this.handles);this.add(this.pickers);this.add(this.planes);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({visible:!1,side:THREE.DoubleSide}),a={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=a.XYZE;a.YZ.rotation.set(0,Math.PI/2,0);a.XZ.rotation.set(-Math.PI/2,0,0);for(var c in a)a[c].name=c,this.planes.add(a[c]),this.planes[c]=a[c];a=function(a,b){for(var d in a)for(c=a[d].length;c--;){var f=a[d][c][0],h=a[d][c][1],p=a[d][c][2];f.name=d;h&&f.position.set(h[0],h[1],h[2]);p&&f.rotation.set(p[0],p[1],p[2]);b.add(f)}};a(this.handleGizmos,this.handles);a(this.pickerGizmos,this.pickers);this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=a.geometry.clone();b.applyMatrix(a.matrix);a.geometry=b;a.position.set(0,0,0);a.rotation.set(0,0,0);a.scale.set(1,1,1)}})};this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name===a?b.material.highlight(!0):b.material.highlight(!1))})}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo;THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),m=new THREE.Vector3(0,1,0),n=new THREE.Matrix4;this.traverse(function(k){-1!==k.name.search("E")?k.quaternion.setFromRotationMatrix(n.lookAt(b,c,m)):-1===k.name.search("X")&&-1===k.name.search("Y")&&-1===k.name.search("Z")||k.quaternion.setFromEuler(a)})};THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var d=new THREE.Geometry,f=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1));f.position.y=.5;f.updateMatrix();d.merge(f.geometry,f.matrix);f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var m=new THREE.BufferGeometry;m.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.handleGizmos={X:[[new THREE.Mesh(d,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:16711680}))]],Y:[[new THREE.Mesh(d,new a({color:65280})),[0,.5,0]],[new THREE.Line(t,new b({color:65280}))]],Z:[[new THREE.Mesh(d,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(m,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),c)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,0,.2],[-Math.PI/2,0,0]]]};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"===a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"===a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"===a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"===a&&(this.activePlane=this.planes.XYZE);"XY"===a&&(this.activePlane=this.planes.XY);"YZ"===a&&(this.activePlane=this.planes.YZ);"XZ"===a&&(this.activePlane=this.planes.XZ)};this.init()};THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate;THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var a=function(a,b,c){var d=new THREE.BufferGeometry,k=[];c=c?c:1;for(var r=0;r<=64*c;++r)"x"===b&&k.push(0,Math.cos(r/32*Math.PI)*a,Math.sin(r/32*Math.PI)*a),"y"===b&&k.push(Math.cos(r/32*Math.PI)*a,0,Math.sin(r/32*Math.PI)*a),"z"===b&&k.push(Math.sin(r/32*Math.PI)*a,Math.cos(r/32*Math.PI)*a,0);d.addAttribute("position",new THREE.Float32Attribute(k,3));return d};this.handleGizmos={X:[[new THREE.Line(new a(1,"x",.5),new b({color:16711680}))]],Y:[[new THREE.Line(new a(1,"y",.5),new b({color:65280}))]],Z:[[new THREE.Line(new a(1,"z",.5),new b({color:255}))]],E:[[new THREE.Line(new a(1.25,"z",1),new b({color:13421568}))]],XYZE:[[new THREE.Line(new a(1,"z",1),new b({color:7895160}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),c)]],XYZE:[[new THREE.Mesh(new THREE.Geometry)]]};this.setActivePlane=function(a){"E"===a&&(this.activePlane=this.planes.XYZE);"X"===a&&(this.activePlane=this.planes.YZ);"Y"===a&&(this.activePlane=this.planes.XZ);"Z"===a&&(this.activePlane=this.planes.XY)};this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),k=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),h=new THREE.Vector3(0,1,0),p=new THREE.Vector3(0,0,1),g=new THREE.Quaternion,v=new THREE.Quaternion,e=new THREE.Quaternion,l=b.clone();d.copy(this.planes.XY.rotation);k.setFromEuler(d);c.makeRotationFromQuaternion(k).getInverse(c);l.applyMatrix4(c);this.traverse(function(a){k.setFromEuler(d);"X"===a.name&&(g.setFromAxisAngle(r,Math.atan2(-l.y,l.z)),k.multiplyQuaternions(k,g),a.quaternion.copy(k));"Y"===a.name&&(v.setFromAxisAngle(h,Math.atan2(l.x,l.z)),k.multiplyQuaternions(k,v),a.quaternion.copy(k));"Z"===a.name&&(e.setFromAxisAngle(p,Math.atan2(l.y,l.x)),k.multiplyQuaternions(k,e),a.quaternion.copy(k))})};this.init()};THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate;THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var d=new THREE.Geometry,f=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));f.position.y=.5;f.updateMatrix();d.merge(f.geometry,f.matrix);f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var m=new THREE.BufferGeometry;m.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.handleGizmos={X:[[new THREE.Mesh(d,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:16711680}))]],Y:[[new THREE.Mesh(d,new a({color:65280})),[0,.5,0]],[new THREE.Line(t,new b({color:65280}))]],Z:[[new THREE.Mesh(d,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(m,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),c)]]};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"===a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"===a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"===a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"===a&&(this.activePlane=this.planes.XYZE)};this.init()};THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale;THREE.TransformControls=function(a,b){function c(a){if(void 0!==h.object&&!0!==g&&(void 0===a.button||0===a.button)){var b=r(a.changedTouches?a.changedTouches[0]:a,v[p].pickers.children),d=null;b&&(d=b.object.name,a.preventDefault());h.axis!==d&&(h.axis=d,h.update(),h.dispatchEvent(A))}}function m(a){if(void 0!==h.object&&!0!==g&&(void 0===a.button||0===a.button)){var b=a.changedTouches?a.changedTouches[0]:a;if(0===b.button||void 0===b.button){var c=r(b,v[p].pickers.children);c&&(a.preventDefault(),a.stopPropagation(),h.dispatchEvent(x),h.axis=c.object.name,h.update(),L.copy(X).sub(S).normalize(),v[p].setActivePlane(h.axis,L),a=r(b,[v[p].activePlane]))&&(Y.copy(h.object.position),R.copy(h.object.scale),Z.extractRotation(h.object.matrix),Q.extractRotation(h.object.matrixWorld),U.extractRotation(h.object.parent.matrixWorld),V.setFromMatrixScale(G.getInverse(h.object.parent.matrixWorld)),D.copy(a.point))}g=!0}}function n(a){if(void 0!==h.object&&null!==h.axis&&!1!==g&&(void 0===a.button||0===a.button)){var b=r(a.changedTouches?a.changedTouches[0]:a,[v[p].activePlane]);if(!1!==b){a.preventDefault();a.stopPropagation();u.copy(b.point);if("translate"===p){u.sub(D);u.multiply(V);"local"===h.space&&(u.applyMatrix4(G.getInverse(Q)),-1===h.axis.search("X")&&(u.x=0),-1===h.axis.search("Y")&&(u.y=0),-1===h.axis.search("Z")&&(u.z=0),u.applyMatrix4(Z),h.object.position.copy(Y),h.object.position.add(u));if("world"===h.space||-1!==h.axis.search("XYZ"))-1===h.axis.search("X")&&(u.x=0),-1===h.axis.search("Y")&&(u.y=0),-1===h.axis.search("Z")&&(u.z=0),u.applyMatrix4(G.getInverse(U)),h.object.position.copy(Y),h.object.position.add(u);null!==h.translationSnap&&("local"===h.space&&h.object.position.applyMatrix4(G.getInverse(Q)),-1!==h.axis.search("X")&&(h.object.position.x=Math.round(h.object.position.x/h.translationSnap)*h.translationSnap),-1!==h.axis.search("Y")&&(h.object.position.y=Math.round(h.object.position.y/h.translationSnap)*h.translationSnap),-1!==h.axis.search("Z")&&(h.object.position.z=Math.round(h.object.position.z/h.translationSnap)*h.translationSnap),"local"===h.space&&h.object.position.applyMatrix4(Q))}else"scale"===p?(u.sub(D),u.multiply(V),"local"===h.space&&("XYZ"===h.axis?(F=1+u.y/50,h.object.scale.x=R.x*F,h.object.scale.y=R.y*F,h.object.scale.z=R.z*F):(u.applyMatrix4(G.getInverse(Q)),"X"===h.axis&&(h.object.scale.x=R.x*(1+u.x/50)),"Y"===h.axis&&(h.object.scale.y=R.y*(1+u.y/50)),"Z"===h.axis&&(h.object.scale.z=R.z*(1+u.z/50))))):"rotate"===p&&(u.sub(S),u.multiply(V),z.copy(D).sub(S),z.multiply(V),"E"===h.axis?(u.applyMatrix4(G.getInverse(H)),z.applyMatrix4(G.getInverse(H)),B.set(Math.atan2(u.z,u.y),Math.atan2(u.x,u.z),Math.atan2(u.y,u.x)),E.set(Math.atan2(z.z,z.y),Math.atan2(z.x,z.z),Math.atan2(z.y,z.x)),y.setFromRotationMatrix(G.getInverse(U)),W.setFromAxisAngle(L,B.z-E.z),K.setFromRotationMatrix(Q),y.multiplyQuaternions(y,W),y.multiplyQuaternions(y,K),h.object.quaternion.copy(y)):"XYZE"===h.axis?(W.setFromEuler(u.clone().cross(z).normalize()),y.setFromRotationMatrix(G.getInverse(U)),P.setFromAxisAngle(W,-u.clone().angleTo(z)),K.setFromRotationMatrix(Q),y.multiplyQuaternions(y,P),y.multiplyQuaternions(y,K),h.object.quaternion.copy(y)):"local"===h.space?(u.applyMatrix4(G.getInverse(Q)),z.applyMatrix4(G.getInverse(Q)),B.set(Math.atan2(u.z,u.y),Math.atan2(u.x,u.z),Math.atan2(u.y,u.x)),E.set(Math.atan2(z.z,z.y),Math.atan2(z.x,z.z),Math.atan2(z.y,z.x)),K.setFromRotationMatrix(Z),null!==h.rotationSnap?(P.setFromAxisAngle(J,Math.round((B.x-E.x)/h.rotationSnap)*h.rotationSnap),M.setFromAxisAngle(N,Math.round((B.y-E.y)/h.rotationSnap)*h.rotationSnap),T.setFromAxisAngle(O,Math.round((B.z-E.z)/h.rotationSnap)*h.rotationSnap)):(P.setFromAxisAngle(J,B.x-E.x),M.setFromAxisAngle(N,B.y-E.y),T.setFromAxisAngle(O,B.z-E.z)),"X"===h.axis&&K.multiplyQuaternions(K,P),"Y"===h.axis&&K.multiplyQuaternions(K,M),"Z"===h.axis&&K.multiplyQuaternions(K,T),h.object.quaternion.copy(K)):"world"===h.space&&(B.set(Math.atan2(u.z,u.y),Math.atan2(u.x,u.z),Math.atan2(u.y,u.x)),E.set(Math.atan2(z.z,z.y),Math.atan2(z.x,z.z),Math.atan2(z.y,z.x)),y.setFromRotationMatrix(G.getInverse(U)),null!==h.rotationSnap?(P.setFromAxisAngle(J,Math.round((B.x-E.x)/h.rotationSnap)*h.rotationSnap),M.setFromAxisAngle(N,Math.round((B.y-E.y)/h.rotationSnap)*h.rotationSnap),T.setFromAxisAngle(O,Math.round((B.z-E.z)/h.rotationSnap)*h.rotationSnap)):(P.setFromAxisAngle(J,B.x-E.x),M.setFromAxisAngle(N,B.y-E.y),T.setFromAxisAngle(O,B.z-E.z)),K.setFromRotationMatrix(Q),"X"===h.axis&&y.multiplyQuaternions(y,P),"Y"===h.axis&&y.multiplyQuaternions(y,M),"Z"===h.axis&&y.multiplyQuaternions(y,T),y.multiplyQuaternions(y,K),h.object.quaternion.copy(y)));h.update();h.dispatchEvent(A);h.dispatchEvent(w)}}}function k(a){if(void 0===a.button||0===a.button)g&&null!==h.axis&&(q.mode=p,h.dispatchEvent(q)),g=!1,c(a)}function r(c,h){var e=b.getBoundingClientRect();C.set((c.clientX-e.left)/e.width*2-1,-((c.clientY-e.top)/e.height*2)+1);I.setFromCamera(C,a);e=I.intersectObjects(h,!0);return e[0]?e[0]:!1}THREE.Object3D.call(this);b=void 0!==b?b:document;this.object=void 0;this.visible=!1;this.rotationSnap=this.translationSnap=null;this.space="world";this.size=1;this.axis=null;var h=this,p="translate",g=!1,v={translate:new THREE.TransformGizmoTranslate,rotate:new THREE.TransformGizmoRotate,scale:new THREE.TransformGizmoScale},e;for(e in v){var l=v[e];l.visible=e===p;this.add(l)}var A={type:"change"},x={type:"mouseDown"},q={type:"mouseUp",mode:p},w={type:"objectChange"},I=new THREE.Raycaster,C=new THREE.Vector2,u=new THREE.Vector3,D=new THREE.Vector3,B=new THREE.Vector3,E=new THREE.Vector3,F=1,H=new THREE.Matrix4,L=new THREE.Vector3,G=new THREE.Matrix4,z=new THREE.Vector3,y=new THREE.Quaternion,J=new THREE.Vector3(1,0,0),N=new THREE.Vector3(0,1,0),O=new THREE.Vector3(0,0,1),K=new THREE.Quaternion,P=new THREE.Quaternion,M=new THREE.Quaternion,T=new THREE.Quaternion,W=new THREE.Quaternion,Y=new THREE.Vector3,R=new THREE.Vector3,Z=new THREE.Matrix4,U=new THREE.Matrix4,V=new THREE.Vector3,S=new THREE.Vector3,aa=new THREE.Euler,Q=new THREE.Matrix4,X=new THREE.Vector3,ba=new THREE.Euler;b.addEventListener("mousedown",m,!1);b.addEventListener("touchstart",m,!1);b.addEventListener("mousemove",c,!1);b.addEventListener("touchmove",c,!1);b.addEventListener("mousemove",n,!1);b.addEventListener("touchmove",n,!1);b.addEventListener("mouseup",k,!1);b.addEventListener("mouseout",k,!1);b.addEventListener("touchend",k,!1);b.addEventListener("touchcancel",k,!1);b.addEventListener("touchleave",k,!1);this.dispose=function(){b.removeEventListener("mousedown",m);b.removeEventListener("touchstart",m);b.removeEventListener("mousemove",c);b.removeEventListener("touchmove",c);b.removeEventListener("mousemove",n);b.removeEventListener("touchmove",n);b.removeEventListener("mouseup",k);b.removeEventListener("mouseout",k);b.removeEventListener("touchend",k);b.removeEventListener("touchcancel",k);b.removeEventListener("touchleave",k)};this.attach=function(a){this.object=a;this.visible=!0;this.update()};this.detach=function(){this.object=void 0;this.visible=!1;this.axis=null};this.getMode=function(){return p};this.setMode=function(a){p=a?a:p;"scale"===p&&(h.space="local");for(var b in v)v[b].visible=b===p;this.update();h.dispatchEvent(A)};this.setTranslationSnap=function(a){h.translationSnap=a};this.setRotationSnap=function(a){h.rotationSnap=a};this.setSize=function(a){h.size=a;this.update();h.dispatchEvent(A)};this.setSpace=function(a){h.space=a;this.update();h.dispatchEvent(A)};this.update=function(){void 0!==h.object&&(h.object.updateMatrixWorld(),S.setFromMatrixPosition(h.object.matrixWorld),aa.setFromRotationMatrix(G.extractRotation(h.object.matrixWorld)),a.updateMatrixWorld(),X.setFromMatrixPosition(a.matrixWorld),ba.setFromRotationMatrix(G.extractRotation(a.matrixWorld)),F=S.distanceTo(X)/6*h.size,this.position.copy(S),this.scale.set(F,F,F),L.copy(X).sub(S).normalize(),"local"===h.space?v[p].update(aa,L):"world"===h.space&&v[p].update(new THREE.Euler,L),v[p].highlight(h.axis))}};THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformControls.prototype.constructor=THREE.TransformControls})();var LZMA=LZMA||{};LZMA.OutWindow=function(){this._windowSize=0};LZMA.OutWindow.prototype.create=function(a){this._buffer&&this._windowSize===a||(this._buffer=[]);this._windowSize=a;this._streamPos=this._pos=0};LZMA.OutWindow.prototype.flush=function(){var a=this._pos-this._streamPos;if(0!==a){for(;a--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0);this._streamPos=this._pos}};LZMA.OutWindow.prototype.releaseStream=function(){this.flush();this._stream=null};LZMA.OutWindow.prototype.setStream=function(a){this.releaseStream();this._stream=a};LZMA.OutWindow.prototype.init=function(a){a||(this._pos=this._streamPos=0)};LZMA.OutWindow.prototype.copyBlock=function(a,b){var c=this._pos-a-1;for(0>c&&(c+=this._windowSize);b--;)c>=this._windowSize&&(c=0),this._buffer[this._pos++]=this._buffer[c++],this._pos>=this._windowSize&&this.flush()};LZMA.OutWindow.prototype.putByte=function(a){this._buffer[this._pos++]=a;this._pos>=this._windowSize&&this.flush()};LZMA.OutWindow.prototype.getByte=function(a){a=this._pos-a-1;0>a&&(a+=this._windowSize);return this._buffer[a]};LZMA.RangeDecoder=function(){};LZMA.RangeDecoder.prototype.setStream=function(a){this._stream=a};LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null};LZMA.RangeDecoder.prototype.init=function(){var a=5;this._code=0;for(this._range=-1;a--;)this._code=this._code<<8|this._stream.readByte()};LZMA.RangeDecoder.prototype.decodeDirectBits=function(a){for(var b=0,c;a--;)this._range>>>=1,c=this._code-this._range>>>31,this._code-=this._range&c-1,b=b<<1|1-c,0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return b};LZMA.RangeDecoder.prototype.decodeBit=function(a,b){var c=a[b],d=(this._range>>>11)*c;if((this._code^2147483648)<(d^2147483648))return this._range=d,a[b]+=2048-c>>>5,0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0;this._range-=d;this._code-=d;a[b]-=c>>>5;0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return 1};LZMA.initBitModels=function(a,b){for(;b--;)a[b]=1024};LZMA.BitTreeDecoder=function(a){this._models=[];this._numBitLevels=a};LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.decode=function(a){for(var b=1,c=this._numBitLevels;c--;)b=b<<1|a.decodeBit(this._models,b);return b-(1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.reverseDecode=function(a){for(var b=1,c=0,d=0,f;d<this._numBitLevels;++d)f=a.decodeBit(this._models,b),b=b<<1|f,c|=f<<d;return c};LZMA.reverseDecode2=function(a,b,c,d){for(var f=1,t=0,m=0,n;m<d;++m)n=c.decodeBit(a,b+f),f=f<<1|n,t|=n<<m;return t};LZMA.LenDecoder=function(){this._choice=[];this._lowCoder=[];this._midCoder=[];this._highCoder=new LZMA.BitTreeDecoder(8);this._numPosStates=0};LZMA.LenDecoder.prototype.create=function(a){for(;this._numPosStates<a;++this._numPosStates)this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)};LZMA.LenDecoder.prototype.init=function(){var a=this._numPosStates;for(LZMA.initBitModels(this._choice,2);a--;)this._lowCoder[a].init(),this._midCoder[a].init();this._highCoder.init()};LZMA.LenDecoder.prototype.decode=function(a,b){return 0===a.decodeBit(this._choice,0)?this._lowCoder[b].decode(a):0===a.decodeBit(this._choice,1)?8+this._midCoder[b].decode(a):16+this._highCoder.decode(a)};LZMA.Decoder2=function(){this._decoders=[]};LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)};LZMA.Decoder2.prototype.decodeNormal=function(a){var b=1;do b=b<<1|a.decodeBit(this._decoders,b);while(256>b);return b&255};LZMA.Decoder2.prototype.decodeWithMatchByte=function(a,b){var c=1,d,f;do if(d=b>>7&1,b<<=1,f=a.decodeBit(this._decoders,(1+d<<8)+c),c=c<<1|f,d!==f){for(;256>c;)c=c<<1|a.decodeBit(this._decoders,c);break}while(256>c);return c&255};LZMA.LiteralDecoder=function(){};LZMA.LiteralDecoder.prototype.create=function(a,b){var c;if(!this._coders||this._numPrevBits!==b||this._numPosBits!==a)for(this._numPosBits=a,this._posMask=(1<<a)-1,this._numPrevBits=b,this._coders=[],c=1<<this._numPrevBits+this._numPosBits;c--;)this._coders[c]=new LZMA.Decoder2};LZMA.LiteralDecoder.prototype.init=function(){for(var a=1<<this._numPrevBits+this._numPosBits;a--;)this._coders[a].init()};LZMA.LiteralDecoder.prototype.getDecoder=function(a,b){return this._coders[((a&this._posMask)<<this._numPrevBits)+((b&255)>>>8-this._numPrevBits)]};LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow;this._rangeDecoder=new LZMA.RangeDecoder;this._isMatchDecoders=[];this._isRepDecoders=[];this._isRepG0Decoders=[];this._isRepG1Decoders=[];this._isRepG2Decoders=[];this._isRep0LongDecoders=[];this._posSlotDecoder=[];this._posDecoders=[];this._posAlignDecoder=new LZMA.BitTreeDecoder(4);this._lenDecoder=new LZMA.LenDecoder;this._repLenDecoder=new LZMA.LenDecoder;this._literalDecoder=new LZMA.LiteralDecoder;this._dictionarySizeCheck=this._dictionarySize=-1;this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)};LZMA.Decoder.prototype.setDictionarySize=function(a){if(0>a)return!1;this._dictionarySize!==a&&(this._dictionarySize=a,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096)));return!0};LZMA.Decoder.prototype.setLcLpPb=function(a,b,c){var d=1<<c;if(8<a||4<b||4<c)return!1;this._literalDecoder.create(b,a);this._lenDecoder.create(d);this._repLenDecoder.create(d);this._posStateMask=d-1;return!0};LZMA.Decoder.prototype.init=function(){var a=4;this._outWindow.init(!1);LZMA.initBitModels(this._isMatchDecoders,192);LZMA.initBitModels(this._isRep0LongDecoders,192);LZMA.initBitModels(this._isRepDecoders,12);LZMA.initBitModels(this._isRepG0Decoders,12);LZMA.initBitModels(this._isRepG1Decoders,12);LZMA.initBitModels(this._isRepG2Decoders,12);LZMA.initBitModels(this._posDecoders,114);for(this._literalDecoder.init();a--;)this._posSlotDecoder[a].init();this._lenDecoder.init();this._repLenDecoder.init();this._posAlignDecoder.init();this._rangeDecoder.init()};LZMA.Decoder.prototype.decode=function(a,b,c){var d=0,f=0,t=0,m=0,n=0,k=0,r=0;this._rangeDecoder.setStream(a);this._outWindow.setStream(b);for(this.init();0>c||k<c;)if(a=k&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(d<<4)+a))r=this._literalDecoder.getDecoder(k++,r),r=7<=d?r.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(f)):r.decodeNormal(this._rangeDecoder),this._outWindow.putByte(r),d=4>d?0:d-(10>d?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,d))r=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,d)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(d<<4)+a)&&(d=7>d?9:11,r=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,d)?b=t:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,d)?b=m:(b=n,n=m),m=t),t=f,f=b),0===r&&(r=2+this._repLenDecoder.decode(this._rangeDecoder,a),d=7>d?8:11);else if(n=m,m=t,t=f,r=2+this._lenDecoder.decode(this._rangeDecoder,a),d=7>d?7:10,a=this._posSlotDecoder[5>=r?r-2:3].decode(this._rangeDecoder),4<=a)if(b=(a>>1)-1,f=(2|a&1)<<b,14>a)f+=LZMA.reverseDecode2(this._posDecoders,f-a-1,this._rangeDecoder,b);else{if(f+=this._rangeDecoder.decodeDirectBits(b-4)<<4,f+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),0>f){if(-1===f)break;return!1}}else f=a;if(f>=k||f>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(f,r);k+=r;r=this._outWindow.getByte(0)}this._outWindow.flush();this._outWindow.releaseStream();this._rangeDecoder.releaseStream();return!0};LZMA.Decoder.prototype.setDecoderProperties=function(a){var b,c;if(5>a.size)return!1;b=a.readByte();c=b%9;b=~~(b/9);if(!this.setLcLpPb(c,b%5,~~(b/5)))return!1;b=a.readByte();b|=a.readByte()<<8;b|=a.readByte()<<16;b+=16777216*a.readByte();return this.setDictionarySize(b)};LZMA.decompress=function(a,b,c,d){var f=new LZMA.Decoder;if(!f.setDecoderProperties(a))throw"Incorrect stream properties";if(!f.decode(b,c,d))throw"Error in data stream";return!0};LZMA.decompressFile=function(a,b){var c=new LZMA.Decoder,d;if(!c.setDecoderProperties(a))throw"Incorrect stream properties";d=a.readByte();d|=a.readByte()<<8;d|=a.readByte()<<16;d+=16777216*a.readByte();a.readByte();a.readByte();a.readByte();a.readByte();if(!c.decode(a,b,d))throw"Error in data stream";return!0};EMPLZMAUncompress=function(a){a=new Uint8Array(a);var b={data:[],position:0,writeByte:function(a){this.data[this.position++]=a}};LZMA.decompressFile({data:a,position:0,readByte:function(){return this.data[this.position++]}},b);return(new Uint8Array(b.data)).buffer};THREE.JsonEmpLoader=function(a){"boolean"===typeof a&&(console.warn("THREE.JsonEmpLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.withCredentials=!1};THREE.JsonEmpLoader.prototype={constructor:THREE.JsonEmpLoader,get statusDomElement(){void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div"));console.warn("THREE.JsonEmpLoader: .statusDomElement has been removed.");return this._statusDomElement},load:function(a,b,c,d,f,t){var m=this,n=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(a),k=new THREE.XHRLoader(this.manager);k.setWithCredentials(this.withCredentials);k.load(a,function(a){var h=JSON.parse(a);a=n+"index.lz.js";var f=new THREE.XHRLoader(this.manager);f.setWithCredentials(this.withCredentials);f.setPath(this.path);f.setResponseType("arraybuffer");f.load(a,function(a){var f=0;"undefined"!==typeof h.guid&&(f+=Object.keys(h.guid).length);"undefined"!==typeof h.guidCam&&(f+=Object.keys(h.guidCam).length);var e=1;if("undefined"!==typeof h.guid)for(key in h.guid){if(d&&"function"==typeof d[2])d[2](e++,f);var l=h.guid[key],p=new Uint8Array(a,l.l0,l.l1);m.convertBufferToJson(l,p,n);var p=l.metadata,l=m.parse(l,n),k=new THREE.Matrix4;p.notOrth||k.set(p.mat_wts[0],p.mat_wts[1],p.mat_wts[2],p.mat_wts[3],p.mat_wts[4],p.mat_wts[5],p.mat_wts[6],p.mat_wts[7],p.mat_wts[8],p.mat_wts[9],p.mat_wts[10],p.mat_wts[11],p.mat_wts[12],p.mat_wts[13],p.mat_wts[14],p.mat_wts[15]);l=b(l.geometry,l.materials,k);l.name=p.meshName;l.visible=p.visible;l.uuid=key}if("undefined"!==typeof h.guidCam)for(key in h.guidCam){if(d&&"function"==typeof d[2])d[2](e++,f);l=h.guidCam[key];if(void 0===l.metadata||0!=l.metadata.isAniCamera)p=new Uint8Array(a,l.l0,l.l1),m.convertBufferToJson(l,p);p=l.metadata;l=m.parseCamera(l,n);l=c(l);l.name=p.name}"function"==typeof t&&t()},d&&"function"==typeof d[1]?d[1]:void 0)},d&&"function"==typeof d[0]?d[0]:void 0,f)},setTexturePath:function(a){this.texturePath=a},convertBufferToJson:function(a,b){var c=EMPLZMAUncompress(b);a.vertices=this._loadBinFileWithBuffer(a.vertices,c,"float");a.normals=this._loadBinFileWithBuffer(a.normals,c,"float");void 0!==a.uvs&&void 0!==a.uvs[0]&&(a.uvs[0]=this._loadBinFileWithBuffer(a.uvs[0],c,"float"));void 0!==a.uvs&&void 0!==a.uvs[1]&&(a.uvs[1]=this._loadBinFileWithBuffer(a.uvs[1],c,"float"));a.faces=this._loadBinFileWithBuffer(a.faces,c,"int32");if("undefined"!==typeof a.animations&&"undefined"!=typeof a.animations.tracks)for(keyIdx in a.animations.tracks){var d=a.animations.tracks[keyIdx];"vector3"===d.type?d.keys=this._loadBinFileWithBuffer(d.keys,c,"timeVector3"):"quaternion"===d.type?d.keys=this._loadBinFileWithBuffer(d.keys,c,"timeQuaternion"):"float"===d.type&&(d.keys=this._loadBinFileWithBuffer(d.keys,c,"timefloat"))}},_loadBinFileWithBuffer:function(a,b,c){if(void 0!==a&&void 0!==b&&void 0!==a.offset&&void 0!==a.length&&0<a.length){var d=[];if("float"==c)return a=new Float32Array(b,a.offset,a.length/4);if("int32"===c)return a=new Int32Array(b,a.offset,a.length/4);if("timeVector3"===c){b=new Float32Array(b,a.offset,a.length/4);for(c=0;c<a.length/4;){var f={time:b[c],value:[b[c+1],b[c+2],b[c+3]]};c+=4;d.push(f)}return d}if("timeQuaternion"===c){b=new Float32Array(b,a.offset,a.length/4);for(c=0;c<a.length/4;)f={time:b[c],value:[b[c+1],b[c+2],b[c+3],b[c+4]]},c+=5,d.push(f);return d}if("timefloat"===c){b=new Float32Array(b,a.offset,a.length/4);for(c=0;c<a.length/4;)f={time:b[c],value:b[c+1]},c+=2,d.push(f);return d}}},parseCamera:function(a){var b=[],c=[];void 0!==a.animation&&c.push(a.animation);void 0!==a.animations&&(a.animations.length?c=c.concat(a.animations):c.push(a.animations));if(c)for(a=0;a<c.length;a++){var d=THREE.AnimationClip.parse(c[a]);d&&b.push(d)}return b},parse:function(a,b){var c=new THREE.Geometry,d=void 0!==a.scale?1/a.scale:1;(function(b){var d,m,n,k,r,h,p,g,v,e,l,A,x,q=a.faces;h=a.vertices;var w=a.normals,I=a.colors,C=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&C++;for(d=0;d<C;d++)c.faceVertexUvs[d]=[]}k=0;for(r=h.length;k<r;)d=new THREE.Vector3,d.x=h[k++]*b,d.y=h[k++]*b,d.z=h[k++]*b,c.vertices.push(d);k=0;for(r=q.length;k<r;)if(b=q[k++],v=b&1,n=b&2,d=b&8,p=b&16,e=b&32,h=b&64,b&=128,v){v=new THREE.Face3;v.a=q[k];v.b=q[k+1];v.c=q[k+3];l=new THREE.Face3;l.a=q[k+1];l.b=q[k+2];l.c=q[k+3];k+=4;n&&(n=q[k++],v.materialIndex=n,l.materialIndex=n);n=c.faces.length;if(d)for(d=0;d<C;d++)for(A=a.uvs[d],c.faceVertexUvs[d][n]=[],c.faceVertexUvs[d][n+1]=[],m=0;4>m;m++)g=q[k++],x=A[2*g],g=A[2*g+1],x=new THREE.Vector2(x,g),2!==m&&c.faceVertexUvs[d][n].push(x),0!==m&&c.faceVertexUvs[d][n+1].push(x);p&&(p=3*q[k++],v.normal.set(w[p++],w[p++],w[p]),l.normal.copy(v.normal));if(e)for(d=0;4>d;d++)p=3*q[k++],e=new THREE.Vector3(w[p++],w[p++],w[p]),2!==d&&v.vertexNormals.push(e),0!==d&&l.vertexNormals.push(e);h&&(h=q[k++],h=I[h],v.color.setHex(h),l.color.setHex(h));if(b)for(d=0;4>d;d++)h=q[k++],h=I[h],2!==d&&v.vertexColors.push(new THREE.Color(h)),0!==d&&l.vertexColors.push(new THREE.Color(h));c.faces.push(v);c.faces.push(l)}else{v=new THREE.Face3;v.a=q[k++];v.b=q[k++];v.c=q[k++];n&&(n=q[k++],v.materialIndex=n);n=c.faces.length;if(d)for(d=0;d<C;d++)for(A=a.uvs[d],c.faceVertexUvs[d][n]=[],m=0;3>m;m++)g=q[k++],x=A[2*g],g=A[2*g+1],x=new THREE.Vector2(x,g),c.faceVertexUvs[d][n].push(x);p&&(p=3*q[k++],v.normal.set(w[p++],w[p++],w[p]));if(e)for(d=0;3>d;d++)p=3*q[k++],e=new THREE.Vector3(w[p++],w[p++],w[p]),v.vertexNormals.push(e);h&&(h=q[k++],v.color.setHex(I[h]));if(b)for(d=0;3>d;d++)h=q[k++],v.vertexColors.push(new THREE.Color(I[h]));c.faces.push(v)}})(d);(function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,m=a.skinWeights.length;d<m;d+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[d],1<b?a.skinWeights[d+1]:0,2<b?a.skinWeights[d+2]:0,3<b?a.skinWeights[d+3]:0));if(a.skinIndices)for(d=0,m=a.skinIndices.length;d<m;d+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[d],1<b?a.skinIndices[d+1]:0,2<b?a.skinIndices[d+2]:0,3<b?a.skinIndices[d+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.")})();(function(b){if(void 0!==a.morphTargets)for(var d=0,m=a.morphTargets.length;d<m;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var n=c.morphTargets[d].vertices,k=a.morphTargets[d].vertices,r=0,h=k.length;r<h;r+=3){var p=new THREE.Vector3;p.x=k[r]*b;p.y=k[r+1]*b;p.z=k[r+2]*b;n.push(p)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JsonEmpLoader: "morphColors" no longer supported. Using them as face colors.'),b=c.faces,n=a.morphColors[0].colors,d=0,m=b.length;d<m;d++)b[d].color.fromArray(n,3*d)})(d);(function(){var b=[],d=[];void 0!==a.animation&&d.push(a.animation);void 0!==a.animations&&(a.animations.length?d=d.concat(a.animations):d.push(a.animations));if(c.bones&&0<c.bones.length)for(var m=0;m<d.length;m++){var n=THREE.AnimationClip.parseAnimation(d[m],c.bones);n&&b.push(n)}c.morphTargets&&(m=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(m));if(d)for(m=0;m<d.length;m++)(n=THREE.AnimationClip.parse(d[m]))&&b.push(n);0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};d=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:d}}};(function(){!1==="performance"in window&&(window.performance={});Date.now=Date.now||function(){return(new Date).getTime()};if(!1==="now"in window.performance){var a=window.performance.timing&&window.performance.timing.navigationStart?window.performance.timing.navigationStart:Date.now();window.performance.now=function(){return Date.now()-a}}})();var TWEEN=TWEEN||function(){var a=[];return{getAll:function(){return a},removeAll:function(){a=[]},add:function(b){a.push(b)},remove:function(b){b=a.indexOf(b);-1!==b&&a.splice(b,1)},update:function(b){if(0===a.length)return!1;var c=0;for(b=void 0!==b?b:window.performance.now();c<a.length;)a[c].update(b)?c++:a.splice(c,1);return!0}}}();TWEEN.Tween=function(a){var b={},c={},d={},f=1E3,t=0,m=!1,n=!1,k=0,r=null,h=TWEEN.Easing.Linear.None,p=TWEEN.Interpolation.Linear,g=[],v=null,e=!1,l=null,A=null,x=null,q;for(q in a)b[q]=parseFloat(a[q],10);this.to=function(a,b){void 0!==b&&(f=b);c=a;return this};this.start=function(h){TWEEN.add(this);n=!0;e=!1;r=void 0!==h?h:window.performance.now();r+=k;for(var g in c){if(c[g]instanceof Array){if(0===c[g].length)continue;c[g]=[a[g]].concat(c[g])}b[g]=a[g];!1===b[g]instanceof Array&&(b[g]*=1);d[g]=b[g]||0}return this};this.stop=function(){if(!n)return this;TWEEN.remove(this);n=!1;null!==x&&x.call(a);this.stopChainedTweens();return this};this.stopChainedTweens=function(){for(var a=0,b=g.length;a<b;a++)g[a].stop()};this.delay=function(a){k=a;return this};this.repeat=function(a){t=a;return this};this.yoyo=function(a){m=a;return this};this.easing=function(a){h=a;return this};this.interpolation=function(a){p=a;return this};this.chain=function(){g=arguments;return this};this.onStart=function(a){v=a;return this};this.onUpdate=function(a){l=a;return this};this.onComplete=function(a){A=a;return this};this.onStop=function(a){x=a;return this};this.update=function(n){var q,x,u;if(n<r)return!0;!1===e&&(null!==v&&v.call(a),e=!0);x=(n-r)/f;x=1<x?1:x;u=h(x);for(q in c){var D=b[q]||0,B=c[q];B instanceof Array?a[q]=p(B,u):("string"===typeof B&&(B=D+parseFloat(B,10)),"number"===typeof B&&(a[q]=D+(B-D)*u))}null!==l&&l.call(a,u);if(1===x)if(0<t){isFinite(t)&&t--;for(q in d)"string"===typeof c[q]&&(d[q]+=parseFloat(c[q],10)),m&&(x=d[q],d[q]=c[q],c[q]=x),b[q]=d[q];r=n+k}else{null!==A&&A.call(a);n=0;for(q=g.length;n<q;n++)g[n].start(r+f);return!1}return!0}};TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI);return-(c*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/.4))},Out:function(a){var b,c=.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI);return c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/.4)+1},InOut:function(a){var b,c=.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI);return 1>(a*=2)?-.5*c*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/.4):c*Math.pow(2,-10*--a)*Math.sin(2*(a-b)*Math.PI/.4)*.5+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*a-1)+.5}}};TWEEN.Interpolation={Linear:function(a,b){var c=a.length-1,d=c*b,f=Math.floor(d),t=TWEEN.Interpolation.Utils.Linear;return 0>b?t(a[0],a[1],d):1<b?t(a[c],a[c-1],c-d):t(a[f],a[f+1>c?c:f+1],d-f)},Bezier:function(a,b){for(var c=0,d=a.length-1,f=Math.pow,t=TWEEN.Interpolation.Utils.Bernstein,m=0;m<=d;m++)c+=f(1-b,d-m)*f(b,m)*a[m]*t(d,m);return c},CatmullRom:function(a,b){var c=a.length-1,d=c*b,f=Math.floor(d),t=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>b&&(f=Math.floor(d=c*(1+b))),t(a[(f-1+c)%c],a[f],a[(f+1)%c],a[(f+2)%c],d-f)):0>b?a[0]-(t(a[0],a[0],a[1],a[1],-d)-a[0]):1<b?a[c]-(t(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):t(a[f?f-1:0],a[f],a[c<f+1?c:f+1],a[c<f+2?c:f+2],d-f)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var c=TWEEN.Interpolation.Utils.Factorial;return c(a)/c(b)/c(a-b)},Factorial:function(){var a=[1];return function(b){var c=1;if(a[b])return a[b];for(var d=b;1<d;d--)c*=d;return a[b]=c}}(),CatmullRom:function(a,b,c,d,f){a=.5*(c-a);d=.5*(d-b);var t=f*f;return(2*b-2*c+a+d)*f*t+(-3*b+3*c-2*a-d)*t+a*f+b}}};(function(a){"function"===typeof define&&define.amd?define([],function(){return TWEEN}):"object"===typeof exports?module.exports=TWEEN:void 0!==a&&(a.TWEEN=TWEEN)})(this);var scene3D=[],scene3DFunction=[];EmpScene=function(){this.name="empscene";this.scene=this.controls=this.camera=this.container=this.renderer=null;this.valid=!1;this.stats=this.grid=null;this.sceneBoundingBox=new THREE.Box3;this.sceneBoundingBox.makeEmpty();this.clearColor=3829413;this.clearAlpha=1;this.selected=null;this.raycaster=new THREE.Raycaster;this.autoCamClip=this.actived=!1;this.sceneHelpers=null;this.showSkyboxFlag=this.showGridFlag=this.showAxisFlag=!1;this.clock=this.mixer=this.skyboxCamera=this.skyboxMesh=this.skyboxTexture=this.skyboxScene=null;this.group={};this.bindingDomUI=[];this.cameras=[]};EmpScene.prototype={constructor:EmpScene,setScene:function(a){this.scene.uuid=a.uuid;this.scene.name=a.name;for(this.scene.userData=JSON.parse(JSON.stringify(a.userData));0<a.children.length;)this.addObject(a.children[0])},select:function(a){this.selected!==a&&(this.selected=a)},selectById:function(a){a===this.camera.id?this.select(this.camera):this.select(this.scene.getObjectById(a,!0))},selectByUuid:function(a){var b=this;this.scene.traverse(function(c){c.uuid===a&&b.select(c)})},deselect:function(){this.select(null)},findObjectByName:function(a){if(!this.scene)return null;for(var b in this.scene.children){var c=this.scene.children[b];if(c.name==a)return c}return null},findObjectByUUID:function(a){if(!this.scene)return null;for(var b in this.scene.children){var c=this.scene.children[b];if(c.uuid==a)return c}return null},removeObjectByName:function(a){(a=this.findObjectByName(a))&&a.parent.remove(a)},addObject:function(a){this.findObjectByName(a.name)||this.scene.add(a)},addHelper:function(){var a=new THREE.BoxHelper;a.material.depthTest=!1;a.material.transparent=!0;a.name="EMPBOX";a.visible=!1;this.sceneHelpers.add(a);a=new THREE.GridHelper(1E3,10);a.name="EMPGROUND";a.visible=!1;this.sceneHelpers.add(a);a=new THREE.AxisHelper(500);a.name="EMPAXIS";a.visible=!1;this.sceneHelpers.add(a);this.skyboxCamera=new THREE.PerspectiveCamera(70,this.container.offsetWidth/this.container.offsetHeight,1,1E5);this.skyboxTexture=(new THREE.CubeTextureLoader).load("empcommon/emp/c_RT.jpg empcommon/emp/c_LF.jpg empcommon/emp/c_UP.jpg empcommon/emp/c_DN.jpg empcommon/emp/c_BK.jpg empcommon/emp/c_FR.jpg".split(" "));this.skyboxTexture.format=THREE.RGBFormat;this.skyboxTexture.mapping=THREE.CubeReflectionMapping;a=THREE.ShaderLib.cube;a=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:a.uniforms,depthWrite:!1,side:THREE.BackSide});a.uniforms.tCube.value=this.skyboxTexture;this.skyboxMesh=new THREE.Mesh(new THREE.BoxGeometry(1E3,1E3,1E3),a);this.skyboxScene.add(this.skyboxMesh)},showAxis:function(a){this.showAxisFlag=a;for(var b in this.sceneHelpers.children)a=this.sceneHelpers.children[b],"EMPAXIS"==a.name&&(a.visible=this.showAxisFlag)},showGround:function(a){this.showGridFlag=a;for(var b in this.sceneHelpers.children)a=this.sceneHelpers.children[b],"EMPGROUND"==a.name&&(a.visible=this.showGridFlag)},showSkybox:function(a){this.showSkyboxFlag=a;this.skyboxMesh.visible=this.showSkyboxFlag},setClearColor:function(a,b){"undefined"!==typeof a&&(this.clearColor=a);"undefined"!==typeof b&&(this.clearAlpha=b);this.renderer.setClearColor(this.clearColor,this.clearAlpha)},setControlType:function(a){void 0==a&&(a="orbit");"orbit"==a?(this.controls=new THREE.OrbitControls(this.camera,this.container),this.controls.enableDamping=!0,this.controls.dampingFactor=.1,this.controls.enableZoom=!0,this.controls.rotateSpeed=.1):"fly"==a?(this.controls=new THREE.FlyControls(this.camera,this.container),this.controls.movementSpeed=1E3,this.controls.rollSpeed=Math.PI/24,this.controls.autoForward=!1,this.controls.dragToLook=!1):"trackball"==a?this.controls=new THREE.TrackballControls(this.camera,this.container):"firstperson"==a&&(this.controls=new THREE.FirstPersonControls(this.camera,this.container),this.controls.movementSpeed=1E3,this.controls.lookSpeed=.1);isBuilderMode&&(this.controls.enabled=!1)},clearScene:function(){this.camera.position.set(500,250,500);this.camera.lookAt(new THREE.Vector3);for(var a=this.scene.children;0<a.length;)this.removeObject(a[0]);this.geometries={};this.materials={};this.textures={};this.scripts={};this.deselect()},removeHelper:function(a){},removeObject:function(a){if(void 0!==a.parent){var b=this;a.traverse(function(a){b.removeHelper(a)});a.parent.remove(a)}},getElapsedTime:function(){return this.clock?this.clock.getElapsedTime():0},initScene:function(a,b){function c(a){a.preventDefault();var b=new THREE.Vector2,c=!!a.touches,n=c?a.touches[0].pageX/EmpGlobalZoom-EmpGlobalLeft-a.currentTarget.offsetLeft:a.offsetX/EmpGlobalZoom,c=c?a.touches[0].pageY/EmpGlobalZoom-EmpGlobalTop-a.currentTarget.offsetTop:a.offsetY/EmpGlobalZoom,n=n/a.currentTarget.clientWidth,c=c/a.currentTarget.clientHeight;b.x=2*n-1;b.y=1-2*c;d.raycaster.setFromCamera(b,d.camera);b=d.raycaster.intersectObjects(d.scene.children);if(0<b.length&&(b=b[0].object)&&"Mesh"==b.type)if("mouseup"==a.type||"touchend"==a.type){if("function"==typeof scene3DFunction[b.name+"_up"])scene3DFunction[b.name+"_up"]()}else if(("mousedown"==a.type||"touchstart"==a.type)&&"function"==typeof scene3DFunction[b.name+"_down"])scene3DFunction[b.name+"_down"]()}this.valid=!1;this.container=document.getElementById(a);if(!this.container)return null;this.clock=new THREE.Clock;this.scene=new THREE.Scene;this.sceneHelpers=new THREE.Scene;this.skyboxScene=new THREE.Scene;this.addHelper();this.camera=new THREE.PerspectiveCamera(50,this.container.offsetWidth/this.container.offsetHeight,.1,1E4);this.createRender(!0);var d=this;(function(){var a=empGetElementByID(d.container.id+"_progress","div",d.container);d.container.appendChild(a);a.style.cssText="pointer-events:auto; background-color:rgba(255,255,255,0.24);position:absolute;left:0px;top:0px;width:100%;height:100%;opacity:1;transform-origin:50% 50%;-webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-o-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform:translate(0px,0px) rotate(0deg) skew(0deg,0deg) scale(1,1);  z-index:10;display:none";empGetElementByID(d.container.id+"_progress_line","div",a).style.cssText="pointer-events:auto; background-color:rgba(33,135,231,1);box-shadow: 1px 1px 1px #696969;position:absolute;left:25%;top:50%;width:50%;height:1px;opacity:1;transform-origin:50% 50%;-webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-o-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform:translate(0px,0px) rotate(0deg) skew(0deg,0deg) scale(1,1);  z-index:20;";var a=empGetElementByID(d.container.id+"_progress_textdiv","div",a),b=empGetElementByID(d.container.id+"_progress_text","p",a);a.style.cssText="pointer-events:auto;position:absolute;left:25%;top:45%;width:50%;height:50%;opacity:1;transform-origin:50% 50%;-webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-o-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform:translate(0px,0px) rotate(0deg) skew(0deg,0deg) scale(1,1);  z-index:30;";b.innerHTML="\u52a0\u8f7d\u4e2d...";b.style.cssText="user-select:none;-moz-user-select: none; -webkit-user-select: none; -ms-user-select: none;overflow:visible;margin:0px;text-align:center;font-family: \u6977\u4f53,Times,Serif; font-weight:400;font-size:20px;font-style:normal;color:rgba(0,0,0,1);text-indent:0px;letter-spacing:0px;line-height:1"})();this.container.addEventListener("mousedown",c,!1);this.container.addEventListener("mouseup",c,!1);this.container.addEventListener("touchstart",c,!1);this.container.addEventListener("touchend",c,!1)},createRender:function(a){a=new THREE.WebGLRenderer({antialias:a,alpha:!0});a.setClearColor(this.clearColor,this.clearAlpha);a.setPixelRatio(window.devicePixelRatio);a.autoClear=!1;a.autoUpdateScene=!1;a.setSize(this.container.offsetWidth,this.container.offsetHeight);this.container.appendChild(a.domElement);this.renderer=a},createStat:function(){var a=new Stats;a.domElement.style.position="absolute";a.domElement.style.top="0px";this.container.appendChild(a.domElement);this.stats=a},getMaterialByObjName:function(a){return(a=this.findObjectByName(a))&&"Mesh"==a.type?a.material:null},setMaterialByObjName:function(a,b){var c=this.findObjectByName(a);c?"Mesh"==c.type?c.material=b:console.log("obj not mesh",a):console.log("obj not found",a)},showModelByName:function(a,b){for(var c in this.scene.children){var d=this.scene.children[c];"Mesh"!=d.type||a!=d.name&&"EMPALLMODEL"!=a||(d.visible=b)}},showGroupByName:function(a,b){for(var c in this.group[a]){var d=this.group[a][c];"Mesh"==d.type&&(d.visible=b)}},getGroupBoundingBox:function(a){var b=new THREE.Box3;b.makeEmpty();for(var c in this.group[a]){var d=this.group[a][c];"Mesh"==d.type&&(d=d.geometry.boundingBox,b.expandByPoint(d.min),b.expandByPoint(d.max))}return b},loadEmpObjs:function(a,b,c,d,f,t){function m(a,b,c){textDesc=a+b;if(a=document.getElementById(h.container.id+"_progress_text"))a.innerHTML=textDesc;if(a=document.getElementById(h.container.id+"_progress_line"))a.width=(50*b).toFixed(1)+"%";1>b||3!=c||jQuery("#"+h.container.id+"_progress").hide()}function n(a){m("(3-1)\u7d22\u5f15\u6587\u4ef6\u52a0\u8f7d\u4e2d:",(a.loaded/a.total).toFixed(4),1)}function k(a){m("(3-2)\u6570\u636e\u6587\u4ef6\u52a0\u8f7d\u4e2d:",(a.loaded/a.total).toFixed(4),2)}function r(a,b){m("(3-3)\u6570\u636e\u52a0\u8f7d\u4e2d:("+a+"-"+b+") ",(a/b).toFixed(4),3)}var h=this;"undefined"==typeof t&&(console.log(" progressArray undefined"),t=[n,k,r],jQuery("#"+h.container.id+"_progress").show());var p=new THREE.JsonEmpLoader,g=[];this.group[b]=g;p.load(a,function(a,b,f){b=b[0];"undefined"!==typeof d&&d.computNormal&&(a.computeFaceNormals(),a.computeVertexNormals());mesh1=new THREE.Mesh(a,b);c||(c="");mesh1.name=c+a.name;mesh1.visible=a.visible;mesh1.applyMatrix(f);mesh1.updateMatrixWorld(!0);a.computeBoundingBox();f=new THREE.Box3;f.copy(a.boundingBox);f.applyMatrix4(mesh1.matrixWorld);h.sceneBoundingBox.expandByPoint(f.min);h.sceneBoundingBox.expandByPoint(f.max);h.sceneBoundingBox.getBoundingSphere();h.sceneBoundingBox.center();h.scene.add(mesh1);g.push(mesh1);"undefined"!==typeof d&&d.autoPlay&&(h.mixer||(h.mixer=new THREE.AnimationMixer(h.scene)),a.animations&&h.mixer.clipAction(a.animations[0],mesh1).setDuration(30*a.animations[0].duration).startAt(0).play());return mesh1},function(a){var b=new THREE.PerspectiveCamera(50,h.container.offsetWidth/h.container.offsetHeight,.1,1E4);void 0!==a&&1<=a.length&&(b.animations=a);h.cameras.push(b);return b},t,void 0,f)},resetAniModel:function(){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(var a in this.scene.children){var b=this.scene.children[a];"Mesh"==b.type&&b.geometry.animations&&this.mixer.clipAction(b.geometry.animations[0],b).stop()}},resetAniCamera:function(a){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(key in this.cameras){var b=this.cameras[key];b.name==a&&b.animations&&this.mixer.clipAction(b.animations[0],this.controls).stop()}},pauseAniCamera:function(a){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(key in this.cameras){var b=this.cameras[key];b.name==a&&b.animations&&(this.mixer.clipAction(b.animations[0],this.controls).paused=!0)}},replayAniCamera:function(a){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(key in this.cameras){var b=this.cameras[key];b.name==a&&b.animations&&(this.mixer.clipAction(b.animations[0],this.controls).paused=!1)}},pauseAniModel:function(){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(var a in this.scene.children){var b=this.scene.children[a];"Mesh"==b.type&&b.geometry.animations&&(this.mixer.clipAction(b.geometry.animations[0],b).paused=!0)}},replayAniModel:function(){this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(var a in this.scene.children){var b=this.scene.children[a];"Mesh"==b.type&&b.geometry.animations&&(this.mixer.clipAction(b.geometry.animations[0],b).paused=!1)}},playAniModel:function(a,b,c){var d=1;"undefined"!==typeof b&&(d=b);b=!1;"undefined"!=typeof c&&(b=c);this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));a=parseFloat(a);isNaN(a)&&(a=1);for(var f in this.scene.children)c=this.scene.children[f],"Mesh"==c.type&&c.geometry.animations&&(this.mixer.clipAction(c.geometry.animations[0],c).setDuration(30*c.geometry.animations[0].duration*a).startAt(null).setLoop(THREE.LoopRepeat,d).play().clampWhenFinished=b)},palyAniCamera:function(a,b,c,d){var f=1;"undefined"!==typeof c&&(f=c);b=parseFloat(b);isNaN(b)&&(b=1);c=!1;"undefined"!=typeof d&&(c=d);this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene));for(key in this.cameras)d=this.cameras[key],d.name==a&&d.animations&&(this.mixer.clipAction(d.animations[0],this.controls).setDuration(30*d.animations[0].duration*b).startAt(null).setLoop(THREE.LoopRepeat,f).play().clampWhenFinished=c)},switchCamera:function(a,b,c,d){this.controls.target=c;this.controls.object.position.copy(d);this.controls.object.up.copy(new THREE.Vector3(0,1,0))},switchToCameraAni:function(a,b,c){this.controls.object.up.copy(new THREE.Vector3(0,1,0));b&&(new TWEEN.Tween(this.controls.object.position)).to(b,c).easing(TWEEN.Easing.Exponential.InOut).start();a&&(new TWEEN.Tween(this.controls.target)).to(a,c).easing(TWEEN.Easing.Exponential.InOut).start()},addBindingDomUI:function(a,b,c){this.bindingDomUI[a]={domID:a,meshName:b,offset:c}},bindDomUI:function(a){var b=this.findObjectByName(a.meshName);if(b&&b.geometry&&(b=b.geometry.boundingBox.center(),b.x+=a.offset.x,b.y+=a.offset.y,b.z+=a.offset.z,b=b.project(this.camera),a=document.getElementById(a.domID))){var c=(1-b.y)*this.container.offsetHeight/2+this.container.offsetTop-a.offsetHeight/2;a.style.left=((b.x+1)*this.container.offsetWidth/2+this.container.offsetLeft-a.offsetWidth/2).toFixed(0)+"px";a.style.top=c.toFixed(0)+"px"}},enable:function(){this.actived=!0;this.reszieScene();this.animate()},disable:function(){this.actived=!1},animate:function(){if(0!=this.actived){var a=this.clock.getDelta();TWEEN.update();this.stats&&this.stats.update();if(this.autoCamClip){var b=new THREE.Sphere;this.sceneBoundingBox.getBoundingSphere(b);var c=new THREE.Vector3;c.subVectors(this.controls.object.position,b.center);c=c.length();this.camera.near=Math.max(.1,c-b.radius);this.camera.far=Math.max(1E3,c+b.radius+1);this.camera.updateProjectionMatrix()}this.controls&&this.controls.update(a);for(key in this.bindingDomUI)this.bindDomUI(this.bindingDomUI[key]);this.mixer&&this.mixer.update(a);this.render();requestAnimationFrame(animateGlobal)}},render:function(){this.actived&&(this.scene.updateMatrixWorld(),this.skyboxCamera.rotation.copy(this.camera.rotation),this.renderer.clear(),this.renderer.render(this.skyboxScene,this.skyboxCamera),this.renderer.render(this.scene,this.camera),this.renderer.render(this.sceneHelpers,this.camera))},reszieScene:function(){this.controls&&"function"===typeof this.controls.handleResize&&this.controls.handleResize();this.camera.aspect=this.container.offsetWidth/this.container.offsetHeight;this.camera.updateProjectionMatrix();this.skyboxCamera.aspect=this.container.offsetWidth/this.container.offsetHeight;this.skyboxCamera.updateProjectionMatrix();this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight);this.render()},setSceneSize:function(a,b){this.controls&&"function"===typeof this.controls.handleResize&&this.controls.handleResize();this.camera.aspect=a/b;this.camera.updateProjectionMatrix();this.skyboxCamera.aspect=a/b;this.skyboxCamera.updateProjectionMatrix();this.renderer.setSize(a,b)}};function QueryCamInfo(a){var b="";if(a=scene3D[a]){var b=b+("\u76f8\u673a\u4f4d\u7f6e:"+a.camera.position.x.toFixed(2)+","+a.camera.position.y.toFixed(2)+","+a.camera.position.z.toFixed(2)),b=b+("\r\n\u76ee\u6807\u4f4d\u7f6e:"+a.controls.target.x.toFixed(2)+","+a.controls.target.y.toFixed(2)+","+a.controls.target.z.toFixed(2)),b=b+("\r\n\u6700\u5c0f\u8ddd\u79bb:"+a.controls.minDistance.toFixed(2)),b=b+("\r\n\u6700\u5927\u8ddd\u79bb:"+a.controls.maxDistance.toFixed(2)),c=new THREE.Vector3;c.subVectors(a.controls.object.position,a.controls.target);b+="\r\n\u5f53\u524d\u8ddd\u79bb:"+c.length().toFixed(2)}return b}function QueryMeshInfo(a){var b="",c=a.split(".");if(2!=c.length)return b;var d=scene3D[c[0]];if(d&&(c=d.findObjectByUUID(c[1]))){var f=c.geometry,b=b+("\u9876\u70b9\u4e2a\u6570:"+f.vertices.length),b=b+("\r\n\u4e09\u89d2\u9762\u4e2a\u6570:"+f.faces.length),b=b+("\r\nUV\u901a\u9053\u6570:"+f.faceVertexUvs.length+"\u5c42"),d=new THREE.Box3;d.copy(f.boundingBox);d.applyMatrix4(c.matrixWorld);f=d.getBoundingSphere();b+="\r\n\u5305\u56f4\u5706\u4e2d\u5fc3\u70b9:"+f.center.x.toFixed(2)+","+f.center.y.toFixed(2)+","+f.center.z.toFixed(2)+", \u534a\u5f84"+f.radius.toFixed(2);b+="\r\n\u5305\u56f4\u76d2:"+d.min.x.toFixed(2)+","+d.min.y.toFixed(2)+","+d.min.z.toFixed(2)+" ~ "+d.max.x.toFixed(2)+","+d.max.y.toFixed(2)+","+d.max.z.toFixed(2);c=c.matrix.elements;b+="\r\n\u77e9\u9635:\r\n  "+c[0].toFixed(4)+","+c[1].toFixed(4)+","+c[2].toFixed(4)+","+c[3].toFixed(4)+",\r\n  "+c[4].toFixed(4)+","+c[5].toFixed(4)+","+c[6].toFixed(4)+","+c[7].toFixed(4)+",\r\n  "+c[8].toFixed(4)+","+c[9].toFixed(4)+","+c[10].toFixed(4)+","+c[11].toFixed(4)+",\r\n  "+c[12].toFixed(4)+","+c[13].toFixed(4)+","+c[14].toFixed(4)+","+c[15].toFixed(4)}console.log("QueryMeshInfo",a,b);return b}function _local_replaceColon(a){return a.replace(/:/g,"%3A")}function EMPLyuQuery(a){console.log("EMPLyuQuery",a);var b="QueryInfo:";a=a.split(":");if(3!=a.length)return"";"QueryCamInfo"==a[0]?(b+=a[0]+":",b+=_local_replaceColon(QueryCamInfo(a[1])),b+=":"+a[2]):"QueryMeshInfo"==a[0]&&(b+=a[0]+":",b+=_local_replaceColon(QueryMeshInfo(a[1])),b+=":"+a[2]);"function"==typeof MsgBuilder&&MsgBuilder(b)}function dom3dReszie(){for(var a in scene3D)scene3D[a].actived&&scene3D[a].reszieScene()}window.addEventListener("resize",dom3dReszie,!1);function animateGlobal(){for(var a in scene3D)scene3D[a].actived&&scene3D[a].animate()}function create3dScene(a,b){var c=scene3D[a];null==c?(c=new EmpScene,c.initScene(a),scene3D[a]=c,b&&("undefined"!==typeof b.size&&c.setSceneSize(b.size[0],b.size[1]),c.setClearColor(b.bgcolor,b.bgalpha),"undefined"!==typeof b.controls&&c.setControlType(b.controls),"undefined"!==typeof b.jsonfile&&c.loadEmpObjs(b.jsonfile,"","",{},b.fileLoadEndFunc,b.progressFuncs))):b&&("undefined"!==typeof b.size&&c.setSceneSize(b.size[0],b.size[1]),c.setClearColor(b.bgcolor,b.bgalpha),"undefined"!==typeof b.controls&&c.setControlType(b.controls));return c}(function(a){function b(a){a.startMove=a.startMove?a.startMove:{startX:null,startY:null,timestamp:null};var b=(new Date).getTime(),c,d;if(a.touches){d=[{lastX:a.deltaX,lastY:a.deltaY,moved:null,startX:a.screenX-a.startMove.screenX,startY:a.screenY-a.startMove.screenY}];c={vector:a.vector||null,orientation:window.orientation||null,lastX:0<d[0].lastX?1:0>d[0].lastX?-1:0,lastY:0<d[0].lastY?1:0>d[0].lastY?-1:0,startX:0<d[0].startX?1:0>d[0].startX?-1:0,startY:0<d[0].startY?1:0>d[0].startY?-1:0};d[0].moved=Math.sqrt(Math.pow(Math.abs(d[0].startX),2)+Math.pow(Math.abs(d[0].startY),2));var e=d[0].lastX,f=d[0].lastY;direction=null;0==e||-2>=f/e||2<=f/e?0<f?direction="down":0>f&&(direction="up"):0==f||-2>=e/f||2<=e/f?0<e?direction="right":0>e&&(direction="left"):.5<f/e&&2>f/e?0<f?direction="rightdown":0>f&&(direction="leftup"):-2<f/e&&-.5>f/e&&(0<f?direction="leftdown":0>f&&(direction="rightup"));c.name=direction}return{type:a.type||null,originalEvent:a.event||null,delta:d||null,direction:c||{orientation:window.orientation||null,vector:a.vector||null},duration:a.duration?a.duration:a.startMove.timestamp?b-a.timestamp:null,rotation:a.rotation||null,scale:a.scale||null,description:a.description||[a.type,":",a.touches,":",0!=d[0].lastX?0<d[0].lastX?"right":"left":"steady",":",0!=d[0].lastY?0<d[0].lastY?"down":"up":"steady"].join("")}}function c(b){a(window).triggerHandler("orientationchange",{direction:{orientation:window.orientation},description:["orientationchange:",["landscape:clockwise:","portrait:default:","landscape:counterclockwise:","portrait:upsidedown:"][window.orientation/90+1],window.orientation].join("")})}function d(c){var d,g=jQuery(window),f=g.data("ojQueryGestures"),e=a.jGestures.defaults.thresholdShake,l=f.oDeviceMotionLastDevicePosition||{accelerationIncludingGravity:{x:0,y:0,z:0},shake:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakeleftright:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakefrontback:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakeupdown:{eventCount:0,intervalsPassed:0,intervalsFreeze:0}},l={accelerationIncludingGravity:{x:c.accelerationIncludingGravity.x,y:c.accelerationIncludingGravity.y,z:c.accelerationIncludingGravity.z},shake:{eventCount:l.shake.eventCount,intervalsPassed:l.shake.intervalsPassed,intervalsFreeze:l.shake.intervalsFreeze},shakeleftright:{eventCount:l.shakeleftright.eventCount,intervalsPassed:l.shakeleftright.intervalsPassed,intervalsFreeze:l.shakeleftright.intervalsFreeze},shakefrontback:{eventCount:l.shakefrontback.eventCount,intervalsPassed:l.shakefrontback.intervalsPassed,intervalsFreeze:l.shakefrontback.intervalsFreeze},shakeupdown:{eventCount:l.shakeupdown.eventCount,intervalsPassed:l.shakeupdown.intervalsPassed,intervalsFreeze:l.shakeupdown.intervalsFreeze}},k;for(d in f){switch(d){case "shake":case "shakeleftright":case "shakefrontback":case "shakeupdown":k=[],k.push(d),++l[d].intervalsFreeze>e.freezeShakes&&l[d].intervalsFreeze<2*e.freezeShakes||(l[d].intervalsFreeze=0,l[d].intervalsPassed++,"shake"!==d&&"shakeleftright"!==d||!(l.accelerationIncludingGravity.x>e.leftright.sensitivity||l.accelerationIncludingGravity.x<-1*e.leftright.sensitivity)||(k.push("leftright"),k.push("x-axis")),"shake"!==d&&"shakefrontback"!==d||!(l.accelerationIncludingGravity.y>e.frontback.sensitivity||l.accelerationIncludingGravity.y<-1*e.frontback.sensitivity)||(k.push("frontback"),k.push("y-axis")),"shake"!==d&&"shakeupdown"!==d||!(l.accelerationIncludingGravity.z+9.81>e.updown.sensitivity||l.accelerationIncludingGravity.z+9.81<-1*e.updown.sensitivity)||(k.push("updown"),k.push("z-axis")),1<k.length&&(++l[d].eventCount==e.requiredShakes&&l[d].intervalsPassed<e.freezeShakes?(g.triggerHandler(d,b({type:d,description:k.join(":"),event:c,duration:5*l[d].intervalsPassed})),l[d].eventCount=0,l[d].intervalsPassed=0,l[d].intervalsFreeze=e.freezeShakes+1):l[d].eventCount==e.requiredShakes&&l[d].intervalsPassed>e.freezeShakes&&(l[d].eventCount=0,l[d].intervalsPassed=0)))}k={};k.oDeviceMotionLastDevicePosition=l;g.data("ojQueryGestures",a.extend(!0,f,k))}}function f(b){var c=jQuery(b.currentTarget);c.triggerHandler(a.jGestures.events.touchstart,b);a.hasGestures?(b.currentTarget.addEventListener("touchmove",t,!1),b.currentTarget.addEventListener("touchend",m,!1)):(c.bind("mousemove",t),c.bind("mouseup",m));var d=c.data("ojQueryGestures");b=b.touches?b.touches[0]:b;var f={};f.oLastSwipemove={screenX:b.screenX,screenY:b.screenY,timestamp:(new Date).getTime()};f.oStartTouch={screenX:b.screenX,screenY:b.screenY,timestamp:(new Date).getTime()};c.data("ojQueryGestures",a.extend(!0,d,f))}function t(c){var d=jQuery(c.currentTarget);c.preventDefault();var g=d.data("ojQueryGestures"),f=!!c.touches,e=f?c.changedTouches[0].screenX:c.screenX,k=f?c.changedTouches[0].screenY:c.screenY,m=g.oLastSwipemove,n=e-m.screenX,q=k-m.screenY;g.oLastSwipemove&&(f=b({type:"swipemove",touches:f?c.touches.length:"1",screenY:k,screenX:e,deltaY:q,deltaX:n,startMove:m,event:c,timestamp:m.timestamp}),d.triggerHandler(f.type,f));f={};c=c.touches?c.touches[0]:c;f.oLastSwipemove={screenX:c.screenX,screenY:c.screenY,timestamp:(new Date).getTime()};d.data("ojQueryGestures",a.extend(!0,g,f))}function m(c){var d=jQuery(c.currentTarget),g=!!c.changedTouches,f=g?c.changedTouches.length:"1",e=g?c.changedTouches[0].screenX:c.screenX,k=g?c.changedTouches[0].screenY:c.screenY;d.triggerHandler(a.jGestures.events.touchendStart,c);a.hasGestures?(c.currentTarget.removeEventListener("touchmove",t,!1),c.currentTarget.removeEventListener("touchend",m,!1)):(d.unbind("mousemove",t),d.unbind("mouseup",m));var n=d.data("ojQueryGestures"),r=Math.abs(n.oStartTouch.screenX-e)>a.jGestures.defaults.thresholdMove||Math.abs(n.oStartTouch.screenY-k)>a.jGestures.defaults.thresholdMove?!0:!1,q=Math.abs(n.oStartTouch.screenX-e)>a.jGestures.defaults.thresholdSwipe||Math.abs(n.oStartTouch.screenY-k)>a.jGestures.defaults.thresholdSwipe?!0:!1,w,I,C,u,D=["zero","one","two","three","four"];for(w in n){I=n.oStartTouch;e=g?c.changedTouches[0].screenX:c.screenX;k=g?c.changedTouches[0].screenY:c.screenY;C=e-I.screenX;u=k-I.screenY;e=b({type:"swipe",touches:f,screenY:k,screenX:e,deltaY:u,deltaX:C,startMove:I,event:c,timestamp:I.timestamp});switch(w){case "swipeone":case "swipetwo":case "swipethree":case "swipefour":case "swipeup":case "swiperightup":case "swiperight":case "swiperightdown":case "swipedown":case "swipeleftdown":case "swipeleft":case "swipeleftup":if(!1===g&&1<=f&&!1===r)break;if(!1===g||1<=f&&!0===r&&!0===q)e.type=["swipe",D[f]].join(""),e.type==w?d.triggerHandler(e.type,e):null!==e.direction.name&&(e.type="swipe"+e.direction.name,e.type==w&&d.triggerHandler(e.type,e));break;case "tapone":case "taptwo":case "tapthree":case "tapfour":!0!==r&&D[f]==w.slice(3)&&(e.description=["tap",D[f]].join(""),e.type=["tap",D[f]].join(""),e.type==w&&d.triggerHandler(e.type,e))}e={};d.data("ojQueryGestures",a.extend(!0,n,e));d.data("ojQueryGestures",a.extend(!0,n,e))}d.triggerHandler(a.jGestures.events.touchendProcessed,c);d.triggerHandler("EmpUpEnd",c)}function n(b){var c=jQuery(b.currentTarget);c.triggerHandler(a.jGestures.events.gesturestart,b);b=c.data("ojQueryGestures");var d={};d.oStartTouch={timestamp:(new Date).getTime()};c.data("ojQueryGestures",a.extend(!0,b,d))}function k(c){var d=jQuery(c.currentTarget),g,f,e=d.data("ojQueryGestures"),k;for(k in e)switch(k){case "pinch":g=c.scale;if(1>g&&g%1<1-a.jGestures.defaults.thresholdPinchclose||1<g&&g%1>a.jGestures.defaults.thresholdPinchopen)f=1>g?-1:1,g=b({type:"pinch",scale:g,touches:null,startMove:e.oStartTouch,event:c,timestamp:e.oStartTouch.timestamp,vector:f,description:["pinch:",f,":",1>g?"close":"open"].join("")}),d.triggerHandler(g.type,g);break;case "rotate":if(g=c.rotation,1>g&&-1*g>a.jGestures.defaults.thresholdRotateccw||1<g&&g>a.jGestures.defaults.thresholdRotatecw)f=1>g?-1:1,g=b({type:"rotate",rotation:g,touches:null,startMove:e.oStartTouch,event:c,timestamp:e.oStartTouch.timestamp,vector:f,description:["rotate:",f,":",1>g?"counterclockwise":"clockwise"].join("")}),d.triggerHandler(g.type,g)}}function r(c){var d=jQuery(c.currentTarget);d.triggerHandler(a.jGestures.events.gestureendStart,c);var g,f=d.data("ojQueryGestures"),e;for(e in f)switch(e){case "pinchclose":g=c.scale;1>g&&g%1<1-a.jGestures.defaults.thresholdPinchclose&&d.triggerHandler("pinchclose",b({type:"pinchclose",scale:g,vector:-1,touches:null,startMove:f.oStartTouch,event:c,timestamp:f.oStartTouch.timestamp,description:"pinch:-1:close"}));break;case "pinchopen":g=c.scale;1<g&&g%1>a.jGestures.defaults.thresholdPinchopen&&d.triggerHandler("pinchopen",b({type:"pinchopen",scale:g,vector:1,touches:null,startMove:f.oStartTouch,event:c,timestamp:f.oStartTouch.timestamp,description:"pinch:+1:open"}));break;case "rotatecw":g=c.rotation;1<g&&g>a.jGestures.defaults.thresholdRotatecw&&d.triggerHandler("rotatecw",b({type:"rotatecw",rotation:g,vector:1,touches:null,startMove:f.oStartTouch,event:c,timestamp:f.oStartTouch.timestamp,description:"rotate:+1:clockwise"}));break;case "rotateccw":g=c.rotation,1>g&&-1*g>a.jGestures.defaults.thresholdRotateccw&&d.triggerHandler("rotateccw",b({type:"rotateccw",rotation:g,vector:-1,touches:null,startMove:f.oStartTouch,event:c,timestamp:f.oStartTouch.timestamp,description:"rotate:-1:counterclockwise"}))}d.triggerHandler(a.jGestures.events.gestureendProcessed,c)}a.jGestures={};a.jGestures.defaults={};a.jGestures.defaults.thresholdShake={requiredShakes:10,freezeShakes:100,frontback:{sensitivity:10},leftright:{sensitivity:10},updown:{sensitivity:10}};a.jGestures.defaults.thresholdPinchopen=.05;a.jGestures.defaults.thresholdPinchmove=.05;a.jGestures.defaults.thresholdPinch=.05;a.jGestures.defaults.thresholdPinchclose=.05;a.jGestures.defaults.thresholdRotatecw=5;a.jGestures.defaults.thresholdRotateccw=5;a.jGestures.defaults.thresholdMove=20;a.jGestures.defaults.thresholdSwipe=100;a.jGestures.data={};a.jGestures.data.capableDevicesInUserAgentString=["iPad","iPhone","iPod","Mobile Safari"];a.jGestures.data.hasGestures=function(){var b;for(b=0;b<a.jGestures.data.capableDevicesInUserAgentString.length;b++)if(-1!==navigator.userAgent.indexOf(a.jGestures.data.capableDevicesInUserAgentString[b]))return!0;return!1}();a.hasGestures=a.jGestures.data.hasGestures;a.jGestures.events={touchstart:"jGestures.touchstart",touchendStart:"jGestures.touchend;start",touchendProcessed:"jGestures.touchend;processed",gesturestart:"jGestures.gesturestart",gestureendStart:"jGestures.gestureend;start",gestureendProcessed:"jGestures.gestureend;processed"};jQuery.each({orientationchange_orientationchange01:"orientationchange",gestureend_pinchopen01:"pinchopen",gestureend_pinchclose01:"pinchclose",gestureend_rotatecw01:"rotatecw",gestureend_rotateccw01:"rotateccw",gesturechange_pinch01:"pinch",gesturechange_rotate01:"rotate",touchstart_swipe13:"swipemove",touchstart_swipe01:"swipeone",touchstart_swipe02:"swipetwo",touchstart_swipe03:"swipethree",touchstart_swipe04:"swipefour",touchstart_swipe05:"swipeup",touchstart_swipe06:"swiperightup",touchstart_swipe07:"swiperight",touchstart_swipe08:"swiperightdown",touchstart_swipe09:"swipedown",touchstart_swipe10:"swipeleftdown",touchstart_swipe11:"swipeleft",touchstart_swipe12:"swipeleftup",touchstart_tap01:"tapone",touchstart_tap02:"taptwo",touchstart_tap03:"tapthree",touchstart_tap04:"tapfour",devicemotion_shake01:"shake",devicemotion_shake02:"shakefrontback",devicemotion_shake03:"shakeleftright",devicemotion_shake04:"shakeupdown"},function(b,p){jQuery.event.special[p]={setup:function(){var g=b.split("_"),m=g[0],g=g[1].slice(0,g[1].length-2),e=jQuery(this),l,p;if(!e.data("ojQueryGestures")||!e.data("ojQueryGestures")[m])if(l=e.data("ojQueryGestures")||{},p={},p[m]=!0,a.extend(!0,l,p),e.data("ojQueryGestures",l),a.hasGestures)switch(g){case "orientationchange":e.get(0).addEventListener("orientationchange",c,!1);break;case "shake":case "shakefrontback":case "shakeleftright":case "shakeupdown":case "tilt":e.get(0).addEventListener("devicemotion",d,!1);break;case "tap":case "swipe":case "swipeup":case "swiperightup":case "swiperight":case "swiperightdown":case "swipedown":case "swipeleftdown":case "swipeleft":e.get(0).addEventListener("touchstart",f,!1);break;case "pinchopen":case "pinchclose":case "rotatecw":case "rotateccw":e.get(0).addEventListener("gesturestart",n,!1);e.get(0).addEventListener("gestureend",r,!1);break;case "pinch":case "rotate":e.get(0).addEventListener("gesturestart",n,!1),e.get(0).addEventListener("gesturechange",k,!1)}else switch(g){case "tap":case "swipe":e.bind("mousedown",f)}return!1},add:function(a){jQuery(this).data("ojQueryGestures")[a.type]={originalType:a.type};return!1},remove:function(a){var b=jQuery(this),c=b.data("ojQueryGestures");c[a.type]=!1;b.data("ojQueryGestures",c);return!1},teardown:function(){var g=b.split("_"),p=g[0],g=g[1].slice(0,g[1].length-2),e=jQuery(this),l,A;if(!e.data("ojQueryGestures")||!e.data("ojQueryGestures")[p])if(l=e.data("ojQueryGestures")||{},A={},A[p]=!1,a.extend(!0,l,A),e.data("ojQueryGestures",l),a.hasGestures)switch(g){case "orientationchange":e.get(0).removeEventListener("orientationchange",c,!1);break;case "shake":case "shakefrontback":case "shakeleftright":case "shakeupdown":case "tilt":e.get(0).removeEventListener("devicemotion",d,!1);break;case "tap":case "swipe":case "swipeup":case "swiperightup":case "swiperight":case "swiperightdown":case "swipedown":case "swipeleftdown":case "swipeleft":case "swipeleftup":e.get(0).removeEventListener("touchstart",f,!1);e.get(0).removeEventListener("touchmove",t,!1);e.get(0).removeEventListener("touchend",m,!1);break;case "pinchopen":case "pinchclose":case "rotatecw":case "rotateccw":e.get(0).removeEventListener("gesturestart",n,!1);e.get(0).removeEventListener("gestureend",r,!1);break;case "pinch":case "rotate":e.get(0).removeEventListener("gesturestart",n,!1),e.get(0).removeEventListener("gesturechange",k,!1)}else switch(g){case "tap":case "swipe":e.unbind("mousedown",f),e.unbind("mousemove",t),e.unbind("mouseup",m)}return!1}}})})(jQuery);var Stats=function(){var a=Date.now(),b=a,c=0,d=Infinity,f=0,t=0,m=Infinity,n=0,k=0,r=0,h=document.createElement("div");h.id="stats";h.addEventListener("mousedown",function(a){a.preventDefault();q(++r%2)},!1);h.style.cssText="width:80px;opacity:0.9;cursor:pointer";var p=document.createElement("div");p.id="fps";p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";h.appendChild(p);var g=document.createElement("div");g.id="fpsText";g.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";g.innerHTML="FPS";p.appendChild(g);var v=document.createElement("div");v.id="fpsGraph";v.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(p.appendChild(v);74>v.children.length;){var e=document.createElement("span");e.style.cssText="width:1px;height:30px;float:left;background-color:#113";v.appendChild(e)}var l=document.createElement("div");l.id="ms";l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";h.appendChild(l);var A=document.createElement("div");A.id="msText";A.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";A.innerHTML="MS";l.appendChild(A);var x=document.createElement("div");x.id="msGraph";x.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(l.appendChild(x);74>x.children.length;)e=document.createElement("span"),e.style.cssText="width:1px;height:30px;float:left;background-color:#131",x.appendChild(e);var q=function(a){r=a;switch(r){case 0:p.style.display="block";l.style.display="none";break;case 1:p.style.display="none",l.style.display="block"}};return{REVISION:11,domElement:h,setMode:q,begin:function(){a=Date.now()},end:function(){var e=Date.now();c=e-a;d=Math.min(d,c);f=Math.max(f,c);A.textContent=c+" MS ("+d+"-"+f+")";var h=Math.min(30,30-c/200*30);x.appendChild(x.firstChild).style.height=h+"px";k++;e>b+1E3&&(t=Math.round(1E3*k/(e-b)),m=Math.min(m,t),n=Math.max(n,t),g.textContent=t+" FPS ("+m+"-"+n+")",h=Math.min(30,30-t/100*30),v.appendChild(v.firstChild).style.height=h+"px",b=e,k=0);return e},update:function(){a=this.end()}}};