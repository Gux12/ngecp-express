var LZMA=LZMA||{};LZMA.OutWindow=function(){this._windowSize=0};LZMA.OutWindow.prototype.create=function(a){this._buffer&&this._windowSize===a||(this._buffer=[]);this._windowSize=a;this._streamPos=this._pos=0};LZMA.OutWindow.prototype.flush=function(){var a=this._pos-this._streamPos;if(0!==a){for(;a--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0);this._streamPos=this._pos}};LZMA.OutWindow.prototype.releaseStream=function(){this.flush();this._stream=null};LZMA.OutWindow.prototype.setStream=function(a){this.releaseStream();this._stream=a};LZMA.OutWindow.prototype.init=function(a){a||(this._pos=this._streamPos=0)};LZMA.OutWindow.prototype.copyBlock=function(a,b){a=this._pos-a-1;for(0>a&&(a+=this._windowSize);b--;)a>=this._windowSize&&(a=0),this._buffer[this._pos++]=this._buffer[a++],this._pos>=this._windowSize&&this.flush()};LZMA.OutWindow.prototype.putByte=function(a){this._buffer[this._pos++]=a;this._pos>=this._windowSize&&this.flush()};LZMA.OutWindow.prototype.getByte=function(a){a=this._pos-a-1;0>a&&(a+=this._windowSize);return this._buffer[a]};LZMA.RangeDecoder=function(){};LZMA.RangeDecoder.prototype.setStream=function(a){this._stream=a};LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null};LZMA.RangeDecoder.prototype.init=function(){var a=5;this._code=0;for(this._range=-1;a--;)this._code=this._code<<8|this._stream.readByte()};LZMA.RangeDecoder.prototype.decodeDirectBits=function(a){for(var b=0,c;a--;)this._range>>>=1,c=this._code-this._range>>>31,this._code-=this._range&c-1,b=b<<1|1-c,0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return b};LZMA.RangeDecoder.prototype.decodeBit=function(a,b){var c=a[b],d=(this._range>>>11)*c;if((this._code^2147483648)<(d^2147483648))return this._range=d,a[b]+=2048-c>>>5,0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0;this._range-=d;this._code-=d;a[b]-=c>>>5;0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return 1};LZMA.initBitModels=function(a,b){for(;b--;)a[b]=1024};LZMA.BitTreeDecoder=function(a){this._models=[];this._numBitLevels=a};LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.decode=function(a){for(var b=1,c=this._numBitLevels;c--;)b=b<<1|a.decodeBit(this._models,b);return b-(1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.reverseDecode=function(a){for(var b=1,c=0,d=0,g;d<this._numBitLevels;++d)g=a.decodeBit(this._models,b),b=b<<1|g,c|=g<<d;return c};LZMA.reverseDecode2=function(a,b,c,d){for(var g=1,e=0,t=0,h;t<d;++t)h=c.decodeBit(a,b+g),g=g<<1|h,e|=h<<t;return e};LZMA.LenDecoder=function(){this._choice=[];this._lowCoder=[];this._midCoder=[];this._highCoder=new LZMA.BitTreeDecoder(8);this._numPosStates=0};LZMA.LenDecoder.prototype.create=function(a){for(;this._numPosStates<a;++this._numPosStates)this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)};LZMA.LenDecoder.prototype.init=function(){var a=this._numPosStates;for(LZMA.initBitModels(this._choice,2);a--;)this._lowCoder[a].init(),this._midCoder[a].init();this._highCoder.init()};LZMA.LenDecoder.prototype.decode=function(a,b){return 0===a.decodeBit(this._choice,0)?this._lowCoder[b].decode(a):0===a.decodeBit(this._choice,1)?8+this._midCoder[b].decode(a):16+this._highCoder.decode(a)};LZMA.Decoder2=function(){this._decoders=[]};LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)};LZMA.Decoder2.prototype.decodeNormal=function(a){var b=1;do b=b<<1|a.decodeBit(this._decoders,b);while(256>b);return b&255};LZMA.Decoder2.prototype.decodeWithMatchByte=function(a,b){var c=1,d,g;do if(d=b>>7&1,b<<=1,g=a.decodeBit(this._decoders,(1+d<<8)+c),c=c<<1|g,d!==g){for(;256>c;)c=c<<1|a.decodeBit(this._decoders,c);break}while(256>c);return c&255};LZMA.LiteralDecoder=function(){};LZMA.LiteralDecoder.prototype.create=function(a,b){if(!this._coders||this._numPrevBits!==b||this._numPosBits!==a)for(this._numPosBits=a,this._posMask=(1<<a)-1,this._numPrevBits=b,this._coders=[],a=1<<this._numPrevBits+this._numPosBits;a--;)this._coders[a]=new LZMA.Decoder2};LZMA.LiteralDecoder.prototype.init=function(){for(var a=1<<this._numPrevBits+this._numPosBits;a--;)this._coders[a].init()};LZMA.LiteralDecoder.prototype.getDecoder=function(a,b){return this._coders[((a&this._posMask)<<this._numPrevBits)+((b&255)>>>8-this._numPrevBits)]};LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow;this._rangeDecoder=new LZMA.RangeDecoder;this._isMatchDecoders=[];this._isRepDecoders=[];this._isRepG0Decoders=[];this._isRepG1Decoders=[];this._isRepG2Decoders=[];this._isRep0LongDecoders=[];this._posSlotDecoder=[];this._posDecoders=[];this._posAlignDecoder=new LZMA.BitTreeDecoder(4);this._lenDecoder=new LZMA.LenDecoder;this._repLenDecoder=new LZMA.LenDecoder;this._literalDecoder=new LZMA.LiteralDecoder;this._dictionarySizeCheck=this._dictionarySize=-1;this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)};LZMA.Decoder.prototype.setDictionarySize=function(a){if(0>a)return!1;this._dictionarySize!==a&&(this._dictionarySize=a,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096)));return!0};LZMA.Decoder.prototype.setLcLpPb=function(a,b,c){var d=1<<c;if(8<a||4<b||4<c)return!1;this._literalDecoder.create(b,a);this._lenDecoder.create(d);this._repLenDecoder.create(d);this._posStateMask=d-1;return!0};LZMA.Decoder.prototype.init=function(){var a=4;this._outWindow.init(!1);LZMA.initBitModels(this._isMatchDecoders,192);LZMA.initBitModels(this._isRep0LongDecoders,192);LZMA.initBitModels(this._isRepDecoders,12);LZMA.initBitModels(this._isRepG0Decoders,12);LZMA.initBitModels(this._isRepG1Decoders,12);LZMA.initBitModels(this._isRepG2Decoders,12);LZMA.initBitModels(this._posDecoders,114);for(this._literalDecoder.init();a--;)this._posSlotDecoder[a].init();this._lenDecoder.init();this._repLenDecoder.init();this._posAlignDecoder.init();this._rangeDecoder.init()};LZMA.Decoder.prototype.decode=function(a,b,c){var d=0,g=0,e=0,t=0,h=0,f=0,m=0;this._rangeDecoder.setStream(a);this._outWindow.setStream(b);for(this.init();0>c||f<c;)if(a=f&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(d<<4)+a))m=this._literalDecoder.getDecoder(f++,m),m=7<=d?m.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(g)):m.decodeNormal(this._rangeDecoder),this._outWindow.putByte(m),d=4>d?0:d-(10>d?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,d))m=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,d)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(d<<4)+a)&&(d=7>d?9:11,m=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,d)?b=e:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,d)?b=t:(b=h,h=t),t=e),e=g,g=b),0===m&&(m=2+this._repLenDecoder.decode(this._rangeDecoder,a),d=7>d?8:11);else if(h=t,t=e,e=g,m=2+this._lenDecoder.decode(this._rangeDecoder,a),d=7>d?7:10,a=this._posSlotDecoder[5>=m?m-2:3].decode(this._rangeDecoder),4<=a)if(b=(a>>1)-1,g=(2|a&1)<<b,14>a)g+=LZMA.reverseDecode2(this._posDecoders,g-a-1,this._rangeDecoder,b);else{if(g+=this._rangeDecoder.decodeDirectBits(b-4)<<4,g+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),0>g){if(-1===g)break;return!1}}else g=a;if(g>=f||g>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(g,m);f+=m;m=this._outWindow.getByte(0)}this._outWindow.flush();this._outWindow.releaseStream();this._rangeDecoder.releaseStream();return!0};LZMA.Decoder.prototype.setDecoderProperties=function(a){var b,c;if(5>a.size)return!1;b=a.readByte();c=b%9;b=~~(b/9);if(!this.setLcLpPb(c,b%5,~~(b/5)))return!1;b=a.readByte();b|=a.readByte()<<8;b|=a.readByte()<<16;b+=16777216*a.readByte();return this.setDictionarySize(b)};LZMA.decompress=function(a,b,c,d){var g=new LZMA.Decoder;if(!g.setDecoderProperties(a))throw"Incorrect stream properties";if(!g.decode(b,c,d))throw"Error in data stream";return!0};LZMA.decompressFile=function(a,b){var c=new LZMA.Decoder,d;if(!c.setDecoderProperties(a))throw"Incorrect stream properties";d=a.readByte();d|=a.readByte()<<8;d|=a.readByte()<<16;d+=16777216*a.readByte();a.readByte();a.readByte();a.readByte();a.readByte();if(!c.decode(a,b,d))throw"Error in data stream";return!0};EMPLZMAUncompress=function(a){a=new Uint8Array(a);var b={data:[],position:0,writeByte:function(a){this.data[this.position++]=a}};LZMA.decompressFile({data:a,position:0,readByte:function(){return this.data[this.position++]}},b);return(new Uint8Array(b.data)).buffer};THREE.JsonEmpLoader=function(a){"boolean"===typeof a&&(console.warn("THREE.JsonEmpLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.withCredentials=!1};THREE.JsonEmpLoader.prototype={constructor:THREE.JsonEmpLoader,get statusDomElement(){void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div"));console.warn("THREE.JsonEmpLoader: .statusDomElement has been removed.");return this._statusDomElement},load:function(a,b,c,d,g,e){var t=this,h=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(a),f=new THREE.XHRLoader(this.manager);f.setWithCredentials(this.withCredentials);f.load(a,function(a){var g=JSON.parse(a);a=h+"index.lz.js";var f=new THREE.XHRLoader(this.manager);f.setWithCredentials(this.withCredentials);f.setPath(this.path);f.setResponseType("arraybuffer");f.load(a,function(a){var f=0;"undefined"!==typeof g.guid&&(f+=Object.keys(g.guid).length);"undefined"!==typeof g.guidCam&&(f+=Object.keys(g.guidCam).length);var m=1;if("undefined"!==typeof g.guid)for(key in g.guid){if(d&&"function"==typeof d[2])d[2](key,m++,f);var l=g.guid[key],k=l.metadata;if("mesh"==k.type){var r=new Uint8Array(a,l.l0,l.l1);t.convertBufferToJson(l,r,h);r=t.parse(l,h);b(r,k,key)}else"PointLight"==k.type?"undefined"!==typeof c&&"function"==typeof c.PointLight&&c.PointLight(l.metadata,key):"AmbientLight"==k.type?"undefined"!==typeof c&&"function"==typeof c.AmbientLight&&c.AmbientLight(l.metadata,key):"DirectionalLight"==k.type?"undefined"!==typeof c&&"function"==typeof c.DirectionalLight&&c.DirectionalLight(l.metadata,key):"SpotLight"==k.type?"undefined"!==typeof c&&"function"==typeof c.SpotLight&&c.SpotLight(l.metadata,key):"HemisphereLight"==k.type?"undefined"!==typeof c&&"function"==typeof c.HemisphereLight&&c.HemisphereLight(l.metadata,key):"camera"==k.type&&(0!=k.isAniCamera&&(r=new Uint8Array(a,l.l0,l.l1),t.convertBufferToJson(l,r)),r=t.parseAniCameraNode(l,h),"undefined"!==typeof c&&"function"==typeof c.camera&&c.camera(r,k,key))}if("undefined"!==typeof g.guidCam)for(key in g.guidCam){if(d&&"function"==typeof d[2])d[2](key,m++,f);l=g.guidCam[key];if(void 0===l.metadata||0!=l.metadata.isAniCamera)r=new Uint8Array(a,l.l0,l.l1),t.convertBufferToJson(l,r);k=l.metadata;r=t.parseAniCameraNode(l,h);"undefined"!==typeof c&&"function"==typeof c.camera&&c.camera(r,k,key)}"function"==typeof e&&e(g.defaultCam)},d&&"function"==typeof d[1]?d[1]:void 0)},d&&"function"==typeof d[0]?d[0]:void 0,g)},setTexturePath:function(a){this.texturePath=a},convertBufferToJson:function(a,b){b=EMPLZMAUncompress(b);a.vertices=this._loadBinFileWithBuffer(a.vertices,b,"float");a.normals=this._loadBinFileWithBuffer(a.normals,b,"float");void 0!==a.uvs&&void 0!==a.uvs[0]&&(a.uvs[0]=this._loadBinFileWithBuffer(a.uvs[0],b,"float"));void 0!==a.uvs&&void 0!==a.uvs[1]&&(a.uvs[1]=this._loadBinFileWithBuffer(a.uvs[1],b,"float"));a.faces=this._loadBinFileWithBuffer(a.faces,b,"int32");if("undefined"!==typeof a.animations&&"undefined"!=typeof a.animations.tracks)for(keyIdx in a.animations.tracks){var c=a.animations.tracks[keyIdx];"vector3"===c.type?c.keys=this._loadBinFileWithBuffer(c.keys,b,"timeVector3"):"quaternion"===c.type?c.keys=this._loadBinFileWithBuffer(c.keys,b,"timeQuaternion"):"float"===c.type&&(c.keys=this._loadBinFileWithBuffer(c.keys,b,"timefloat"))}},_loadBinFileWithBuffer:function(a,b,c){if(void 0!==a&&void 0!==b&&void 0!==a.offset&&void 0!==a.length&&0<a.length){var d=[];if("float"==c)return a=new Float32Array(b,a.offset,a.length/4);if("int32"===c)return a=new Int32Array(b,a.offset,a.length/4);if("timeVector3"===c){b=new Float32Array(b,a.offset,a.length/4);for(c=0;c<a.length/4;){var g={time:b[c],value:[b[c+1],b[c+2],b[c+3]]};c+=4;d.push(g)}return d}if("timeQuaternion"===c){b=new Float32Array(b,a.offset,a.length/4);for(c=0;c<a.length/4;)g={time:b[c],value:[b[c+1],b[c+2],b[c+3],b[c+4]]},c+=5,d.push(g);return d}if("timefloat"===c){b=new Float32Array(b,a.offset,a.length/4);for(c=0;c<a.length/4;)g={time:b[c],value:b[c+1]},c+=2,d.push(g);return d}}},parseAniCameraNode:function(a){var b=[],c=[];void 0!==a.animation&&c.push(a.animation);void 0!==a.animations&&(a.animations.length?c=c.concat(a.animations):c.push(a.animations));if(c)for(a=0;a<c.length;a++){var d=THREE.AnimationClip.parse(c[a]);d&&b.push(d)}return b},parse:function(a,b){var c=new THREE.Geometry,d=void 0!==a.scale?1/a.scale:1;(function(b){var e,d,h,f,m,n,k,v,p,w,l,x,r,q=a.faces;n=a.vertices;var u=a.normals,y=a.colors,z=0;if(void 0!==a.uvs){for(e=0;e<a.uvs.length;e++)a.uvs[e].length&&z++;for(e=0;e<z;e++)c.faceVertexUvs[e]=[]}f=0;for(m=n.length;f<m;)e=new THREE.Vector3,e.x=n[f++]*b,e.y=n[f++]*b,e.z=n[f++]*b,c.vertices.push(e);f=0;for(m=q.length;f<m;)if(b=q[f++],p=b&1,h=b&2,e=b&8,k=b&16,w=b&32,n=b&64,b&=128,p){p=new THREE.Face3;p.a=q[f];p.b=q[f+1];p.c=q[f+3];l=new THREE.Face3;l.a=q[f+1];l.b=q[f+2];l.c=q[f+3];f+=4;h&&(h=q[f++],p.materialIndex=h,l.materialIndex=h);h=c.faces.length;if(e)for(e=0;e<z;e++)for(x=a.uvs[e],c.faceVertexUvs[e][h]=[],c.faceVertexUvs[e][h+1]=[],d=0;4>d;d++)v=q[f++],r=x[2*v],v=x[2*v+1],r=new THREE.Vector2(r,v),2!==d&&c.faceVertexUvs[e][h].push(r),0!==d&&c.faceVertexUvs[e][h+1].push(r);k&&(k=3*q[f++],p.normal.set(u[k++],u[k++],u[k]),l.normal.copy(p.normal));if(w)for(e=0;4>e;e++)k=3*q[f++],w=new THREE.Vector3(u[k++],u[k++],u[k]),2!==e&&p.vertexNormals.push(w),0!==e&&l.vertexNormals.push(w);n&&(n=q[f++],n=y[n],p.color.setHex(n),l.color.setHex(n));if(b)for(e=0;4>e;e++)n=q[f++],n=y[n],2!==e&&p.vertexColors.push(new THREE.Color(n)),0!==e&&l.vertexColors.push(new THREE.Color(n));c.faces.push(p);c.faces.push(l)}else{p=new THREE.Face3;p.a=q[f++];p.b=q[f++];p.c=q[f++];h&&(h=q[f++],p.materialIndex=h);h=c.faces.length;if(e)for(e=0;e<z;e++)for(x=a.uvs[e],c.faceVertexUvs[e][h]=[],d=0;3>d;d++)v=q[f++],r=x[2*v],v=x[2*v+1],r=new THREE.Vector2(r,v),c.faceVertexUvs[e][h].push(r);k&&(k=3*q[f++],p.normal.set(u[k++],u[k++],u[k]));if(w)for(e=0;3>e;e++)k=3*q[f++],w=new THREE.Vector3(u[k++],u[k++],u[k]),p.vertexNormals.push(w);n&&(n=q[f++],p.color.setHex(y[n]));if(b)for(e=0;3>e;e++)n=q[f++],p.vertexColors.push(new THREE.Color(y[n]));c.faces.push(p)}})(d);(function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var e=0,d=a.skinWeights.length;e<d;e+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[e],1<b?a.skinWeights[e+1]:0,2<b?a.skinWeights[e+2]:0,3<b?a.skinWeights[e+3]:0));if(a.skinIndices)for(e=0,d=a.skinIndices.length;e<d;e+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[e],1<b?a.skinIndices[e+1]:0,2<b?a.skinIndices[e+2]:0,3<b?a.skinIndices[e+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.")})();(function(b){if(void 0!==a.morphTargets)for(var e=0,d=a.morphTargets.length;e<d;e++){c.morphTargets[e]={};c.morphTargets[e].name=a.morphTargets[e].name;c.morphTargets[e].vertices=[];for(var h=c.morphTargets[e].vertices,f=a.morphTargets[e].vertices,m=0,n=f.length;m<n;m+=3){var k=new THREE.Vector3;k.x=f[m]*b;k.y=f[m+1]*b;k.z=f[m+2]*b;h.push(k)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JsonEmpLoader: "morphColors" no longer supported. Using them as face colors.'),b=c.faces,h=a.morphColors[0].colors,e=0,d=b.length;e<d;e++)b[e].color.fromArray(h,3*e)})(d);(function(){var b=[],e=[];void 0!==a.animation&&e.push(a.animation);void 0!==a.animations&&(a.animations.length?e=e.concat(a.animations):e.push(a.animations));if(c.bones&&0<c.bones.length)for(var d=0;d<e.length;d++){var h=THREE.AnimationClip.parseAnimation(e[d],c.bones);h&&b.push(h)}c.morphTargets&&(d=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(d));if(e)for(d=0;d<e.length;d++)(h=THREE.AnimationClip.parse(e[d]))&&b.push(h);0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};b=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:b}}};