(function(){jQuery.fn.extend({empRubber:function(q,d){return new jQuery.empRubber(this,q,d)}});jQuery.empRubber=function(q,d,g){function r(a,b){return{x:b?a.touches[0].pageX-EmpGlobalLeft-a.originalEvent.offsetLeft:a.offsetX,y:b?a.touches[0].pageY-EmpGlobalTop-a.originalEvent.offsetTop:a.offsetY}}function u(){var d="ontouchstart"in window?!0:!1,c,e,n;a.ctx.lineCap="round";a.ctx.lineJoin="round";a.ctx.lineWidth=f*EmpGlobalZoom*2;a.ctx.globalCompositeOperation="destination-out";h.bind("touchstart mousedown",function(f){function g(a){clearTimeout(p);a.preventDefault();c=r(a,d);e=c.x;n=c.y;t(k,l,e,n);k=e;l=n}clearTimeout(p);f.preventDefault();c=r(f,d);k=c.x;l=c.y;t(k,l);h.bind("touchmove mousemove",g);jQuery(document.body).one("touchend mouseup",function(){h.unbind("touchmove mousemove",g);p=setTimeout(function(){if(.01<parseFloat(b.style.opacity)){for(var c=a.ctx.getImageData(0,0,b.width,b.height),e=0,d=0;d<c.width;d+=m)for(var f=0;f<c.height;f+=m)0<c.data[4*(f*c.width+d)+3]&&e++;e/(c.width*c.height/(m*m))<v&&h.animo({animation:"fadeOut",iterate:"1",delay:0,duration:1,keep:!1,timing:"liner"},function(){b.style.opacity="0.0"})}},w)})})}function t(b,c,d,e){a.ctx.save();a.ctx.beginPath();2==arguments.length?(a.ctx.arc(b,c,f*EmpGlobalZoom,0,2*Math.PI),a.ctx.fill()):(a.ctx.lineWidth=f*EmpGlobalZoom*2,a.ctx.moveTo(b,c),a.ctx.lineTo(d,e),a.ctx.stroke());a.ctx.restore()}var e=document.getElementById(d),b=empGetElementByID(d+"_rubber","canvas",e);this.ctx=b.getContext("2d");var k,l,p,w=parseFloat(g.triggerTime)||100,v=parseFloat(g.triggerArea)||.4,f=parseInt(g.radius)||30,m=f,h=jQuery("#"+d+"_rubber");b.style.opacity="1";var a=this;this.img=new Image;window.addEventListener("load",function(){a.img.src=g.maskfile;a.img.onload=function(){b.width=e.offsetWidth;b.height=e.offsetHeight;a.ctx.drawImage(a.img,0,0,b.width,b.height);u()}},!1);window.addEventListener("resize",function(){b.width=e.offsetWidth;b.height=e.offsetHeight;a.resetRubber()},!1);this.resetRubber=function(){a.ctx.save();a.ctx.globalCompositeOperation="source-over";a.ctx.drawImage(a.img,0,0,b.width,b.height);b.style.opacity="1.0";a.ctx.lineCap="round";a.ctx.lineJoin="round";a.ctx.lineWidth=f*EmpGlobalZoom*2;a.ctx.globalCompositeOperation="destination-out"};return this}})();