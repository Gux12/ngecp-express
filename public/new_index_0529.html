<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>new index</title>
</head>
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/font-awesome.css">
<link rel="stylesheet" href="/css/buttons.min.css">
<script src="/js/vendor/jquery-1.11.2.min.js"></script>
<script src="/js/vendor/bootstrap.min.js"></script>
<script src="/js/vendor/hammer.min.js"></script>
<script src="/js/vendor/interact.js"></script>
<script src="/js/vendor/jquery.row-grid.js"></script>
<script src="js/vendor/echarts.js"></script>
<script src="/js/vendor/recorder.js"></script>
<script src="/js/vendor/resampler.js"></script>
<style>
body {
    height: 100vh;
    overflow: hidden;
    padding: 30px 10px 10px 10px;
    background: -moz-radial-gradient(#B9B9B9, #FFFFFF);
    background: -webkit-radial-gradient(#B9B9B9, #FFFFFF);
}

.dropzone {
    background-color: #DEDEDE;
    border: dashed 4px transparent;
    border-radius: 4px;
    box-shadow: rgba(255, 255, 255, 0.8) 0 0 20px 0;
    /*margin: 20px 20vw 30px;*/
    padding: 10px;
    /*width: 60vw;*/
    height: 80%;
    transition: background-color 0.3s;
}

.drop-active {
    border-color: #aaa;
}

.drop-target {
    background-color: #B9B9B9;
    border-color: transparent;
}

#drop-block-area {
    /*width: 20vw;*/
    height: 80%;
}

#option-area {
    height: 100%;
}

#speech-mic-area {
    height: 20%;
    padding-top: 20px;
    text-align: center;
}

#refresh {
    height: 20%;
    padding-top: 50px;
    text-align: center;
}

.drag-drop {
    display: inline-block;
    min-width: 40px;
    padding: 2em 0.5em;
    color: #fff;
    background-color: #29e;
    border: solid 2px #fff;
    -webkit-transform: translate(0px, 0px);
    transform: translate(0px, 0px);
    transition: background-color 0.3s;
}

.drag-drop.can-drop {
    color: #000;
    background-color: #4e4;
}

#drop-block-area img {
    position: absolute;
    cursor: pointer;
    visibility: hidden;
    width: 0px;
    height: 0px;
}

#drop-block-area .tvover {
    border: solid #876;
    opacity: 1;
    filter: alpha(opacity=100);
}

#drop-block-area .tvout {
    border: solid #fff;
    opacity: 0.7;
}

#bankImages {
    display: none;
}
</style>

<body>
    <div id="option-area" class="col-md-2">
        <a href=""><img src="/img/u2.gif" alt=""></a>
        <a href=""><img src="/img/u4.gif" alt=""></a>
        <a href=""><img src="/img/u2.gif" alt=""></a>
    </div>
    <div id="universal-dropzone" class="dropzone col-md-7">
        <div class="row" style="height: 30%;">
            <img id="object-img" src="/img/cloth/TS03K07JWHT_3col_F_1.jpg" alt="" style="height:100%;float:right;margin-right:10px">
            <div style="float: left;padding:10px 20px">
                <h2>北汽EV200</h2>
                <h1 style="color:blue">进行中</h1>
                <h1>￥230，000</h1>
                <h1>给我一辆小汽车</h1>
            </div>
        </div>
        <div class="col-md-4" style="height: 70%;">
        </div>
        <div id="container" class="col-md-8" style="height: 70%;">
        </div>
        <!--         <div id="myTabContent" class="tab-content">
            <a href="#home" data-toggle="tab">W3Cschool Home</a>
            <a href="#ios" data-toggle="tab">iOS</a>
            <div class="tab-pane fade in active" id="home">
                <p>W3Cschoool菜鸟教程是一个提供最新的web技术站点，本站免费提供了建站相关的技术文档，帮助广大web技术爱好者快速入门并建立自己的网站。菜鸟先飞早入行——学的不仅是技术，更是梦想。</p>
            </div>
            <div class="tab-pane fade" id="ios">
                <p>iOS 是一个由苹果公司开发和发布的手机操作系统。最初是于 2007 年首次发布 iPhone、iPod Touch 和 Apple TV。iOS 派生自 OS X，它们共享 Darwin 基础。OS X 操作系统是用在苹果电脑上，iOS 是苹果的移动版本。</p>
            </div>
        </div>
        <script>
        $(function() {
            $('#myTab li:eq(1) a').tab('show');
        });
        </script> -->
    </div>
    <div id="drop-block-area" class="col-md-3">
        <!--         <div id="no-drop" class="draggable drag-drop"> #no-drop </div>
        <div id="yes-drop" class="draggable drag-drop"> #yes-drop </div> -->
    </div>
    <div id="speech-mic-area" class="col-md-7">
        <!--         <button class="button button-inverse button-circle button-giant button-longshadow">
            <i class="fa fa-microphone"></i>
        </button> -->
        <a href=""><img src="/img/u8.gif" alt="" style="height:10vh"></a>
        <p id="speech" style="font-size:40px">按‘T’说话</p>
        <button id="test" style="display:none">
        </button>
    </div>
    <div id="refresh" class="col-md-3">
        <button class="button button-3d button-box button-jumbo" style="margin:auto auto auto auto;" id="ref">
            <i class="fa fa-refresh" aria-hidden="true" style="font-size: 40px"></i>
        </button>
    </div>
    <div id="bankImages">
        <img src="/img/cloth/TS03K07JWHT_3col_F_1.jpg" />
        <img src="/img/car/car1.jpg" />
        <img src="img/cloth/TS05H02KWBK_3col_F_1.png" alt="">
        <img src="/img/car/car2.jpeg" />
        <img src="img/cloth/TS10L20JIND_3col_F_1.png" alt="">
        <img src="/img/car/car3.jpg" />
        <img src="img/cloth/TS10L45LNAV_3col_F_1.png" alt="">
        <img src="/img/car/car4.jpg" />
        <img src="/img/car/car5.jpg" />
        <img src="/img/car/car6.jpg" />
    </div>
</body>
<script>
/* The dragging code for '.draggable' from the demo above
 * applies to this demo as well so it doesn't have to be repeated. */
// target elements with the "draggable" class
interact('.draggable')
    .draggable({
        // enable inertial throwing
        inertia: true,
        // keep the element within the area of it's parent
        restrict: {
            restriction: "parent",
            endOnly: true,
            elementRect: {
                top: 1,
                left: 1,
                bottom: 1,
                right: 1
            }
        },
        // enable autoScroll
        autoScroll: true,

        // call this function on every dragmove event
        onmove: dragMoveListener,
        // call this function on every dragend event
        onend: function(event) {
            $("#ref").click();
        }
    });

function dragMoveListener(event) {
    var target = event.target,
        // keep the dragged position in the data-x/data-y attributes
        x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
        y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

    // translate the element
    target.style.webkitTransform =
        target.style.transform =
        'translate(' + x + 'px, ' + y + 'px)';

    // update the posiion attributes
    target.setAttribute('data-x', x);
    target.setAttribute('data-y', y);
}

// this is used later in the resizing and gesture demos
window.dragMoveListener = dragMoveListener;
// enable draggables to be dropped into this
interact('.dropzone').dropzone({
    // only accept elements matching this CSS selector
    accept: '.draggable',
    // Require a 75% element overlap for a drop to be possible
    overlap: 0.75,

    // listen for drop related events:

    ondropactivate: function(event) {
        // add active dropzone feedback
        event.target.classList.add('drop-active');
        // $("#object-img")[0].src = draggableElement.src;
    },
    ondragenter: function(event) {
        var draggableElement = event.relatedTarget,
            dropzoneElement = event.target;

        // feedback the possibility of a drop
        dropzoneElement.classList.add('drop-target');
        draggableElement.classList.add('can-drop');
        $("#object-img")[0].src = event.relatedTarget.src;
        $("#test").click();
    },
    ondragleave: function(event) {
        // remove the drop feedback style
        event.target.classList.remove('drop-target');
        event.relatedTarget.classList.remove('can-drop');
    },
    ondrop: function(event) {
        event.relatedTarget.textContent = 'Dropped';
    },
    ondropdeactivate: function(event) {
        // remove active dropzone feedback
        event.target.classList.remove('drop-active');
        event.target.classList.remove('drop-target');
    }
});
</script>
<script type="text/javascript">
$(document).ready(function() {
    var Library = {};
    Library.ease = function() {
        this.target = 0;
        this.position = 0;
        this.move = function(target, speed) {
            this.position += (target - this.position) * speed;
        }
    }

    var tv = {
        /* ==== variables ==== */
        O: [],
        screen: {},
        grid: {
            size: 3, // 4x4 grid
            borderSize: 3, // borders size
            zoomed: false
        },
        angle: {
            x: new Library.ease(),
            y: new Library.ease()
        },
        camera: {
            x: new Library.ease(),
            y: new Library.ease(),
            zoom: new Library.ease(),
            focalLength: 750 // camera Focal Length
        },

        /* ==== init script ==== */
        init: function() {
            this.screen.obj = document.getElementById('drop-block-area');
            var img = document.getElementById('bankImages').getElementsByTagName('img');
            this.screen.obj.onselectstart = function() {
                return false;
            }
            this.screen.obj.ondrag = function() {
                    return false;
                }
                /* ==== create images grid ==== */
            var ni = 0;
            var n = (tv.grid.size / 2) - .5;
            for (var y = -n; y <= n; y++) {
                for (var x = -n; x <= n; x++) {
                    /* ==== create HTML image element ==== */
                    var o = document.createElement('img');
                    var i = img[(ni++) % img.length];
                    o.className = 'tvout draggable';
                    o.src = i.src;
                    tv.screen.obj.appendChild(o);
                    /* ==== 3D coordinates ==== */
                    o.point3D = {
                        x: x,
                        y: y,
                        z: new Library.ease()
                    };
                    /* ==== push object ==== */
                    o.point2D = {};
                    o.ratioImage = 1;
                    tv.O.push(o);
                    /* ==== on mouse over event ==== */
                    o.onmouseover = function() {
                            if (!tv.grid.zoomed) {
                                if (tv.o) {
                                    /* ==== mouse out ==== */
                                    tv.o.point3D.z.target = 0;
                                    tv.o.className = 'tvout draggable';
                                }
                                /* ==== mouse over ==== */
                                this.className = 'tvover draggable';
                                this.point3D.z.target = -.5;
                                tv.o = this;
                            }
                        }
                        /* ==== on click event ==== */
                    o.onclick = function() {
                            // if (!tv.grid.zoomed) {
                            //     /* ==== zoom in ==== */
                            //     tv.camera.x.target = this.point3D.x;
                            //     tv.camera.y.target = this.point3D.y;
                            //     tv.camera.zoom.target = tv.screen.w * 1.25;
                            //     tv.grid.zoomed = this;
                            // } else {
                            //     if (this == tv.grid.zoomed) {
                            //         /* ==== zoom out ==== */
                            //         tv.camera.x.target = 0;
                            //         tv.camera.y.target = 0;
                            //         tv.camera.zoom.target = tv.screen.w / (tv.grid.size + .1);
                            //         tv.grid.zoomed = false;
                            //     }
                            // }
                        }
                        /* ==== 3D transform function ==== */
                    o.calc = function() {
                            /* ==== ease mouseover ==== */
                            this.point3D.z.move(this.point3D.z.target, .5);
                            /* ==== assign 3D coords ==== */
                            var x = (this.point3D.x - tv.camera.x.position) * tv.camera.zoom.position;
                            var y = (this.point3D.y - tv.camera.y.position) * tv.camera.zoom.position;
                            var z = this.point3D.z.position * tv.camera.zoom.position;
                            /* ==== perform rotations ==== */
                            var xy = tv.angle.cx * y - tv.angle.sx * z;
                            var xz = tv.angle.sx * y + tv.angle.cx * z;
                            var yz = tv.angle.cy * xz - tv.angle.sy * x;
                            var yx = tv.angle.sy * xz + tv.angle.cy * x;
                            /* ==== 2D transformation ==== */
                            this.point2D.scale = tv.camera.focalLength / (tv.camera.focalLength + yz);
                            this.point2D.x = yx * this.point2D.scale * 2;
                            this.point2D.y = xy * this.point2D.scale * 2;
                            this.point2D.w = Math.round(
                                Math.max(
                                    0,
                                    this.point2D.scale * tv.camera.zoom.position * 2
                                )
                            );
                            /* ==== image size ratio ==== */
                            if (this.ratioImage > 1)
                                this.point2D.h = Math.round(this.point2D.w / this.ratioImage);
                            else {
                                this.point2D.h = this.point2D.w;
                                this.point2D.w = Math.round(this.point2D.h * this.ratioImage);
                            }
                        }
                        /* ==== rendering ==== */
                    o.draw = function() {
                        if (this.complete) {
                            /* ==== paranoid image load ==== */
                            if (!this.loaded) {
                                if (!this.img) {
                                    /* ==== create internal image ==== */
                                    this.img = new Image();
                                    this.img.src = this.src;
                                }
                                if (this.img.complete) {
                                    /* ==== get width / height ratio ==== */
                                    this.style.visibility = 'visible';
                                    this.ratioImage = this.img.width / this.img.height;
                                    this.loaded = true;
                                    this.img = false;
                                }
                            }
                            /* ==== HTML rendering ==== */
                            this.style.left = Math.round(
                                this.point2D.x * this.point2D.scale +
                                tv.screen.w - this.point2D.w * .5
                            ) + 'px';
                            this.style.top = Math.round(
                                this.point2D.y * this.point2D.scale +
                                tv.screen.h - this.point2D.h * .5
                            ) + 'px';
                            this.style.width = this.point2D.w + 'px';
                            this.style.height = this.point2D.h + 'px';
                            this.style.borderWidth = Math.round(
                                Math.max(
                                    this.point2D.w,
                                    this.point2D.h
                                ) * tv.grid.borderSize * .01
                            ) + 'px';
                            this.style.zIndex = Math.floor(this.point2D.scale * 100);
                        }
                    }
                }
            }
            /* ==== start script ==== */
            tv.resize();
            mouse.y = tv.screen.y + tv.screen.h;
            mouse.x = tv.screen.x + tv.screen.w;
            tv.run();
        },

        /* ==== resize window ==== */
        resize: function() {
            var o = tv.screen.obj;
            tv.screen.w = o.offsetWidth / 2;
            tv.screen.h = o.offsetHeight / 2;
            tv.camera.zoom.target = tv.screen.w / (tv.grid.size + .1);
            for (tv.screen.x = 0, tv.screen.y = 0; o != null; o = o.offsetParent) {
                tv.screen.x += o.offsetLeft;
                tv.screen.y += o.offsetTop;
            }
        },

        /* ==== main loop ==== */
        run: function() {
            /* ==== motion ease ==== */
            tv.angle.x.move(-(mouse.y - tv.screen.h - tv.screen.y) * .0025, .1);
            tv.angle.y.move((mouse.x - tv.screen.w - tv.screen.x) * .0025, .1);
            tv.camera.x.move(tv.camera.x.target, tv.grid.zoomed ? .25 : .025);
            tv.camera.y.move(tv.camera.y.target, tv.grid.zoomed ? .25 : .025);
            tv.camera.zoom.move(tv.camera.zoom.target, .05);
            /* ==== angles sin and cos ==== */
            tv.angle.cx = Math.cos(tv.angle.x.position);
            tv.angle.sx = Math.sin(tv.angle.x.position);
            tv.angle.cy = Math.cos(tv.angle.y.position);
            tv.angle.sy = Math.sin(tv.angle.y.position);
            /* ==== loop through all images ==== */
            for (var i = 0, o; o = tv.O[i]; i++) {
                o.calc();
                o.draw();
            }
            /* ==== loop ==== */
            setTimeout(tv.run, 5);
        }
    }

    /* ==== global mouse position ==== */
    var mouse = {
        x: 0,
        y: 0
    }
    var con = document.getElementById("drop-block-area");
    document.onmousemove = function(e) {
        if (window.event) e = window.event;
        mouse.x = e.clientX;
        mouse.y = e.clientY;
        // tv.run();
        return false;
    }
    onresize = tv.resize;
    tv.init();

    $('#ref').click(function(event) {
        /* Act on the event */
        $('#drop-block-area')[0].innerHTML = '';
        tv.init();
    });
});
</script>
<script>
$.get('/js/vendor/map/china.json', function(chinaJson) {
    echarts.registerMap('china', chinaJson);
    var dom = document.getElementById("container");
    var myChart = echarts.init(dom);
    option = null;
    var geoCoordMap = {
        '上海': [121.4648, 31.2891],
        '东莞': [113.8953, 22.901],
        '东营': [118.7073, 37.5513],
        '中山': [113.4229, 22.478],
        '临汾': [111.4783, 36.1615],
        '临沂': [118.3118, 35.2936],
        '丹东': [124.541, 40.4242],
        '丽水': [119.5642, 28.1854],
        '乌鲁木齐': [87.9236, 43.5883],
        '佛山': [112.8955, 23.1097],
        '保定': [115.0488, 39.0948],
        '兰州': [103.5901, 36.3043],
        '包头': [110.3467, 41.4899],
        '北京': [116.4551, 40.2539],
        '北海': [109.314, 21.6211],
        '南京': [118.8062, 31.9208],
        '南宁': [108.479, 23.1152],
        '南昌': [116.0046, 28.6633],
        '南通': [121.1023, 32.1625],
        '厦门': [118.1689, 24.6478],
        '台州': [121.1353, 28.6688],
        '合肥': [117.29, 32.0581],
        '呼和浩特': [111.4124, 40.4901],
        '咸阳': [108.4131, 34.8706],
        '哈尔滨': [127.9688, 45.368],
        '唐山': [118.4766, 39.6826],
        '嘉兴': [120.9155, 30.6354],
        '大同': [113.7854, 39.8035],
        '大连': [122.2229, 39.4409],
        '天津': [117.4219, 39.4189],
        '太原': [112.3352, 37.9413],
        '威海': [121.9482, 37.1393],
        '宁波': [121.5967, 29.6466],
        '宝鸡': [107.1826, 34.3433],
        '宿迁': [118.5535, 33.7775],
        '常州': [119.4543, 31.5582],
        '广州': [113.5107, 23.2196],
        '廊坊': [116.521, 39.0509],
        '延安': [109.1052, 36.4252],
        '张家口': [115.1477, 40.8527],
        '徐州': [117.5208, 34.3268],
        '德州': [116.6858, 37.2107],
        '惠州': [114.6204, 23.1647],
        '成都': [103.9526, 30.7617],
        '扬州': [119.4653, 32.8162],
        '承德': [117.5757, 41.4075],
        '拉萨': [91.1865, 30.1465],
        '无锡': [120.3442, 31.5527],
        '日照': [119.2786, 35.5023],
        '昆明': [102.9199, 25.4663],
        '杭州': [119.5313, 29.8773],
        '枣庄': [117.323, 34.8926],
        '柳州': [109.3799, 24.9774],
        '株洲': [113.5327, 27.0319],
        '武汉': [114.3896, 30.6628],
        '汕头': [117.1692, 23.3405],
        '江门': [112.6318, 22.1484],
        '沈阳': [123.1238, 42.1216],
        '沧州': [116.8286, 38.2104],
        '河源': [114.917, 23.9722],
        '泉州': [118.3228, 25.1147],
        '泰安': [117.0264, 36.0516],
        '泰州': [120.0586, 32.5525],
        '济南': [117.1582, 36.8701],
        '济宁': [116.8286, 35.3375],
        '海口': [110.3893, 19.8516],
        '淄博': [118.0371, 36.6064],
        '淮安': [118.927, 33.4039],
        '深圳': [114.5435, 22.5439],
        '清远': [112.9175, 24.3292],
        '温州': [120.498, 27.8119],
        '渭南': [109.7864, 35.0299],
        '湖州': [119.8608, 30.7782],
        '湘潭': [112.5439, 27.7075],
        '滨州': [117.8174, 37.4963],
        '潍坊': [119.0918, 36.524],
        '烟台': [120.7397, 37.5128],
        '玉溪': [101.9312, 23.8898],
        '珠海': [113.7305, 22.1155],
        '盐城': [120.2234, 33.5577],
        '盘锦': [121.9482, 41.0449],
        '石家庄': [114.4995, 38.1006],
        '福州': [119.4543, 25.9222],
        '秦皇岛': [119.2126, 40.0232],
        '绍兴': [120.564, 29.7565],
        '聊城': [115.9167, 36.4032],
        '肇庆': [112.1265, 23.5822],
        '舟山': [122.2559, 30.2234],
        '苏州': [120.6519, 31.3989],
        '莱芜': [117.6526, 36.2714],
        '菏泽': [115.6201, 35.2057],
        '营口': [122.4316, 40.4297],
        '葫芦岛': [120.1575, 40.578],
        '衡水': [115.8838, 37.7161],
        '衢州': [118.6853, 28.8666],
        '西宁': [101.4038, 36.8207],
        '西安': [109.1162, 34.2004],
        '贵阳': [106.6992, 26.7682],
        '连云港': [119.1248, 34.552],
        '邢台': [114.8071, 37.2821],
        '邯郸': [114.4775, 36.535],
        '郑州': [113.4668, 34.6234],
        '鄂尔多斯': [108.9734, 39.2487],
        '重庆': [107.7539, 30.1904],
        '金华': [120.0037, 29.1028],
        '铜川': [109.0393, 35.1947],
        '银川': [106.3586, 38.1775],
        '镇江': [119.4763, 31.9702],
        '长春': [125.8154, 44.2584],
        '长沙': [113.0823, 28.2568],
        '长治': [112.8625, 36.4746],
        '阳泉': [113.4778, 38.0951],
        '青岛': [120.4651, 36.3373],
        '韶关': [113.7964, 24.7028]
    };

    var BJData = [
        [{
            name: '成都'
        }, {
            name: '长沙',
            value: 95
        }],
        [{
            name: '长沙'
        }, {
            name: '上海',
            value: 90
        }],
        [{
            name: '上海'
        }, {
            name: '青岛',
            value: 80
        }],
        [{
            name: '青岛'
        }, {
            name: '北京',
            value: 70
        }],
    ];

    function setoption(BJData) {
        var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';

        var convertData = function(data) {
            var res = [];
            for (var i = 0; i < data.length; i++) {
                var dataItem = data[i];
                var fromCoord = geoCoordMap[dataItem[0].name];
                var toCoord = geoCoordMap[dataItem[1].name];
                if (fromCoord && toCoord) {
                    res.push([{
                        name: dataItem[0].name,
                        coord: fromCoord
                    }, {
                        name: dataItem[1].name,
                        coord: toCoord
                    }]);
                }
            }
            return res;
        };

        var color = ['#a6c84c', '#ffa022', '#46bee9'];
        var series = [];
        [
            ['北京', BJData]
        ].forEach(function(item, i) {
            series.push({
                name: item[0] + ' Top10',
                type: 'lines',
                zlevel: 1,
                effect: {
                    show: true,
                    period: 6,
                    trailLength: 0.7,
                    color: '#fff',
                    symbolSize: 3
                },
                lineStyle: {
                    normal: {
                        color: color[i],
                        width: 0,
                        curveness: 0.2
                    }
                },
                data: convertData(item[1])
            }, {
                name: item[0] + ' Top10',
                type: 'lines',
                zlevel: 2,
                effect: {
                    show: true,
                    period: 6,
                    trailLength: 0,
                    symbol: planePath,
                    symbolSize: 15
                },
                lineStyle: {
                    normal: {
                        color: color[i],
                        width: 1,
                        opacity: 0.4,
                        curveness: 0.2
                    }
                },
                data: convertData(item[1])
            }, {
                name: item[0] + ' Top10',
                type: 'effectScatter',
                coordinateSystem: 'geo',
                zlevel: 2,
                rippleEffect: {
                    brushType: 'stroke'
                },
                label: {
                    normal: {
                        show: true,
                        position: 'right',
                        formatter: '{b}'
                    }
                },
                symbolSize: function(val) {
                    return val[2] / 8;
                },
                itemStyle: {
                    normal: {
                        color: color[i]
                    }
                },
                data: item[1].map(function(dataItem) {
                    return {
                        name: dataItem[1].name,
                        value: geoCoordMap[dataItem[1].name].concat([dataItem[1].value])
                    };
                })
            });
        });

        option = {
            backgroundColor: 'transparent',
            title: {
                left: 'center',
                textStyle: {
                    color: '#fff'
                }
            },
            tooltip: {
                trigger: 'item'
            },
            legend: {
                orient: 'vertical',
                top: 'bottom',
                left: 'right',
                textStyle: {
                    color: '#fff'
                },
                selectedMode: 'single'
            },
            geo: {
                map: 'china',
                label: {
                    emphasis: {
                        show: false
                    }
                },
                roam: true,
                itemStyle: {
                    normal: {
                        areaColor: '#323c48',
                        borderColor: '#404a59'
                    },
                    emphasis: {
                        areaColor: '#2a333d'
                    }
                }
            },
            series: series
        };
        return option;
    }
    option = setoption(BJData);
    if (option && typeof option === "object") {
        var startTime = +new Date();
        myChart.setOption(option, true);
        var endTime = +new Date();
        var updateTime = endTime - startTime;
        console.log("Time used:", updateTime);
    }
    $('#test').click(function(event) {
        /* Act on the event */
        function getPropertyCount(o) {
            var n, count = 0;
            for (n in o) {
                if (o.hasOwnProperty(n)) {
                    count++;
                }
            }
            return count;
        }

        function getPropertyName(ind, o) {
            var n, count = 0;
            for (n in o) {
                if (ind == count) {
                    return n;
                }
                if (o.hasOwnProperty(n)) {
                    count++;
                }
            }
            return count;
        }
        var l = getPropertyCount(geoCoordMap);
        var pre = Math.floor(Math.random() * l);
        for (var i = 0; i < 4; i++) {
            var now = Math.floor(Math.random() * l);
            BJData[i][0].name = getPropertyName(pre, geoCoordMap);
            BJData[i][1].name = getPropertyName(now, geoCoordMap);
            pre = now;
        }
        option = setoption(BJData);
        myChart.setOption(option, true);
    });
});
</script>
<script>
var audio_context;
var recorder;

function startUserMedia(stream) {
    var input = audio_context.createMediaStreamSource(stream);
    recorder = new Recorder(input, {
        numChannels: 1
    });
}

function startRecording() {
    recorder && recorder.record();
}

function stopRecording() {
    recorder && recorder.stop();
    // create WAV download link using audio data blob 
    createDownloadLink();
    recorder.clear();
}

function createDownloadLink() {
    recorder && recorder.getBuffer(function(buffers) {
        var resampler = new Resampler(44100, 16000, 1, buffers[0]);
        var resampled = resampler.resampler(buffers[0].length);
        // var buffer = new ArrayBuffer(resampler.outputBuffer.length * 2);
        // var view = new DataView(buffer);
        // var offset = 0;
        // var input = resampler.outputBuffer;
        // for (var i = 0; i < input.length; i++, offset += 2) {
        //     var s = Math.max(-1, Math.min(1, input[i]));
        //     view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
        // }

        function writeString(view, offset, string) {
            for (var i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        function floatTo16BitPCM(output, offset, input) {
            for (var i = 0; i < input.length; i++, offset += 2) {
                var s = Math.max(-1, Math.min(1, input[i]));
                output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
            }
        }
        var buffer = new ArrayBuffer(44 + resampler.outputBuffer.length * 2);
        var view = new DataView(buffer);
        numChannels = 1;
        sampleRate = 16000;
        /* RIFF identifier */
        writeString(view, 0, 'RIFF');
        /* RIFF chunk length */
        view.setUint32(4, 36 + resampler.outputBuffer.length * 2, true);
        /* RIFF type */
        writeString(view, 8, 'WAVE');
        /* format chunk identifier */
        writeString(view, 12, 'fmt ');
        /* format chunk length */
        view.setUint32(16, 16, true);
        /* sample format (raw) */
        view.setUint16(20, 1, true);
        /* channel count */
        view.setUint16(22, numChannels, true);
        // sample rate 
        view.setUint32(24, sampleRate, true);
        /* byte rate (sample rate * block align) */
        view.setUint32(28, sampleRate * 4, true);
        /* block align (channel count * bytes per sample) */
        view.setUint16(32, numChannels * 2, true);
        /* bits per sample */
        view.setUint16(34, 16, true);
        /* data chunk identifier */
        writeString(view, 36, 'data');
        /* data chunk length */
        view.setUint32(40, resampler.outputBuffer.length * 2, true);


        floatTo16BitPCM(view, 44, resampler.outputBuffer);
        var audioBlob = new Blob([view], {
            type: 'audio/wav'
        });
        // Recorder.forceDownload(audioBlob);
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = state_Change;
        xhr.open('POST', '/speech', true);
        xhr.send(audioBlob);
        var isSend = false;

        function state_Change() {
            if (xhr.readyState == 4) { // 4 = "loaded"
                if (xhr.status == 200) { // 200 = OK
                    // ...our code here...
                    var url = URL.createObjectURL(audioBlob);
                    var li = document.createElement('li');
                    var au = document.createElement('audio');
                    var hf = document.createElement('a');

                    au.controls = true;
                    au.src = url;
                    hf.href = url;
                    hf.download = new Date().toISOString() + '.wav';
                    hf.innerHTML = hf.download;
                    // li.appendChild(au);
                    // li.appendChild(hf);
                    // document.body.appendChild(li);
                    var ret = eval('(' + xhr.responseText + ')');
                    if (ret.err_no == 0) {
                    	$("#speech")[0].innerText = ret.result[0];
                    } else if (ret.err_no == 3301) {
                    	$("#speech")[0].innerText = '识别不出来，请重新说';
                    } else {
                    	$("#speech")[0].innerText = '参数或者严重错误';
                    }
                } else {
                    // alert("Problem retrieving XML data");
                }
            } else if (xhr.readyState == 1) {
                isSend = false;
                setTimeout(function() {
                    if (!isSend) {
                        // xhr.abort();
                        xhr.open('POST', '/speech', true);
                        xhr.send(audioBlob);
                        console.log('1');
                    }
                }, 1000);
            } else if (xhr.readyState == 2) {
                isSend = true;
            }
        }
    });
}

window.onload = function init() {
    try {
        // webkit shim
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;
        window.URL = window.URL || window.webkitURL;

        audio_context = new AudioContext;
    } catch (e) {
        alert('No web audio support in this browser!');
    }

    navigator.getUserMedia({
        audio: true
    }, startUserMedia, function(e) {
        alert('No live audio input: ' + e);
    });
};

// $('#start').click(function(event) {
//     /* Act on the event */
//     startRecording();
//     setTimeout(stopRecording, 3000);
// });

document.addEventListener("keydown", function(event) {
    if (event.keyCode === 84) {
        event.preventDefault();
        startRecording();
    }
}, false);

document.addEventListener("keyup", function(event) {

    if (event.keyCode === 84) {
        stopRecording();
        event.preventDefault();
    }
}, false);
</script>

</html>
