<html>

<head>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/font-awesome.css">
    <link rel="stylesheet" href="/css/buttons.min.css">
    <link rel="stylesheet/less" type="text/css" href="/css/supplycell.less" />
    <link rel="stylesheet" href="/css/jquery.sidr.dark.min.css">
    <link rel="stylesheet" href="/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.css" />
    <script src="/jquery/dist/jquery.min.js"></script>
    <script src="/js/myTrick.js"></script>
    <script src="/js/vendor/bootstrap.min.js"></script>
    <script src="/hammerjs/hammer.min.js"></script>
    <script src="/interact/dist/interact.min.js"></script>
    <script src="/js/vendor/jquery.row-grid.js"></script>
    <script src="/js/vendor/echarts2.min.js"></script>
    <script src="/js/vendor/dataTool.min.js"></script>
    <script src="/js/vendor/jquery.sidr.min.js"></script>
    <script src="/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="/js/vendor/map/china.js"></script>
    <script src="/js/vendor/map/world.js"></script>
    <style>
    div {
        font-family: Microsoft YaHei;
    }
    
    .button5 {
        background-color: rgba(0, 0, 0, 0);
        color: #e9c165;
        border: 2px solid #555555;
        width: 120px;
        margin-top: 20px;
    }
    
    .button5:hover {
        background-color: #555555;
        color: #e9c165;
    }
    </style>
</head>
<style>
body {
    background-color: #161627;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
}
</style>
<script type="text/javascript">
$(document).ready(function() {
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('test-main'));
    var isDataEmpty = true;
    var smartChainData = [];
    var smartChainDataSort = {};
    var smartChainColor = [];
    var view = [{
        site: '西安',
        href: {
            '炼钢厂': '',
            '电动机厂': '3Dmodels/motorF/',
            '橡胶厂': '',
            '轮胎厂': '',
            '汽车制造厂': '3Dmodels/car1/',
        }
    }, {
        site: '成都',
        href: {
            '炼钢厂': '',
            '电动机厂': '3Dmodels/motorF/',
            '橡胶厂': '',
            '轮胎厂': '',
            '汽车制造厂': '3Dmodels/car1/',
        }
    }, ];

    function draw(method) {
        $('#ok').addClass('disabled');
        var propOfGoods = ['速度', '质量', '价格', '销量', '信用'];
        var smartChainNodes = ['炼钢厂', '电动机厂', '橡胶厂', '轮胎厂', '汽车制造厂'];
        var smartChainLines = [
            [{
                name: '炼钢厂'
            }, {
                name: '电动机厂',
                value: 95
            }],
            [{
                name: '橡胶厂'
            }, {
                name: '轮胎厂',
                value: 90
            }],
            [{
                name: '炼钢厂'
            }, {
                name: '汽车制造厂',
                value: 80
            }],
            [{
                name: '电动机厂'
            }, {
                name: '汽车制造厂',
                value: 70
            }],
            [{
                name: '轮胎厂'
            }, {
                name: '汽车制造厂',
                value: 70
            }],
            [{
                name: '橡胶厂'
            }, {
                name: '汽车制造厂',
                value: 70
            }]
        ];
        var geoCoordMap = {
            '海门': [121.15, 31.89],
            '鄂尔多斯': [109.781327, 39.608266],
            '招远': [120.38, 37.35],
            '舟山': [122.207216, 29.985295],
            '齐齐哈尔': [123.97, 47.33],
            '盐城': [120.13, 33.38],
            '赤峰': [118.87, 42.28],
            '青岛': [120.33, 36.07],
            '乳山': [121.52, 36.89],
            '金昌': [102.188043, 38.520089],
            '泉州': [118.58, 24.93],
            '莱西': [120.53, 36.86],
            '日照': [119.46, 35.42],
            '胶南': [119.97, 35.88],
            '南通': [121.05, 32.08],
            '拉萨': [91.11, 29.97],
            '云浮': [112.02, 22.93],
            '梅州': [116.1, 24.55],
            '文登': [122.05, 37.2],
            '上海': [121.48, 31.22],
            '攀枝花': [101.718637, 26.582347],
            '威海': [122.1, 37.5],
            '承德': [117.93, 40.97],
            '厦门': [118.1, 24.46],
            '汕尾': [115.375279, 22.786211],
            '潮州': [116.63, 23.68],
            '丹东': [124.37, 40.13],
            '太仓': [121.1, 31.45],
            '曲靖': [103.79, 25.51],
            '烟台': [121.39, 37.52],
            '福州': [119.3, 26.08],
            '瓦房店': [121.979603, 39.627114],
            '即墨': [120.45, 36.38],
            '抚顺': [123.97, 41.97],
            '玉溪': [102.52, 24.35],
            '张家口': [114.87, 40.82],
            '阳泉': [113.57, 37.85],
            '莱州': [119.942327, 37.177017],
            '湖州': [120.1, 30.86],
            '汕头': [116.69, 23.39],
            '昆山': [120.95, 31.39],
            '宁波': [121.56, 29.86],
            '湛江': [110.359377, 21.270708],
            '揭阳': [116.35, 23.55],
            '荣成': [122.41, 37.16],
            '连云港': [119.16, 34.59],
            '葫芦岛': [120.836932, 40.711052],
            '常熟': [120.74, 31.64],
            '东莞': [113.75, 23.04],
            '河源': [114.68, 23.73],
            '淮安': [119.15, 33.5],
            '泰州': [119.9, 32.49],
            '南宁': [108.33, 22.84],
            '营口': [122.18, 40.65],
            '惠州': [114.4, 23.09],
            '江阴': [120.26, 31.91],
            '蓬莱': [120.75, 37.8],
            '韶关': [113.62, 24.84],
            '嘉峪关': [98.289152, 39.77313],
            '广州': [113.23, 23.16],
            '延安': [109.47, 36.6],
            '太原': [112.53, 37.87],
            '清远': [113.01, 23.7],
            '中山': [113.38, 22.52],
            '昆明': [102.73, 25.04],
            '寿光': [118.73, 36.86],
            '盘锦': [122.070714, 41.119997],
            '长治': [113.08, 36.18],
            '深圳': [114.07, 22.62],
            '珠海': [113.52, 22.3],
            '宿迁': [118.3, 33.96],
            '咸阳': [108.72, 34.36],
            '铜川': [109.11, 35.09],
            '平度': [119.97, 36.77],
            '佛山': [113.11, 23.05],
            '海口': [110.35, 20.02],
            '江门': [113.06, 22.61],
            '章丘': [117.53, 36.72],
            '肇庆': [112.44, 23.05],
            '大连': [121.62, 38.92],
            '临汾': [111.5, 36.08],
            '吴江': [120.63, 31.16],
            '石嘴山': [106.39, 39.04],
            '沈阳': [123.38, 41.8],
            '苏州': [120.62, 31.32],
            '茂名': [110.88, 21.68],
            '嘉兴': [120.76, 30.77],
            '长春': [125.35, 43.88],
            '胶州': [120.03336, 36.264622],
            '银川': [106.27, 38.47],
            '张家港': [120.555821, 31.875428],
            '三门峡': [111.19, 34.76],
            '锦州': [121.15, 41.13],
            '南昌': [115.89, 28.68],
            '柳州': [109.4, 24.33],
            '三亚': [109.511909, 18.252847],
            '自贡': [104.778442, 29.33903],
            '吉林': [126.57, 43.87],
            '阳江': [111.95, 21.85],
            '泸州': [105.39, 28.91],
            '西宁': [101.74, 36.56],
            '宜宾': [104.56, 29.77],
            '呼和浩特': [111.65, 40.82],
            '成都': [104.06, 30.67],
            '大同': [113.3, 40.12],
            '镇江': [119.44, 32.2],
            '桂林': [110.28, 25.29],
            '张家界': [110.479191, 29.117096],
            '宜兴': [119.82, 31.36],
            '北海': [109.12, 21.49],
            '西安': [108.95, 34.27],
            '金坛': [119.56, 31.74],
            '东营': [118.49, 37.46],
            '牡丹江': [129.58, 44.6],
            '遵义': [106.9, 27.7],
            '绍兴': [120.58, 30.01],
            '扬州': [119.42, 32.39],
            '常州': [119.95, 31.79],
            '潍坊': [119.1, 36.62],
            '重庆': [106.54, 29.59],
            '台州': [121.420757, 28.656386],
            '南京': [118.78, 32.04],
            '滨州': [118.03, 37.36],
            '贵阳': [106.71, 26.57],
            '无锡': [120.29, 31.59],
            '本溪': [123.73, 41.3],
            '克拉玛依': [84.77, 45.59],

            "Amsterdam": [4.895168, 52.370216],
            "Athens": [-83.357567, 33.951935],
            "Auckland": [174.763332, -36.84846],
            "Bangkok": [100.501765, 13.756331],
            "Barcelona": [2.173403, 41.385064],
            "Beijing": [116.407395, 39.904211],
            "Berlin": [13.404954, 52.520007],
            "Bogotá": [-74.072092, 4.710989],
            "Bratislava": [17.107748, 48.148596],
            "Brussels": [4.35171, 50.85034],
            "Budapest": [19.040235, 47.497912],
            "Buenos Aires": [-58.381559, -34.603684],
            "Bucharest": [26.102538, 44.426767],
            "Caracas": [-66.903606, 10.480594],
            "Chicago": [-87.629798, 41.878114],
            "Delhi": [77.209021, 28.613939],
            "Doha": [51.53104, 25.285447],
            "Dubai": [55.270783, 25.204849],
            "Dublin": [-6.26031, 53.349805],
            "Frankfurt": [8.682127, 50.110922],
            "Geneva": [6.143158, 46.204391],
            "Helsinki": [24.938379, 60.169856],
            "Hong Kong": [114.109497, 22.396428],
            "Istanbul": [28.978359, 41.008238],
            "Jakarta": [106.845599, -6.208763],
            "Johannesburg": [28.047305, -26.204103],
            "Cairo": [31.235712, 30.04442],
            "Kiev": [30.5234, 50.4501],
            "Copenhagen": [12.568337, 55.676097],
            "Kuala Lumpur": [101.686855, 3.139003],
            "Lima": [-77.042793, -12.046374],
            "Lisbon": [-9.139337, 38.722252],
            "Ljubljana": [14.505751, 46.056947],
            "London": [-0.127758, 51.507351],
            "Los Angeles": [-118.243685, 34.052234],
            "Luxembourg": [6.129583, 49.815273],

            '渭南': [109.5, 34.52],
            '马鞍山': [118.48, 31.56],
            '宝鸡': [107.15, 34.38],
            '焦作': [113.21, 35.24],
            '句容': [119.16, 31.95],
            '北京': [116.46, 39.92],
            '徐州': [117.2, 34.26],
            '衡水': [115.72, 37.72],
            '包头': [110, 40.58],
            '绵阳': [104.73, 31.48],
            '乌鲁木齐': [87.68, 43.77],
            '枣庄': [117.57, 34.86],
            '杭州': [120.19, 30.26],
            '淄博': [118.05, 36.78],
            '鞍山': [122.85, 41.12],
            '溧阳': [119.48, 31.43],
            '库尔勒': [86.06, 41.68],
            '安阳': [114.35, 36.1],
            '开封': [114.35, 34.79],
            '济南': [117, 36.65],
            '德阳': [104.37, 31.13],
            '温州': [120.65, 28.01],
            '九江': [115.97, 29.71],
            '邯郸': [114.47, 36.6],
            '临安': [119.72, 30.23],
            '兰州': [103.73, 36.03],
            '沧州': [116.83, 38.33],
            '临沂': [118.35, 35.05],
            '南充': [106.110698, 30.837793],
            '天津': [117.2, 39.13],
            '富阳': [119.95, 30.07],
            '泰安': [117.13, 36.18],
            '诸暨': [120.23, 29.71],
            '郑州': [113.65, 34.76],
            '哈尔滨': [126.63, 45.75],
            '聊城': [115.97, 36.45],
            '芜湖': [118.38, 31.33],
            '唐山': [118.02, 39.63],
            '平顶山': [113.29, 33.75],
            '邢台': [114.48, 37.05],
            '德州': [116.29, 37.45],
            '济宁': [116.59, 35.38],
            '荆州': [112.239741, 30.335165],
            '宜昌': [111.3, 30.7],
            '义乌': [120.06, 29.32],
            '丽水': [119.92, 28.45],
            '洛阳': [112.44, 34.7],
            '秦皇岛': [119.57, 39.95],
            '株洲': [113.16, 27.83],
            '石家庄': [114.48, 38.03],
            '莱芜': [117.67, 36.19],
            '常德': [111.69, 29.05],
            '保定': [115.48, 38.85],
            '湘潭': [112.91, 27.87],
            '金华': [119.64, 29.12],
            '岳阳': [113.09, 29.37],
            '长沙': [113, 28.21],
            '衢州': [118.88, 28.97],
            '廊坊': [116.7, 39.53],
            '菏泽': [115.480656, 35.23375],
            '合肥': [117.27, 31.86],
            '武汉': [114.31, 30.52],
            '大庆': [125.03, 46.58],
            '黄岩岛': [130, 22],
            
            "Lyon": [4.835659, 45.764043],
            "Madrid": [-3.70379, 40.416775],
            "Milan": [9.185924, 45.465422],
            "Manama": [50.58605, 26.228516],
            "Manila": [120.984219, 14.599512],
            "Mexico City": [-99.133208, 19.432608],
            "Miami": [-80.19179, 25.76168],
            "Montreal": [-73.567256, 45.501689],
            "Moscow": [37.6173, 55.755826],
            "Mumbai": [72.877656, 19.075984],
            "Munich": [11.581981, 48.135125],
            "Nairobi": [36.821946, -1.292066],
            "New York": [-74.005941, 40.712784],
            "Nicosia": [33.382276, 35.185566],
            "Oslo": [10.752245, 59.913869],
            "Paris": [2.352222, 48.856614],
            "Prague": [14.4378, 50.075538],
            "Riga": [24.105186, 56.949649],
            "Rio de Janeiro": [-43.172896, -22.906847],
            "Rome": [12.496366, 41.902783],
            "Santiago de Chile": [-70.669265, -33.44889],
            "São Paulo": [-46.633309, -23.55052],
            "Seoul": [126.977969, 37.566535],
            "Shanghai": [121.473701, 31.230416],
            "Singapore": [103.819836, 1.352083],
            "Sofia": [23.321868, 42.697708],
            "Stockholm": [18.068581, 59.329323],
            "Sydney": [151.209296, -33.86882],
            "Taipei": [121.565418, 25.032969],
            "Tallinn": [24.753575, 59.436961],
            "Tel Aviv": [34.781768, 32.0853],
            "Tokyo": [139.691706, 35.689487],
            "Toronto": [-79.383184, 43.653226],
            "Vilnius": [25.279651, 54.687156],
            "Warsaw": [21.012229, 52.229676],
            "Vienna": [16.373819, 48.208174],
            "Zurich": [8.541694, 47.376887]
        };

        function findHrefbyName(view, name) {
            for (var i = view.length - 1; i >= 0; i--) {
                if (view[i].name == name) return view[i].href;
            }
            return false;
        }
        var convertData = function(data, prop, site) {
            var res = [];
            for (var i = 0; i < data.length; i++) {
                var geoCoord = geoCoordMap[data[i].name];
                if (geoCoord) {
                    res.push({
                        name: data[i].name + site,
                        value: geoCoord.concat(data[i][prop]),
                        data: data[i],
                    });
                }
            }
            return res;
        };

        var convertDataLine = function(data) {
            var res = [];
            for (var i = 0; i < data.length; i++) {
                var dataItem = data[i];
                var fromCoord = geoCoordMap[dataItem[0].name];
                var toCoord = geoCoordMap[dataItem[1].name];
                if (fromCoord && toCoord) {
                    res.push({
                        fromName: dataItem[0].name,
                        toName: dataItem[1].name,
                        coords: [fromCoord, toCoord]
                    });
                }
            }
            return res;
        };

        function generateData(geoCoordMap, valueType) {
            data = [];
            for (var j = Object.getOwnPropertyNames(geoCoordMap).length - 1; j >= 0; j--) {
                var threshold = Math.random() * 100;
                if (threshold > 85) {
                    var dataBuf = {};
                    dataBuf['name'] = Object.getOwnPropertyNames(geoCoordMap)[j];
                    for (var i = valueType.length - 1; i >= 0; i--) {
                        dataBuf[valueType[i]] = Math.random() * 300;
                    }
                    data.push(dataBuf);
                }
            }
            for (var i = data.length - 1; i >= 0; i--) {
                data[i]['综合'] = 0;
                for (var j = 1; j < Object.getOwnPropertyNames(data[i]).length - 1; j++) {
                    data[i]['综合'] += data[i][Object.getOwnPropertyNames(data[i])[j]];
                }
                data[i]['综合'] = data[i]['综合'] / (j - 1);
            }
            return data;
        }

        function drawCandidateOption(data, prop, site, color) {
            dataseries = {
                name: '厂商',
                type: 'scatter',
                coordinateSystem: 'geo',
                data: convertData(data, prop, site),
                symbolSize: function(val) {
                    return val[2] / 10;
                },
                label: {
                    normal: {
                        formatter: '{b}',
                        show: false
                    },
                    emphasis: {
                        show: true
                    }
                },
                itemStyle: {
                    normal: {
                        color: color,
                        opacity: 0.8,
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowOffsetY: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }
            return dataseries;
        }

        function drawBestOption(data, prop, site, num, color) {
            return {
                name: 'Top ' + num,
                type: 'effectScatter',
                coordinateSystem: 'geo',
                data: convertData(data.sort(function(a, b) {
                    return b[prop] - a[prop];
                }).slice(0, num), prop, site),
                symbolSize: function(val) {
                    return val[2] / 10;
                },
                // showEffectOn: 'render',
                rippleEffect: {
                    brushType: 'stroke'
                },
                hoverAnimation: true,
                label: {
                    normal: {
                        formatter: '{b}',
                        // position: 'right',
                        show: true,
                    }
                },
                itemStyle: {
                    normal: {
                        color: color,
                        // shadowBlur: 10,
                        // shadowColor: '#333'
                    }
                },
                zlevel: 2
            }
        }

        function lighterColor(color, level) {
            var colorReg = color.match(/\w+/)[0];
            var r = Math.round((parseInt(colorReg.slice(0, 2), 16) * (1 + level) <= 255) ? parseInt(colorReg.slice(0, 2), 16) * (1 + level) : 255).toString(16);
            var g = Math.round((parseInt(colorReg.slice(2, 4), 16) * (1 + level) <= 255) ? parseInt(colorReg.slice(2, 4), 16) * (1 + level) : 255).toString(16);
            var b = Math.round((parseInt(colorReg.slice(4, 6), 16) * (1 + level) <= 255) ? parseInt(colorReg.slice(4, 6), 16) * (1 + level) : 255).toString(16);
            return '#' + r + g + b;
        }
        myChart.setOption({
                backgroundColor: '#404a59',
                animationDuration: 1000,
                animationEasingUpdate: 'quinticInOut',
                tooltip: {
                    // trigger: 'item',
                    formatter: function(obj) {
                        if (obj.componentSubType == "lines") {} else {
                            var data = obj.data.data;
                            var res = '<div style="border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px">' + obj.name + '</div>';
                            for (var i = Object.getOwnPropertyNames(data).length - 1; i >= 1; i--) {
                                var reg = data.name
                                var buf = obj.name.replace(reg,'');
                                var num = indexOfSmartChainDataSort(smartChainDataSort, data.name, Object.getOwnPropertyNames(data)[i], buf);
                                res += Object.getOwnPropertyNames(data)[i] + '：' + Math.ceil(data[Object.getOwnPropertyNames(data)[i]]) + ' 排名' + num.sort + '/' + num.total + '<br>';
                            }
                            return res;
                        }

                    }
                },
                geo: {
                    map: 'world',
                    label: {
                        emphasis: {
                            show: false
                        }
                    },
                    roam: true,
                    itemStyle: {
                        normal: {
                            areaColor: '#e0d35d',
                            borderColor: '#111'
                        },
                        emphasis: {
                            areaColor: '#F0E46e'
                        }
                    }
                }
        })

        function generateSeries(title, subtitle, data, datacolor, prop, policy) {
            datacolorlighter = lighterColor(datacolor, 0.2);
            switch (policy) {
                case 0:
                    {
                        return {
                            title: {
                                text: title,
                                subtext: subtitle,
                                left: 'center',
                                textStyle: {
                                    color: '#fff'
                                }
                            }
                        }
                    }
                case 1:
                    return datacandidate = drawCandidateOption(data, prop, title, datacolor);
                case 2:
                    return databest = drawBestOption(data, prop, title, 1, datacolorlighter);;
            }
        };

        function randomColor(smartChainColor) {
            var r = ((buf = (Math.floor(Math.random() * 255))) <= 16) ? '0' + buf.toString(16) : buf.toString(16);
            var g = ((buf = (Math.floor(Math.random() * 255))) <= 16) ? '0' + buf.toString(16) : buf.toString(16);
            var b = ((buf = (Math.floor(Math.random() * 255))) <= 16) ? '0' + buf.toString(16) : buf.toString(16);
            var a = '#' + r + g + b;
            // for (var i = smartChainColor.length - 1; i >= 0; i--) {
            //     if (smartChainColor[i] == a) return randomColor(smartChainColor);
            // }
            return a;
        }

        function randomData(smartChainData) {
            var data = generateData(geoCoordMap, propOfGoods);
            // for (var i = smartChainData.length - 1; i >= 0; i--) {
            //     if (smartChainData[i] === data) return randomData(smartChainData)
            // }
            return data;
        }

        function generateOption(series) {
            return {
                series: series
            }
        }

        function indexOfSmartChainDataSort(smartChainDataSort, name, prop, title) {
            var buf = smartChainDataSort[prop][title];
            for (var i = 0; i <= buf.length; i++) {
                if (buf[i].name == name) {
                    return {
                        'sort': i + 1,
                        total: buf.length
                    };
                }
            }
            return {
                'sort': -1,
                total: buf.length
            };
        }
        // 使用刚指定的配置项和数据显示图表。
        var smartChainTitle = [];
        var smartChainCandidates = [];
        var smartChainBest = [];
        var smartChainBestCity;
        for (var i = 0; i < smartChainNodes.length; i++) {
            if (isDataEmpty) {
                color = randomColor(smartChainColor);
                data = randomData(smartChainData);
                smartChainColor.push(color);
                smartChainData.push(data);
            }
            smartChainTitle.push(generateSeries(smartChainNodes[i], '数据由可信智能供应链提供', smartChainData[i], smartChainColor[i], method, 0));
            smartChainCandidates.push(generateSeries(smartChainNodes[i], '数据由可信智能供应链提供', smartChainData[i], smartChainColor[i], method, 1));
            smartChainBest.push(generateSeries(smartChainNodes[i], '数据由可信智能供应链提供', smartChainData[i], smartChainColor[i], method, 2));
        }
        propOfGoods1 = propOfGoods.slice(0);
        propOfGoods1.push('综合');
        for (var i = propOfGoods1.length - 1; i >= 0; i--) {
            smartChainDataSort[propOfGoods1[i]] = {};
            for (var j = 0; j < smartChainData.length; j++) {
                var buf = smartChainData[j].slice(0);
                smartChainDataSort[propOfGoods1[i]][smartChainNodes[j]] = buf.sort(function(a, b) {
                    return b[propOfGoods1[i]] - a[propOfGoods1[i]];
                });
            }
        }

        isDataEmpty = false;
        var modalBody = '';
        for (var i = smartChainBest.length - 1; i >= 0; i--) {
            modalBody += '<p>' + smartChainTitle[i].title.text + '：' + smartChainBest[i].data[0].name + '</p>';
        }
        modalBody += '<p>物流：顺丰物流</p><p>动态成交价：210,000￥</p>';
        $('#myModal').find('.modal-body')[0].innerHTML = modalBody;
        var scc = [smartChainCandidates[0]];
        var scb = [smartChainCandidates[0], smartChainBest[0]];
        var i = 0;
        var animationFunction = [];

        function animationSmartChain(smartChainTitle, smartChainCandidates, smartChainBest, scc, scb, i) {
            if (i < smartChainNodes.length * 2) {
                if (i % 2 == 0) {
                    myChart.setOption(smartChainTitle[Math.floor(i / 2)]);
                    myChart.setOption(generateOption(scc));
                    animationFunction.push(setTimeout(function() {
                        animationSmartChain(smartChainTitle, smartChainCandidates, smartChainBest, scc, scb, i + 1)
                    }, 1000));
                } else if (i == smartChainNodes.length * 2 - 1) {
                    var buf = generateSeriesLine(smartChainBestCity, '#a6c84c');
                    // var buf = [];
                    for (var i = smartChainBest.length - 1; i >= 0; i--) {
                        buf.push(smartChainBest[i]);
                    }
                    myChart.setOption(generateOption(buf));
                    $('#ok').removeClass('disabled');
                } else {
                    myChart.setOption(generateOption(scb));
                    scc.push(smartChainBest[Math.floor(i / 2)]);
                    scc[0] = smartChainCandidates[Math.floor(i / 2) + 1];
                    scb.push(smartChainBest[Math.floor(i / 2) + 1]);
                    scb[0] = smartChainCandidates[Math.floor(i / 2) + 1];
                    animationFunction.push(setTimeout(function() {
                        animationSmartChain(smartChainTitle, smartChainCandidates, smartChainBest, scc, scb, i + 1)
                    }, 1000));
                }
            }
        }

        function getBestLine(smartChainBest, smartChainNodes, smartChainLines) {
            for (var i = smartChainNodes.length - 1; i >= 0; i--) {
                var reg = eval('/.*?(?=' + smartChainNodes[i] + '+)/');
                var buf = smartChainBest[i].data[0].name.match(reg)[0];
                for (var j = smartChainLines.length - 1; j >= 0; j--) {
                    if (smartChainLines[j][0].name == smartChainNodes[i]) smartChainLines[j][0].name = buf;
                    if (smartChainLines[j][1].name == smartChainNodes[i]) smartChainLines[j][1].name = buf;
                }
            }
            return smartChainLines;
        }
        smartChainBestCity = getBestLine(smartChainBest, smartChainNodes, smartChainLines);

        function generateSeriesLine(data, color) {
            var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';
            var seriesLine = [{
                name: '',
                type: 'lines',
                zlevel: 1,
                effect: {
                    show: false,
                    period: 6,
                    trailLength: 0.7,
                    color: '#000000',
                    symbolSize: 3
                },
                lineStyle: {
                    normal: {
                        color: color,
                        width: 0,
                        curveness: 0.2
                    }
                },
                data: convertDataLine(data)
            }, {
                name: '',
                type: 'lines',
                zlevel: 2,
                effect: {
                    show: true,
                    period: 6,
                    trailLength: 0,
                    symbol: planePath,
                    symbolSize: 30
                },
                lineStyle: {
                    normal: {
                        color: color,
                        width: 1,
                        opacity: 0.4,
                        curveness: 0.2
                    }
                },
                data: convertDataLine(data)
            }]
            return seriesLine;
        }
        animationSmartChain(smartChainTitle, smartChainCandidates, smartChainBest, scc, scb, i);
        return animationFunction;
    }
    var animationFunction = [];
    animationFunction = draw('综合');

    $('button').click(function(event) {
        /* Act on the event */
        if (this.getAttribute('data-method')) {
            for (var i = animationFunction.length - 1; i >= 0; i--) {
                clearTimeout(animationFunction[i]);
            }
            myChart.clear();
            draw(this.getAttribute('data-method'));
        }
    });

    $('#ok').click(function(event) {
        /* Act on the event */
        if (!$(this).hasClass('disabled')) {
            $('#myModal').modal('show');
        }
    });


    myChart.on('click', function(params) {
        if (params.componentType === 'markPoint') {
            // 点击到了 markPoint 上
            if (params.seriesIndex === 5) {
                // 点击到了 index 为 5 的 series 的 markPoint 上。
            }
        } else if (params.componentType === 'series') {
            // if (params.seriesType === 'graph') {
            //     if (params.dataType === 'edge') {
            //         // 点击到了 graph 的 edge（边）上。

            //     } else {
            //         // 点击到了 graph 的 node（节点）上。
            //         href = findHrefbyName(view, params.name);
            //         if (href) {
            //             window.location.href = href;
            //         }
            //     }
            // }
            if (params.seriesType === 'effectScatter') {
                for (var i = Object.getOwnPropertyNames(view[0].href).length - 1; i >= 0; i--) {
                    var reg = eval('/.*?(?=' + Object.getOwnPropertyNames(view[0].href)[i] + '+)/');
                    if (params.name.match(reg)) {
                        if (view[0].href[Object.getOwnPropertyNames(view[0].href)[i]] != '') {
                            window.open(view[0].href[Object.getOwnPropertyNames(view[0].href)[i]]);
                        }
                    }
                }
            }
        }

    });
});
</script>

<body>
    <div style="position:absolute;z-index:1000;padding:20px;display: none">
        <button class='button button-small button-rounded button-3d' style='display: block;' data-method='时间'>最短时间</button>
        <br>
        <button class='button button-small button-rounded button-3d' style='display: block;' data-method='价格'>最低价格</button>
        <br>
        <button class='button button-small button-rounded button-3d' style='display: block;' data-method='质量'>最高质量</button>
        <br>
        <button class='button button-small button-rounded button-3d' style='display: block;' data-method='销量'>最多销量</button>
        <br>
        <button class='button button-small button-rounded button-3d' style='display: block;' data-method='信用'>最佳信用</button>
        <br>
        <button class='button button-small button-rounded button-3d' style='display: block;' data-method='综合'>综合最优</button>
        <br>
        <button class='button button-small button-rounded button-3d button-action disabled' style='display: block;' id='ok'>确认订单</button>
        <div class="modal fade" id='myModal'>
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">订单信息</h4>
                    </div>
                    <div class="modal-body" style="text-align:center;">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary">继续购物</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="row">
                    <div id="test-main" style="width: 100%;height: 100%;"></div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
